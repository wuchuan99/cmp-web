window.TILE_VERSION={"ditu":{"normal":{"version":"088","updateDate":"20221031"},"satellite":{"version":"009","updateDate":"20221031"},"normalTraffic":{"version":"081","updateDate":"20221031"},"satelliteTraffic":{"version":"083","updateDate":"20221031"},"mapJS":{"version":"104","updateDate":"20221031"},"satelliteStreet":{"version":"083","updateDate":"20221031"},"earthVector":{"version":"001","updateDate":"20221031"}},"webapp":{"high_normal":{"version":"001","updateDate":"20221031"},"lower_normal":{"version":"002","updateDate":"20221031"}},"api_for_mobile":{"vector":{"version":"002","updateDate":"20221031"},"vectorIcon":{"version":"002","updateDate":"20221031"}}};window.MSV={"mapstyle":{"version":"001","updateDate":"20220923"}};window.BMAP_AUTHENTIC_KEY="fbQG26Gy2U2zhNqzRypfIyDMj2cFrTzS";
(function(t){"use strict";function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t,e){return t(e={exports:{}},e.exports),e.exports}Object.values||(Object.values=function(t){if(t!==Object(t))throw new TypeError("Object.values called on a non-object");var e,n=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.push(t[e]);return n}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=0;n<(arguments.length<=1?0:arguments.length-1);n++){var r=n+1<1||arguments.length<=n+1?void 0:arguments[n+1];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},writable:!0,configurable:!0});var r=n((function(t){function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports})),i=e(r),o=e(n((function(t){function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports}))),a=e(n((function(t){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports}))),s=n((function(t){function e(n,r){return t.exports=e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n,r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}));e(s);var u,h,c=e(n((function(t){t.exports=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,s(t,e)},t.exports.__esModule=!0,t.exports.default=t.exports}))),l=function(t,e){var n=this;this.width=void 0,this.height=void 0,this.equals=function(t){return t&&n.width===t.width&&n.height===t.height},this.width=t||0,this.height=e||0},f=function(){function t(t,e){this.lng=void 0,this.lat=void 0,this.lng=+t,this.lat=+e}return t.prototype.equals=function(t){return t&&this.lat===t.lat&&this.lng===t.lng},t}(),d={REFRESH:"refresh",DATA_LOADED:"dataload",THUMB_LOADED:"thumb_loaded",SET_POV:"set_pov",POV_CHANGED:"pov_changed",POV_CHANGED_END:"pov_changed_end",ZOOM_CHANGED:"zoom_changed",SIZE_CHANGED:"size_changed",SET_ID:"set_id",SET_POSITION:"set_position",ID_CHANGED:"id_changed",POSITION_CHANGED:"position_changed",TOUCH_START:"touchstart",TOUCH_END:"touchend",CLICK:"click",DOUBLE_CLICK:"dblclick",LINK_CLICK:"link_click",OVERLAY_ADD:"overlay_add",OVERLAY_REMOVE:"overlay_remove",OVERLAYS_CLEAR:"overlays_clear",PANO_ERROR:"pano_error",LINK_VISIBLE_CHANGE:"links_visible_changed",DESTROY:"destroy",SCENE_CHANGE_END:"scene_change_end"},p={TYPE_INNER:"inter",TYPE_STREET:"street",RADIUS:3e3,COLS:16,ROWS:8,TILE_MAX_ZOOM:4,TILE_MIN_ZOOM:1,MIN_PITCH:-90,MAX_PITCH:90,MAX_ZOOM:4,MIN_ZOOM:1,TILE_BASE_URLS:["//apisv0.bdimg.com/","//apisv1.bdimg.com/"],TOPO_ARROW_TEXTURE:"//webmap0.bdimg.com/wolfman/static/pano/images/webgl/topo_arrow_06f0f2e.png",FISHEYE_DURATION:1500,FISHEYE_DELAY:2e3},v=(u={},h=(navigator.userAgent||"").toLowerCase(),u.isAndroid=h.includes("android"),u.isFirefox=h.includes("firefox"),u.isIos=/ip(hone|ad|od)/i.test(h),u.isWeixin=h.includes("micromessenger"),u.isWeibo=h.includes("weibo"),u.isWeChatOrWeiBo=u.isWeixin&&u.isWeibo,u.isBaiduMap=h.includes("baidumap_"),u.isMobile=/android|webos|ip(hone|ad|od)|opera (mini|mobi|tablet)|iemobile|windows.+(phone|touch)|mobile|fennec|kindle (Fire)|Silk|maemo|blackberry|playbook; (touch|kbd)|Symbian(OS)|Ubuntu Touch/i.test(h),u.isPc=!u.isMobile,u),m=function(t){for(var e=arguments.length<=1?0:arguments.length-1,n=0;n<e;n++){var r=n+1<1||arguments.length<=n+1?void 0:arguments[n+1];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},g=function(t){return t*Math.PI/180},y=function(t){return 180*t/Math.PI},_=function(t){return t-360*Math.floor(t/360)},x=function(){return Date.now()};var b=function t(){var e=t;if("boolean"==typeof e._supportWebGL)return e._supportWebGL;if(!window.WebGLRenderingContext)return e._supportWebGL=!1,!1;var n=null,r=document.createElement("canvas");try{(n=r.getContext("webgl")||r.getContext("experimental-webgl"))&&n instanceof WebGLRenderingContext&&(e._supportWebGL=!0)}catch(t){e._supportWebGL=!1}return null===n&&(e._supportWebGL=!1),e._supportWebGL},M=function(t){for(var e,n=Number.MAX_VALUE,r=-Number.MAX_VALUE,i=t.length-1;i>=0;i--)n>(e=t[i])&&(n=e),r<e&&(r=e);return{min:n,max:r}},w={g:function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1===t.nodeType||9===t.nodeType)?t:null},show:function(t){var e=w.g(t);return e&&(e.style.display=""),e},hide:function(t){var e=w.g(t);return e&&(e.style.display="none"),t},create:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=document.createElement(t);for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.setAttribute(r,e[r]);return n},getCurrentStyle:function(t){return window.getComputedStyle(t,null)}};function E(){var t,e,n=function(t,e){var n,r,i="eii",o="dac",a="hem",s="llm",u=function(t,e){return t+e},h="constructor",c=function(t,e){return t(e)},l=function(t,e){return t+e};function f(t,e){for(var n=i;"mill"!==n;)switch(n){case"llm":return c;case"eii":var r=t.length;n=o;break;case a:for(var u=0;u<r;u++){var h=e(t[u]);c.push(h)}n=s;break;case"dac":var c=[];n=a}}var d=decodeURIComponent;b="de",r=l("fr","o")+"m",n=l("Co",b);var p=function(t){return u(t,"")[h][u(r,"Char")+n](t)},v=function(t){return f(t,(function(t){return c(p,t)}))},m=v.call(p,[39,34,37,96,60,120,97,65,98,66,99,67,100,68,101,69,102,70,103,110,109,111,112,48,49,50,51,52,53,54,55,56,57]),g=f([28782,27702,26416,25167,24183],(function(t){return c(d,t)})),y=v.call(g,[22354,22749,24415,23346,22257,22688,24306,25174,23595,25547,22984,25690,22212,27547,21594,27210,23090,29193,22394,29368,29532,29459,29530,24146,24500,26352,27441,28788,29370,27673,26925,25249,24430]),_={};g=c(v,g);for(var x=new RegExp(g.join("|")),b=0;b<m.length;b++)_[y[b]]=m[b];return e=f(e.split(""),(function(t){return _[t]||t})).join(""),f(e.split(x),(function(t){return d(t)}))}(0,"su尫stri犸坺幷囄獜呚囄獜扏su尫str氶h廲廲呚l灮i犸囄呚墠O娲氶呚呚廲廲廲朰墠h姈i囄朰彟曰氙si坺犸彟欱殛");t=n,e=265,function(e){for(;--e;)t.push(t.shift())}(++e);var r=function(t,e){return n[t-=0]};return function(t){var e={dmedm:"F5L2O6R6AD8990O",haael:function(t,e){return t+e},eeaaa:function(t,e){return t(e)},xhcid:function(t,e){return t+e},deiic:function(t,e){return t-e}},n=e[r("0x0")],i=t[r("0x1")](e[r("0x2")](t[r("0x3")]("?"),1)),o=e[r("0x4")](md5,e[r("0x5")](md5(i+n),"H0A9P8P7Y6ABQO0"));return r("0x6")+o[r("0x7")](e.deiic(o.length,12))}}var T=function(t,e,n){var r,o,a="",s=[],u="jsonp"+Math.ceil(1e5*Math.random()),h=t.indexOf("?")>0?"&":"?";for(var c in n=Object.assign({},{jsonpCallback:"jsonp",timeout:5e4,jsonp:"callback"},n),e)({}).hasOwnProperty.call(e,c)&&(a="object"===i(e[c])?c+"="+JSON.stringify(e[c]):c+"="+e[c],s.push(a));function l(){r.parentNode&&r.parentNode.removeChild(r),window[u]=null}return t+=h+s.join("&"),o=document.getElementsByTagName("script")[0]||document.head,t=t+"&"+n.jsonp+"="+u,t+=E()(t),(r=document.createElement("script")).src=t,r.type="text/javascript",o.parentNode.appendChild(r,o),new Promise((function(t,e){window[u]=function(e){if(e&&"string"==typeof e)try{e=JSON.parse(e)}catch(t){e={},console.error("[ERROR] Parse Error.")}t(e),l()},r.onerror=function(t){l(),e({errno:-2,errmsg:"[ERROR] Load Error: ".concat(t),data:{}})}}))},A=function(){function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._size=0,this._cache=void 0,this.keyList=[],this._options=void 0,this._size=t,this._cache=new window.Map;var n={clearCallback:null};this._options=Object.assign({},n,e)}var e=t.prototype;return e.setData=function(t,e){0!==this._size&&(this._cache.size>=this._size&&this._removeOld(),this._cache.has(t)||this.keyList.push(t),this._cache.set(t,e))},e.getData=function(t){return this._cache.get(t)},e._removeOld=function(){for(var t=Math.round(.6*this._size),e=0;e<t;e++){var n=this.keyList[e];this._options.clearCallback&&this._options.clearCallback(this.getData(n)),this._cache.delete(n)}this.keyList.splice(0,t)},e.clear=function(){this._cache.clear(),this.keyList=[]},o(t,[{key:"cacheCount",get:function(){return this._cache.size}}]),t}(),C=function(){function t(){var t=this;this.rid="",this.roadName="",this.roadWidth=5,this.isCurrentRoad=0,this.pointList=[],this.getTopoInRoad=function(e){var n=[],r=t.pointList,i=r.length,o=t.getPointByPanoId(e);if(!o||i<=1)return n;var a=o.order;return 0===a?n.push(t.generateTopoData(o.dir,r[1])):a===i-1?n.push(t.generateTopoData(r[a-1].dir+180,r[a-1])):(n.push(t.generateTopoData((r[a-1].dir+180)%360,r[a-1])),n.push(t.generateTopoData(r[a].dir,r[a+1]))),n},this.getPointByPanoId=function(e){for(var n,r=t.pointList,i=0,o=r.length;i<o;i++)if(r[i].panoId===e){n=r[i];break}return n}}return t.prototype.generateTopoData=function(t,e){return void 0!==e&&(e.topoDir=t,e.roadName=this.roadName),e},t}(),R=function(){var t=this;this.image=void 0,this.panoId="",this.iid="",this.panoType="",this.panoX=0,this.panoY=0,this.panoZ=0,this.heading=0,this.pitch=0,this.defaultHeading=void 0,this.defaultPitch=void 0,this.northDir=0,this.fixHeading=0,this.fixPitch=0,this.fixRoll=0,this.deviceHeight=0,this.date="20130822",this.time="",this.provider=1,this.admission="GS(2013)6021",this.photos=[],this.roadName="",this.roads=[],this.vpoints=[],this.topoArray=void 0,this.currentRoad=void 0,this.roadWidth=void 0,this.getCurrentRoad=function(){if(t.currentRoad)return t.currentRoad;for(var e=t.roads,n=0,r=e.length;n<r;n++)if(e[n].isCurrentRoad){t.currentRoad=e[n];break}return t.currentRoad},this.getTopos=function(){if(t.topoArray)return t.topoArray;if(t.currentRoad||(t.currentRoad=t.getCurrentRoad()),!t.currentRoad)return[];if(t.topoArray=t.currentRoad.getTopoInRoad(t.panoId),t.vpoints.length<1)return t.topoArray;for(var e,n=t.vpoints.length-1;n>=0;n--)(e=t.vpoints[n]).topoDir=e.dir,t.topoArray.push(e);return t.topoArray},this.getRoadWidth=function(){return void 0===t.roadWidth&&(t.currentRoad||(t.currentRoad=t.getCurrentRoad()),t.currentRoad?t.roadWidth=t.currentRoad.roadWidth:t.roadWidth=0),t.roadWidth}};function S(t){var e={};return e.panoId=t.PID,e.panoType=t.Type,e.rid=t.RID,e.dir=t.DIR,e.roadName=t.RoadName,e.order=t.Order,e.panoX=t.X/100,e.panoY=t.Y/100,void 0!==t.CPointX&&void 0!==t.CPointY&&(e.cPoint={x:t.CPointX/100,y:t.CPointY/100}),e}function P(t){if(!t)return console.error("Get none from server"),null;var e=t.result;if(e&&0!==e.error)return console.error("Get error from server"),null;var n=t.content;if(void 0===n||0===n.length||void 0===n[0])return console.error("Get empty data from server"),null;var r=n[0],i=new R,o=r.Roll,a={};if(i.panoId=r.ID,r.Inters instanceof Array){var s=r.Inters[0];void 0!==s&&(i.iid=s.IID)}if(i.panoType=r.Type,i.panoX=(r.X||0)/100,i.panoY=(r.Y||0)/100,i.panoZ=(r.Z||0)/100,i.heading=void 0!==r.MoveDir?r.MoveDir:0,i.northDir=r.NorthDir,i.fixHeading=void 0!==r.Heading?r.Heading:270-r.NorthDir,i.fixPitch=r.Pitch,i.fixRoll=90<o||-90>o?0:o,i.deviceHeight=r.DeviceHeight,i.date=r.Date||i.date,i.time=r.Time,i.provider=void 0!==r.Provider?r.Provider:i.provider,i.admission=r.Admission||i.admission,i.timeLine=r.TimeLine||[],i.roadName=r.Rname,r.Roads){var u=r.Roads;i.roads=u.map((function(t){return a[t.ID]=t.Name,function(t){var e=new C;if(e.rid=t.ID,e.roadName=t.Name,e.roadWidth=void 0!==t.Width?t.Width/100:0,e.isCurrentRoad=t.IsCurrent||0,t.Panos)for(var n=t.Panos,r=0,i=n.length;r<i;r++)e.pointList.push(S(n[r]));return e}(t)}))}if(r.Links)for(var h=r.Links,c=h.length,l=0;l<c;l++){var f=h[l];f.RoadName=a[f.RID],i.vpoints.push(S(f))}return i.photos=r.Photos||[],i}function D(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function O(t,e,n,r,i,o){return D((a=D(D(e,t),D(r,o)))<<(s=i)|a>>>32-s,n);var a,s}function I(t,e,n,r,i,o,a){return O(e&n|~e&r,t,e,i,o,a)}function L(t,e,n,r,i,o,a){return O(e&r|n&~r,t,e,i,o,a)}function B(t,e,n,r,i,o,a){return O(e^n^r,t,e,i,o,a)}function k(t,e,n,r,i,o,a){return O(n^(e|~r),t,e,i,o,a)}function U(t,e){var n,r,i,o,a;t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;var s=1732584193,u=-271733879,h=-1732584194,c=271733878;for(n=0;n<t.length;n+=16)r=s,i=u,o=h,a=c,s=I(s,u,h,c,t[n],7,-680876936),c=I(c,s,u,h,t[n+1],12,-389564586),h=I(h,c,s,u,t[n+2],17,606105819),u=I(u,h,c,s,t[n+3],22,-1044525330),s=I(s,u,h,c,t[n+4],7,-176418897),c=I(c,s,u,h,t[n+5],12,1200080426),h=I(h,c,s,u,t[n+6],17,-1473231341),u=I(u,h,c,s,t[n+7],22,-45705983),s=I(s,u,h,c,t[n+8],7,1770035416),c=I(c,s,u,h,t[n+9],12,-1958414417),h=I(h,c,s,u,t[n+10],17,-42063),u=I(u,h,c,s,t[n+11],22,-1990404162),s=I(s,u,h,c,t[n+12],7,1804603682),c=I(c,s,u,h,t[n+13],12,-40341101),h=I(h,c,s,u,t[n+14],17,-1502002290),s=L(s,u=I(u,h,c,s,t[n+15],22,1236535329),h,c,t[n+1],5,-165796510),c=L(c,s,u,h,t[n+6],9,-1069501632),h=L(h,c,s,u,t[n+11],14,643717713),u=L(u,h,c,s,t[n],20,-373897302),s=L(s,u,h,c,t[n+5],5,-701558691),c=L(c,s,u,h,t[n+10],9,38016083),h=L(h,c,s,u,t[n+15],14,-660478335),u=L(u,h,c,s,t[n+4],20,-405537848),s=L(s,u,h,c,t[n+9],5,568446438),c=L(c,s,u,h,t[n+14],9,-1019803690),h=L(h,c,s,u,t[n+3],14,-187363961),u=L(u,h,c,s,t[n+8],20,1163531501),s=L(s,u,h,c,t[n+13],5,-1444681467),c=L(c,s,u,h,t[n+2],9,-51403784),h=L(h,c,s,u,t[n+7],14,1735328473),s=B(s,u=L(u,h,c,s,t[n+12],20,-1926607734),h,c,t[n+5],4,-378558),c=B(c,s,u,h,t[n+8],11,-2022574463),h=B(h,c,s,u,t[n+11],16,1839030562),u=B(u,h,c,s,t[n+14],23,-35309556),s=B(s,u,h,c,t[n+1],4,-1530992060),c=B(c,s,u,h,t[n+4],11,1272893353),h=B(h,c,s,u,t[n+7],16,-155497632),u=B(u,h,c,s,t[n+10],23,-1094730640),s=B(s,u,h,c,t[n+13],4,681279174),c=B(c,s,u,h,t[n],11,-358537222),h=B(h,c,s,u,t[n+3],16,-722521979),u=B(u,h,c,s,t[n+6],23,76029189),s=B(s,u,h,c,t[n+9],4,-640364487),c=B(c,s,u,h,t[n+12],11,-421815835),h=B(h,c,s,u,t[n+15],16,530742520),s=k(s,u=B(u,h,c,s,t[n+2],23,-995338651),h,c,t[n],6,-198630844),c=k(c,s,u,h,t[n+7],10,1126891415),h=k(h,c,s,u,t[n+14],15,-1416354905),u=k(u,h,c,s,t[n+5],21,-57434055),s=k(s,u,h,c,t[n+12],6,1700485571),c=k(c,s,u,h,t[n+3],10,-1894986606),h=k(h,c,s,u,t[n+10],15,-1051523),u=k(u,h,c,s,t[n+1],21,-2054922799),s=k(s,u,h,c,t[n+8],6,1873313359),c=k(c,s,u,h,t[n+15],10,-30611744),h=k(h,c,s,u,t[n+6],15,-1560198380),u=k(u,h,c,s,t[n+13],21,1309151649),s=k(s,u,h,c,t[n+4],6,-145523070),c=k(c,s,u,h,t[n+11],10,-1120210379),h=k(h,c,s,u,t[n+2],15,718787259),u=k(u,h,c,s,t[n+9],21,-343485551),s=D(s,r),u=D(u,i),h=D(h,o),c=D(c,a);return[s,u,h,c]}function N(t){var e,n="",r=32*t.length;for(e=0;e<r;e+=8)n+=String.fromCharCode(t[e>>5]>>>e%32&255);return n}function F(t){var e,n=[];for(n[(t.length>>2)-1]=void 0,e=0;e<n.length;e+=1)n[e]=0;var r=8*t.length;for(e=0;e<r;e+=8)n[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return n}function j(t){var e,n,r="0123456789abcdef",i="";for(n=0;n<t.length;n+=1)e=t.charCodeAt(n),i+=r.charAt(e>>>4&15)+r.charAt(15&e);return i}function z(t){return unescape(encodeURIComponent(t))}function V(t){return function(t){return N(U(F(t),8*t.length))}(z(t))}function G(t,e){return function(t,e){var n,r,i=F(t),o=[],a=[];for(o[15]=a[15]=void 0,i.length>16&&(i=U(i,8*t.length)),n=0;n<16;n+=1)o[n]=909522486^i[n],a[n]=1549556828^i[n];return r=U(o.concat(F(e)),512+8*e.length),N(U(a.concat(r),640))}(z(t),z(e))}var W,H,Z,q,Y=function(t,e,n){return e?n?G(e,t):j(G(e,t)):n?V(t):j(V(t))},X=function(t,e){return T(t,{},{jsonp:"fn"})},K=function(t,e){if("PANORAMA"===t){var n="https://api.map.baidu.com/?qt=pano_entry&v=gl&ak="+window.BMAP_AUTHENTIC_KEY;"function"==typeof e?X(n).then((function(t){e()})).catch((function(t){})):X(n+"&callback="+e)}},Q=function(t){if("PANORAMA"===t)alert("您需要申请全景地图服务使用权限")},J=(H=null,Z=0,q=W||5e3,function(t){var e=(1e5*Math.random()).toFixed(0);window["cbk"+e]=function(t){t&&void 0!==t.error&&0===t.error||K("PANORAMA",(function(t){t&&void 0!==t.error&&0===t.error||Q("PANORAMA")}))},Z+=t,H||(H=setTimeout((function(){var t="https://api.map.baidu.com/?qt=pano_count&v=gl&ak="+window.BMAP_AUTHENTIC_KEY+"&consume="+Z;X(t+"&callback=window.cbk"+e),Z=0,H=null}),q))}),$=function(t,e){var n=(e=e||{}).counter?e.counter:1,r=!1!==e.isCounter,i=Date.parse(new Date),o=i/1e3,a=t+"-"+(o+1800)+"-"+i+"-"+window.BMAP_AUTHENTIC_KEY+"-SJvEY5h37ZDh5pHS",s=Y(a),u="auth_key="+(o+1800)+"-"+i+"-"+window.BMAP_AUTHENTIC_KEY+"-"+s;return r&&J(n),u},tt=function(){function t(e){var n=this;this.getPanoById=function(e){var r;r="".concat(t.SERVICE_URL,"?qt=sdata&sid=").concat(e,"&").concat($("/")),n.getDataByUrl(r).then((function(t){var e=P(t);if(null===e)throw new Error("数据解析异常");return n._cache.setData(r,t),n._pano.dispatchEvent(d.DATA_LOADED,{data:e}),n._pano.dispatchEvent(d.ID_CHANGED,e.panoId),n._pano.dispatchEvent(d.POSITION_CHANGED,new f(e.panoX,e.panoY)),e})).catch((function(t){n._pano.dispatchEvent({type:d.PANO_ERROR,data:t})}))},this.getPanoByLocation=function(e,r){var i;i="".concat(t.SERVICE_URL,"?qt=qsdata&x=").concat(e.lng,"&y=").concat(e.lat).concat(r?"&r="+r:"","&action=1&").concat($("/")),n.getDataByUrl(i).then((function(t){var r=P(t);n._cache.setData(i,t),n._pano.dispatchEvent(d.DATA_LOADED,{data:r}),n._pano.dispatchEvent(d.POSITION_CHANGED,e)})).catch((function(t){n._pano.dispatchEvent({type:d.PANO_ERROR,data:t})}))},this._pano=e,this._cache=new A(10)}return t.prototype.getDataByUrl=function(t){var e=this._cache.getData(t);return e?Promise.resolve(e):T(t,{},{jsonp:"fn"})},t}();tt.SERVICE_URL="//apisv0.bdimg.com/";var et=n((function(t){function e(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}t.exports=function(t){return function(){var n=this,r=arguments;return new Promise((function(i,o){var a=t.apply(n,r);function s(t){e(a,i,o,s,u,"next",t)}function u(t){e(a,i,o,s,u,"throw",t)}s(void 0)}))}},t.exports.__esModule=!0,t.exports.default=t.exports})),nt=e(et),rt=n((function(t){var e=r.default;function n(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
t.exports=n=function(){return r},t.exports.__esModule=!0,t.exports.default=t.exports;var r={},i=Object.prototype,o=i.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",h=a.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof p?e:p,o=Object.create(i.prototype),a=new A(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return R()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=w(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=f(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),o}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}r.wrap=l;var d={};function p(){}function v(){}function m(){}var g={};c(g,s,(function(){return this}));var y=Object.getPrototypeOf,_=y&&y(y(C([])));_&&_!==i&&o.call(_,s)&&(g=_);var x=m.prototype=p.prototype=Object.create(g);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,n){function r(i,a,s,u){var h=f(t[i],t,a);if("throw"!==h.type){var c=h.arg,l=c.value;return l&&"object"==e(l)&&o.call(l,"__await")?n.resolve(l.__await).then((function(t){r("next",t,s,u)}),(function(t){r("throw",t,s,u)})):n.resolve(l).then((function(t){c.value=t,s(c)}),(function(t){return r("throw",t,s,u)}))}u(h.arg)}var i;this._invoke=function(t,e){function o(){return new n((function(n,i){r(t,e,n,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=f(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,d;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function C(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(o.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:R}}function R(){return{value:void 0,done:!0}}return v.prototype=m,c(x,"constructor",m),c(m,"constructor",v),v.displayName=c(m,h,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,c(t,h,"GeneratorFunction")),t.prototype=Object.create(x),t},r.awrap=function(t){return{__await:t}},b(M.prototype),c(M.prototype,u,(function(){return this})),r.AsyncIterator=M,r.async=function(t,e,n,i,o){void 0===o&&(o=Promise);var a=new M(l(t,e,n,i),o);return r.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(x),c(x,h,"Generator"),c(x,s,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},r.values=C,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:C(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},r}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}));e(rt);var it=rt(),ot=it;try{regeneratorRuntime=it}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=it:Function("r","regeneratorRuntime = r")(it)}function at(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const st={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function ut(t,{precision:e=st.precision}={}){return t=function(t){return Math.round(t/st.EPSILON)*st.EPSILON}(t),"".concat(parseFloat(t.toPrecision(e)))}function ht(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ct(t,e,n){const r=st.EPSILON;n&&(st.EPSILON=n);try{if(t===e)return!0;if(ht(t)&&ht(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!ct(t[n],e[n]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):"number"==typeof t&&"number"==typeof e&&Math.abs(t-e)<=st.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{st.EPSILON=r}}class lt extends(function(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}(Array)){clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}toArray(t=[],e=0){for(let n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:ht(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(st)}formatString(t){let e="";for(let n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+ut(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!ct(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,n){if(void 0===n)return this.lerp(this,t,e);for(let r=0;r<this.ELEMENTS;++r){const i=t[r];this[r]=i+n*(e[r]-i)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}add(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]+=e[t];return this.check()}subtract(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]-=e[t];return this.check()}scale(t){if("number"==typeof t)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(st.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}get elements(){return this}}function ft(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function dt(t,e,n=""){if(st.debug&&!function(t,e){if(t.length!==e)return!1;for(let e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class pt extends lt{get x(){return this[0]}set x(t){this[0]=ft(t)}get y(){return this[1]}set y(t){this[1]=ft(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let n=0;n<this.ELEMENTS;++n){const r=this[n]-t[n];e+=r*r}return ft(e)}dot(t){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return ft(e)}normalize(){const t=this.magnitude();if(0!==t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e[t];return this.check()}divide(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e[t];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return at(t>=0&&t<this.ELEMENTS,"index is out of range"),ft(this[t])}setComponent(t,e){return at(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var vt=1e-6,mt="undefined"!=typeof Float32Array?Float32Array:Array,gt=Math.random;function yt(){var t=new mt(2);return mt!=Float32Array&&(t[0]=0,t[1]=0),t}function _t(t,e){var n=new mt(2);return n[0]=t,n[1]=e,n}function xt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function bt(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function Mt(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function wt(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function Et(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function Tt(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function At(t){var e=t[0],n=t[1];return e*e+n*n}function Ct(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Rt,St=Tt,Pt=xt,Dt=bt,Ot=Mt,It=wt,Lt=Et,Bt=At,kt=(Rt=yt(),function(t,e,n,r,i,o){var a,s;for(e||(e=2),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)Rt[0]=t[a],Rt[1]=t[a+1],i(Rt,Rt,o),t[a]=Rt[0],t[a+1]=Rt[1];return t}),Ut=Object.freeze({__proto__:null,create:yt,clone:function(t){var e=new mt(2);return e[0]=t[0],e[1]=t[1],e},fromValues:_t,copy:function(t,e){return t[0]=e[0],t[1]=e[1],t},set:function(t,e,n){return t[0]=e,t[1]=n,t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},subtract:xt,multiply:bt,divide:Mt,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},min:function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},max:function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},scale:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},scaleAndAdd:function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t},distance:wt,squaredDistance:Et,length:Tt,squaredLength:At,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},normalize:function(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},cross:function(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t},lerp:function(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t},random:function(t,e){e=e||1;var n=2*gt()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},transformMat2:function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t},transformMat2d:function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t},transformMat3:function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t},transformMat4:Ct,rotate:function(t,e,n,r){var i=e[0]-n[0],o=e[1]-n[1],a=Math.sin(r),s=Math.cos(r);return t[0]=i*s-o*a+n[0],t[1]=i*a+o*s+n[1],t},angle:function(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+o*o),s=a&&(n*i+r*o)/a;return Math.acos(Math.min(Math.max(s,-1),1))},zero:function(t){return t[0]=0,t[1]=0,t},str:function(t){return"vec2("+t[0]+", "+t[1]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]},equals:function(t,e){var n=t[0],r=t[1],i=e[0],o=e[1];return Math.abs(n-i)<=vt*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=vt*Math.max(1,Math.abs(r),Math.abs(o))},len:St,sub:Pt,mul:Dt,div:Ot,dist:It,sqrDist:Lt,sqrLen:Bt,forEach:kt});function Nt(t,e,n){const r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o||1;return t[0]=(n[0]*r+n[4]*i+n[8]*o)/a,t[1]=(n[1]*r+n[5]*i+n[9]*o)/a,t[2]=(n[2]*r+n[6]*i+n[10]*o)/a,t}function Ft(){var t=new mt(3);return mt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function jt(t){var e=new mt(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function zt(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Vt(t,e,n){var r=new mt(3);return r[0]=t,r[1]=e,r[2]=n,r}function Gt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Wt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Ht(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Zt(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function qt(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Yt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Xt(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function Kt(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function Qt(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function Jt(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function $t(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function te(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function ee(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}function ne(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function re(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],h=e[2],c=i*h-o*u,l=o*s-r*h,f=r*u-i*s,d=i*f-o*l,p=o*c-r*f,v=r*l-i*c,m=2*a;return c*=m,l*=m,f*=m,d*=2,p*=2,v*=2,t[0]=s+c+d,t[1]=u+l+p,t[2]=h+f+v,t}function ie(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function oe(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function ae(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function se(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),h=u&&$t(t,e)/u;return Math.acos(Math.min(Math.max(h,-1),1))}function ue(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2];return Math.abs(n-o)<=vt*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=vt*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=vt*Math.max(1,Math.abs(i),Math.abs(s))}var he=Ht,ce=Zt,le=qt,fe=Xt,de=Kt,pe=zt,ve=Qt,me=function(){var t=Ft();return function(e,n,r,i,o,a){var s,u;for(n||(n=3),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),ge=Object.freeze({__proto__:null,create:Ft,clone:jt,length:zt,fromValues:Vt,copy:Gt,set:function(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t},add:Wt,subtract:Ht,multiply:Zt,divide:qt,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},min:function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},max:function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},scale:Yt,scaleAndAdd:function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t},distance:Xt,squaredDistance:Kt,squaredLength:Qt,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},normalize:Jt,dot:$t,cross:te,lerp:function(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t},hermite:function(t,e,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,h=a*(o-1),c=a*(3-2*o);return t[0]=e[0]*s+n[0]*u+r[0]*h+i[0]*c,t[1]=e[1]*s+n[1]*u+r[1]*h+i[1]*c,t[2]=e[2]*s+n[2]*u+r[2]*h+i[2]*c,t},bezier:function(t,e,n,r,i,o){var a=1-o,s=a*a,u=o*o,h=s*a,c=3*o*s,l=3*u*a,f=u*o;return t[0]=e[0]*h+n[0]*c+r[0]*l+i[0]*f,t[1]=e[1]*h+n[1]*c+r[1]*l+i[1]*f,t[2]=e[2]*h+n[2]*c+r[2]*l+i[2]*f,t},random:function(t,e){e=e||1;var n=2*gt()*Math.PI,r=2*gt()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t},transformMat4:ee,transformMat3:ne,transformQuat:re,rotateX:ie,rotateY:oe,rotateZ:ae,angle:se,zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t},str:function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},equals:ue,sub:he,mul:ce,div:le,dist:fe,sqrDist:de,len:pe,sqrLen:ve,forEach:me});const ye=[0,0,0];let _e,xe;class be extends pt{static get ZERO(){return _e||(_e=new be(0,0,0),Object.freeze(_e)),_e}constructor(t=0,e=0,n=0){super(-0,-0,-0),1===arguments.length&&ht(t)?this.copy(t):(st.debug&&(ft(t),ft(e),ft(n)),this[0]=t,this[1]=e,this[2]=n)}set(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return st.debug&&(ft(t.x),ft(t.y),ft(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=ft(t)}angle(t){return se(this,t)}cross(t){return te(this,this,t),this.check()}rotateX({radians:t,origin:e=ye}){return ie(this,this,e,t),this.check()}rotateY({radians:t,origin:e=ye}){return oe(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=ye}){return ae(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return ee(this,this,t),this.check()}transformAsVector(t){return Nt(this,this,t),this.check()}transformByMatrix3(t){return ne(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,n){const r=e[0],i=e[1];t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2]}(this,this,t),this.check()}transformByQuaternion(t){return re(this,this,t),this.check()}}class Me extends pt{static get ZERO(){return xe||(xe=new Me(0,0,0,0),Object.freeze(xe)),xe}constructor(t=0,e=0,n=0,r=0){super(-0,-0,-0,-0),ht(t)&&1===arguments.length?this.copy(t):(st.debug&&(ft(t),ft(e),ft(n),ft(r)),this[0]=t,this[1]=e,this[2]=n,this[3]=r)}set(t,e,n,r){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return st.debug&&(ft(t.x),ft(t.y),ft(t.z),ft(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=ft(t)}get w(){return this[3]}set w(t){this[3]=ft(t)}transform(t){return ee(this,this,t),this.check()}transformByMatrix3(t){return function(t,e,n){const r=e[0],i=e[1],o=e[2];t[0]=n[0]*r+n[3]*i+n[6]*o,t[1]=n[1]*r+n[4]*i+n[7]*o,t[2]=n[2]*r+n[5]*i+n[8]*o,t[3]=e[3]}(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,n){const r=e[0],i=e[1];t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t[3]=e[3]}(this,this,t),this.check()}transformByQuaternion(t){return re(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class we extends lt{toString(){let t="[";if(st.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let n=0;n<this.RANK;++n)t+=" ".concat(this[n*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,n){return this[e*this.RANK+t]=ft(n),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const n=t*this.RANK;for(let t=0;t<this.RANK;++t)e[t]=this[n+t];return e}setColumn(t,e){const n=t*this.RANK;for(let t=0;t<this.RANK;++t)this[n+t]=e[t];return this}}function Ee(){var t=new mt(9);return mt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Te(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=n[0],d=n[1],p=n[2],v=n[3],m=n[4],g=n[5],y=n[6],_=n[7],x=n[8];return t[0]=f*r+d*a+p*h,t[1]=f*i+d*s+p*c,t[2]=f*o+d*u+p*l,t[3]=v*r+m*a+g*h,t[4]=v*i+m*s+g*c,t[5]=v*o+m*u+g*l,t[6]=y*r+_*a+x*h,t[7]=y*i+_*s+x*c,t[8]=y*o+_*u+x*l,t}function Ae(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}var Ce=Te,Re=Ae,Se=Object.freeze({__proto__:null,create:Ee,fromMat4:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},clone:function(t){var e=new mt(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromValues:function(t,e,n,r,i,o,a,s,u){var h=new mt(9);return h[0]=t,h[1]=e,h[2]=n,h[3]=r,h[4]=i,h[5]=o,h[6]=a,h[7]=s,h[8]=u,h},set:function(t,e,n,r,i,o,a,s,u,h){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=h,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},invert:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=c*a-s*h,f=-c*o+s*u,d=h*o-a*u,p=n*l+r*f+i*d;return p?(p=1/p,t[0]=l*p,t[1]=(-c*r+i*h)*p,t[2]=(s*r-i*a)*p,t[3]=f*p,t[4]=(c*n-i*u)*p,t[5]=(-s*n+i*o)*p,t[6]=d*p,t[7]=(-h*n+r*u)*p,t[8]=(a*n-r*o)*p,t):null},adjoint:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],c=e[8];return t[0]=a*c-s*h,t[1]=i*h-r*c,t[2]=r*s-i*a,t[3]=s*u-o*c,t[4]=n*c-i*u,t[5]=i*o-n*s,t[6]=o*h-a*u,t[7]=r*u-n*h,t[8]=n*a-r*o,t},determinant:function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],h=t[8];return e*(h*o-a*u)+n*(-h*i+a*s)+r*(u*i-o*s)},multiply:Te,translate:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=n[0],d=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=f*r+d*a+h,t[7]=f*i+d*s+c,t[8]=f*o+d*u+l,t},rotate:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=Math.sin(n),d=Math.cos(n);return t[0]=d*r+f*a,t[1]=d*i+f*s,t[2]=d*o+f*u,t[3]=d*a-f*r,t[4]=d*s-f*i,t[5]=d*u-f*o,t[6]=h,t[7]=c,t[8]=l,t},scale:function(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},fromRotation:function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat2d:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},fromQuat:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,h=n*a,c=r*a,l=r*s,f=i*a,d=i*s,p=i*u,v=o*a,m=o*s,g=o*u;return t[0]=1-l-p,t[3]=c-g,t[6]=f+m,t[1]=c+g,t[4]=1-h-p,t[7]=d-v,t[2]=f-m,t[5]=d+v,t[8]=1-h-l,t},normalFromMat4:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],p=e[12],v=e[13],m=e[14],g=e[15],y=n*s-r*a,_=n*u-i*a,x=n*h-o*a,b=r*u-i*s,M=r*h-o*s,w=i*h-o*u,E=c*v-l*p,T=c*m-f*p,A=c*g-d*p,C=l*m-f*v,R=l*g-d*v,S=f*g-d*m,P=y*S-_*R+x*C+b*A-M*T+w*E;return P?(P=1/P,t[0]=(s*S-u*R+h*C)*P,t[1]=(u*A-a*S-h*T)*P,t[2]=(a*R-s*A+h*E)*P,t[3]=(i*R-r*S-o*C)*P,t[4]=(n*S-i*A+o*T)*P,t[5]=(r*A-n*R-o*E)*P,t[6]=(v*w-m*M+g*b)*P,t[7]=(m*x-p*w-g*_)*P,t[8]=(p*M-v*x+g*y)*P,t):null},projection:function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},str:function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},subtract:Ae,multiplyScalar:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},multiplyScalarAndAdd:function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},equals:function(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],h=t[7],c=t[8],l=e[0],f=e[1],d=e[2],p=e[3],v=e[4],m=e[5],g=e[6],y=e[7],_=e[8];return Math.abs(n-l)<=vt*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-f)<=vt*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-d)<=vt*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-p)<=vt*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-v)<=vt*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(s-m)<=vt*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-g)<=vt*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(h-y)<=vt*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(c-_)<=vt*Math.max(1,Math.abs(c),Math.abs(_))},mul:Ce,sub:Re});function Pe(){var t=new mt(16);return mt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function De(t){var e=new mt(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Oe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ie(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Le(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Be(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],p=e[12],v=e[13],m=e[14],g=e[15],y=n*s-r*a,_=n*u-i*a,x=n*h-o*a,b=r*u-i*s,M=r*h-o*s,w=i*h-o*u,E=c*v-l*p,T=c*m-f*p,A=c*g-d*p,C=l*m-f*v,R=l*g-d*v,S=f*g-d*m,P=y*S-_*R+x*C+b*A-M*T+w*E;return P?(P=1/P,t[0]=(s*S-u*R+h*C)*P,t[1]=(i*R-r*S-o*C)*P,t[2]=(v*w-m*M+g*b)*P,t[3]=(f*M-l*w-d*b)*P,t[4]=(u*A-a*S-h*T)*P,t[5]=(n*S-i*A+o*T)*P,t[6]=(m*x-p*w-g*_)*P,t[7]=(c*w-f*x+d*_)*P,t[8]=(a*R-s*A+h*E)*P,t[9]=(r*A-n*R-o*E)*P,t[10]=(p*M-v*x+g*y)*P,t[11]=(l*x-c*M-d*y)*P,t[12]=(s*T-a*C-u*E)*P,t[13]=(n*C-r*T+i*E)*P,t[14]=(v*_-p*b-m*y)*P,t[15]=(c*b-l*_+f*y)*P,t):null}function ke(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],h=t[8],c=t[9],l=t[10],f=t[11],d=t[12],p=t[13],v=t[14],m=t[15];return(e*a-n*o)*(l*m-f*v)-(e*s-r*o)*(c*m-f*p)+(e*u-i*o)*(c*v-l*p)+(n*s-r*a)*(h*m-f*d)-(n*u-i*a)*(h*v-l*d)+(r*u-i*s)*(h*p-c*d)}function Ue(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],d=e[10],p=e[11],v=e[12],m=e[13],g=e[14],y=e[15],_=n[0],x=n[1],b=n[2],M=n[3];return t[0]=_*r+x*s+b*l+M*v,t[1]=_*i+x*u+b*f+M*m,t[2]=_*o+x*h+b*d+M*g,t[3]=_*a+x*c+b*p+M*y,_=n[4],x=n[5],b=n[6],M=n[7],t[4]=_*r+x*s+b*l+M*v,t[5]=_*i+x*u+b*f+M*m,t[6]=_*o+x*h+b*d+M*g,t[7]=_*a+x*c+b*p+M*y,_=n[8],x=n[9],b=n[10],M=n[11],t[8]=_*r+x*s+b*l+M*v,t[9]=_*i+x*u+b*f+M*m,t[10]=_*o+x*h+b*d+M*g,t[11]=_*a+x*c+b*p+M*y,_=n[12],x=n[13],b=n[14],M=n[15],t[12]=_*r+x*s+b*l+M*v,t[13]=_*i+x*u+b*f+M*m,t[14]=_*o+x*h+b*d+M*g,t[15]=_*a+x*c+b*p+M*y,t}function Ne(t,e,n){var r,i,o,a,s,u,h,c,l,f,d,p,v=n[0],m=n[1],g=n[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*g+e[12],t[13]=e[1]*v+e[5]*m+e[9]*g+e[13],t[14]=e[2]*v+e[6]*m+e[10]*g+e[14],t[15]=e[3]*v+e[7]*m+e[11]*g+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],d=e[10],p=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=h,t[7]=c,t[8]=l,t[9]=f,t[10]=d,t[11]=p,t[12]=r*v+s*m+l*g+e[12],t[13]=i*v+u*m+f*g+e[13],t[14]=o*v+h*m+d*g+e[14],t[15]=a*v+c*m+p*g+e[15]),t}function Fe(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function je(t,e,n,r){var i,o,a,s,u,h,c,l,f,d,p,v,m,g,y,_,x,b,M,w,E,T,A,C,R=r[0],S=r[1],P=r[2],D=Math.hypot(R,S,P);return D<vt?null:(R*=D=1/D,S*=D,P*=D,i=Math.sin(n),a=1-(o=Math.cos(n)),s=e[0],u=e[1],h=e[2],c=e[3],l=e[4],f=e[5],d=e[6],p=e[7],v=e[8],m=e[9],g=e[10],y=e[11],_=R*R*a+o,x=S*R*a+P*i,b=P*R*a-S*i,M=R*S*a-P*i,w=S*S*a+o,E=P*S*a+R*i,T=R*P*a+S*i,A=S*P*a-R*i,C=P*P*a+o,t[0]=s*_+l*x+v*b,t[1]=u*_+f*x+m*b,t[2]=h*_+d*x+g*b,t[3]=c*_+p*x+y*b,t[4]=s*M+l*w+v*E,t[5]=u*M+f*w+m*E,t[6]=h*M+d*w+g*E,t[7]=c*M+p*w+y*E,t[8]=s*T+l*A+v*C,t[9]=u*T+f*A+m*C,t[10]=h*T+d*A+g*C,t[11]=c*T+p*A+y*C,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ze(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],h=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+h*r,t[5]=a*i+c*r,t[6]=s*i+l*r,t[7]=u*i+f*r,t[8]=h*i-o*r,t[9]=c*i-a*r,t[10]=l*i-s*r,t[11]=f*i-u*r,t}function Ve(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],h=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-h*r,t[1]=a*i-c*r,t[2]=s*i-l*r,t[3]=u*i-f*r,t[8]=o*r+h*i,t[9]=a*r+c*i,t[10]=s*r+l*i,t[11]=u*r+f*i,t}function Ge(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],h=e[4],c=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+h*r,t[1]=a*i+c*r,t[2]=s*i+l*r,t[3]=u*i+f*r,t[4]=h*i-o*r,t[5]=c*i-a*r,t[6]=l*i-s*r,t[7]=f*i-u*r,t}function We(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,u=i+i,h=o+o,c=r*s,l=r*u,f=r*h,d=i*u,p=i*h,v=o*h,m=a*s,g=a*u,y=a*h;return t[0]=1-(d+v),t[1]=l+y,t[2]=f-g,t[3]=0,t[4]=l-y,t[5]=1-(c+v),t[6]=p+m,t[7]=0,t[8]=f+g,t[9]=p-m,t[10]=1-(c+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function He(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],h=e[9],c=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(u,h,c),t}function Ze(t,e){var n=new mt(3);He(n,e);var r=1/n[0],i=1/n[1],o=1/n[2],a=e[0]*r,s=e[1]*i,u=e[2]*o,h=e[4]*r,c=e[5]*i,l=e[6]*o,f=e[8]*r,d=e[9]*i,p=e[10]*o,v=a+c+p,m=0;return v>0?(m=2*Math.sqrt(v+1),t[3]=.25*m,t[0]=(l-d)/m,t[1]=(f-u)/m,t[2]=(s-h)/m):a>c&&a>p?(m=2*Math.sqrt(1+a-c-p),t[3]=(l-d)/m,t[0]=.25*m,t[1]=(s+h)/m,t[2]=(f+u)/m):c>p?(m=2*Math.sqrt(1+c-a-p),t[3]=(f-u)/m,t[0]=(s+h)/m,t[1]=.25*m,t[2]=(l+d)/m):(m=2*Math.sqrt(1+p-a-c),t[3]=(s-h)/m,t[0]=(f+u)/m,t[1]=(l+d)/m,t[2]=.25*m),t}function qe(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,h=o+o,c=a+a,l=i*u,f=i*h,d=i*c,p=o*h,v=o*c,m=a*c,g=s*u,y=s*h,_=s*c,x=r[0],b=r[1],M=r[2];return t[0]=(1-(p+m))*x,t[1]=(f+_)*x,t[2]=(d-y)*x,t[3]=0,t[4]=(f-_)*b,t[5]=(1-(l+m))*b,t[6]=(v+g)*b,t[7]=0,t[8]=(d+y)*M,t[9]=(v-g)*M,t[10]=(1-(l+p))*M,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Ye(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,h=n*a,c=r*a,l=r*s,f=i*a,d=i*s,p=i*u,v=o*a,m=o*s,g=o*u;return t[0]=1-l-p,t[1]=c+g,t[2]=f-m,t[3]=0,t[4]=c-g,t[5]=1-h-p,t[6]=d+v,t[7]=0,t[8]=f+m,t[9]=d-v,t[10]=1-h-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Xe(t,e,n,r,i,o,a){var s=1/(n-e),u=1/(i-r),h=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(a+o)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*h,t[15]=0,t}function Ke(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var Qe=Ke;function Je(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),h=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*h,t[15]=1,t}var $e=Je;function tn(t,e,n,r){var i,o,a,s,u,h,c,l,f,d,p=e[0],v=e[1],m=e[2],g=r[0],y=r[1],_=r[2],x=n[0],b=n[1],M=n[2];return Math.abs(p-x)<vt&&Math.abs(v-b)<vt&&Math.abs(m-M)<vt?Ie(t):(c=p-x,l=v-b,f=m-M,i=y*(f*=d=1/Math.hypot(c,l,f))-_*(l*=d),o=_*(c*=d)-g*f,a=g*l-y*c,(d=Math.hypot(i,o,a))?(i*=d=1/d,o*=d,a*=d):(i=0,o=0,a=0),s=l*a-f*o,u=f*i-c*a,h=c*o-l*i,(d=Math.hypot(s,u,h))?(s*=d=1/d,u*=d,h*=d):(s=0,u=0,h=0),t[0]=i,t[1]=s,t[2]=c,t[3]=0,t[4]=o,t[5]=u,t[6]=l,t[7]=0,t[8]=a,t[9]=h,t[10]=f,t[11]=0,t[12]=-(i*p+o*v+a*m),t[13]=-(s*p+u*v+h*m),t[14]=-(c*p+l*v+f*m),t[15]=1,t)}function en(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=r[0],u=r[1],h=r[2],c=i-n[0],l=o-n[1],f=a-n[2],d=c*c+l*l+f*f;d>0&&(c*=d=1/Math.sqrt(d),l*=d,f*=d);var p=u*f-h*l,v=h*c-s*f,m=s*l-u*c;return(d=p*p+v*v+m*m)>0&&(p*=d=1/Math.sqrt(d),v*=d,m*=d),t[0]=p,t[1]=v,t[2]=m,t[3]=0,t[4]=l*m-f*v,t[5]=f*p-c*m,t[6]=c*v-l*p,t[7]=0,t[8]=c,t[9]=l,t[10]=f,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function nn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}var rn=Ue,on=nn,an=Object.freeze({__proto__:null,create:Pe,clone:De,copy:Oe,fromValues:function(t,e,n,r,i,o,a,s,u,h,c,l,f,d,p,v){var m=new mt(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=r,m[4]=i,m[5]=o,m[6]=a,m[7]=s,m[8]=u,m[9]=h,m[10]=c,m[11]=l,m[12]=f,m[13]=d,m[14]=p,m[15]=v,m},set:function(t,e,n,r,i,o,a,s,u,h,c,l,f,d,p,v,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=h,t[9]=c,t[10]=l,t[11]=f,t[12]=d,t[13]=p,t[14]=v,t[15]=m,t},identity:Ie,transpose:Le,invert:Be,adjoint:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],p=e[12],v=e[13],m=e[14],g=e[15];return t[0]=s*(f*g-d*m)-l*(u*g-h*m)+v*(u*d-h*f),t[1]=-(r*(f*g-d*m)-l*(i*g-o*m)+v*(i*d-o*f)),t[2]=r*(u*g-h*m)-s*(i*g-o*m)+v*(i*h-o*u),t[3]=-(r*(u*d-h*f)-s*(i*d-o*f)+l*(i*h-o*u)),t[4]=-(a*(f*g-d*m)-c*(u*g-h*m)+p*(u*d-h*f)),t[5]=n*(f*g-d*m)-c*(i*g-o*m)+p*(i*d-o*f),t[6]=-(n*(u*g-h*m)-a*(i*g-o*m)+p*(i*h-o*u)),t[7]=n*(u*d-h*f)-a*(i*d-o*f)+c*(i*h-o*u),t[8]=a*(l*g-d*v)-c*(s*g-h*v)+p*(s*d-h*l),t[9]=-(n*(l*g-d*v)-c*(r*g-o*v)+p*(r*d-o*l)),t[10]=n*(s*g-h*v)-a*(r*g-o*v)+p*(r*h-o*s),t[11]=-(n*(s*d-h*l)-a*(r*d-o*l)+c*(r*h-o*s)),t[12]=-(a*(l*m-f*v)-c*(s*m-u*v)+p*(s*f-u*l)),t[13]=n*(l*m-f*v)-c*(r*m-i*v)+p*(r*f-i*l),t[14]=-(n*(s*m-u*v)-a*(r*m-i*v)+p*(r*u-i*s)),t[15]=n*(s*f-u*l)-a*(r*f-i*l)+c*(r*u-i*s),t},determinant:ke,multiply:Ue,translate:Ne,scale:Fe,rotate:je,rotateX:ze,rotateY:Ve,rotateZ:Ge,fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotation:function(t,e,n){var r,i,o,a=n[0],s=n[1],u=n[2],h=Math.hypot(a,s,u);return h<vt?null:(a*=h=1/h,s*=h,u*=h,r=Math.sin(e),o=1-(i=Math.cos(e)),t[0]=a*a*o+i,t[1]=s*a*o+u*r,t[2]=u*a*o-s*r,t[3]=0,t[4]=a*s*o-u*r,t[5]=s*s*o+i,t[6]=u*s*o+a*r,t[7]=0,t[8]=a*u*o+s*r,t[9]=s*u*o-a*r,t[10]=u*u*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},fromXRotation:function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromYRotation:function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromZRotation:function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotationTranslation:We,fromQuat2:function(t,e){var n=new mt(3),r=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=r*r+i*i+o*o+a*a;return l>0?(n[0]=2*(s*a+c*r+u*o-h*i)/l,n[1]=2*(u*a+c*i+h*r-s*o)/l,n[2]=2*(h*a+c*o+s*i-u*r)/l):(n[0]=2*(s*a+c*r+u*o-h*i),n[1]=2*(u*a+c*i+h*r-s*o),n[2]=2*(h*a+c*o+s*i-u*r)),We(t,e,n),t},getTranslation:function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},getScaling:He,getRotation:Ze,fromRotationTranslationScale:qe,fromRotationTranslationScaleOrigin:function(t,e,n,r,i){var o=e[0],a=e[1],s=e[2],u=e[3],h=o+o,c=a+a,l=s+s,f=o*h,d=o*c,p=o*l,v=a*c,m=a*l,g=s*l,y=u*h,_=u*c,x=u*l,b=r[0],M=r[1],w=r[2],E=i[0],T=i[1],A=i[2],C=(1-(v+g))*b,R=(d+x)*b,S=(p-_)*b,P=(d-x)*M,D=(1-(f+g))*M,O=(m+y)*M,I=(p+_)*w,L=(m-y)*w,B=(1-(f+v))*w;return t[0]=C,t[1]=R,t[2]=S,t[3]=0,t[4]=P,t[5]=D,t[6]=O,t[7]=0,t[8]=I,t[9]=L,t[10]=B,t[11]=0,t[12]=n[0]+E-(C*E+P*T+I*A),t[13]=n[1]+T-(R*E+D*T+L*A),t[14]=n[2]+A-(S*E+O*T+B*A),t[15]=1,t},fromQuat:Ye,frustum:Xe,perspectiveNO:Ke,perspective:Qe,perspectiveZO:function(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t},perspectiveFromFieldOfView:function(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),h=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-(a-s)*u*.5,t[9]=(i-o)*h*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t},orthoNO:Je,ortho:$e,orthoZO:function(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),h=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=h,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=o*h,t[15]=1,t},lookAt:tn,targetTo:en,str:function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},subtract:nn,multiplyScalar:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},multiplyScalarAndAdd:function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},equals:function(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],h=t[7],c=t[8],l=t[9],f=t[10],d=t[11],p=t[12],v=t[13],m=t[14],g=t[15],y=e[0],_=e[1],x=e[2],b=e[3],M=e[4],w=e[5],E=e[6],T=e[7],A=e[8],C=e[9],R=e[10],S=e[11],P=e[12],D=e[13],O=e[14],I=e[15];return Math.abs(n-y)<=vt*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-_)<=vt*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-x)<=vt*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-b)<=vt*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-M)<=vt*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(s-w)<=vt*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(u-E)<=vt*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-T)<=vt*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(c-A)<=vt*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(l-C)<=vt*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(f-R)<=vt*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(d-S)<=vt*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(p-P)<=vt*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(v-D)<=vt*Math.max(1,Math.abs(v),Math.abs(D))&&Math.abs(m-O)<=vt*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(g-I)<=vt*Math.max(1,Math.abs(g),Math.abs(I))},mul:rn,sub:on});function sn(){var t=new mt(4);return mt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function un(t){var e=new mt(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function hn(t,e,n,r){var i=new mt(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function cn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ln(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function fn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function dn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function pn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function vn(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function mn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function gn(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.hypot(n,r,i,o)}function yn(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return n*n+r*r+i*i+o*o}function _n(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function xn(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function bn(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a,t}function Mn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function wn(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t[3]=s+r*(n[3]-s),t}function En(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}function Tn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function An(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=e[0],s=e[1],u=e[2],h=e[3];return Math.abs(n-a)<=vt*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=vt*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=vt*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-h)<=vt*Math.max(1,Math.abs(o),Math.abs(h))}var Cn,Rn=dn,Sn=pn,Pn=vn,Dn=gn,On=yn,In=_n,Ln=xn,Bn=function(){var t=sn();return function(e,n,r,i,o,a){var s,u;for(n||(n=4),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),kn=Object.freeze({__proto__:null,create:sn,clone:un,fromValues:hn,copy:cn,set:ln,add:fn,subtract:dn,multiply:pn,divide:vn,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},min:function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},max:function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},scale:mn,scaleAndAdd:function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t},distance:gn,squaredDistance:yn,length:_n,squaredLength:xn,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},normalize:bn,dot:Mn,cross:function(t,e,n,r){var i=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],a=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],u=n[1]*r[3]-n[3]*r[1],h=n[2]*r[3]-n[3]*r[2],c=e[0],l=e[1],f=e[2],d=e[3];return t[0]=l*h-f*u+d*s,t[1]=-c*h+f*a-d*o,t[2]=c*u-l*a+d*i,t[3]=-c*s+l*o-f*i,t},lerp:wn,random:function(t,e){var n,r,i,o,a,s;e=e||1;do{a=(n=2*gt()-1)*n+(r=2*gt()-1)*r}while(a>=1);do{s=(i=2*gt()-1)*i+(o=2*gt()-1)*o}while(s>=1);var u=Math.sqrt((1-a)/s);return t[0]=e*n,t[1]=e*r,t[2]=e*i*u,t[3]=e*o*u,t},transformMat4:En,transformQuat:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2],h=n[3],c=h*r+s*o-u*i,l=h*i+u*r-a*o,f=h*o+a*i-s*r,d=-a*r-s*i-u*o;return t[0]=c*h+d*-a+l*-u-f*-s,t[1]=l*h+d*-s+f*-a-c*-u,t[2]=f*h+d*-u+c*-s-l*-a,t[3]=e[3],t},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},str:function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},exactEquals:Tn,equals:An,sub:Rn,mul:Sn,div:Pn,dist:Dn,sqrDist:On,len:In,sqrLen:Ln,forEach:Bn});!function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"}(Cn||(Cn={}));const Un=45*Math.PI/180,Nn=1,Fn=.1,jn=500,zn=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Vn extends we{static get IDENTITY(){return function(){Wn||(Wn=new Vn,Object.freeze(Wn));return Wn}()}static get ZERO(){return function(){Gn||(Gn=new Vn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Gn));return Gn}()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Cn}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,n,r,i,o,a,s,u,h,c,l,f,d,p,v){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this[4]=i,this[5]=o,this[6]=a,this[7]=s,this[8]=u,this[9]=h,this[10]=c,this[11]=l,this[12]=f,this[13]=d,this[14]=p,this[15]=v,this.check()}setRowMajor(t,e,n,r,i,o,a,s,u,h,c,l,f,d,p,v){return this[0]=t,this[1]=i,this[2]=u,this[3]=f,this[4]=e,this[5]=o,this[6]=h,this[7]=d,this[8]=n,this[9]=a,this[10]=c,this[11]=p,this[12]=r,this[13]=s,this[14]=l,this[15]=v,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(zn)}fromObject(t){return this.check()}fromQuaternion(t){return Ye(this,t),this.check()}frustum(t){const{left:e,right:n,bottom:r,top:i,near:o=Fn,far:a=jn}=t;return a===1/0?function(t,e,n,r,i,o){const a=2*o/(n-e),s=2*o/(i-r),u=(n+e)/(n-e),h=(i+r)/(i-r),c=-1,l=-1,f=-2*o;t[0]=a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=u,t[9]=h,t[10]=c,t[11]=l,t[12]=0,t[13]=0,t[14]=f,t[15]=0}(this,e,n,r,i,o):Xe(this,e,n,r,i,o,a),this.check()}lookAt(t){const{eye:e,center:n=[0,0,0],up:r=[0,1,0]}=t;return tn(this,e,n,r),this.check()}ortho(t){const{left:e,right:n,bottom:r,top:i,near:o=Fn,far:a=jn}=t;return $e(this,e,n,r,i,o,a),this.check()}orthographic(t){const{fovy:e=Un,aspect:n=Nn,focalDistance:r=1,near:i=Fn,far:o=jn}=t;Hn(e);const a=e/2,s=r*Math.tan(a),u=s*n;return this.ortho({left:-u,right:u,bottom:-s,top:s,near:i,far:o})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:n=1,near:r=.1,far:i=500}=t;return Hn(e),Qe(this,e,n,r,i),this.check()}determinant(){return ke(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),r=1/n[0],i=1/n[1],o=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*i,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*i,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),r=1/n[0],i=1/n[1],o=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=this[4]*r,t[4]=this[5]*i,t[5]=this[6]*o,t[6]=this[8]*r,t[7]=this[9]*i,t[8]=this[10]*o,t}transpose(){return Le(this,this),this.check()}invert(){return Be(this,this),this.check()}multiplyLeft(t){return Ue(this,t,this),this.check()}multiplyRight(t){return Ue(this,this,t),this.check()}rotateX(t){return ze(this,this,t),this.check()}rotateY(t){return Ve(this,this,t),this.check()}rotateZ(t){return Ge(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return je(this,this,t,e),this.check()}scale(t){return Fe(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return Ne(this,this,t),this.check()}transform(t,e){return 4===t.length?(dt(e=En(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:n}=t;let r;switch(n){case 2:r=Ct(e||[-0,-0],t,this);break;case 3:r=ee(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return dt(r,t.length),r}transformAsVector(t,e){let n;switch(t.length){case 2:n=function(t,e,n){const r=e[0],i=e[1],o=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/o,t[1]=(n[1]*r+n[5]*i)/o,t}(e||[-0,-0],t,this);break;case 3:n=Nt(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return dt(n,t.length),n}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,n){return this.identity().translate([t,e,n])}}let Gn,Wn;function Hn(t){if(t>2*Math.PI)throw Error("expected radians")}function Zn(){var t=new mt(4);return mt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function qn(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Yn(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function Xn(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],h=n[2],c=n[3];return t[0]=r*c+a*s+i*h-o*u,t[1]=i*c+a*u+o*s-r*h,t[2]=o*c+a*h+r*u-i*s,t[3]=a*c-r*s-i*u-o*h,t}function Kn(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=Math.sqrt(n*n+r*r+i*i),s=Math.exp(o),u=a>0?s*Math.sin(a)/a:0;return t[0]=n*u,t[1]=r*u,t[2]=i*u,t[3]=s*Math.cos(a),t}function Qn(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=Math.sqrt(n*n+r*r+i*i),s=a>0?Math.atan2(a,o)/a:0;return t[0]=n*s,t[1]=r*s,t[2]=i*s,t[3]=.5*Math.log(n*n+r*r+i*i+o*o),t}function Jn(t,e,n,r){var i,o,a,s,u,h=e[0],c=e[1],l=e[2],f=e[3],d=n[0],p=n[1],v=n[2],m=n[3];return(o=h*d+c*p+l*v+f*m)<0&&(o=-o,d=-d,p=-p,v=-v,m=-m),1-o>vt?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-r)*i)/a,u=Math.sin(r*i)/a):(s=1-r,u=r),t[0]=s*h+u*d,t[1]=s*c+u*p,t[2]=s*l+u*v,t[3]=s*f+u*m,t}function $n(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*a+a]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*o+a]-e[3*a+o])*n,t[o]=(e[3*o+i]+e[3*i+o])*n,t[a]=(e[3*a+i]+e[3*i+a])*n}return t}function tr(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var o=Math.sin(e),a=Math.cos(e),s=Math.sin(n),u=Math.cos(n),h=Math.sin(r),c=Math.cos(r);return t[0]=o*u*c-a*s*h,t[1]=a*s*c+o*u*h,t[2]=a*u*h-o*s*c,t[3]=a*u*c+o*s*h,t}var er,nr,rr,ir,or,ar,sr=un,ur=hn,hr=cn,cr=ln,lr=fn,fr=Xn,dr=mn,pr=Mn,vr=wn,mr=_n,gr=mr,yr=xn,_r=yr,xr=bn,br=Tn,Mr=An,wr=(er=Ft(),nr=Vt(1,0,0),rr=Vt(0,1,0),function(t,e,n){var r=$t(e,n);return r<-.999999?(te(er,nr,e),pe(er)<1e-6&&te(er,rr,e),Jt(er,er),Yn(t,er,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(te(er,e,n),t[0]=er[0],t[1]=er[1],t[2]=er[2],t[3]=1+r,xr(t,t))}),Er=(ir=Zn(),or=Zn(),function(t,e,n,r,i,o){return Jn(ir,e,i,o),Jn(or,n,r,o),Jn(t,ir,or,2*o*(1-o)),t}),Tr=(ar=Ee(),function(t,e,n,r){return ar[0]=n[0],ar[3]=n[1],ar[6]=n[2],ar[1]=r[0],ar[4]=r[1],ar[7]=r[2],ar[2]=-e[0],ar[5]=-e[1],ar[8]=-e[2],xr(t,$n(t,ar))}),Ar=Object.freeze({__proto__:null,create:Zn,identity:qn,setAxisAngle:Yn,getAxisAngle:function(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>vt?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n},getAngle:function(t,e){var n=pr(t,e);return Math.acos(2*n*n-1)},multiply:Xn,rotateX:function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+a*s,t[1]=i*u+o*s,t[2]=o*u-i*s,t[3]=a*u-r*s,t},rotateY:function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u-o*s,t[1]=i*u+a*s,t[2]=o*u+r*s,t[3]=a*u-i*s,t},rotateZ:function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*s,t[1]=i*u-r*s,t[2]=o*u+a*s,t[3]=a*u-o*s,t},calculateW:function(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t},exp:Kn,ln:Qn,pow:function(t,e,n){return Qn(t,e),dr(t,t,n),Kn(t,t),t},slerp:Jn,random:function(t){var e=gt(),n=gt(),r=gt(),i=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*n),t[1]=i*Math.cos(2*Math.PI*n),t[2]=o*Math.sin(2*Math.PI*r),t[3]=o*Math.cos(2*Math.PI*r),t},invert:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-i*s,t[3]=o*s,t},conjugate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},fromMat3:$n,fromEuler:tr,str:function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},clone:sr,fromValues:ur,copy:hr,set:cr,add:lr,mul:fr,scale:dr,dot:pr,lerp:vr,length:mr,len:gr,squaredLength:yr,sqrLen:_r,normalize:xr,exactEquals:br,equals:Mr,rotationTo:wr,sqlerp:Er,setAxes:Tr});function Cr(t){return Cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cr(t)}var Rr=function(t){return"[object String]"===Object.prototype.toString.call(t)},Sr=function(t){var e="[object Function]"===Object.prototype.toString.call(t),n="[object AsyncFunction]"===Object.prototype.toString.call(t);return e||n},Pr=365611;function Dr(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null}var Or=function(){function t(){this.__listeners=void 0}var e=t.prototype;return e.on=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.alias("addEventListener")(e)},e.off=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.alias("removeEventListener")(e)},e.emit=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.alias("dispatchEvent")(e)},e.addEventListener=function(t,e,n){if(Sr(e)){var r;!this.__listeners&&(this.__listeners={});var i=this.__listeners;if("string"==typeof n&&n){if(/[^\w-]/.test(n))throw"nonstandard key:"+n;e.hashCode=n,r=n}!t.startsWith("on")&&(t="on"+t),"object"!==Cr(i[t])&&(i[t]={}),r=r||(++Pr).toString(),e.hashCode=r,i[t][r]=e}},e.removeEventListener=function(t,e){if(Sr(e))e=e.hashCode;else if(!Rr(e))return;!this.__listeners&&(this.__listeners={}),!t.startsWith("on")&&(t="on"+t);var n=this.__listeners;n[t]&&n[t][e]&&delete n[t][e]},e.dispatchEvent=function(t,e){Rr(t)&&(t=new Dr(t)),!this.__listeners&&(this.__listeners={});var n=this.__listeners,r=t.type,i=e||t;if(t.target=t.target||this,t.currentTarget=this,0!==r.indexOf("on")&&(r="on".concat(r)),Sr(n[r])&&n[r].call(this,i),"object"===Cr(n[r]))for(var o in n[r])Object.prototype.hasOwnProperty.call(n[r],o)&&n[r][o].call(this,i);return t.returnValue},e.alias=function(t){var e=this;return function(n){return e[t].apply(e,n)}},t}();function Ir(t,e){var n=e[2],r=e[0],i=e[1],o=e[3],a=o*o,s=n*n,u=r*r,h=i*i,c=i*n-r*o,l=.4999999;return c<-l?(t[0]=Math.PI/2,t[1]=2*Math.atan2(i,o),t[2]=0):c>l?(t[0]=-Math.PI/2,t[1]=2*Math.atan2(i,o),t[2]=0):(t[0]=Math.asin(-2*(n*i-r*o)),t[1]=Math.atan2(2*(n*r+i*o),s-u-h+a),t[2]=Math.atan2(2*(r*i+n*o),-s-u+h+a)),t}var Lr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DefaultOrder;this.isEuler=!0,this._x=void 0,this._y=void 0,this._z=void 0,this._order=void 0,this._onChangeCallback=void 0,this._x=e,this._y=n,this._z=r,this._order=i,this._onChangeCallback=function(){}}var e=t.prototype;return e.set=function(t,e,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return this._x=t,this._y=e,this._z=n,r&&this._onChangeCallback(),this},e.clone=function(){return new t(this._x,this._y,this._z,this._order)},e.copy=function(t){return t.isEuler?(this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this):this},e.equals=function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},e.toVector3=function(){return Vt(this._x,this._y,this._z)},e.onChange=function(t){"function"==typeof t&&(this._onChangeCallback=t)},o(t,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}]),t}();function Br(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}Lr.DefaultOrder="XYZ";var kr=function(t){return 180*t/Math.PI},Ur=function(t){function e(){var n;return(n=t.call(this)||this).isObject3D=!0,n.uuid=Br(),n.name="",n.parent=null,n.children=[],n.visible=!0,n.position=Ft(),n.rotation=new Lr,n.scale=Vt(1,1,1),n.quaternion=Zn(),n.up=jt(e.DefaultUp),n.modelMatrix=Pe(),n.worldMatrix=Pe(),n.modelMatrixNeedUpdate=!1,n.worldMatrixNeedsUpdate=!1,n.rotation.onChange((function(){n.modelMatrixNeedUpdate=!0})),n}c(e,t);var n=e.prototype;return n.rotateX=function(t){this.rotation.x=t},n.rotateY=function(t){this.rotation.y=t},n.rotateZ=function(t){this.rotation.z=t},n.translate=function(t,e,n){var r=Vt(t,e,n);return this.position=Wt(this.position,this.position,r),this.modelMatrixNeedUpdate=!0,this},n.setPosition=function(t,e,n){var r=Vt(t,e,n);return ue(this.position,r)||(this.position=r,this.modelMatrixNeedUpdate=!0),this},n.lookAt=function(t,e,n){var r=this.up,i=this.position,o=Vt(t,e,n),a=en(Pe(),i,o,r),s=Ze(Zn(),a),u=Ir(Ft(),s);this.rotation.set(kr(u[0]),kr(u[1]),kr(u[2]))},n.setVisible=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.visible!==t&&(this.visible=t,e))for(var n=0,r=this.children.length;n<r;n++)this.children[n].setVisible(t,e)},n.setScale=function(t,e,n){var r=Vt(t,e,n);return ue(this.scale,r)||(this.scale=r,this.modelMatrixNeedUpdate=!0),this},n.updateMatrix=function(){Ie(this.modelMatrix),qn(this.quaternion),tr(this.quaternion,this.rotation.x,this.rotation.y,this.rotation.z),qe(this.modelMatrix,this.quaternion,this.position,this.scale),this.modelMatrixNeedUpdate=!1,this.worldMatrixNeedsUpdate=!0},n.updateWorldMatrix=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!0!==this.modelMatrixNeedUpdate&&!0!==t||this.updateMatrix(),!0===this.worldMatrixNeedsUpdate&&(this.parent?Ue(this.worldMatrix,this.parent.worldMatrix,this.modelMatrix):Oe(this.worldMatrix,this.modelMatrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(var e=0,n=this.children.length;e<n;e++)this.children[e].updateWorldMatrix(t)},n.add=function(t){if(t===this)return console.error("object3D.add: object can't be added as a child of itself. ==> ".concat(t)),this;if(t instanceof Array){for(var e=0,n=t.length;e<n;e++)this.add(t[e]);return this}return t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t)):console.error("Object3D.add: object not an instance of Object3D.",t),this},n.remove=function(t){if(t instanceof Array){for(var e=0,n=t.length;e<n;e++)this.remove(t[e]);return this}var r=this.children.indexOf(t);return-1!==r&&(t.parent=null,this.children.splice(r,1)),this},n.traverse=function(t){t(this),this.children&&this.children.length>0&&this.children.forEach((function(e){e.traverse(t)}))},n.clone=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=new e;if(n.up=jt(this.up),n.scale=jt(this.scale),n.position=jt(this.position),n.rotation=this.rotation.clone(),n.quaternion=sr(this.quaternion),n.modelMatrix=De(this.modelMatrix),n.worldMatrix=De(this.worldMatrix),n.visible=this.visible,this.children.length&&t)for(var r=0,i=this.children.length;r<i;r++)n.add(this.children[r].clone());return n},n.raycast=function(t){return null},e}(Or);Ur.DefaultUp=Vt(0,1,0);var Nr=function(){function t(t,e){this.isBox=!0,this.min=void 0,this.max=void 0,this.min=void 0!==t?t:Vt(1/0,1/0,1/0),this.max=void 0!==e?e:Vt(-1/0,-1/0,-1/0)}var e=t.prototype;return e.set=function(t,e){return Gt(this.min,t),Gt(this.max,e),this},e.setFromBufferAttribute=function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=t.array,u=t.count,h=t.itemSize,c=0;c<u;c++){var l=s[c*h],f=s[c*h+1],d=s[c*h+2];l<e&&(e=l),f<n&&(n=f),d<r&&(r=d),l>i&&(i=l),f>o&&(o=f),d>a&&(a=d)}var p=Vt(e,n,r),v=Vt(i,o,a);return this.set(p,v),this},e.getCenter=function(){return this.isInvalid()?Ft():Vt((this.max[0]+this.min[0])/2,(this.max[1]+this.min[1])/2,(this.max[2]+this.min[2])/2)},e.isInvalid=function(){return this.max[0]<this.min[0]||this.max[1]<this.min[1]||this.max[2]<this.min[2]},t}(),Fr=function(){function t(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.isBufferAttribute=!0,this.name="",this.type=void 0,this.array=void 0,this.itemSize=void 0,this.count=void 0,this.normalized=void 0,this.usage=void 0,this.needUpdate=void 0,Array.isArray(e))throw new TypeError("BufferAttribute: array should be a Typed Array.");if(this.name="BufferAttribute",this.array=e,this.itemSize=n,this.count=void 0!==e?e.length/n:0,this.normalized=!0===i,this.usage=35044,this.needUpdate=!0,void 0===r){var o=this.array;this.type=t.FLOAT,o instanceof Int8Array?this.type=t.BYTE:o instanceof Uint8Array?this.type=t.UNSIGNED_BYTE:o instanceof Int16Array?this.type=t.SHORT:o instanceof Uint16Array?this.type=t.UNSIGNED_SHORT:o instanceof Int32Array?this.type=t.INT:o instanceof Uint32Array&&(this.type=t.UNSIGNED_INT)}else this.type=r}t.isBufferAttribute=function(e){var n=!1;return e&&e instanceof t&&(n=!0),n};var e=t.prototype;return e.setUsage=function(t){return this.usage=t,this},e.setArray=function(t){return this.array.set(t),this},t}();Fr.BYTE=5120,Fr.UNSIGNED_BYTE=5121,Fr.SHORT=5122,Fr.UNSIGNED_SHORT=5123,Fr.INT=5124,Fr.UNSIGNED_INT=5125,Fr.FLOAT=5126;var jr=function(t){function e(e,n,r,i){var o;return(o=t.call(this,new Uint8Array(e),n,r,i)||this).name="Uint8BufferAttribute",o}return c(e,t),e}(Fr),zr=function(t){function e(e,n,r,i){var o;return(o=t.call(this,new Uint16Array(e),n,r,i)||this).name="Uint16BufferAttribute",o}return c(e,t),e}(Fr),Vr=function(t){function e(e,n,r,i){var o;return(o=t.call(this,new Uint32Array(e),n,r,i)||this).name="Uint32BufferAttribute",o}return c(e,t),e}(Fr),Gr=function(t){function e(e,n,r,i){var o;return(o=t.call(this,new Float32Array(e),n,r,i)||this).name="Float32ArrayAttribute",o}return c(e,t),e}(Fr),Wr=function(t){function e(e,n,r,i){var o;if(Array.isArray(e)){var a=function(t){for(var e,n=Number.MAX_VALUE,r=-Number.MAX_VALUE,i=t.length-1;i>=0;i--)n>(e=t[i])&&(n=e),r<e&&(r=e);return{min:n,max:r}}(e);o=new(a.max>65535?Uint32Array:Uint16Array)(e)}else o=e;return t.call(this,o,n,r,i)||this}return c(e,t),e}(Fr),Hr=0,Zr=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).id=Hr++,e.uuid=Br(),e.name="",e.type="BufferGeometry",e.indexes=null,e.attributes={},e.__webglInit=!1,e.groupsNeedUpdate=!1,e.boundingBox=null,e}c(e,t);var n=e.prototype;return n.getIndexes=function(){return this.indexes},n.getCenter=function(){return this.computeBoundingBox(),this.boundingBox?this.boundingBox.getCenter():void 0},n.setIndexes=function(t){return Array.isArray(t)||ArrayBuffer.isView(t)?this.indexes=new Wr(t,1):Wr.isBufferAttribute(t)&&(this.indexes=t),this},n.getAttribute=function(t){return t?this.attributes[t]:this.attributes},n.setAttribute=function(t,e){return t&&Fr.isBufferAttribute(e)&&(this.attributes[t]=e),this},n.deleteAttribute=function(t){return this.attributes[t]&&delete this.attributes[t],this},n.computeBoundingBox=function(){null===this.boundingBox&&(this.boundingBox=new Nr);var t=this.attributes.position;t&&t.isBufferAttribute&&this.boundingBox.setFromBufferAttribute(t)},e}(Or),qr=new be,Yr=new be,Xr=new be,Kr=function(t){function e(e,n){var r;return(r=t.call(this)||this).type="Mesh",r.geometry=void 0,r.material=void 0,r.materialChanged=void 0,r.__webglInit=!1,r.geometry=void 0!==e?e:new Zr,r.material=void 0!==n?n:null,r.materialChanged=!1,r}c(e,t);var n=e.prototype;return n.updateMaterial=function(t){this.material&&t.isMaterial&&t.uuid!==this.material.uuid&&(this.material=t,this.materialChanged=!0)},n.raycast=function(t){var e=this.geometry,n=e.indexes&&e.indexes.array,r=e.attributes.position.array;if(!n)return null;for(var i=0;i<n.length;i+=3){var o=3*n[i],a=3*n[i+1],s=3*n[i+2],u=qr.set(r[o],r[o+1],r[o+2]).transform(this.worldMatrix),h=Yr.set(r[a],r[a+1],r[a+2]).transform(this.worldMatrix),c=Xr.set(r[s],r[s+1],r[s+2]).transform(this.worldMatrix),l=t.intersectTriangle(u,h,c);if(l)return{distance:l.distance,point:l.point,object:this}}return null},e}(Ur),Qr=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).type="Scene",e.isScene=!0,e.autoUpdate=!0,e}c(e,t);var n=e.prototype;return n.updateWorldMatrix=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!0===this.autoUpdate&&t.prototype.updateWorldMatrix.call(this,e)},n.clone=function(n){return void 0===n&&(n=new e),t.prototype.clone.call(this,n),n.autoUpdate=this.autoUpdate,n},e}(Ur),Jr=function(t){function e(){var e;return(e=t.call(this)||this).type="Geometry",e.vertices=[],e.verticesBufferData=new Float32Array,e.indicesBufferData=new Uint16Array,e.uvtsBufferData=new Float32Array,e.groupsNeedUpdate=!1,e}return c(e,t),e}(Or),$r=new be,ti=new be,ei=new be,ni=new be,ri=new be,ii=function(){function t(t,e){this.origin=void 0,this.direction=void 0,this.origin=t||new be,this.direction=e||new be(0,0,-1)}var e=t.prototype;return e.set=function(t,e){return this.origin.copy(t),this.direction.copy(e),this},e.setFromCamera=function(t,e){var n=new be(e.position[0],e.position[1],e.position[2]),r=(new Vn).fromArray(e.projectionMatrix),i=e.worldMatrix,o=new Me(t[0],t[1],.5,1).transform(r).transform(i),a=o.x,s=o.y,u=o.z,h=new be(a,s,u).sub(n).normalize();this.set(n,h)},e.getPointByLen=function(t,e){var n=void 0!==e?e:new be;return n.copy(this.direction),n.scale(t),n.add(this.origin),n},e.intersectTriangle_Old=function(t,e,n){var r,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0,a=$r.copy(e).subtract(t),s=ti.copy(n).subtract(t),u=ei.copy(a).cross(s),h=ni.copy(this.origin).subtract(t),c=this.direction.dot(u);if(0<c){if(i)return null;r=1}else{if(!(0>c))return null;r=-1,c=-c}s.copy((new be).copy(h).cross(s));var l=r*this.direction.dot(s);if(0>l)return null;var f=r*this.direction.dot((new be).copy(h).cross(a));if(0>f)return null;if(l+f>c)return null;var d=-r*h.dot(u);return 0>d?null:this.getPointByLen(d/c,o)},e.intersectTriangle=function(t,e,n){var r=arguments.length>4?arguments[4]:void 0,i=1e-6,o=$r.subVectors(e,t),a=ti.subVectors(n,t),s=ei.copy(this.direction).cross(a),u=o.dot(s);if(u>-i&&u<i)return null;var h=1/u,c=ni.subVectors(this.origin,t),l=h*c.dot(s);if(l<0||l>1)return null;var f=ri.copy(c).cross(o),d=h*this.direction.dot(f);if(d<0||l+d>1)return null;var p=a.dot(f)*h;return p>i?{distance:p,point:this.getPointByLen(p,r)}:null},e.intersectSphere=function(t,e,n){var r=(new be).subtract(t,this.origin),i=r.dot(this.direction),o=r.dot(r)-i*i,a=e*e;if(o>a)return null;var s=Math.sqrt(a-o),u=i-s,h=i+s;return 0>u&&0>h?null:0>u?this.getPointByLen(h,n):this.getPointByLen(u,n)},t}();function oi(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return ai(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ai(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ai(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var si=function(){function t(t,e,n,r){this.ray=void 0,this.near=void 0,this.far=void 0,this.ray=new ii(t,e),this.near=n||0,this.far=r||1/0}var e=t.prototype;return e.set=function(t,e){this.ray.set(t,e)},e.setFromCamera=function(t,e){var n=new be(e.position[0],e.position[1],e.position[2]),r=(new Vn).fromArray(e.projectionMatrix).invert(),i=e.worldMatrix,o=new Me(t[0],t[1],.5,1).transform(r).transform(i),a=o.x,s=o.y,u=o.z,h=new be(a,s,u).sub(n).normalize();this.set(n,h)},e.pick=function(t){var e,n=this.ray,r=[],i=oi([].concat(t));try{for(i.s();!(e=i.n()).done;){var o=e.value.raycast(n);o&&r.push(o)}}catch(t){i.e(t)}finally{i.f()}return r.sort((function(t,e){return t.distance-e.distance})),r},t}(),ui=function(t){function e(n){var r;return(r=t.call(this)||this).image=void 0,r.flipY=!0,r.premultiplyAlpha=!1,r.needsUpdate=!0,r.glTexture=null,r.isTexture=!0,r.gl=null,r.__textureInit=!1,r.clone=function(t){return void 0===t&&(t=new e),t.image=r.image,t.flipY=r.flipY,t},r.destory=function(){r.emit("destory",r.glTexture)},r.destoryTexture=function(){r.glTexture&&r.gl&&(r.off("destory",r.destoryTexture),r.gl.deleteTexture(r.glTexture))},void 0!==n&&(r.image=n),r}return c(e,t),e.prototype.init=function(t){!0!==this.__textureInit&&(this.gl=t,this.glTexture=t.createTexture(),this.on("destory",this.destoryTexture),this.__textureInit=!0)},e}(Or),hi=function(t){function e(e){var n;return(n=t.call(this)||this).isCube=!0,n.image=e||[],n.flipY=!1,n}return c(e,t),e}(ui),ci=function(){function t(t,e,n){var r=this;this.gl=void 0,this.maxTextureSize=void 0,this.maxTextures=void 0,this.usedTextureUnits=0,this.getTextureUnit=function(){var t=r.usedTextureUnits;return r.usedTextureUnits>=r.maxTextures?r.usedTextureUnits=0:r.usedTextureUnits+=1,t},this.resetUsedTextureUnits=function(){r.usedTextureUnits=0},this.setTexture=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t instanceof hi)r.setCubeTexture(t,e);else{var n=r.gl;n.activeTexture(n.TEXTURE0+e),t.needsUpdate?(t.init(n),r.uploadTexture(n,t)):n.bindTexture(n.TEXTURE_2D,t.glTexture)}},this.setTextureForRenderTarget=function(t){var e=r.gl;t.glTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,t.glTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),r.setTextureParameter(e);var n=e.RGBA,i=e.RGBA,o=e.UNSIGNED_BYTE;e.texImage2D(e.TEXTURE_2D,0,n,t.width,t.height,0,i,o,null)},this.uploadTexture=function(t,e){e.init(t),t.bindTexture(t.TEXTURE_2D,e.glTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),r.setTextureParameter(t),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.image),e.needsUpdate=!1},this.setTextureParameter=function(t){t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)},this.gl=t,this.maxTextureSize=n,this.maxTextures=e}return t.prototype.setCubeTexture=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t.image;if(6!==n.length)throw new Error("[setCubeTexture] CubeTexture need six images, but get\n                ".concat(n.length,"\n            "));var r=this.gl;if(t.needsUpdate){t.init(r),r.activeTexture(r.TEXTURE0+e),r.bindTexture(r.TEXTURE_CUBE_MAP,t.glTexture),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t.flipY),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);for(var i=0;i<6;i++){var o=n[i];r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,o)}t.needsUpdate=!1}else r.bindTexture(r.TEXTURE_CUBE_MAP,t.glTexture)},t}(),li=n((function(t){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r},t.exports.__esModule=!0,t.exports.default=t.exports}));e(li);var fi=n((function(t){t.exports=function(t){if(Array.isArray(t))return li(t)},t.exports.__esModule=!0,t.exports.default=t.exports}));e(fi);var di=n((function(t){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.__esModule=!0,t.exports.default=t.exports}));e(di);var pi=n((function(t){t.exports=function(t,e){if(t){if("string"==typeof t)return li(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?li(t,e):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports}));e(pi);var vi=n((function(t){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports}));e(vi);var mi=e(n((function(t){t.exports=function(t){return fi(t)||di(t)||pi(t)||vi()},t.exports.__esModule=!0,t.exports.default=t.exports}))),gi=n((function(t){t.exports=function(t){if(Array.isArray(t))return t},t.exports.__esModule=!0,t.exports.default=t.exports}));e(gi);var yi=n((function(t){t.exports=function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}},t.exports.__esModule=!0,t.exports.default=t.exports}));e(yi);var _i=n((function(t){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports}));e(_i);var xi=e(n((function(t){t.exports=function(t,e){return gi(t)||yi(t,e)||pi(t,e)||_i()},t.exports.__esModule=!0,t.exports.default=t.exports}))),bi=function(t,e,n){if(t&&e&&e.length)for(var r=e.length,i=0;i<r;i++){var o=void 0,a=void 0,s=void 0,u=e[i],h=xi(u,2),c=h[0],l=h[1],f=c.type,d=c.value;switch(c.type){case"1i":case"1f":t["uniform".concat(f)](l,c.value);break;case"2f":case"3f":case"4f":t["uniform".concat(f)].apply(t,[l].concat(mi(d)));break;case"t":if(!(o=c.value)||!o.image&&!o.glTexture)break;a=n.getTextureUnit(),t.uniform1i(l,a),n.setTexture(o,a);break;case"tv":s=[];for(var p=c.value,v=0,m=p.length;v<m;v++)s[v]=n.getTextureUnit();t.uniform1iv(l,s);for(var g=0,y=p.length;g<y;g++)(o=p[g])&&(o.image||o.glTexture)&&(a=s[g],n.setTexture(o,a));break;case"mat4fv":t.uniformMatrix4fv(l,!1,c.value);break;default:console.warn("[UniformOperation] Unknown uniform type: ".concat(f))}}};var Mi="\nvoid main() {\n    gl_Position = mvpMatrix * vec4(position, 1.0);\n}\n",wi="\nvoid main() {\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n",Ei=0,Ti=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).isMaterial=!0,e.id=Ei++,e.type="Material",e.name="",e.uuid=Br(),e.uniforms={},e.vertexShader=Mi,e.fragmentShader=wi,e.program=null,e.depthTest=!0,e.visible=!0,e.opacity=1,e.needsUpdate=!0,e.uniformsList=[],e}c(e,t);var n=e.prototype;return n.setValues=function(t){if(void 0!==t)for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var n=t[e];if(void 0===n){console.warn("Material: '"+e+"' parameter is undefined.");continue}if(void 0===this[e]){console.warn("".concat(this.type,": ").concat(e," is not a property of this material."));continue}var r="set"+e.charAt(0).toUpperCase()+e.slice(1);"function"==typeof this[r]?this[r](n):this[e]=n}},n.clone=function(){return(new e).copy(this)},n.copy=function(t){return this.uniforms=function(t){var e,n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))for(var i in n[r]={},t[r])Object.prototype.hasOwnProperty.call(t[r],i)&&((e=t[r][i])&&e.isTexture?n[r][i]=e.clone():n[r][i]=e instanceof Array?e.slice(0):e);return n}(t.uniforms),this.depthTest=t.depthTest,this.visible=t.visible,this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this},o(e,[{key:"defines",get:function(){return""}}]),e}(Or),Ai={useColor:"USE_COLOR",useUV:"NEED_UV"},Ci=function(){function t(){this.useColor=!1,this.useUV=!1}return t.prototype.getDefines=function(){for(var t=[],e=0,n=Object.keys(this);e<n.length;e++){var r=n[e];Ai[r]&&!0===this[r]&&t.push("#define ".concat(Ai[r]))}return t.push(""),t.join("\n")},t}(),Ri="\n#ifdef NEED_UV\n    varying vec2 vUV;\n#endif\nvoid main(void) {\n    gl_Position = mvpMatrix * vec4(position, 1.0);\n    #ifdef NEED_UV\n        vUV = uv;\n    #endif\n}\n",Si="\nprecision mediump float;\n#ifdef NEED_UV\n    varying vec2 vUV;\n    uniform sampler2D uSampler;\n#endif\n#ifdef USE_COLOR\n    uniform vec4 uColor;\n#endif\nuniform float uOpacity;\nvoid main(void) {\n    vec4 finalColor;\n    vec4 defaultColor = vec4(1.0, 0.0, 0.0, 1.0);\n    finalColor = defaultColor;\n    #ifdef USE_COLOR\n        finalColor = uColor;\n    #endif\n    #ifdef NEED_UV\n        finalColor = texture2D(uSampler, vUV);\n    #endif\n    gl_FragColor = vec4(finalColor.rgb, finalColor.a * uOpacity);\n}\n",Pi=function(t){function e(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(e=t.call(this)||this).map=null,e.color=[1,0,0,1],e.type="BasicMaterial",e.opacity=1,e.depthTest=!0,e.vertexShader=Ri,e.fragmentShader=Si,e.uniforms={uSampler:{type:"t",value:null},uColor:{type:"4f",value:[1,0,0,1]},uOpacity:{type:"1f",value:e.opacity}},e.setValues(n),e}c(e,t);var n=e.prototype;return n.setOpacity=function(t){this.uniforms.uOpacity.value=t,this.opacity=t},n.setColor=function(t){!Array.isArray(t)||t.length<4||(this.uniforms.uColor.value=t,this.color=t)},n.setMap=function(t){var e=this;t&&(t instanceof Promise?t.then((function(t){e.uniforms.uSampler.value=t instanceof ui==!0?t:new ui(t)})).catch((function(t){return console.error(t)})):!0===t.isTexture&&(this.uniforms.uSampler.value=t),this.map=t)},o(e,[{key:"defines",get:function(){var t=new Ci;return t.useColor=!!this.color,t.useUV=!!this.map,t.getDefines()}}]),e}(Ti),Di=function(t){var e=this;this.gl=void 0,this.newAttributes=new Uint8Array(16),this.enabledAttributes=new Uint8Array(16),this.currentDepthTest=!1,this.currentDepthWrite=!0,this.currentColorWrite=!0,this.currentDoubleSided=!1,this.currentFlipSided=!1,this.initAttributes=function(){for(var t=0,n=e.newAttributes.length;t<n;t++)e.newAttributes[t]=0},this.enableAttribute=function(t){var n=e.gl,r=e.newAttributes,i=e.enabledAttributes;r[t]=1,0===i[t]&&(n.enableVertexAttribArray(t),i[t]=1)},this.disableAttribute=function(t){var n=e.gl,r=e.newAttributes,i=e.enabledAttributes;r[t]=0,1===i[t]&&(n.disableVertexAttribArray(t),i[t]=0)},this.disableUnusedAttributes=function(){for(var t=e.gl,n=e.newAttributes,r=e.enabledAttributes,i=0,o=r.length;i<o;i++)r[i]!==n[i]&&(t.disableVertexAttribArray(i),r[i]=0)},this.setDepthTest=function(t){var n=e.gl;e.currentDepthTest!==t&&(t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),e.currentDepthTest=t)},this.setDepthWrite=function(t){var n=e.gl;e.currentDepthWrite!==t&&(n.depthMask(t),e.currentDepthWrite=t)},this.setColorWrite=function(t){var n=e.gl;e.currentColorWrite!==t&&(n.colorMask(t,t,t,t),e.currentColorWrite=t)},this.setDefaultGLState=function(t,n,r,i){var o=e.gl;o.clearColor(229/255,227/255,223/255,1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.clearDepth(1),o.clearStencil(0),o.disable(o.DEPTH_TEST),o.depthFunc(o.LEQUAL),o.frontFace(o.CCW),o.disable(o.CULL_FACE),o.depthMask(!0),o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.viewport(t,n,r,i)},this.setDoubleSided=function(t){var n=e.gl;e.currentDoubleSided!==t&&(t?n.disable(n.CULL_FACE):n.enable(n.CULL_FACE),e.currentDoubleSided=t)},this.setFlipSided=function(t){var n=e.gl;e.currentFlipSided!==t&&(t?n.frontFace(n.CW):n.frontFace(n.CCW),e.currentFlipSided=t)},this.reset=function(){for(var t=e.enabledAttributes,n=0;n<t.length;n++)t[n]=0;e.currentDepthTest=!1,e.currentDepthWrite=!0,e.currentColorWrite=!0,e.currentDoubleSided=!1,e.currentFlipSided=!1},this.gl=t},Oi=function(t){var e=this;this.maxTextures=void 0,this.maxTextureSize=void 0,this.maxVerticesOneDraw=void 0,this.maxVertexShaderTextureUnits=void 0,this.maxFragmentShaderTextureUnits=void 0,this.gl=void 0,this.getMaxTextures=function(){var t=e.gl;return t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS)},this.getLineWidthRange=function(){var t=e.gl;return t.getParameter(t.ALIASED_LINE_WIDTH_RANGE)},this.getMaxVertexShaderTextureUnits=function(){var t=e.gl;return t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)},this.getMaxFragmentShaderTextureUnits=function(){var t=e.gl;return t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)},this.getMaxTextureSize=function(){var t=e.gl;return t.getParameter(t.MAX_TEXTURE_SIZE)},this.getMaxVerticesOneDraw=function(){return e.gl.getExtension("OES_element_index_uint")?4294967296:65535},this.getLegalPrecision=function(t){var n=e.gl,r=n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT),i=n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT),o=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT),a=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT),s=r&&o&&r.precision>0&&o.precision>0,u=i&&a&&i.precision>0&&a.precision>0;return"highp"!==t||s?"mediump"!==t||u||(t="lowp",console.warn("[WebGLCapability] mediump is not supported, using lowp by default.")):u?(t="mediump",console.warn("[WebGLCapability] highp is not supported, using mediump by default.")):(t="lowp",console.warn("[WebGLCapability] highp and mediump is not supported, using lowp by default.")),t},this.gl=t,this.maxTextures=this.getMaxTextures(),this.maxVertexShaderTextureUnits=this.getMaxVertexShaderTextureUnits(),this.maxFragmentShaderTextureUnits=this.getMaxFragmentShaderTextureUnits(),this.maxTextureSize=this.getMaxTextureSize(),this.maxVerticesOneDraw=this.getMaxVerticesOneDraw()},Ii=0,Li=function(t,e,n){var r=t.createShader(n);if(!r)throw new Error("Something went wrong while compile the shader.");return t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)||console.error("Error compiling shader: ".concat(t.getShaderInfoLog(r))),r},Bi=function(){function t(t,e,n){this.usedTimes=void 0,this.id=void 0,this.code=void 0,this.program=void 0,this.attributes=void 0,this.uniforms=void 0,this.gl=void 0,this.parameters=void 0,this.precision=void 0,this.gl=t,this.parameters=e,this.precision=n.precision||"highp",this.usedTimes=1,this.id=Ii++;var r=e.defines,i=void 0===r?"":r,o=e.vertexShader,a=e.fragmentShader;this.code=i+o+a,this.program=this.createProgram(t,e,this.precision),this.attributes=this.fetchAttributes(t,this.program),this.uniforms=function(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i={},o=r.length;if(!o)return i;for(var a=0;a<o;a++)i[n=r[a]]=t.getUniformLocation(e,n);return i}(t,this.program,this.getFullUniforms(e.uniforms))}var e=t.prototype;return e.getAttributes=function(){return this.attributes},e.getUniforms=function(){return this.uniforms},e.createProgram=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"highp",r=e.vertexShader,i=e.fragmentShader,o=e.defines,a=void 0===o?"":o,s=["precision ".concat(n," float;"),"uniform mat4 modelMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat4 mvpMatrix;","attribute vec3 position;","attribute vec2 uv;",""].join("\n"),u=t.createProgram(),h=["precision ".concat(n," float;"),""].join("\n"),c=Li(t,s+a+r,t.VERTEX_SHADER),l=Li(t,h+a+i,t.FRAGMENT_SHADER);if(!u)throw new Error("Something went wrong while createProgram.");return t.attachShader(u,c),t.attachShader(u,l),t.linkProgram(u),u},e.fetchAttributes=function(t,e){for(var n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),i=0;i<r;i++){var o=t.getActiveAttrib(e,i);if(!o)throw new Error("Something went wrong while getActiveAttrib.");var a=o.name;n[a]=t.getAttribLocation(e,a)}return n},e.getFullUniforms=function(t){var e=["mvpMatrix","modelMatrix","projectionMatrix","viewMatrix"];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e},t}(),ki={canvas:document.createElement("canvas"),context:void 0,width:0,height:0,pixelRatio:1,precision:"highp",alpha:!1,premultipliedAlpha:!0,antialias:!0,stencil:!0,depth:!0,preserveDrawingBuffer:!1},Ui=function(){function t(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.state=void 0,this.domElement=void 0,this.capability=void 0,this.textureOperation=void 0,this._gl=void 0,this.parameters=void 0,this.programs=void 0,this.viewportInfo=void 0,this.autoDisposeProgram=!0,this.currentCacheState=void 0,this.setSize=function(e,n){var r=t.parameters,i=r.canvas,o=r.pixelRatio;i.style.width="".concat(e,"px"),i.style.height="".concat(n,"px"),i.width=e*o,i.height=n*o,t.setViewport(0,0,e,n)},this.setViewport=function(e,n,r,i){var o=t.parameters.pixelRatio,a=t.viewportInfo;a.x=e*o,a.y=n*o,a.width=r*o,a.height=i*o,t._gl.viewport.apply(t._gl,Object.values(a))},this.setClearColor=function(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;!0===t.parameters.premultipliedAlpha&&(e*=i,n*=i,r*=i),t._gl.clearColor(e,n,r,i)},this.getContext=function(){return t._gl},this.forceContextLoss=function(){try{var e=t._gl.getExtension("WEBGL_lose_context");e&&e.loseContext()}catch(t){console.error("[WebGLRenderer] WEBGL_lose_context error: ",t)}},this.initScene=function(e){!0===e.visible&&e.traverse((function(e){!0===e.visible&&e instanceof Kr&&t.initMesh(e)}))},this.initMesh=function(e){!0===e.visible&&(!0!==e.__webglInit&&(e.__webglInit=!0,e.addEventListener("removed",t.onObjectRemoved)),e.geometry&&t.checkAndUpdateGeometry(e.geometry),e.children&&e.children.length>0&&e.children.forEach((function(e){t.initMesh(e)})))},this.checkAndUpdateGeometry=function(e){!0!==e.__webglInit&&(e.__webglInit=!0,e.addEventListener("removed",t.onGeometryRemove),e.groupsNeedUpdate=!0),!0===e.groupsNeedUpdate&&("BufferGeometry"===e.type?t.updateBufferGeometry(e):t.updateGeometryBuffer(e,t._gl.STATIC_DRAW),e.groupsNeedUpdate=!1)},this.updateGeometryBuffer=function(e,n){var r=e.verticesBufferData,i=e.uvtsBufferData,o=e.indicesBufferData,a=e.borderVerticesBufferData,s=t._gl;0<r.length&&(e.glVerticesBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,e.glVerticesBuffer),s.bufferData(s.ARRAY_BUFFER,r,n)),0<i.length&&(e.glUvtsBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,e.glUvtsBuffer),s.bufferData(s.ARRAY_BUFFER,i,n)),0<o.length&&(e.glIndicesBuffer=s.createBuffer(),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.glIndicesBuffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,o,n)),!0===e.showBorder&&void 0!==a&&0<a.length&&(e.glBorderVerticesBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,e.glBorderVerticesBuffer),s.bufferData(s.ARRAY_BUFFER,e.borderVerticesBufferData,n))},this.renderScene=function(e,n){!0===e.visible&&e.traverse((function(e){e instanceof Kr&&(t.renderObject(e,n),e.children.length&&e.children.forEach((function(e){t.renderObject(e,n)})))}))},this.renderObject=function(e,n){var r=e.material,i=e.geometry;if(!0===e.visible&&r&&i&&!0===r.visible){t.state.setDepthTest(r.depthTest);var o=!1,a=t.setProgram(n,r,e);o="BufferGeometry"===i.type?t.updateVerticesAttribute2(a,i,!1):t.updateVerticesAttribute(a,i,!1),t.renderGeometryWithProgram(a,i,r,o)}},this.setProgram=function(e,n,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=t._gl;t.textureOperation.resetUsedTextureUnits(),t.checkAndUpdateMaterial(r.material);var a=n.program,s=a.getUniforms();return a.id!==t.currentCacheState.programId&&(o.useProgram(a.program),t.currentCacheState.programId=a.id),!1!==i&&bi(o,n.uniformsList,t.textureOperation),t.updateMVPMatrix(s,e,r),a},this.checkAndUpdateMaterial=function(e){void 0!==e&&(!0!==e.__webglInit&&(e.__webglInit=!0,e.addEventListener("removed",t.onMaterialRomove),e.needsUpdate=!0),!0===e.needsUpdate&&(t.updateMaterial(e),e.needsUpdate=!1))},this.updateMaterial=function(e){e.program&&t.removeMaterial(e);for(var n=null,r=t.programs.length,i=e.defines,o=(void 0===i?"":i)+e.vertexShader+e.fragmentShader,a=r-1;a>=0;a--){var s=t.programs[a];if(s.code===o){(n=s).usedTimes++;break}}if(null===n){var u={uniforms:e.uniforms,defines:e.defines||"",vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};n=new Bi(t._gl,u,{precision:t.parameters.precision}),t.programs.push(n)}e.program=n,e.uniformsList=[];var h=0,c=n.uniforms,l=e.uniforms;for(var f in l)if(Object.prototype.hasOwnProperty.call(l,f)){var d=c[f];d&&(e.uniformsList[h]=[l[f],d],h++)}},this.updateMVPMatrix=function(e,n,r){if(void 0!==e.mvpMatrix){var i=De(n.projectionMatrix);Ue(i,i,n.viewMatrix),Ue(i,i,r.worldMatrix),t._gl.uniformMatrix4fv(e.mvpMatrix,!1,i),t._gl.uniformMatrix4fv(e.modelMatrix,!1,r.worldMatrix),t._gl.uniformMatrix4fv(e.viewMatrix,!1,n.viewMatrix),t._gl.uniformMatrix4fv(e.projectionMatrix,!1,n.projectionMatrix)}t.currentCacheState.camera=n},this.renderGeometryWithProgram=function(e,n,r){var i=t._gl,o=t.currentCacheState.curRenderTarget;if(e.uniforms.showDebugLine&&i.uniform1i(e.uniforms.showDebugLine,0),"BufferGeometry"===n.type?i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n.indexesBuffer):i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n.glIndicesBuffer),null!==o&&void 0!==o.glFrameBuffer){var a=i.checkFramebufferStatus(i.FRAMEBUFFER);if(i.FRAMEBUFFER_COMPLETE!==a)return t.removeRenderTarget(o),void(t.currentCacheState.curRenderTarget=null)}n.indexes&&n.indexes.count>0?i.drawElements(i.TRIANGLES,n.indexes.count,i.UNSIGNED_SHORT,0):i.drawArrays(i.TRIANGLES,0,n.attributes.position.count)},this.onObjectRemoved=function(e){e.target.traverse((function(e){e.removeEventListener("removed",t.onObjectRemoved),t.removeObject(e)}))},this.onGeometryRemove=function(e){var n=e.target;n.removeEventListener("removed",t.onGeometryRemove),t.removeGeometry(n)},this.onMaterialRomove=function(e){var n=e.target;n.removeEventListener("removed",t.onMaterialRomove),t.removeMaterial(n)},this.onRenderTargetRemove=function(e){var n=e.target;n.removeEventListener("removed",t.onRenderTargetRemove),t.removeRenderTarget(n)},this.removeObject=function(t){t.geometry&&delete t.geometry.__webglInit,delete t.__webglInit},this.removeGeometry=function(e){delete e.__webglInit,t.deleteBuffers(e),t.currentCacheState.geometryProgramId=null},this.deleteBuffers=function(e){["glVerticesBuffer","glUvtsBuffer","glIndicesBuffer","glBorderVerticesBuffer"].forEach((function(n){t._gl.deleteBuffer(e[n]),void 0!==e[n]&&0<e[n]&&delete e[n]}))},this.removeMaterial=function(e){var n=e.program.program;if(n){e.program=null;for(var r=t.programs,i=r.length-1;i>=0;i--){var o=r[i];if(o.program===n){o.usedTimes--,0===o.usedTimes&&!1!==t.autoDisposeProgram&&(r.splice(i,1),t._gl.deleteProgram(n));break}}}},this.removeRenderTarget=function(e){t._gl.deleteRenderbuffer(e.glDepthBuffer),e.glDepthBuffer=null,t._gl.deleteTexture(e.glTexture),e.glTexture=null,t._gl.deleteFramebuffer(e.glFrameBuffer),e.glFrameBuffer=null},this.parameters=Object.assign({},ki,e),e&&!e.canvas&&(this.parameters.canvas=document.createElement("canvas")),this.initGL(),this.programs=[],this.viewportInfo={x:0,y:0,width:this.parameters.canvas.width,height:this.parameters.canvas.height},this.parameters.width&&this.parameters.height&&this.setSize(this.parameters.width,this.parameters.height),this.domElement=this.parameters.canvas,this.state=new Di(this._gl),this.state.setDefaultGLState.apply(this.state,Object.values(this.viewportInfo)),this.currentCacheState={programId:null,geometryProgramId:null,materialId:null,camera:null,curRenderTarget:null},this.capability=new Oi(this._gl);var n=this.capability.maxTextures,r=this.capability.maxTextureSize;this.textureOperation=new ci(this._gl,n,r)}var e=t.prototype;return e.clearBuffer=function(){var t=this._gl;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.initGL=function(){var t=this,e=this.parameters,n=e.canvas,r=e.context,i=e.alpha,o=e.depth,a=e.stencil,s=e.antialias,u=e.premultipliedAlpha,h=e.preserveDrawingBuffer;try{var c={alpha:i,depth:o,stencil:a,antialias:s,premultipliedAlpha:u,preserveDrawingBuffer:h},l=r||n.getContext("webgl",c)||n.getContext("experimental-webgl",c)||n.getContext("moz-webgl",c)||n.getContext("webkit-3d",c);if(!l)throw null!==n.getContext?"Error creating WebGL context with your provided attributes.":"Error creating WebGL context.";this._gl=l,n.addEventListener("webglcontextlost",(function(e){e.preventDefault(),void 0!==t.state&&(t.resetGLState(),t.state.setDefaultGLState.apply(t.state,Object.values(t.viewportInfo)))}),!1)}catch(t){console.error("[WebGLRenderer] Create webgl error: ",t)}},e.resetGLState=function(){this.currentCacheState={programId:null,geometryProgramId:null,materialId:null,camera:null,curRenderTarget:null},this.state.reset()},e.setRenderTarget=function(t){var e=this._gl;void 0!==t&&null===t.glFrameBuffer&&(t.addEventListener("removed",this.onRenderTargetRemove),t.glFrameBuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,t.glFrameBuffer),this.textureOperation.setTextureForRenderTarget(t),t.glDepthBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,t.glDepthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.width,t.height),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.glTexture,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t.glDepthBuffer),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null))},e.render=function(t,e,n){if(e.isCamera){var r=this._gl;if(t.updateWorldMatrix(),e.updateWorldMatrix(),e.updateProjectionMatrix(),this.currentCacheState.camera=null,void 0!==n)this.setRenderTarget(n),this.currentCacheState.curRenderTarget=n,r.bindFramebuffer(r.FRAMEBUFFER,n.glFrameBuffer),r.viewport(0,0,n.width,n.height);else{var i=this.viewportInfo,o=i.width,a=i.height;this.currentCacheState.curRenderTarget=null,r.bindFramebuffer(r.FRAMEBUFFER,null),r.viewport(0,0,o,a)}this.initScene(t),this.renderScene(t,e)}else console.error("[WebGLRenderer]  Camera is not leagal.")},e.updateBufferGeometry=function(t){var e=this._gl,n=t.getIndexes(),r=t.getAttribute();for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){var o=i+"Buffer",a=r[i],s=a.array,u=a.usage;t[o]=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t[o]),e.bufferData(e.ARRAY_BUFFER,s,u)}n&&(t.indexesBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexesBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,n.array,n.usage))},e.updateVerticesAttribute2=function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this._gl,i=!1,o="".concat(e.id,"_").concat(t.id);if(o!==this.currentCacheState.geometryProgramId){this.currentCacheState.geometryProgramId=o,this.state.initAttributes(),i=!0;var a=e.getAttribute();for(var s in a)if(Object.prototype.hasOwnProperty.call(a,s)){var u=s+"Buffer",h=a[s],c=h.itemSize,l=h.type,f=h.normalized;0<=t.attributes[s]&&(!0!==n&&(r.bindBuffer(r.ARRAY_BUFFER,e[u]),r.vertexAttribPointer(t.attributes[s],c,l,f,0,0)),this.state.enableAttribute(t.attributes[s]))}}return this.state.disableUnusedAttributes(),i},e.updateVerticesAttribute=function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this._gl,i=!1,o="".concat(e.id,"_").concat(t.id);if(o!==this.currentCacheState.geometryProgramId){this.currentCacheState.geometryProgramId=o,this.state.initAttributes(),i=!0;var a=t.getAttributes();0<=a.position&&(!0!==n&&(r.bindBuffer(r.ARRAY_BUFFER,e.glVerticesBuffer),r.vertexAttribPointer(a.position,3,r.FLOAT,!1,0,0)),this.state.enableAttribute(a.position)),0<=a.uv&&void 0!==e.glUvtsBuffer&&(r.bindBuffer(r.ARRAY_BUFFER,e.glUvtsBuffer),r.vertexAttribPointer(a.uv,2,r.FLOAT,!1,0,0),this.state.enableAttribute(a.uv))}return this.state.disableUnusedAttributes(),i},t}(),Ni=function(t){function e(e,n,r,i,o,a){var s;switch((s=t.call(this)||this).addIntoBuffer=function(t,e,n){t[n]=e[0],t[n+1]=e[1],t[n+2]=e[2]},s.get3DVertex=function(t,e){var n;switch(e){case"x":n=Vt(0,t[0],t[1]);break;case"y":n=Vt(t[0],0,t[1]);break;default:n=Vt(t[0],t[1],0)}return n},s.zeroAxis=void 0!==o?o:"z",s.zeroAxis){case"x":s.normal=Vt(-1,0,0);break;case"y":default:s.normal=Vt(0,-1,0);break;case"z":s.normal=Vt(0,0,-1)}a=void 0!==a?a:{},s.showBorder=!(!1===a.showBorder),s.borderWidth=void 0!==a.borderWidth?a.borderWidth:1,s.borderColor=void 0!==a.borderColor?a.borderColor:[0,0,0,1];var u,h,c,l=.5*e,f=.5*n,d=r||1,p=i||1,v=e/d,m=n/p,g=(d+1)*(p+1);s.verticesBufferData=new Float32Array(3*g),s.uvtsBufferData=new Float32Array(2*g),s.indicesBufferData=new(g>65535?Uint32Array:Uint16Array)(d*p*6);for(var y=0,_=0,x=0;x<=p;x++){u=x*m-f;for(var b=0;b<=d;b++)c=_t(b*v-l,u),h=s.get3DVertex(c,s.zeroAxis),s.vertices.push(h),s.addIntoBuffer(s.verticesBufferData,h,y),s.uvtsBufferData[_]=b/d,s.uvtsBufferData[_+1]=1-x/p,y+=3,_+=2}for(var M,w,E,T,A=0,C=0;C<p;C++)for(var R=0;R<d;R++)M=R+(d+1)*C,w=R+(d+1)*(C+1),E=R+1+(d+1)*(C+1),T=R+1+(d+1)*C,s.addIntoBuffer(s.indicesBufferData,[M,w,E],A),s.addIntoBuffer(s.indicesBufferData,[M,E,T],A+3),A+=6;s.borderIndicesBufferData=new Uint16Array(4),s.borderIndicesBufferData[0]=0,s.borderIndicesBufferData[1]=d,s.borderIndicesBufferData[2]=(d+1)*p,s.borderIndicesBufferData[3]=(d+1)*(p+1)-1;var S=0;s.borderVerticesBufferData=new Float32Array(6*(d+p));for(var P=0;P<g;P+=d+1)s.addIntoBuffer(s.borderVerticesBufferData,s.vertices[P],S),S+=3;for(var D=(d+1)*p+1;D<g;D++)s.addIntoBuffer(s.borderVerticesBufferData,s.vertices[D],S),S+=3;for(var O=(d+1)*p-1;O>0;O-=d+1)s.addIntoBuffer(s.borderVerticesBufferData,s.vertices[O],S),S+=3;for(var I=d-1;I>0;I--)s.addIntoBuffer(s.borderVerticesBufferData,s.vertices[I],S),S+=3;return s}return c(e,t),e}(Jr),Fi="z",ji=function(t){function e(n,r,i,o){var a,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};a=t.call(this)||this;var u=e.buildPlane(n,r,i,o,s),h=u.uvs,c=u.indices,l=u.normals,f=u.vertices;return a.name="PlaneBufferGeometry",a.setAttribute("position",new Gr(f,3)),a.setAttribute("normals",new Gr(l,3)),a.setAttribute("uv",new Gr(h,2)),a.setIndexes(c),a}return c(e,t),e.buildPlane=function(t,n,r,i){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=o.normalAxis,s=void 0===a?Fi:a,u=o.useBack,h=void 0!==u&&u,c=o.normalDest,l=void 0===c?0:c,f=.5*t,d=.5*n,p=r||1,v=i||1,m=t/p,g=n/v,y=e.getNormal(s,h),_=[],x=[],b=[],M=[],w=0;w<=v;w++)for(var E=w*g-d,T=0;T<=p;T++){var A=T*m-f,C=e.get3DVertex([A,E],s,l);b.push.apply(b,mi(C)),_.push(T/p,1-w/v),M.push.apply(M,mi(y))}for(var R=0;R<v;R++)for(var S=0;S<p;S++){var P=S+(p+1)*R,D=S+(p+1)*(R+1),O=S+1+(p+1)*(R+1),I=S+1+(p+1)*R;x.push(P,D,O),x.push(P,O,I)}return{uvs:_,indices:x,vertices:b,normals:M}},e.getNormal=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=n?-1:1;switch(t){case"x":e=[r,0,0];break;case Fi:e=[0,0,r];break;default:e=[0,r,0]}return e},e}(Zr);ji.get3DVertex=function(t,e){var n,r=xi(t,2),i=r[0],o=r[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;switch(e){case"x":n=[a,i,o];break;case"y":n=[i,a,o];break;default:n=[i,o,a]}return n};var zi=function(t){function e(e,n,r,i,o,a){var s;(s=t.call(this)||this).name="BoxGeometry";var u=s.initBox(e,n,r,i,o,a),h=u.uvs,c=u.normals,l=u.vertices,f=u.indices;return s.setAttribute("position",new Gr(l,3)),s.setAttribute("normals",new Gr(c,3)),s.setAttribute("uv",new Gr(h,2)),s.setIndexes(f),s}return c(e,t),e.prototype.initBox=function(t,e,n,r,i,o){var a=[],s=ji.buildPlane,u=s(n,e,o,i,{normalAxis:"x",normalDest:t/2}),h=s(n,e,o,i,{normalAxis:"x",useBack:!0,normalDest:-t/2}),c=s(t,n,r,o,{normalAxis:"y",normalDest:e/2}),l=s(t,n,r,o,{normalAxis:"y",useBack:!0,normalDest:-e/2}),f=s(t,e,r,i,{normalAxis:"z",normalDest:n/2}),d=s(t,e,r,i,{normalAxis:"z",useBack:!0,normalDest:-n/2});a.push(u,h,c,l,f,d);for(var p=0,v=[],m=[],g=[],y=[],_=function(t){var e=a[t],n=e.uvs,r=e.vertices,i=e.normals,o=e.indices,s=p;v=v.concat(n),m=m.concat(r),g=g.concat(i),y=y.concat(o.map((function(t){return s+t}))),p+=r.length/3},x=0;x<6;x++)_(x);return{uvs:v,vertices:m,normals:g,indices:y}},e}(Zr),Vi=function(t){function e(e,n){var r;return(r=t.call(this)||this).width=void 0,r.height=void 0,r.glFrameBuffer=null,r.glDepthBuffer=null,r.flipY=!1,r.premultiplyAlpha=!1,r.glTexture=null,r.width=e,r.height=n,r}return c(e,t),e}(Or);function Gi(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Wi(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wi(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Wi(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Hi=function(){function t(){this.faceCount=0,this.verticesCoords=[],this.textureCoords=[],this.uvs=[],this.vertices=[],this.normals=[],this.indexes=[]}var e=t.prototype;return e.load=function(t){var e=this;return new Promise((function(n){(function(t){var e=new XMLHttpRequest;return e.open("GET",t,!0),e.send(null),new Promise((function(t){e.addEventListener("load",(function(){t(e.responseText)}),!1)}),(function(t){e.addEventListener("error",(function(e){console.error("request error"),t(e)}),!1)}))})(t).then((function(t){e.parse(t);var r=e.genObject3D();n(r)}))}))},e.genObject3D=function(){var t=new Zr;t.setAttribute("position",new Gr(this.vertices,3)),this.uvs.length&&t.setAttribute("uv",new Gr(this.uvs,2)),t.setIndexes(this.indexes);var e=new Pi;return new Kr(t,e)},e.parse=function(t){var e,n=Gi(t.split("\n"));try{for(n.s();!(e=n.n()).done;){var r=e.value,i=r.indexOf("#");-1!==i&&(r=r.substring(0,i));var o=(r=r.trim()).split(/\s+/);switch(o[0]){case"v":this.verticesCoords.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));break;case"vn":this.normals.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));break;case"vt":this.textureCoords.push(parseFloat(o[1]),parseFloat(o[2]));break;case"p":case"l":case"usemtl":break;case"f":o.shift(),this.parseFaceLine(o)}}}catch(t){n.e(t)}finally{n.f()}},e.parseFaceLine=function(t){for(var e=[],n=t.length,r=0;r<n;r++){var i=t[r];if(i.length>0){var o=i.split("/");e.push(o)}}for(var a=e[0],s=1,u=e.length-1;s<u;s++){var h=e[s],c=e[s+1];this.addFace(a,h,c)}},e.addFace=function(t,e,n){var r=this.verticesCoords,i=r.length/3,o=this.parseVertexIndex(t[0],i),a=this.parseVertexIndex(e[0],i),s=this.parseVertexIndex(n[0],i);this.vertices.push(r[o],r[o+1],r[o+2],r[a],r[a+1],r[a+2],r[s],r[s+1],r[s+2]);var u=3*this.faceCount;if(this.indexes.push(u,u+1,u+2),this.faceCount++,""!==t[1]){var h=this.textureCoords,c=h.length,l=this.parseUVIndex(t[1],c),f=this.parseUVIndex(e[1],c),d=this.parseUVIndex(n[1],c);this.uvs.push(h[l],h[l+1],h[f],h[f+1],h[d],h[d+1])}t[2]},e.parseVertexIndex=function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},e.parseUVIndex=function(t,e){var n=parseInt(t,10);return 2*(n>=0?n-1:n+e/2)},t}();function Zi(t){return new Promise((function(e,n){var r=new Image;r.src=t,r.crossOrigin="Anonymous",r.onload=function(){e(r)},r.onerror=function(t){n(t)}}))}function qi(t){if(6!==t.length)throw new Error("[loadCubeTexture] param urls need len six. [px, nx, py, ny, pz, nz]");return new Promise((function(e,n){for(var r=0,i=new hi,o=i.image,a=function(a){Zi(t[a]).then((function(t){r++,o[a]=t,6===r&&(i.needsUpdate=!0,e(i))})).catch((function(t){console.error(t),n(t)}))},s=0;s<6;s++)a(s)}))}var Yi=function(t){function e(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;return(e=t.call(this)||this).isCamera=!0,e.viewMatrix=Pe(),e.projectionMatrix=Pe(),e.projectionMatrixNeedUpdate=!1,e._far=void 0,e._near=void 0,e._far=r,e._near=n,e}return c(e,t),e.prototype.updateWorldMatrix=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t.prototype.updateWorldMatrix.call(this,e),Be(this.viewMatrix,this.worldMatrix)},o(e,[{key:"near",get:function(){return this._near},set:function(t){this._near=t,this.projectionMatrixNeedUpdate=!0}},{key:"far",get:function(){return this._far},set:function(t){this._far=t,this.projectionMatrixNeedUpdate=!0}}]),e}(Ur),Xi=function(t){function e(e,n,r,i,o,a){var s;return(s=t.call(this,o,a)||this)._left=void 0,s._right=void 0,s._top=void 0,s._bottom=void 0,s._top=r,s._left=e,s._right=n,s._bottom=i,s.updateProjectionMatrix(!0),s}c(e,t);var n=e.prototype;return n.updateProjectionMatrix=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===t||!0===this.projectionMatrixNeedUpdate){var e=(this.right-this.left)/2,n=(this.top-this.bottom)/2,r=(this.right+this.left)/2,i=(this.top+this.bottom)/2,o=r-e,a=r+e,s=i+n,u=i-n;Ie(this.projectionMatrix),$e(this.projectionMatrix,o,a,s,u,this.near,this.far),this.projectionMatrixNeedUpdate=!1}},n.clone=function(n){return void 0===n&&(n=new e(0,0,0,0,0,0)),t.prototype.clone.call(this,n),n.left=this.left,n.right=this.right,n.top=this.top,n.bottom=this.bottom,n.near=this.near,n.far=this.far,n.updateProjectionMatrix(),n.updateWorldMatrix(),n},o(e,[{key:"top",get:function(){return this._top},set:function(t){t!==this._top&&(this._top=t,this.projectionMatrixNeedUpdate=!0)}},{key:"left",get:function(){return this._left},set:function(t){t!==this._left&&(this._left=t,this.projectionMatrixNeedUpdate=!0)}},{key:"right",get:function(){return this._right},set:function(t){t!==this._right&&(this._right=t,this.projectionMatrixNeedUpdate=!0)}},{key:"bottom",get:function(){return this._bottom},set:function(t){t!==this._bottom&&(this._bottom=t,this.projectionMatrixNeedUpdate=!0)}}]),e}(Yi),Ki=function(t){function e(e,n,r,i){var o;return(o=t.call(this,r,i)||this).type="PerspectiveCamera",o._fov=void 0,o._aspect=void 0,o._fov=e,o._aspect=n,o.updateProjectionMatrix(!0),o}c(e,t);var n=e.prototype;return n.updateProjectionMatrix=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!0!==t&&!0!==this.projectionMatrixNeedUpdate||(Ie(this.projectionMatrix),Qe(this.projectionMatrix,this.fov*Math.PI/180,this.aspect,this.near,this.far),this.projectionMatrixNeedUpdate=!1)},n.clone=function(n){return void 0===n&&(n=new e(0,0,0,0)),t.prototype.clone.call(this,n),n.fov=this.fov,n.aspect=this.aspect,n.near=this.near,n.far=this.far,n.updateProjectionMatrix(),n.updateWorldMatrix(),n},o(e,[{key:"fov",get:function(){return this._fov},set:function(t){t!==this._fov&&(this._fov=t,this.projectionMatrixNeedUpdate=!0)}},{key:"aspect",get:function(){return this._aspect},set:function(t){t!==this._aspect&&(this._aspect=t,this.projectionMatrixNeedUpdate=!0)}}]),e}(Yi),Qi=Object.freeze({__proto__:null,Mesh:Kr,Scene:Qr,Geometry:Jr,Object3D:Ur,Raycaster:si,Texture:ui,CubeTexture:hi,TextureOperation:ci,Material:Ti,BasicMaterial:Pi,BufferGeometry:Zr,WebGLRenderer:Ui,PlaneGeometry:Ni,BoxGeometry:zi,WebGLRenderTarget:Vi,PlaneBufferGeometry:ji,Box3:Nr,OBJLoader:Hi,loadImage:Zi,loadTexture:function(t,e,n){return Zi(t).then((function(t){var n=new ui(t);return e&&e(n),n})).catch((function(t){n&&n(t)}))},loadCubeTexture:qi,Vec2:Ut,Vec3:ge,Vec4:kn,Mat3:Se,Mat4:an,Quat:Ar,quatToEuler:Ir,BufferAttribute:Fr,Uint8BufferAttribute:jr,Uint16BufferAttribute:zr,Uint32BufferAttribute:Vr,Float32ArrayAttribute:Gr,UintBufferAttribute:Wr,OrthographicCamera:Xi,PerspectiveCamera:Ki}),Ji=function(){function t(t){this.pano=void 0,this.panoData=void 0,this._meshs=new Kr,this.pano=t}return o(t,[{key:"camera",get:function(){return this.pano.camera}},{key:"meshs",get:function(){return this._meshs},set:function(t){this._meshs=t}}]),t}(),$i=["varying vec3 v_normal;","void main(void){","   gl_Position = mvpMatrix * vec4(position, 1.0);","   v_normal = normalize(position.xyz);","}"].join("\n"),to=["uniform samplerCube uSampler;","uniform float uOpacity;","varying vec3 v_normal;","void main(void){","    vec4 textureColor = textureCube(uSampler, normalize(v_normal));","    gl_FragColor = vec4(textureColor.rgb, textureColor.a * uOpacity);","}"].join("\n"),eo=function(t){function e(e){var n;return(n=t.call(this,e)||this).initMesh(),n}c(e,t);var n=e.prototype;return n.initMesh=function(){var t=new zi(8,8,8,1,1,1),e=new Ti;e.vertexShader=$i,e.fragmentShader=to,e.uniforms={vColor:{type:"4f",value:[1,0,0,1]},uSampler:{type:"t",value:null},uOpacity:{type:"1f",value:1}};var n=new Kr(t,e);n.visible=!1,n.setScale(-1,1,1),this.meshs=n},n.setData=function(t){var e=this;if(!t.image||6!==t.image.length)throw new Error("天空盒模型需要6张纹理，但只获取到 ".concat(t.image?t.image.length:0,"张"));this.panoData=t;var n=this.meshs;qi(t.image).then((function(t){n.material.uniforms.uSampler.value=t,n.visible=!0,e.pano.emit({type:d.REFRESH,log:"[Refresh Log] 立方贴图加载完成， 渲染一帧"})})).catch((function(t){return console.error(t)}))},n.update=function(){},n.draw=function(){},e}(Ji),no=function(t){return t},ro=function(t){return t*t},io=function(t){return-t*(t-2)},oo=ro,ao=io,so=Object.freeze({__proto__:null,linear:no,reverse:function(t){return 1-t},easeInQuad:ro,easeInCubic:function(t){return Math.pow(t,3)},easeOutQuad:io,easeOutCubic:function(t){return Math.pow(t-1,3)+1},easeInOutQuad:function(t){return t<.5?t*t*2:-2*(t-2)*t-1},easeInOutCubic:function(t){return t<.5?4*Math.pow(t,3):4*Math.pow(t-1,3)+1},easeInOutSine:function(t){return(1-Math.cos(Math.PI*t))/2},easeIn:oo,easeOut:ao}),uo=function(){},ho=function(){function t(t,e,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:no;this.from=void 0,this.to=void 0,this.duration=void 0,this.easingFn=void 0,this._isPlaying=!1,this._autoTimer=null,this._startTime=null,this._onUpdateCallback=uo,this._onEndCallback=uo,this.start=function(){return r._isPlaying||(r._isPlaying=!0,r._startTime=r.getNow()),r},this.stop=function(){return r._isPlaying=!1,r},this.startAndAutoUpdate=function(){if(r._isPlaying)return r;r.start(),r._autoTimer=null;return function t(){r.update(),r._autoTimer=requestAnimationFrame(t)}(),r},this.onEnd=function(t){return"function"==typeof t?r._onEndCallback=t:console.warn("[Warning] onUpdate required a funtion"),r},this.onUpdate=function(t){return"function"==typeof t?r._onUpdateCallback=t:console.warn("[Warning] onUpdate required a funtion"),r},this.update=function(){if(!r._isPlaying)return!1;var t=r.from,e=r.to,n=r.getNow(),i=r.easingFn,o=r._startTime;if(o>n)return!1;var a=(n-o)/r.duration,s=t+(e-t)*i(a=0===r.duration||a>1?1:a);return r._onUpdateCallback(s),1===a&&r.handleEnd(),!0},this.from=t,this.to=e,this.duration=n,this.easingFn=i}var e=t.prototype;return e.getNow=function(){return Date.now()},e.handleEnd=function(){this._isPlaying=!1,this._autoTimer=null,this._onEndCallback()},t}(),co=function(t,e,n){var r=.5*e,i=.5*n;return _t((t[0]-r)/r,(i-t[1])/i)},lo=function(t,e,n){var r=.5*e,i=.5*n;return _t((t[0]+1)*r,(1-t[1])*i)},fo=function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100,o=sn(),a=co(t,n,r),s=hn(a[0],a[1],i,1),u=Pe(),h=e.worldMatrix;return Be(u,e.projectionMatrix),En(o,s,u),En(o,o,h),o},po=function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=hn(e[0],e[1],e[2],1);if(En(o,o,t.viewMatrix),0<o[2]&&!0!==i)return null;En(o,o,t.projectionMatrix),o[0]=o[0]/o[3],o[1]=o[1]/o[3],o[2]=o[2]/o[3],o[3]=1;var a=_t(o[0],o[1]);return lo(a,n,r)},vo=function(t,e,n,r){var i=po(e,t,n,r)||[-1,-1],o=xi(i,2),a=o[0],s=o[1],u=!1;return a>=0&&a<=n&&s>=0&&s<=r&&(u=!0),u},mo=Object.freeze({__proto__:null,viewportToNormalizeProjection:co,normalizeProjectionToViewport:lo,viewportToWorld:fo,worldToViewport:po,isCoordsInView:vo}),go=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;this.getVertexs=function(){return e.vertexs},this.getFacesVertex=function(){return e.facesVertex},this.generateTextureCoord=function(n,r,i){var o=e.facesVertex[Math.round(e.facesVertex.length/2)];if(o){for(var a=[],s=Math.pow(2,5-i),u=r%s,h=n%s,c=t.H_SEGS/e.cols,l=1/c,f=1/((t.V_SEGS-1)/e.rows),d=0;d<o.length/3;d++){var p=d%(c+1)*l,v=Math.floor(d/(c+1))*f;p=p/s+1*u/s,v=v/s+1*h/s,1===i&&(v*=2),a.push(p,v)}return a}},this.getFaceIndex=function(n){var r=0,i=xi(n,3),o=i[0],a=i[1],s=i[2],u=Math.round(180*Math.atan(Math.abs(s)/Math.abs(o))/Math.PI);o>0?s<0&&(u=360-u):u=s>0?180-u:180+u,u%=360,r=a>e._x3?7:a>e._x2?6:a>e._x1?5:a>0?4:a>-e._x1?3:a>-e._x2?2:a>-e._x3?1:0;var h=Math.floor(u/22.5),c=t.H_SEGS;return[h,r,h+r*(c/(c/e.cols))]},this.viewportToSphereCoord=function(t,n,r,i){var o=e.radius,a=fo(t,i,n,r),s=xi(a,3),u=s[0],h=s[1],c=s[2],l=o/Math.sqrt(u*u+h*h+c*c);return[u*l,h*l,c*l]},this.getFaceVertex=function(n,r){var i=t.H_SEGS/e.cols,o=r+n*(t.H_SEGS/i);return e.facesVertex[o]},this.radius=n,this.rows=t.DEFAULT_COLS/2,this.cols=t.DEFAULT_COLS,this.vertexs=null,this.facesVertex=[],this.facesVertexIndice=[],this.init()}var e=t.prototype;return e.init=function(){var t=this.getSphereVertexInfo();this.facesVertexIndice=this.getSphereFacesIndices(),this.vertexs=t.vertexs,this.facesVertex=t.facesVertex,this.calcConst()},e.calcConst=function(){var t=360/this.cols;this._x1=Math.cos(g(3*t))*this.radius,this._x2=Math.cos(g(2*t))*this.radius,this._x3=Math.cos(g(1*t))*this.radius},e.getSphereVertexInfo=function(){for(var e,n=[],r=[],i=this.radius,o=t.H_SEGS,a=t.V_SEGS,s=360/o,u=180/(a-1),h=o/this.cols,c=o/h,l=0,f=0,d=[],p=0;p<a;p++){var v=Math.sin(g(p*u-90))*i,m=Math.cos(g(p*u-90))*i;v=Math.round(100*v)/100,m=Math.round(100*m)/100,l=Math.floor(p/h);for(var y=0;y<o;y++){var _=Math.cos(g(y*s))*m,x=Math.sin(g(y*s))*m;if(_=Math.round(100*_)/100,x=Math.round(100*x)/100,n.push(_,v,x),e=(f=Math.floor(y/h))+l*c,l<this.rows&&(r[e]||(r[e]=[]),r[e].push(_,v,x)),l>0&&p%h==0){var b=f+(l-1)*c;r[b].push(_,v,x),y>0&&y%h==0&&r[b-1]&&r[b-1].push(_,v,x),y===o-1&&r[b].push(d[0],d[1],d[2])}0===f&&0===y&&(d=[_,v,x]),y>0&&y%h==0&&r[e-1]&&r[e-1].push(_,v,x),l<this.rows&&y===o-1&&r[e].push(d[0],d[1],d[2])}}return{vertexs:n,facesVertex:r}},e.getSphereFacesIndices=function(){for(var e=[],n=t.H_SEGS/this.cols,r=n+1,i=0;i<n;i++)for(var o=0;o<n;o++){var a=i*r,s=a+o+1,u=a+o+1+r;e.push(a+o,s,u),s=a+o+1+r,e.push(a+o,s,a+r+o)}return e},e.getSphereFacesIndicesByimageZoom=function(e){for(var n=this,r=[],i=t.H_SEGS,o=Math.pow(2,5-e),a=i/this.cols+1,s=a*a,u=function(t){for(var e=function(e){n.facesVertexIndice.forEach((function(n){r.push(n+s*e+s*t*2)}))},i=0;i<o;i++)e(i)},h=0;h<o;h++)u(h);return r},t}();go.DEFAULT_COLS=Math.pow(2,4),go.H_SEGS=64,go.V_SEGS=33;var yo=function(){function t(){this._counter=0,this._imageCollection={}}var e=t.prototype;return e.getImageInstance=function(){var t;for(var e in this._imageCollection)if(this._imageCollection[e]&&!0===this._imageCollection[e]._free)return this._imageCollection[e]._free=!1,this._imageCollection[e];t=new Image;var n=this.getGUID();return this._imageCollection[n]=t,t},e.freeImage=function(t){t&&(t._free=!0,t.src="",t.onload=t.onerror=null)},e.getGUID=function(){return this._counter++,"img_".concat(this._counter)},t}(),_o=function(){function t(e,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.imageInstancePool=void 0,this.tileImagesCache=void 0,this.textureInfo=void 0,this.pano=void 0,this.udtVersion=void 0,this.cdnList=void 0,this.calcTileKey=function(t,e,n,r){return"".concat(t,"_").concat(e,"_").concat(n,"_").concat(r)},this.loadImage=function(t,e,n,i){var o=r.calcTileKey(t,e,n,i),a=r.getTilesUrl(t,{x:e,y:n},i),s=r.tileImagesCache.getData(o);return new Promise((function(t,e){s?t(s._loaded?s:null):((s=r.imageInstancePool.getImageInstance()).crossOrigin="anonymous",s._loaded=!1,s.onload=function(){s._loaded=!0,t(s)},s.onerror=function(t){console.error("Tile ".concat(o," load error => "),t),e(t)},s.src=a,r.tileImagesCache.setData(o,s))}))},this.loadTexture=function(t,e,n,i){var o=r.calcTileKey(t,e,n,i),a=r.textureInfo.getData(o);return new Promise((function(s,u){a&&a.loaded?s(a):r.loadImage(t,e,n,i).then((function(t){if(!t)return null;var e=new ui(t);1!==i&&r.textureInfo.setData(o,e),s(e)})).catch((function(t){console.error("[TextureManager] loadTexture fail => ".concat(t)),u(null)}))}))},this.loadTopoTexture=function(t){var e=0,n=new Image;return new Promise((function(r){n.onload=function(){var t=new ui(n);t.flipY=!1,r(t)},n.onerror=function(){2>e?(e++,n.src="".concat(t,"&random=").concat((new Date).getTime())):r(null)},n.crossOrigin="anonymous",n.src=t}))},this.clear=function(){r.textureInfo.clear()},this.pano=e,this.udtVersion=i,this.cdnList=n||e.opts.tileBaseUrls,this.imageInstancePool=new yo,this.tileImagesCache=new A(t.MAX_TILE_CACHED,{clearCallback:function(t){r.imageInstancePool.freeImage(t)}}),this.textureInfo=new A(t.MAX_TILE_CACHED,{clearCallback:function(t){t.destory()}})}var e=t.prototype;return e.getRandomCDN=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=t.length;return t[Math.floor(Math.random()*e)]},e.getTilesUrl=function(e,n,r){return this.getRandomCDN(this.cdnList)+(t.TILE_URL_TEMPLATE+"&".concat($("/",{isCounter:!0}))).replace("{udt}",this.udtVersion).replace("{sid}",e).replace("{x}","".concat(n.x)).replace("{y}","".concat(n.y)).replace("{zoom}","".concat(r))},t}();_o.MAX_TILE_CACHED=160,_o.TILE_URL_TEMPLATE="?qt=pdata&sid={sid}&pos={y}_{x}&z={zoom}&udt={udt}&from=H5";var xo=["attribute vec2 uvBack;","varying mediump vec2 vTextureCoordBack;","varying mediump vec2 vTextureCoord;","void main(void) {","    gl_Position = mvpMatrix * vec4(position, 1.0);","    vTextureCoordBack = uvBack;","    vTextureCoord = uv;","}"].join("\n"),bo=["precision mediump float;","varying vec2 vTextureCoordBack;","varying vec2 vTextureCoord;","uniform sampler2D uSamplerBack;","uniform sampler2D uSampler;","uniform bool uDrawThumb;","uniform bool uDrawBack;","uniform float uAlpha;","void main(void) {","    if (uDrawThumb) {","        gl_FragColor = texture2D(uSamplerBack, vTextureCoordBack);","        return;","    }","    if (uAlpha == 1.0) {","        gl_FragColor = texture2D(uSampler, vTextureCoord);","        return;","    }","    if (uDrawBack) {","        gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha + texture2D(uSamplerBack, vTextureCoordBack) * (1.0 - uAlpha);","    } else {","        vec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));","        gl_FragColor =  vec4(textureColor.rgb, textureColor.a * uAlpha);","    }","}"].join("\n"),Mo=["varying highp vec2 vTextureCoord;","void main(void) {","    gl_Position = mvpMatrix * vec4(position, 1.0);","    vTextureCoord = uv;","}"].join("\n"),wo=["precision mediump float;","uniform sampler2D uSampler;","varying highp vec2 vTextureCoord;","void main(void) {","    gl_FragColor = texture2D(uSampler, vTextureCoord);","}"].join("\n"),Eo=["varying highp vec2 vTextureCoord;","void main(void) {","    gl_Position = mvpMatrix * vec4(position, 1.0);","    vTextureCoord = uv;","}"].join("\n"),To=["uniform sampler2D uSampler;","uniform float uOpacity;","varying vec2 vTextureCoord;","void main(void){","    vec4 textureColor = texture2D(uSampler, vTextureCoord);","    gl_FragColor = vec4(textureColor.rgb, textureColor.a * uOpacity);","}"].join("\n"),Ao=["varying highp vec3 vTextureCoord;","void main(void){","   gl_Position = mvpMatrix  * vec4(position, 1.0);","   vTextureCoord = vec3(uv, 1.0) * length(position);","}"].join("\n"),Co=["uniform sampler2D uSampler;","uniform float uOpacity;","varying vec3 vTextureCoord;","uniform bool showDebugLine;","uniform vec4 vColor;","void main(void){","   if (!showDebugLine) {","       vec4 textureColor = texture2DProj(uSampler, vTextureCoord);","       gl_FragColor = vec4(textureColor.rgb, textureColor.a * uOpacity);","   } else {","       gl_FragColor = vec4(vColor.rgb, vColor.a);","   }","}"].join("\n"),Ro=function(){function t(e,n,r,i){this.nodes=void 0,this.level=void 0,this.key=void 0,this.nodes=[],this.level=e,this.key="".concat(r,"_").concat(i),e<n&&(this.nodes[0]=new t(e+1,n,2*r,2*i),this.nodes[1]=new t(e+1,n,2*r,2*i+1),this.nodes[2]=new t(e+1,n,2*r+1,2*i),this.nodes[3]=new t(e+1,n,2*r+1,2*i+1))}var e=t.prototype;return e.hasNodes=function(){return this.nodes.length>0},e.getNodeKeysByLevel=function(t){if(t<this.level)return console.warn("指定节点".concat(t," 不在当前节点").concat(this.level,"范围内！")),[];if(this.level===t)return[this.key];for(var e=[],n=0;n<this.nodes.length;n++)if(Object.prototype.hasOwnProperty.call(this.nodes,n)){var r=this.nodes[n];if(this.level===t-1)e.push(r.key);else if(r.hasNodes()){var i=r.getNodeKeysByLevel(t);e.push.apply(e,mi(i))}}return e},t}();var So=function(t){function e(e){var n;return(n=t.call(this,e)||this).name="SphereRender",n.sphere=void 0,n.textureManager=void 0,n.imgColsRows=void 0,n.curThumbTexture=void 0,n.meshCache={},n.tileInfoCache={},n.imgRange=void 0,n.faceRange=void 0,n.hitTile=void 0,n.setData=function(t){n.panoData=t,n.curThumbTexture=null,n.loadThumbTextures(t.panoId)},n.update=function(){n.updateRangeInfo(),n.checkAndLoadTiles()},n.checkAndLoadTiles=function(){if(n.curThumbTexture&&n.panoData){var t=n.panoData.panoId,e=n.camera,r=n.imgColsRows[n._imgZoom],i=r.cols,o=i-1,a=r.rows-1,s=n.pano.getContainerSize(),u=s.width,h=s.height,c=!1,l=[],f=xi(n.imgRange,4),d=f[0],p=f[1],v=f[2],m=f[3];if(vo(Vt(0,100,0),e,u,h)){for(var g=0;g<=v;g++)for(var y=0;y<=o;y++)n.checkAndLoadTile(t,y,g,n._imgZoom),l.push([g,y]);v<m&&(v+=1,c=!0)}else if(vo(Vt(0,-100,0),e,u,h)){for(var _=m;_<=a;_++)for(var x=0;x<=o;x++)n.checkAndLoadTile(t,x,_,n._imgZoom),l.push([_,x]);v<m&&(m-=1,c=!0)}else c=!0;if(!0===c){p>o&&(p=o);for(var b=d;b<=p;b++)for(var M=v;M<=m;M++){var w=b<0?b+i:b;n.checkAndLoadTile(t,w,M,n._imgZoom),l.push([M,w])}}n.hitTile=l,l.forEach((function(t){var e=xi(t,2),r=e[0],i=e[1],o="".concat(r,"_").concat(i,"_").concat(n._imgZoom);if(void 0===n.tileInfoCache[o]){var a=new Ro(n._imgZoom,5,r,i).getNodeKeysByLevel(5);n.tileInfoCache[o]=a}}))}},n.draw=function(){var t=n.meshs;if(!n.faceRange||!n.curThumbTexture)return!1;t.children=[];for(var e=function(e,r){var i=n.curThumbTexture,o=n.textureManager.calcTileKey(n.panoData.panoId,e,r,n._imgZoom),a=n.textureManager.textureInfo.getData(o),s=!1,u=null;if(a?!(u=a).finished&&u.aniInfo&&u.aniInfo&&u.aniInfo.update():i&&(s=!0,u=i),u){var h="".concat(r,"_").concat(e,"_").concat(n._imgZoom),c=n.meshCache[h];if(!c){if(!(c=n.createTileMesh(r,e)))return;n.meshCache[h]=c}if(!c.material)return;var l=c.material.uniforms;l.uSamplerBack.value=i,s?l.uDrawThumb.value=!0:(l.uDrawThumb.value=!1,l.uSampler.value=u,l.uAlpha.value=u.alpha),t.add(c)}},r=0;r<n.hitTile.length;r++){var i=xi(n.hitTile[r],2),o=i[0];e(i[1],o)}return!0},n.pano=e,n.sphere=new go(e.opts.radius),n.textureManager=new _o(e),n.imgColsRows=function(){for(var t=[],e=0;e<=5;e++)t[e]=e<2?{cols:1,rows:1}:{cols:Math.pow(2,e-1),rows:Math.pow(2,e-1)/2};return t}(),n.curThumbTexture=null,n.meshs=new Kr,n}c(e,t);var n=e.prototype;return n.checkAndLoadTile=function(t,e,n,r){var i=this,o=this.textureManager,a=o.calcTileKey(t,e,n,r);!0!==(void 0!==o.textureInfo.getData(a))&&this.textureManager.loadTexture(t,e,n,r).then((function(t){t&&!t.done&&(t.aniInfo=i.createTextureAnimation(t),t.done=!0,i.pano.dispatchEvent({type:d.REFRESH,log:"[Refresh Log] 瓦片加载完成， 渲染一帧"}))}))},n.loadThumbTextures=function(t){var e=this;this.textureManager.loadTexture(t,0,0,1).then((function(t){e.curThumbTexture=t,e.pano.dispatchEvent({type:d.THUMB_LOADED}),e.pano.dispatchEvent({debug:!0,type:d.REFRESH,log:"[Refresh Log] 缩略图加载完毕，渲染一帧"})}))},n.createTextureAnimation=function(t){var e=this;return t.alpha=0,new ho(0,1,300).onUpdate((function(n){t.alpha=n,e.pano.dispatchEvent({debug:!0,type:d.REFRESH,log:"[Refresh Log] 纹理清晰度渐变动画，渲染一帧"})})).onEnd((function(){t.finished=!0})).start()},n.createTileMesh=function(t,e){var n=new Ti,r=new Zr;if(n.depthTest=!1,n.vertexShader=xo,n.fragmentShader=bo,n.uniforms={uSampler:{type:"t",value:null},uSamplerBack:{type:"t",value:null},uDrawThumb:{type:"1i",value:1},uDrawBack:{type:"1i",value:1},uAlpha:{type:"1f",value:1}},!this.setGeometryAttrib(r,t,e))return null;var i=new Kr(r,n);return i.name="tile-mesh",i},n.setGeometryAttrib=function(t,e,n){var r="".concat(e,"_").concat(n,"_").concat(this._imgZoom),i=this.tileInfoCache[r];if(!i)return!1;for(var o=[],a=[],s=[],u=0;u<i.length;u++){var h=i[u].split("_"),c=this.sphere.rows,l=Number(h[1]),f=c-1-Number(h[0]);o.push.apply(o,mi(this.sphere.getFaceVertex(f,l))),a.push.apply(a,mi(this.sphere.generateTextureCoord(f,l,this._imgZoom))),s.push.apply(s,mi(this.sphere.generateTextureCoord(f,l,1)))}var d=this.sphere.getSphereFacesIndicesByimageZoom(this._imgZoom);return t.setAttribute("uv",new Gr(a,2)),t.setAttribute("uvBack",new Gr(s,2)),t.setAttribute("position",new Gr(o,3)),t.setIndexes(d),!0},n.getTileBoundary=function(){var t=this.pano.getContainerSize(),e=t.width,n=t.height,r=_t(0,0),i=_t(e,0),o=_t(0,n),a=_t(e,n),s=_t(.5*e,0),u=_t(.5*e,n),h=_t(0,.5*n),c=_t(e,.5*n),l=this.getSpherePosition(r),f=this.getSpherePosition(i),d=this.getSpherePosition(o),p=this.getSpherePosition(a),v=this.getSpherePosition(s),m=this.getSpherePosition(u),g=this.getSpherePosition(h),y=this.getSpherePosition(c),_=Math.max(l[1],v[1],f[1]),x=Math.min(d[1],m[1],p[1]),b=[l[0],g[0],d[0],v[0]],w=[f[0],y[0],p[0],m[0]],E=Math.min.apply(Math,b),T=Math.max.apply(Math,w),A=M(b),C=M(w),R=this.sphere.cols,S=R/2;A.max-A.min>S&&(E=Math.min.apply(Math,mi(b.filter((function(t){return t>S}))))),C.max-C.min>S&&(T=Math.max.apply(Math,mi(w.filter((function(t){return t<S}))))),E>T&&(E-=R);var P=this.getImgIndexByFaceColRow(E,_),D=xi(P,2),O=D[0],I=D[1],L=this.getImgIndexByFaceColRow(T,x),B=xi(L,2);return[[E,T,_,x],[O,B[0],I,B[1]]]},n.updateRangeInfo=function(){var t=this.getTileBoundary(),e=xi(t,2),n=e[0],r=e[1];this.imgRange=r,this.faceRange=n},n.getImgIndexByFaceColRow=function(t,e,n){n=n||this._imgZoom;var r=Math.pow(2,5-n),i=Math.floor(t/r),o=Math.floor(e/r);return[i,o=this.imgColsRows[n].rows-o-1,i+o*go.DEFAULT_COLS/r]},n.normalizeNum=function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=t;r<n;)r+=e;return r%=e},n.getSpherePosition=function(t){var e=this.camera,n=this.pano.getContainerSize(),r=n.width,i=n.height,o=this.sphere.viewportToSphereCoord(t,r,i,e),a=this.sphere.getFaceIndex(o),s=xi(a,2);return _t(s[0],s[1])},n.generateBackThumb=function(t){if(t){var e=this.pano,n=e.getContainerSize(),r=n.width,i=n.height,o="//apisv0.bdimg.com/?udt=20140616&qt=pdata&pos=0_0&z=2&sid=".concat(t,"&from=H5&").concat($("/",{isCounter:!0})),a=e.getPanes().tileLayer;a.style.backgroundImage='url("'+o+'")',a.style.backgroundPosition="50% 50%",a.style.backgroundSize="150% 150%",a.style.width="".concat(r,"px"),a.style.height="".concat(i,"px")}},o(e,[{key:"_imgZoom",get:function(){return this.pano.imageZoom}}]),e}(Ji),Po=[10,-20,30,10,-20,10,-10,-20,10,-10,-20,30].map((function(t){return-20===t?-20:1.8*t})),Do=[10,-22,30,10,-22,10,-10,-22,10,-10,-22,30].map((function(t){return-22===t?-22:1.8*t})),Oo=[1.8,-20,24.9,1.8,-20,16.3,-1.8,-20,16.3,-1.8,-20,24.9].map((function(t){return-20===t?-20:1.8*t})),Io=[0,0,0,.5,.25,.5,.25,0],Lo=function(){function t(t,e,n){var r=this;this.mesh=void 0,this.material=void 0,this.linkData=void 0,this._pano=void 0,this.northDir=void 0,this.yAxisDis=void 0,this.isPosInArrow=function(t,e,n,i,o){var a=_t(t,e),s=fo(a,n,i,o,-1),u=200*s[0],h=200*s[1],c=200*s[2],l=r.yAxisDis/h;if(l<0)return!1;var f=[u*l,h*l,c*l];return r.isHitLink(f)},this._pano=t,this.linkData=e,this.northDir=n,this.yAxisDis=0,this.linkData.refinedDir=_((e.topoDir||0)+this.northDir),this.material=this.createArrowMaterial(),this.mesh=this.initMesh(),this.changePose()}var e=t.prototype;return e.initMesh=function(){var t=this.createGeometry(),e=new Kr(t,this.material);return e.visible=!1,e.name="link-mesh",e},e.createArrowMaterial=function(){var t=new Ti;return t.depthTest=!1,t.vertexShader=Mo,t.fragmentShader=wo,t.uniforms={uSampler:{type:"t",value:null}},t},e.setTopoTexture=function(t){t.isTexture&&(this.material.uniforms.uSampler.value=t)},e.setVisible=function(t){this.mesh.setVisible(t,!0)},e.createGeometry=function(){var t=new Zr,e=this.getTextCoord(this.linkData.topoDir),n=[].concat(Do,Po,Oo),r=[].concat([.5,0,.5,.5,1,.5,1,0],[0,0,0,.5,.5,.5,.5,0],e),i=[].concat([0,1,2,0,2,3],[4,5,6,4,6,7],[8,9,11,10,11,9]);return t.setAttribute("position",new Gr(n,3)),t.setAttribute("uv",new Gr(r,2)),t.setIndexes(i),t},e.changePose=function(t){t=t||this.mesh;var e=50,n=-30,r=this._pano.getPov().pitch,i=this.linkData.refinedDir;(e+=20*this._pano.getZoom(),r<0)&&(e*=(90-(r=Math.abs(r)))/90,n-=20*r/90);var o=Math.cos(g(i))*e,a=Math.sin(g(i))*e;this.yAxisDis=n+-20,t.setPosition(o,n,a),t.rotateY(-_(i-90)),t.rotateX(-5),t.updateWorldMatrix(!0)},e.getTextCoord=function(t){t=(t+360)%360;var e=Math.ceil(Math.floor(t/22.5)/2);8===e&&(e=0);for(var n=Io.slice(0),r=Math.floor(e/2),i=e%2,o=0;o<n.length;o++)o%2==0?(n[o]+=.25*r,n[o]=.5*n[o]):(n[o]+=.5*i,n[o]=.5*n[o]+.5);return n},e.isHitLink=function(t){var e=t[0],n=t[2],r=this.mesh.worldMatrix,i=Vt(Po[0],Po[1],Po[2]),o=Vt(Po[6],Po[7],Po[8]),a=Vt((i[0]+o[0])/2,(i[1]+o[1])/2,(i[2]+o[2])/2);return ee(a,a,r),Math.abs(e-a[0])<18&&Math.abs(n-a[2])<18},t}(),Bo=function(t){function e(e){var n;return(n=t.call(this,e)||this).name="PanoLinkRender",n.linkVisible=!0,n.textureManager=void 0,n.linkInfos=[],n.setData=function(t){if(t&&(o=t.getTopos,a="[object Function]"===Object.prototype.toString.call(o),s="[object AsyncFunction]"===Object.prototype.toString.call(o),a||s)){n.reset();var e=t.getTopos(),r=t.northDir,i=t.panoType===p.TYPE_STREET;e.length&&i&&(n.linkInfos=e.map((function(t){return new Lo(n.pano,t,r)})),n.meshs=n.linkInfos.map((function(t){return t.mesh})),n.loadTextures(),n.setVisible(!0))}var o,a,s},n.clickChecker=function(t,e){if(n.linkVisible){var r=n.getIdByTouchPos(t,e);return r&&(n.setVisible(!1),n.pano.dispatchEvent({type:d.LINK_CLICK,id:r}),n.pano.setId(r,{animation:!0})),!r}},n.pano=e,n.meshs=[],n.textureManager=new _o(e),n}c(e,t);var n=e.prototype;return n.reset=function(){this.meshs=[],this.linkInfos=[]},n.update=function(){this.linkInfos.forEach((function(t){t.changePose()}))},n.setVisible=function(t){var e=this.linkInfos;if(!(e.length<1)){var n=this.pano.opts.linksControl,r=!1;!0===n&&(r=t),this.linkVisible=r,e.forEach((function(t){return t.setVisible(r)}))}},n.draw=function(){},n.loadTextures=function(){var t=this,e=this.pano.opts.imgPath?"".concat(this.pano.opts.imgPath,"topo_arrow.png"):p.TOPO_ARROW_TEXTURE;this.textureManager.loadTopoTexture(e).then((function(e){e&&t.linkInfos.forEach((function(t){t.setTopoTexture(e)}))}))},n.getIdByTouchPos=function(t,e){var n=this,r=null;if(!this.linkInfos.length)return r;var i=this.pano.getContainerSize(),o=i.width,a=i.height,s=this.linkInfos.filter((function(r){return r.isPosInArrow(t,e,n.camera,o,a)}));return s.length&&(r=s[0].linkData.panoId),r},e}(Ji),ko=function(){function t(t,e,n){var r=this;this.start=function(){r.fadeAni.start(),r._pano.dispatchEvent({debug:!0,log:"淡出动画，渲染一帧",type:d.REFRESH})},this.update=function(){r.fadeAni.update()},this._pano=t,this.gl=this._pano.gl,this.snapshot=e,this.scene=this.initScene(),this.camera=this.initCamera();this.fadeAni=new ho(1,0,600).onUpdate((function(t){r.material.uniforms.uOpacity.value=t,r._pano.dispatchEvent({type:d.REFRESH})})).onEnd((function(){n&&n(),r._pano.dispatchEvent({type:d.REFRESH,debug:!0,log:"淡出动画结束，渲染一帧"})}))}var e=t.prototype;return e.initScene=function(){var t=new Qr,e=this._pano.getContainerSize(),n=e.width,r=e.height,i=new ji(n,r),o=this.initMaterial(),a=new Kr(i,o);return t.add(a),t},e.initMaterial=function(){var t=new Ti;return t.depthTest=!1,t.vertexShader=Eo,t.fragmentShader=To,t.uniforms={uSampler:{type:"t",value:this.snapshot},uOpacity:{type:"1f",value:1}},this.material=t,t},e.initCamera=function(){var t=this._pano.getContainerSize(),e=t.width/2,n=t.height/2;return new Xi(-e,e,n,-n,0,11e3)},t}(),Uo=function(){function t(t,e,n){var r=this;this.start=function(){r.waveAni.start(),r._pano.dispatchEvent({debug:!0,log:"淡出动画，渲染一帧",type:d.REFRESH})},this.update=function(){r.waveAni.update()},this._pano=t,this.gl=this._pano.gl,this.snapshot=e,this.scene=this.initScene(),this.camera=this.initCamera();this.waveAni=new ho(0,1,800).onUpdate((function(t){r.material.uniforms.progress.value=t,r.material.uniforms.uOpacity.value=1-t,r._pano.dispatchEvent({type:d.REFRESH})})).onEnd((function(){n&&n(),r._pano.dispatchEvent({type:d.REFRESH,debug:!0,log:"淡出动画结束，渲染一帧"})}))}var e=t.prototype;return e.initCamera=function(){var t=this._pano.getContainerSize(),e=t.width/2,n=t.height/2;return new Xi(-e,e,n,-n,0,11e3)},e.initScene=function(){var t=new Qr,e=this._pano.getContainerSize(),n=e.width,r=e.height,i=new ji(n,r),o=this.initMaterial(),a=new Kr(i,o);return t.add(a),t},e.initMaterial=function(){var t=new Ti,e=this._pano.getContainerSize(),n=e.width,r=e.height;return t.depthTest=!1,t.vertexShader=Eo,t.fragmentShader="\n    uniform float aspect;\n    uniform float radius;\n    uniform float amp;\n    uniform float band;\n    uniform float waves;\n    uniform float speed;\n    uniform float progress;\n    uniform vec2 uCenter;\n    uniform sampler2D uSampler;\n    uniform float uOpacity;\n\n    varying vec2 vTextureCoord;\n\n    void main() {\n        vec2 tc = vTextureCoord;\n        vec2 uv = vec2(0.0, 0.0);\n        vec2 p;\n        float len;\n        vec2 uv_offset;\n        float wave_width = band * radius;\n\n        p = (tc - uCenter);\n        p.x = p.x * aspect;\n        len = length(p);\n\n        float current_radius = radius * progress;\n        float damp_factor = 1.0;\n        if (progress > .5) {\n            damp_factor = (1.0 - progress) * 2.0;\n        }\n\n        float cut_factor = clamp(wave_width * damp_factor - abs(current_radius - len), 0.0, 1.0);\n        float waves_factor = waves * len / radius;\n        uv_offset = (p / len) * cos((waves_factor - progress * speed) * 3.14) * amp * cut_factor;\n\n        uv += uv_offset;\n\n        vec4 t_image = texture2D(uSampler, fract(tc + uv));\n\n        // gl_FragColor = t_image;\n        gl_FragColor = vec4(t_image.rgb, t_image.a * uOpacity);\n    }\n",t.uniforms={uSampler:{type:"t",value:this.snapshot},uCenter:{type:"2f",value:[.5,.5]},uOpacity:{type:"1f",value:1},progress:{type:"1f",value:0},speed:{type:"1f",value:4},waves:{type:"1f",value:14},band:{type:"1f",value:.3},amp:{type:"1f",value:.3},aspect:{type:"1f",value:n/r},radius:{type:"1f",value:1}},this.material=t,t},t}(),No=function(){function t(t,e,n,r){var i=this;this.startAni=function(){i.animation.start()},this.update=function(){i.animation.update()},this.pano=t,this.distance=n,this.refinedDir=e,this.camera=this.pano.camera,this.cameraBase=this.pano.camera.clone(),this.handleEnd=r,this.initAni()}return t.prototype.initAni=function(){var t=this,e=this.distance,n=this.refinedDir,r=Math.cos(g(n)),i=Math.sin(g(n));this.animation=new ho(0,1,400,so.easeOutQuad).onUpdate((function(n){var o=e*n,a=r*o,s=i*o;t.camera.setPosition(a,0,s),t.pano.dispatchEvent({debug:!0,type:d.REFRESH,log:"[Refresh Log] 前进动画， 渲染一帧"})})).onEnd((function(){t.handleEnd&&t.handleEnd()}))},t}(),Fo=function(t,e,n,r){this.x=t||0,this.y=e||0,this.width=n||0,this.height=r||0},jo=function(t,e){var n=this;this.angleDegreeDelta=function(t,e){var n=Math.abs(t-e);return n>180?360-n:n},this.getRoad=function(t,e,n,r,i){for(var o,a=[],s=[[-t/2,-e,-10],[-t/2,-e,-20],[t/2,-e,-10],[t/2,-e,-20]],u=s.length,h=0;h<u;h++)ee(o=s[h],o,n),a[h]={x:o[0]*r*.5,y:-o[1]*i*.5};return a},this.getIntersection=function(t,e,n,r){if(t.x===e.x||n.x===r.x)return null;var i=(e.y-t.y)/(e.x-t.x),o=(r.y-n.y)/(r.x-n.x);if(i===o)return null;var a=(o*n.x-i*t.x+t.y-n.y)/(o-i);return{x:a,y:i*(a-t.x)+t.y}},this.calculateVanishPoint=function(t,e,r,i){var o=n.getIntersection(t[0],t[1],t[2],t[3]);return null===o?null:(o.x+=r*e*.5,o.y+=i*e*.5,o)},this.getOuterRect=function(t,e,n){return new Fo(t*(n-1)*.5,e*(n-1)*.5,t,e)},this.transformPoint=function(t,e,n){return t&&void 0!==t.x&&void 0!==t.y?{x:t.x+e,y:t.y+n}:t},this.getInnerRect=function(t,e,r,i,o){var a=n.transformPoint(t,.5*-r*o,.5*-i*o),s=n.transformPoint(a,0,20),u=n.transformPoint(a,10,20),h=n.getIntersection(e[0],e[1],s,u),c=n.getIntersection(e[2],e[3],s,u),l=n.transformPoint(h,0,-70),f=new Fo(l.x+r*o*.5,l.y+i*o*.5,c.x-h.x,70);return f=n.fixInnerRectPosition(f,t),f=n.fixInnerRectSize(f,t,r)},this.fixInnerRectPosition=function(t,e){var n=t,r=(e.x-t.x)/t.width,i=0;return r>.7&&(i=r-.7),r<.3&&(i=.3-r),n.x=n.x+n.width*i,n},this.fixInnerRectSize=function(t,e,n){var r,i,o,a,s=t;s.width/n>.12&&(a=(o=.12*n)*(s.width/s.height),r=s.x+(s.width-o)*(e.x-s.x)/s.width,i=s.y+(s.height-a)*(e.y-s.y)/s.height,s=new Fo(r,i,o,a));var u=s.width/s.height;return a=s.height,u>1.2&&(a=s.height*u/1.2),u<.9&&(a=s.height*u/.9),i=s.y+s.height-a,s.height=a,s.y=i,s},this.panoData=t.panoData,this.camera=t.camera,this.projectionMatrix=this.camera.projectionMatrix,this.fov=g(this.camera.fov),this.traverseDir=e,this.cameraHeading=t.getPov().heading||0,this.isMovingForward=this.angleDegreeDelta(this.cameraHeading,this.traverseDir)<=90,this.roadWith=Math.min(1.5*this.panoData.getRoadWidth(),10),this.deviceHeight=this.panoData.deviceHeight||2.2,this.panoWidth=t._container.clientWidth,this.panoHeight=t._container.clientHeight;var r=this.angleDegreeDelta(this.cameraHeading,this.traverseDir)>45;this.snapshotRatio=r?1:1.8,this.projectionRoadInfos=this.getRoad(this.roadWith,this.deviceHeight,this.projectionMatrix,this.panoWidth,this.panoHeight),this.vanishPoint=this.calculateVanishPoint(this.projectionRoadInfos,this.snapshotRatio,this.panoWidth,this.panoHeight),this.innerRect=this.getInnerRect(this.vanishPoint,this.projectionRoadInfos,this.panoWidth,this.panoHeight,this.snapshotRatio),this.outerRect=this.getOuterRect(this.panoWidth,this.panoHeight,this.snapshotRatio),this.focusLength=.5*this.panoHeight/Math.tan(.75*this.fov),this.vanishPointDeltaX=this.vanishPoint.x-this.outerRect.x-.5*this.outerRect.width,this.vanishPointDeltaY=this.vanishPoint.y-this.outerRect.y-.5*this.outerRect.height},zo={FAR:[10,10,0],LEFT:[0,10,30],RIGHT:[0,10,30],TOP:[10,0,30],BOTTOM:[10,0,30]},Vo={FAR:["innerTopLeftVertex","innerBottomRightVertex"],LEFT:["outerTopLeftVertex","innerBottomLeftVertex"],RIGHT:["innerTopRightVertex","outerBottomRightVertex"],TOP:["outerTopLeftVertex","innerTopRightVertex"],BOTTOM:["innerBottomLeftVertex","outerBottomRightVertex"]},Go=Object.keys(zo),Wo=function(t){function e(e,n){var r;if((r=t.call(this)||this).createSkeleton=function(t){var e=t.vanishPoint,n=t.innerRect,r=t.outerRect,i=t.focusLength,o=r.y+r.height-n.y-n.height,a=e.y-n.y,s=e.x-n.x,u=n.x+n.width-e.x,h=r.y+r.height-e.y,c=o*i/(h-o),l=u*(i+c)/i,f=-(s*(i+c)/i),d=h+a*(i+c)/i-h,p=-h,v=c/5;return{innerTopLeftVertex:{x:f,y:d,z:-c},innerBottomLeftVertex:{x:f,y:p,z:-c},innerTopRightVertex:{x:l,y:d,z:-c},innerBottomRightVertex:{x:l,y:p,z:-c},outerTopLeftVertex:{x:f,y:d,z:v},outerTopRightVertex:{x:l,y:d,z:v},outerBottomLeftVertex:{x:f,y:p,z:v},outerBottomRightVertex:{x:l,y:p,z:v}}},r.modelSkeleton=function(t,e){var n=[],i=[];return Go.forEach((function(o){var a=xi(Vo[o],2),s=a[0],u=a[1],h=n.length/3;n=n.concat(r.calculatePlaneVertex(t[s],t[u],o,e)),i=i.concat(r.calculateIndices(o,h))})),[n,i]},r.calculatePlaneVertex=function(t,e,n,i){for(var o,a=[],s=xi(zo[n],3),u=s[0],h=s[1],c=s[2],l=r.linerInterpolate(t.x,e.x,u),f=r.linerInterpolate(t.y,e.y,h),d=r.linerInterpolate(t.z,e.z,c),p=0;p<=u;p++)for(var v=0;v<=h;v++)for(var m=0;m<=c;m++)En(o=hn(l[p],f[v],d[m],1),o,i),o[0]=o[0]/o[3],o[1]=o[1]/o[3],o[2]=o[2]/o[3],a.push(o[0],o[1],o[2]);return a},r.calculateIndices=function(t,e){var n=[],r=zo[t];r=r.filter((function(t){return t>0}));for(var i=xi(r,2),o=i[0],a=i[1],s=0,u=0,h=0,c=0,l=0;l<o;l++)for(var f=0;f<a;f++)u=(s=e+(a+1)*l+f)+1,c=(h=s+a+1)+1,n.push(s,h,c),n.push(s,c,u);return n},r.linerInterpolate=function(t,e,n){var r=[];if(n<=0)r.push(t);else for(var i=(e-t)/n,o=0;o<=n;o++)r[o]=t+i*o;return r},r.calculateUVCoordinate=function(t,e,n){for(var i,o=t.camera,a=t.panoWidth,s=t.panoHeight,u=t.vanishPointDeltaX,h=t.vanishPointDeltaY,c=[],l=e.width,f=e.height,d=0,p=0,v=n.length/3,m=0;m<v;m++)En(i=hn(n[3*m],n[3*m+1],n[3*m+2],1),i,o.viewMatrix),En(i,i,o.projectionMatrix),i[0]=i[0]/i[3],i[1]=i[1]/i[3],i[2]=i[2]/i[3],i[3]=1,d=(i[0]*a*.5+u+.5*l)/l,p=(i[1]*s*.5+h+.5*f)/f,c.push(r.getValidateUV(d),r.getValidateUV(p));return new Float32Array(c)},r.getValidateUV=function(t){return Math.max(-.1,Math.min(1.1,t))},r.rotationMatrix=Pe(),r.camera=e.camera,e.isMovingForward)Ve(r.rotationMatrix,r.rotationMatrix,g(_(-e.traverseDir+e.panoData.heading)));else{var i=_(180-e.traverseDir+e.panoData.heading);Ve(r.rotationMatrix,r.rotationMatrix,g(i))}r.cuboidVertexes=r.createSkeleton(e);var o=r.modelSkeleton(r.cuboidVertexes,r.rotationMatrix),a=xi(o,2),s=a[0],u=a[1];return r.verticesBufferData=new Float32Array(s),r.indicesBufferData=new Uint16Array(u),r.uvtsBufferData=r.calculateUVCoordinate(e,n,s,r.rotationMatrix),r.setAttribute("position",new Gr(r.verticesBufferData,3)),r.setAttribute("uv",new Gr(r.uvtsBufferData,2)),r.setIndexes(r.indicesBufferData),r}return c(e,t),e}(Zr),Ho=[0,1,0,.5],Zo=function(){function t(t,e,n,r,i){var o=this;this.start=function(){o.animation.start(),o._pano.dispatchEvent({debug:!0,log:"淡出动画，渲染一帧",type:d.REFRESH})},this.update=function(){o.animation.update()},this._pano=t,this.distance=e,this.handleEnd=i,this.traverseDir=r,this.snapshot=n,this.camera=t.camera,this.scene=this.initScene(),this.rotationMatrix=this.traverseGeometry.rotationMatrix,this.initAni()}var e=t.prototype;return e.initAni=function(){var t=this,e=Vt(0,0,this.distance);ee(e,e,this.rotationMatrix),this.animation=new ho(0,1,700,so.linear).onUpdate((function(n){var r=Ft();Yt(r,e,n),t.scene.traverse((function(t){t.position=r,t.updateWorldMatrix(!0)})),t._pano.dispatchEvent({debug:!0,type:d.REFRESH,log:"[Refresh Log] 前进动画， 渲染一帧"})})).onEnd((function(){t.handleEnd&&t.handleEnd(),t._pano.dispatchEvent({debug:!0,type:d.REFRESH,log:"[Refresh Log] 前进动画， 渲染一帧"})}))},e.initScene=function(){var t=new Qr,e=this._pano.getContainerSize(),n=e.width,r=e.height,i=new jo(this._pano,this.traverseDir),o=new Fo(0,0,n,r),a=new Wo(i,o),s=this.initMaterial(),u=new Kr(a,s);return this.traverseGeometry=a,t.add(u),t},e.initMaterial=function(){var t=new Ti;return t.depthTest=!1,t.vertexShader=Ao,t.fragmentShader=Co,t.uniforms={uSampler:{type:"t",value:this.snapshot},uOpacity:{type:"1f",value:1},vColor:{type:"4f",value:Ho},showDebugLine:{type:"1i",value:true}},this.material=t,t},t}(),qo=function(){function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=t,this.y=e}return t.prototype.equals=function(t){return t&&t.x===this.x&&t.y===this.y},t}(),Yo=function(){function t(t,e){var n=this;this.setData=function(t,e){n.panoData=t,n.nextPanoData=e},this.sceneChangeHandler=function(){if(n.panoData&&n.nextPanoData)return new Promise((function(t){var e=n.isStreet(n.panoData.panoType),r=n.isStreet(n.nextPanoData.panoType),i=n.snapshotFn(),o=n.pano.animationType;if(o&&["waterwave","fade"].indexOf(o)>-1)switch(o){case"waterwave":n.prepareWaterWave(i),t();break;case"fade":n.prepareFade(i),t()}else r&&e?(n.setDir(),n.prepareTraverse(i).then((function(e){n.prepareFade(e),t()}))):(n.prepareFade(i),t())}))},this.setSnapshot=function(t){n.snapshot=t},this.pano=t,this.snapshotFn=e,this.panoData=null,this.nextPanoData=null,this.changeAni=null,this.animateDir=0}var e=t.prototype;return e.draw=function(){if(this.changeAni){var t=this.changeAni,e=t.scene,n=t.camera;this.changeAni.update(),this.pano.renderer.render(e,n)}},e.setDir=function(){if(this.panoData&&this.nextPanoData){var t=this.nextPanoData.panoId,e=this.panoData.getTopos().filter((function(e){return e&&e.panoId===t}));if(e.length){var n=e[0].topoDir;this.animateDir=n}else this.animateDir=this.pano.getPov().heading||0}},e.prepareJump=function(){var t=this,e=this.calcJumpDistance();return new Promise((function(n){t.changeAni=new No(t.pano,t.animateDir,e,(function(){t.changeAni=null,n()})),t.changeAni.startAni(),t.pano.dispatchEvent({debug:!0,log:"穿梭动画，渲染一帧",type:d.REFRESH})}))},e.prepareTraverse=function(t){var e=this,n=this.calcJumpDistance();return new Promise((function(r){e.changeAni=new Zo(e.pano,n,t,e.animateDir,(function(){var t=e.snapshotFn(e.changeAni.scene,e.changeAni.camera);r(t),e.changeAni=null})),e.changeAni.start(),e.pano.dispatchEvent({debug:!0,log:"穿梭动画，渲染一帧",type:d.REFRESH})}))},e.prepareFade=function(t){var e=this;this.changeAni=new ko(this.pano,t,(function(){e.changeAni=null,e.pano.emit(d.SCENE_CHANGE_END)}))},e.prepareWaterWave=function(t){var e=this;this.changeAni=new Uo(this.pano,t,(function(){e.changeAni=null,e.pano.emit(d.SCENE_CHANGE_END)}))},e.calcJumpDistance=function(){var t,e,n=300,r=(t=new qo(this.panoData.panoX,this.panoData.panoY),e=new qo(this.nextPanoData.panoX,this.nextPanoData.panoY),t&&e?Math.round(Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))):0);"number"==typeof r&&(n*=Math.pow(r,1/4));return n},e.isStreet=function(t){return t===p.TYPE_STREET},t}(),Xo=function(){function t(t,e){var n=e.fov,r=void 0===n?145:n,i=e.cameraY,o=void 0===i?3e3:i,a=e.handleEnd;this._pano=void 0,this.originFov=void 0,this.originRotateX=void 0,this.originRotateY=void 0,this.targetFov=void 0,this.targetCameraY=void 0,this.handleEnd=void 0,this.animate=void 0,this._pano=t,this.originFov=this.camera.fov,this.originRotateX=this.camera.rotation.x,this.originRotateY=this.camera.rotation.y,this.targetFov=r,this.targetCameraY=o,this.handleEnd=a,this.init()}var e=t.prototype;return e.start=function(){this._pano.dispatchEvent({type:d.REFRESH,debug:!0,log:"开场动画动画起始，渲染一帧"}),this.animate.start()},e.update=function(){this.animate.update()},e.init=function(){var t=this,e=this.camera;this.handleCameraChange(0),this.animate=new ho(0,1,p.FISHEYE_DURATION,so.easeInOutQuad).onUpdate((function(e){t.handleCameraChange(e),t._pano.dispatchEvent({type:d.REFRESH,debug:!0,log:"开场动画动画，渲染一帧"})})).onEnd((function(){e.fov=t.originFov,e.rotateX(t.originRotateX),e.rotateY(t.originRotateY),e.setPosition(0,0,0),e.updateWorldMatrix(),e.updateProjectionMatrix(),t._pano.dispatchEvent({type:d.REFRESH,debug:!0,log:"开场动画动画结束，渲染一帧"}),t.handleEnd()}))},e.handleCameraChange=function(t){var e=this.camera,n=this.targetCameraY,r=this.targetFov-(this.targetFov-this.originFov)*t,i=(this.originRotateX- -90)*t-90,o=this.originRotateY*t;e.fov=r,e.rotateX(i),e.rotateY(o),e.setPosition(0,n-n*t,0),e.updateWorldMatrix(),e.updateProjectionMatrix()},o(t,[{key:"camera",get:function(){return this._pano.camera}}]),t}();function Ko(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Qo(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qo(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Qo(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Jo=function(){function t(t){var e=this;this.name="PanoOverlayManager",this.overlays=[],this.pano=void 0,this.isReady=!1,this.clickChecker=function(t,n){var r,i=!0,o=Ko(e.overlays);try{for(o.s();!(r=o.n()).done;){var a=r.value,s=a.dom.getBoundingClientRect(),u=s.left,h=s.right,c=s.top,l=s.bottom;if(t>=u&&t<=h&&n>=c&&n<=l){i=!1,a.handleClick();break}}}catch(t){o.e(t)}finally{o.f()}return i},this.pano=t}var e=t.prototype;return e.handleAdd=function(t){t&&t.id&&(this.overlays.some((function(e){return e.id===t.id}))||(this.overlays.push(t),this.isReady&&t.init(this.pano)))},e.handleRemove=function(t){for(var e=0;e<this.overlays.length;e++)if(this.overlays[e].id===t.id)return this.overlays[e].remove(),void this.overlays.splice(e,1)},e.init=function(){this.isReady=!0;var t,e=Ko(this.overlays);try{for(e.s();!(t=e.n()).done;){t.value.init(this.pano)}}catch(t){e.e(t)}finally{e.f()}},e.draw=function(){if(this.isReady){var t,e=Ko(this.overlays);try{for(e.s();!(t=e.n()).done;){t.value.draw()}}catch(t){e.e(t)}finally{e.f()}}},e.destroy=function(){var t,e=Ko(this.overlays);try{for(e.s();!(t=e.n()).done;){t.value.remove()}}catch(t){e.e(t)}finally{e.f()}this.overlays=[]},t}();function $o(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return ta(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ta(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ta(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ea=function(){function t(t){var e=this;this.renderer=void 0,this.gl=void 0,this.camera=void 0,this.cameraNoFix=null,this.panoData=null,this.scene=void 0,this.sceneChange=void 0,this.openingAni=void 0,this.sphereRender=void 0,this.linkGLRender=void 0,this.overlayManager=void 0,this.skyboxRender=void 0,this.pano=void 0,this.renderThreadId=null,this.requestId=null,this.isRAFRuning=!1,this.setData=function(){var t=nt(ot.mark((function t(n){var r,o;return ot.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:if(!e.panoData||!e.pano.useAnimation){t.next=8;break}return e.sceneChange.setData(e.panoData,n),t.next=6,e.sceneChange.sceneChangeHandler();case 6:void 0!==e.pano.backupUseAnimation&&(e.pano.useAnimation=e.pano.backupUseAnimation),e.pano.animationType="";case 8:e.reset(),e.panoData=n,e.pano.panoData=n,void 0===i(n.defaultHeading)&&void 0===i(n.defaultPitch)||e.pano.handlePovChange({heading:n.defaultHeading,pitch:n.defaultPitch}),r=n.image&&6===n.image.length,(o=r?e.skyboxRender:e.sphereRender).setData(n),e.linkGLRender.setData(n),e.overlayManager.init(),e.scene.add(o.meshs),e.updateProjectionMatrix(e.camera),e.updateCameraHeadingAndPitch(e.camera);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.getSnapshot=function(t,n){t=t||e.scene,n=n||e.camera;var r=e.pano.getContainerSize(),i=r.width,o=r.height,a=new Vi(i,o);return a.premultiplyAlpha=!0,e.renderer.render(t,n,a),a},this.update=function(){e.panoData&&(e.sphereRender.update(),e.linkGLRender.update(),e.startRenderThread())},this.onThumbLoaded=function(){e.sceneChange.changeAni&&e.sceneChange.changeAni.start();var t=e.linkGLRender.meshs;t&&e.scene.add(t),e.startFishEyeAni()},this.startRenderThread=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;e.renderThreadId&&(clearTimeout(e.renderThreadId),e.renderThreadId=null),e.renderThreadId=window.setTimeout((function(){e.isRAFRuning=!1,e.renderThreadId=null}),t),e.isRAFRuning||(e.isRAFRuning=!0,e.renderFrame())},this.resize=function(){var t=e.pano.getContainer();e.renderer.setSize(t.clientWidth,t.clientHeight)};var n=window.devicePixelRatio||1,r=t.getContainer();this.pano=t,this.renderer=new Ui({premultipliedAlpha:!1,preserveDrawingBuffer:t.opts.enableCapture||!1,antialias:!(n>1),pixelRatio:n,width:r.clientWidth,height:r.clientHeight}),this.renderer.setSize(r.clientWidth,r.clientHeight),t.getPanes().tileLayer.appendChild(this.renderer.domElement),this.gl=this.renderer.getContext(),this.camera=new Ki(75,r.clientWidth/r.clientHeight,.01,67e3),this.scene=new Qr,t.gl=this.gl,t.canvas=this.renderer.domElement,t.scene=this.scene,t.camera=this.camera,t.cameraNoFix=this.cameraNoFix,t.renderer=this.renderer,t.renders=[],this.sceneChange=new Yo(t,this.getSnapshot),this.initModule()}var e=t.prototype;return e.initModule=function(){var t=this.pano;this.sphereRender=new So(t),this.linkGLRender=new Bo(t),this.overlayManager=new Jo(t),this.skyboxRender=new eo(t),this.pano.renders.push(this.sphereRender,this.linkGLRender,this.overlayManager,this.skyboxRender)},e.reset=function(){this.scene.remove(this.sphereRender.meshs),this.scene.remove(this.linkGLRender.meshs)},e.getModule=function(t){var e,n=null,r=$o(this.pano.renders);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(i.name===t){n=i;break}}}catch(t){r.e(t)}finally{r.f()}return n},e.renderFrame=function(){!1!==this.isRAFRuning?(this.openingAni&&this.openingAni.update(),this.sphereRender.draw(),this.renderer.render(this.scene,this.camera),this.overlayManager.draw(),this.sceneChange.draw(),this.requestId=requestAnimationFrame(this.renderFrame.bind(this))):this.requestId&&(cancelAnimationFrame(this.requestId),this.requestId=null)},e.startFishEyeAni=function(){var t=this;this.pano.fisheye&&(this.openingAni=new Xo(this.pano,{handleEnd:function(){t.openingAni=null,t.pano.fisheye=!1}}),setTimeout((function(){t.openingAni.start(),t.startRenderThread()}),p.FISHEYE_DELAY))},e.updateProjectionMatrix=function(t,e){var n=this.pano.getFov(e),r=this.pano.getContainerSize(),i=r.width/r.height;t.fov=n,t.aspect=i,t.updateProjectionMatrix()},e.updateCameraHeadingAndPitch=function(t){var e=this.pano.getPov(),n=e.heading,r=e.pitch,i=this.panoData,o=i.fixHeading,a=void 0===o?0:o,s=i.fixPitch,u=void 0===s?0:s,h=i.fixRoll,c=void 0===h?0:h;t.rotateX(r-u),t.rotateY(-n+a),t.rotateZ(c),t.updateWorldMatrix()},e.safeCall=function(t,e,n){var r=this.getModule(t);if(r&&r[e])return r[e].apply(r,n||[]);throw new Error("[safeCall] get module error => ".concat(t))},o(t,[{key:"isCanUpdate",get:function(){var t=this.sceneChange.changeAni,e=this.openingAni;return this.panoData&&!(t||e)}}]),t}(),na=function(){function t(t){var e=this;this.updateAnglePerPixel=function(){e._anglePerPixel=e._pano.calcAnglePerPixel()},this.destroy=function(){e.bindEvent(!1)},this._pano=t,this._displayZoom=t.getZoom(),this._anglePerPixel=t.calcAnglePerPixel(),this.lock=!1,this.clickTimer=null,this.dragAni=null,this.state={initPos:null,initHeading:0,initPitch:0,lastDiffPos:null,moveDiffPos:null,isTouchDown:!1,isTouchMove:!1,startTime:0,lastMoveTime:0}}var e=t.prototype;return e.init=function(){this._initialized||(this._initialized=!0,this.isMobile=navigator.userAgent.toLowerCase().match(/ipod|ipad|iphone|android/),this.isMobile?(this.EVENTS={START:"touchstart",MOVING:"touchmove",END:"touchend",OUT:"touchcancel",WHEEL:"gesturechange",DOMMouseScroll:"DOMMouseScroll"},this.getPagePosition=function(t){var e=t.touches.length>0?t.touches[0]:t.changedTouches[0];return{x:e.pageX,y:e.pageY}}):(this.EVENTS={START:"mousedown",MOVING:"mousemove",END:"mouseup",OUT:"mouseout",WHEEL:"mousewheel"},this.getPagePosition=function(t){return{x:t.pageX,y:t.pageY}}),this.bindEvent())},e.bindEvent=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=document.body,n=this.EVENTS,r=n.START,i=n.MOVING,o=n.END,a=this._pano._svContainer,s=t?"addEventListener":"removeEventListener";a[s](r,this.handleDown.bind(this)),a[s](i,this.handleMove.bind(this)),e[s](o,this.handleUp.bind(this))},e.handleDown=function(t){this.dragAni&&this.dragAni.stop();var e=this.state,n=this.getPagePosition(t),r=this._pano.getPov();e.initPos=n,e.isTouchDown=!0,e.initHeading=r.heading,e.initPitch=r.pitch,e.startTime=x(),this._pano.dispatchEvent(d.TOUCH_START,t)},e.handleMove=function(t){if(this.state.isTouchDown){this.state.isTouchMove=!0;var e=this.calcDiffPos(this.state.initPos,this.getPagePosition(t));this.setPov(e),this.state.moveDiffPos=e,this.state.lastDiffPos=e,this.state.lastMoveTime=x(),t.preventDefault(),t.stopPropagation()}},e.handleUp=function(t){var e=this;if(this.state.isTouchDown){var n=!0,r=this.getPagePosition(t);if(t.pos=r,this.state.isTouchDown=!1,this._pano.dispatchEvent(d.TOUCH_END,t),this._pano.renders.length)for(var i=0;i<this._pano.renders.length;i++){var o=this._pano.renders[i];if(o.clickChecker&&!(n=o.clickChecker(r.x,r.y))){t.stopPropagation();break}}if(!1!==n)if(this.state.isTouchMove)this.state.isTouchMove=!1,this.processMotion(t);else if(t.stopPropagation(),this.clickTimer)clearTimeout(this.clickTimer),this.clickTimer=null,this._pano.dispatchEvent(d.DOUBLE_CLICK,t);else{this.clickTimer=setTimeout((function(){e.clickTimer=null,e._pano.dispatchEvent(d.CLICK,t)}),300)}}},e.setPov=function(t){var e=t.x,n=t.y,r=-e*this._anglePerPixel,i=n*this._anglePerPixel,o=this.state.initHeading+r,a=this.state.initPitch+i;this._pano.setPov({heading:o,pitch:a})},e.processMotion=function(t){var e=this,n=this.state,r=x(),i=r-n.lastMoveTime,o=n.moveDiffPos,a=o.x,s=o.y;if(i<300&&(Math.abs(a)>10||Math.abs(s)>10)){var u=this.calcDiffPos(this.state.initPos,this.getPagePosition(t)),h=2*Math.sqrt(Math.pow(u.x,2)+Math.pow(u.y,2))/(.008*(r-n.startTime)),c=[u.x>0?1:-1,u.y>0?1:-1],l=Math.abs(u.x),f=Math.abs(u.y),p=Math.atan2(f,l),v=Math.cos(p)*h,m=Math.sin(p)*h;-1===c[0]&&(v=-v),-1===c[1]&&(m=-m),this.dragAni&&this.dragAni.stop();var g=this._pano.getPov(),y=g.heading,_=g.pitch;n.initHeading=y,n.initPitch=_;this.dragAni=new ho(0,1,400,(function(t){return.3125*t-.15625*t*t})).onUpdate((function(t){var n=(t*=6.4)*v,r=t*m;e.setPov({x:n,y:r})})).onEnd((function(){e.dragAni=null,e._pano.dispatchEvent({type:d.POV_CHANGED_END})})).startAndAutoUpdate()}else this._pano.dispatchEvent({type:d.POV_CHANGED_END})},e.calcDiffPos=function(t,e){return t&&e?{x:e.x-t.x,y:e.y-t.y}:{x:0,y:0}},t}();function ra(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return ia(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ia(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ia(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var oa=function(){function t(t){this.pano=t,this.preZoom=t.getZoom(),this.zoomChangeAni=null,this.debug=!1,this.panoServiceLock=!1,this.bindEvent(),this.initModule(),this.initResize(),this.handleContextStatus()}var e=t.prototype;return e.initModule=function(){var t=this.pano;this.panoService=new tt(t),this.panoGLRender=new ea(t),this.op=new na(t)},e.initResize=function(){var t=this,e=this.pano.getContainerSize(),n=this.pano.getContainer(),r=function(n,r){if(n&&r){var i=new l(n,r);i.equals(e)||(t.pano.dispatchEvent({type:d.SIZE_CHANGED}),e=i)}};if(void 0!==window.ResizeObserver){var i=new window.ResizeObserver((function(t){var e,n=ra(t);try{for(n.s();!(e=n.n()).done;){var i=e.value.target;r(i.clientWidth,i.clientHeight)}}catch(t){n.e(t)}finally{n.f()}}));i.observe(n),this.resizeOb=i}else this.checkSizeTimer=setInterval((function(){r(n.clientWidth,n.clientHeight)}),80)},e.bindEvent=function(){var t=this,e=this.pano;e.on(d.PANO_ERROR,(function(){t.panoServiceLock=!1})),e.on(d.DATA_LOADED,(function(n){t.pano.opts.visible?t.pano.show():t.pano.hide(),t.panoServiceLock=!1,n.options&&n.options.animation&&(e.backupUseAnimation=e.useAnimation,e.useAnimation=n.options.animation,""!==n.options.animationType&&(e.animationType=n.options.animationType)),t.panoGLRender.setData(n.data),t.op.init()})),e.on(d.SET_POV,(function(n){var r=n.pov,i=n.options,o=(void 0===i?{animation:!0}:i).animation;if(t.panoGLRender.isCanUpdate){var a=function(n){e.handlePovChange(n)&&(t.panoGLRender.updateCameraHeadingAndPitch(e.camera),t.panoGLRender.update(),e.dispatchEvent(d.POV_CHANGED,n))};if(o){var s=e.getPov(),u=s.heading,h=s.pitch,c=r.heading-u,l=r.pitch-h;c>180?(u+=360,c=r.heading-u):c<-180&&(u-=360,c=r.heading-u),new ho(0,1,400,so["ease-out"]).onUpdate((function(t){a({heading:u+t*c,pitch:h+t*l})})).onEnd((function(){})).startAndAutoUpdate()}else a(r)}else e.handlePovChange(r)})),e.on(d.ZOOM_CHANGED,(function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.panoGLRender.isCanUpdate){var r=t.preZoom,i=e.getZoom();if(r!==i){var o=n.noAnimation||!1;if(t.zoomChangeAni&&(t.zoomChangeAni.stop(),t.zoomChangeAni=null),o)return t.op.updateAnglePerPixel(),t.panoGLRender.updateProjectionMatrix(e.camera),t.panoGLRender.update(),void(t.preZoom=i);var a=400;t.zoomChangeAni=new ho(r,i,a,so.easeOutCubic).onUpdate((function(n){t.panoGLRender.updateProjectionMatrix(e.camera,n),t.panoGLRender.update(n)})).onEnd((function(){t.zoomChangeAni=null,t.preZoom=i})).startAndAutoUpdate()}}})),e.on(d.DOUBLE_CLICK,(function(){t.panoGLRender.isCanUpdate&&(v.isMobile&&(3===e.getZoom()?e.setZoom(2):e.setZoom(3)))})),e.on(d.REFRESH,(function(e){var n=e.duration||200;t.panoGLRender.startRenderThread(n),t.debug&&e.log&&e.debug&&console.warn(e.log)})),e.on(d.SET_ID,(function(e){if(!t.panoServiceLock&&e.id){t.panoServiceLock=!0,window.getPanoById=t.panoService.getPanoById;var n=(1e5*Math.random()).toFixed(0);BMapGL._rd=BMapGL._rd||{},BMapGL._rd["_cbk"+n]=function(t){t&&void 0!==t.error&&0===t.error?window.getPanoById(e.id):Q("PANORAMA"),delete BMapGL._rd["_cbk"+n]},K("PANORAMA","BMapGL._rd._cbk"+n)}})),e.on(d.SET_POSITION,(function(e){if(!t.panoServiceLock&&e.point){t.panoServiceLock=!0,window.getPanoByLocation=t.panoService.getPanoByLocation;var n=(1e5*Math.random()).toFixed(0);BMapGL._rd=BMapGL._rd||{},BMapGL._rd["_cbk"+n]=function(t){t&&void 0!==t.error&&0===t.error?window.getPanoByLocation(e.point):Q("PANORAMA"),delete BMapGL._rd["_cbk"+n]},K("PANORAMA","BMapGL._rd._cbk"+n)}})),e.on(d.SIZE_CHANGED,(function(){t.op.updateAnglePerPixel(),t.panoGLRender.resize(),t.panoGLRender.updateProjectionMatrix(e.camera),t.panoGLRender.update()})),e.on(d.THUMB_LOADED,(function(){t.panoGLRender.onThumbLoaded(),t.panoGLRender.update()})),e.on(d.OVERLAY_ADD,(function(e){t.panoGLRender.overlayManager.handleAdd(e)})),e.on(d.OVERLAY_REMOVE,(function(e){t.panoGLRender.overlayManager.handleRemove(e)})),e.on(d.OVERLAYS_CLEAR,(function(){t.panoGLRender.overlayManager.destroy()})),e.on(d.LINK_VISIBLE_CHANGE,(function(e){"boolean"==typeof e.value&&(t.panoGLRender.safeCall("PanoLinkRender","setVisible",[e.value]),t.pano.dispatchEvent(d.REFRESH))})),e.on(d.DESTROY,(function(){t.op.destroy(),t.resizeOb&&t.resizeOb.disconnect(),t.checkSizeTimer&&clearInterval(t.checkSizeTimer),t.panoGLRender.renderer.forceContextLoss(),e.canvas.removeEventListener("webglcontextlost",t.onWebGLContextLost,!1)}));var n=v.isFirefox?"DOMMouseScroll":"mousewheel",r=new Date;e._svContainer.addEventListener(n,(function(t){if(e.opts.enableScrollWheelZoom&&e.opts.visible){var n=new Date;if(n-r<400)return;r=n;var i=-t.detail/3||t.wheelDelta/120,o=e.getZoom()+i;e.setZoom(o),t.preventDefault()}}))},e.getImgZoom=function(){return this.pano.calcDisplayZoom().imgZoom},e.handleContextStatus=function(){this.pano.canvas.addEventListener("webglcontextlost",this.onWebGLContextLost,!1)},e.onWebGLContextLost=function(t){t.preventDefault(),setTimeout((function(){window.location.reload()}),200)},t}();function aa(t,e,n){t.addEventListener(e,n,!1)}var sa=function(t){function e(e,n){var r;(r=t.call(this)||this).panoData=null,r.opts=void 0,r.useAnimation=!1,r.backupUseAnimation=r.useAnimation,r.animationType="",r.fisheye=!1,r.canvas=void 0,r.camera=void 0,r.renderer=void 0,r.gl=void 0,r.scene=void 0,r.cameraNoFix=void 0,r.renders=void 0,r.closeBtn=null,r.navigator=null,r._container=void 0,r._pov={heading:0,pitch:0},r._id=null,r._position=null,r._zoom=2,r._displayZoomResultsCache={},r._svContainer=void 0,r._eventManager=void 0,r._panes=void 0,r.addCloseButton=function(t){var e=r.closeBtn=document.createElement("div");e.className="pano_close",e.style.cssText=["position:absolute","right:10px","top:10px","padding: 5px 8px;","cursor:pointer","border-radius: 4px","font-size: 14px","background-color: rgba(0,0,0,.55)","z-index: 99","color: #fff"].join(";"),e.innerText="关闭",e.title="退出全景",e.onclick=function(){r.hide(),t&&t()},r._svContainer.appendChild(e)},r.getContainer=function(){return r._container},r.getContainerSize=function(){var t=r._container;return new l(t.clientWidth,t.clientHeight)},r.getPanes=function(){return r._panes},r.show=function(){r.opts.visible=!0,w.show(r._svContainer)},r.hide=function(){r.opts.visible=!1,w.hide(r._svContainer)},r.getZoom=function(){return r._zoom},r.setZoom=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t!==r._zoom&&(t>p.MAX_ZOOM&&(t=p.MAX_ZOOM),t<p.MIN_ZOOM&&(t=p.MIN_ZOOM),t!==r._zoom&&(r._zoom=t,r.dispatchEvent(d.ZOOM_CHANGED,{noAnimation:e.noAnimation||!1})))},r.getPov=function(){return r._pov},r.setPov=function(t,e){r.dispatchEvent(d.SET_POV,{pov:t,options:e||{animation:!1}})},r.handlePovChange=function(t){if("object"===i(t)){var e=!1,n=t.heading,o=t.pitch;if("number"!=typeof n||isNaN(n)||(e=!0,n=_(n),r._pov.heading=n),"number"==typeof o&&!isNaN(n)){e=!0;var a=r.opts.minPitch,s=r.opts.maxPitch;o>s&&(o=s),o<a&&(o=a),r._pov.pitch=o}return e}},r.calcDisplayZoom=function(t,e){t=t||r.getContainerSize(),e=e||r.getZoom();var n=t,i=n.width,o=n.height,a=r.opts.maxImageZoom,s=r.opts.minImageZoom,u="".concat(i,"_").concat(o,"_").concat(e);if(r._displayZoomResultsCache[u])return r._displayZoomResultsCache[u];for(var h=r.calcAnglePerPixel(),c=Math.floor(e)+2,l=360/(2*Math.pow(2,c-2)*h);l>512;)c++,l=360/(2*Math.pow(2,c-2)*h);if(c>a){var f=c-a;l*=Math.pow(2,f),c=a}c<s&&(c=s);var d={imgZoom:c,displayTileSize:l=Math.round(l)};return r._displayZoomResultsCache[u]=d,d},r.calcAnglePerPixel=function(){return r.getFov()/r.getContainerSize().height},r.getFov=function(t){return t=t||r.getZoom(),(v.isMobile?r.calcMobileFovy:r.calcPCFovy).call(a(r),t)},r.getVisible=function(){return r.opts.visible},r.setId=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.useAnimation=e.animation||!1,r.fisheye=e.fisheye||!1,r.animationType=e.animationType||"",r.dispatchEvent(d.SET_ID,{id:t})},r.setPosition=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.useAnimation=e.animation||!1,r.fisheye=e.fisheye||!1,r.animationType=e.animationType||"",r.dispatchEvent(d.SET_POSITION,{point:t})};var o={minImageZoom:p.TILE_MIN_ZOOM,maxImageZoom:p.TILE_MAX_ZOOM,minPitch:p.MIN_PITCH,maxPitch:p.MAX_PITCH,radius:p.RADIUS,tileBaseUrls:p.TILE_BASE_URLS,linksControl:!0,navigationControl:!0,enableScrollWheelZoom:!0,enableCapture:!1,visible:!0};r.opts=Object.assign({},o,n);var s="string"==typeof e?document.querySelector(e):e;if(!s)throw new Error("全景引擎宿主容器不存在");return r._container=s,r._init(),r}c(e,t);var n=e.prototype;return n.getPosition=function(){return this.position},n.setOptions=function(t){var e;for(e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var n=!0;if("object"!==i(t[e])&&(n=t[e]!==this.opts[e]),this.opts[e]=t[e],!n)continue;switch(e){case"linksControl":this.dispatchEvent(d.LINK_VISIBLE_CHANGE,{value:t[e]});break;case"navigationControl":var r=!!t[e],o=this.navigator;r?o.show():o.hide()}}},n.capture=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.canvas){var e=this.canvas,n=t.quality||.8,r=t.type||"image/jpeg",i=e.toDataURL(r,n);return i}},n.addOverlay=function(t){this.dispatchEvent(d.OVERLAY_ADD,t)},n.removeOverlay=function(t){this.dispatchEvent(d.OVERLAY_REMOVE,t)},n.clearOverlays=function(){this.dispatchEvent(d.OVERLAYS_CLEAR)},n.destroy=function(){this.dispatchEvent(d.DESTROY)},n._init=function(){this._createDoms(),this.navigator=function(t){function e(t){this._initialize(t)}return m(e.prototype,{_initialize:function(t){this._pano=t,this.imgPath=t.opts.imgPath||"//api0.map.bdimg.com/images/",this._zoomInEnabled=!0,this._zoomOutEnabled=!0,this._render(),this._bind()},_render:function(){this._container=w.create("div");var t=this._container.style;t.position="absolute",t.left="10px",t.top="10px",t.zIndex=99;var e=this._container;e.innerHTML=this._generateHtml(),v.isPc?(this._panBtnContainer=e.children[2],this._panBtns=[this._panBtnContainer.children[0],this._panBtnContainer.children[1],this._panBtnContainer.children[2],this._panBtnContainer.children[3]],this._svgDirGroup=e.children[1].childNodes[0],this._zoomContainer=e.children[3]):v.isMobile&&(this._zoomContainer=e.children[0]),this._btnZoomIn=this._zoomContainer.children[0],this._btnZoomOut=this._zoomContainer.children[1],v.isMobile&&(this._zoomContainer.style.left=this._zoomContainer.style.top="0",this._zoomContainer.style.width="36px",this._zoomContainer.style.height="78px",this._btnZoomIn.style.width=this._btnZoomOut.style.width="33px",this._btnZoomIn.style.height=this._btnZoomOut.style.height="36px",this._btnZoomOut.style.top="37.5px"),this._pano.getZoom()>=p.MAX_ZOOM&&this._setZoomBtnEnabled("zoomIn",!1),this._pano.getZoom()<=p.MIN_ZOOM&&this._setZoomBtnEnabled("zoomOut",!1),this._pano._svContainer.appendChild(e)},_generateHtml:function(){var t=[];return v.isPc&&(t.push(this._generatePanHtml()),t.push(this._generateDirHtml()),t.push(this._generatePanBtnHtml())),t.push(this._generateZoomContainerHtml()),t.join("")},_generateDirHtml:function(){return'<svg version="1.1" overflow="hidden" width="82px" height="82px" viewBox="0 0 82 82"style="position: absolute; top: 0px; left: 0px;"><g transform="rotate(0, 41, 41)"><rect x="33"y="1" width="14" height="12" rx="4" ry="4" stroke="#868685" stroke-width="1" fill="#f8f8f8"></rect><polyline points="37.5,9.5 37.5,3.5 42.5,9.5 42.5,3.5" stroke-linejoin="bevel" stroke-width="1.5" fill="#f2f4f6" stroke="#868685"></polyline></g></svg>'},_generatePanHtml:function(){return'<div style="position:absolute;top:4px;left:4px;width:74px;height:74px;background:url('+this.imgPath+'st-navictrl.png) no-repeat;-webkit-user-select:none;overflow:hidden"><div></div></div>'},_generatePanBtnHtml:function(){return'<div style="position:absolute;top:0px;left:0;width:82px;height:82px;user-select:none;"><div style="position:absolute;left:32px;top:13px;cursor:pointer;width:17px;height:17px;" title="向上平移"></div><div style="position:absolute;left:14px;top:32px;cursor:pointer;width:17px;height:17px;" title="向左平移"></div><div style="position:absolute;left:51px;top:32px;cursor:pointer;width:17px;height:17px;" title="向右平移"></div><div style="position:absolute;left:33px;top:51px;cursor:pointer;width:17px;height:17px;" title="向下平移"></div></div>'},_generateZoomContainerHtml:function(){var t="background-image:url('"+this.imgPath+"st-navictrl.png');background-repeat:no-repeat;background-position:-74px 0;";return v.isMobile&&(t="background-image:url('"+this.imgPath+"st-navictrl-hd.png');background-repeat:no-repeat;background-position:0 0;background-size:180px 78px;"),'<div style="position:absolute;top:84px;left:30px;width:24px;height:52px;'+t+'-webkit-user-select:none;overflow:hidden"><div style="position:absolute;cursor:pointer;width:22px;height:24px;top:0;left:0;-webkit-user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)" title="放大一级"></div><div style="position:absolute;cursor:pointer;width:22px;height:24px;top:25px;left:0;-webkit-user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)" title="缩小一级"></div><div></div></div>'},_bind:function(){var t=this._pano,e=this;if(v.isPc){aa(this._panBtns[0],"click",(function(){var e=t.getPov();t.setPov({heading:e.heading,pitch:e.pitch+30},{animation:!0})})),aa(this._panBtns[1],"click",(function(){var e=t.getPov();t.setPov({heading:e.heading-45,pitch:e.pitch},{animation:!0})})),aa(this._panBtns[2],"click",(function(){var e=t.getPov();t.setPov({heading:e.heading+45,pitch:e.pitch},{animation:!0})})),aa(this._panBtns[3],"click",(function(){var e=t.getPov();t.setPov({heading:e.heading,pitch:e.pitch-30},{animation:!0})}));for(var n=0;n<this._panBtns.length;n++)aa(this._panBtns[n],"mousedown",(function(t){t.stopPropagation()}));e._mousedown=!1,aa(this._panBtnContainer,"mousedown",(function(n){e._mousedown=!0,e._panBtnContainer.style.cursor="grabbing",e._startHeading=e._calcAngle(n),e._curHeading=t.getPov().heading,n.preventDefault()})),aa(document,"mousemove",(function(n){e._mousedown&&t.setPov({heading:e._curHeading+360-(e._calcAngle(n)-e._startHeading),pitch:t.getPov().pitch})})),aa(document,"mouseup",(function(){e._mousedown&&(e._mousedown=!1,e._panBtnContainer.style.cursor="grab",e._startHeading=null)})),t.addEventListener("position_changed",(function(){var t=360-this.getPov().heading;e._svgDirGroup.setAttribute("transform","rotate("+t+", 41, 41)")})),t.addEventListener("pov_changed",(function(){var t=360-this.getPov().heading;e._svgDirGroup.setAttribute("transform","rotate("+t+", 41, 41)")}))}aa(this._btnZoomIn,"click",(function(){t.setZoom(t.getZoom()+1)})),aa(this._btnZoomOut,"click",(function(){t.setZoom(t.getZoom()-1)})),v.isPc?(aa(this._btnZoomIn,"mousedown",(function(){e._redrawZoomBtn(e._zoomInEnabled,-98)})),aa(this._btnZoomOut,"mousedown",(function(){e._redrawZoomBtn(e._zoomOutEnabled,-122)})),aa(this._btnZoomIn,"mouseup",(function(){e._redrawZoomBtn(e._zoomInEnabled,-74)})),aa(this._btnZoomOut,"mouseup",(function(){e._redrawZoomBtn(e._zoomOutEnabled,-74)}))):v.isMobile&&(aa(this._btnZoomIn,"touchstart",(function(){e._redrawZoomBtn(e._zoomInEnabled,-98)})),aa(this._btnZoomOut,"touchstart",(function(){e._redrawZoomBtn(e._zoomOutEnabled,-122)})),aa(this._btnZoomIn,"touchend",(function(){e._redrawZoomBtn(e._zoomInEnabled,-74)})),aa(this._btnZoomOut,"touchend",(function(){e._redrawZoomBtn(e._zoomOutEnabled,-74)}))),t.addEventListener("zoom_changed",(function(n){t.getZoom()>=p.MAX_ZOOM?e._setZoomBtnEnabled("zoomIn",!1):t.getZoom()<=p.MIN_ZOOM?e._setZoomBtnEnabled("zoomOut",!1):(e._setZoomBtnEnabled("zoomIn",!0),e._setZoomBtnEnabled("zoomOut",!0))}))},_redrawZoomBtn:function(t,e){t&&(v.isMobile&&(e=(e+74)/24*36),this._zoomContainer.style.backgroundPosition=e+"px 0")},show:function(){this._container.style.display=""},hide:function(){this._container.style.display="none"},_calcAngle:function(t){var e=(t=window.event||t).pageX||t.clientX,n=t.pageY||t.clientY,r=this._pano.getContainer().getBoundingClientRect();e=e-r.left-50,n=-(n-r.top-50);var i=Math.atan2(n,e)/Math.PI*180;return i<90?90-i:450-i},_setZoomBtnEnabled:function(t,e){if("zoomIn"===t)if(e){this._zoomInEnabled=!0,this._btnZoomIn.style.cursor="pointer";var n=-74;v.isMobile&&(n=0),this._zoomContainer.style.backgroundPosition=n+"px 0"}else{this._zoomInEnabled=!1,this._btnZoomIn.style.cursor="";var r=-170;v.isMobile&&(r=-144),this._zoomContainer.style.backgroundPosition=r+"px 0"}if("zoomOut"===t)if(e){this._zoomOutEnabled=!0,this._btnZoomOut.style.cursor="pointer";var i=-74;v.isMobile&&(i=0),this._zoomContainer.style.backgroundPosition=i+"px 0"}else{this._zoomOutEnabled=!1,this._btnZoomOut.style.cursor="";var o=-146;v.isMobile&&(o=-108),this._zoomContainer.style.backgroundPosition=o+"px 0"}}}),new e(t)}(this),this._eventManager=new oa(this)},n._createDoms=function(){var t=this._container,e=w.create("div"),n=e.style;n.overflow="hidden",n.position="absolute",n.zIndex="20",n.top=n.left="0px",n.height=n.width="100%",n.backgroundColor="#e5e3df",n.display="none",n.cursor="grab",e.addEventListener("mousedown",(function(){return n.cursor="grabbing"})),e.addEventListener("mouseup",(function(){return n.cursor="grab"})),this._svContainer=e,this._panes={tileLayer:this._createContainer("1"),maskLayer:this._createContainer("2"),linksLayer:this._createContainer("3"),overlayLayer:this._createContainer("4"),effectLayer:this._createContainer("5")},e.appendChild(this._panes.tileLayer),e.appendChild(this._panes.linksLayer),e.appendChild(this._panes.overlayLayer),e.appendChild(this._panes.effectLayer),b()||(e.appendChild(this._panes.maskLayer),this._panes.maskLayer.style.width="".concat(t.clientWidth,"px"),this._panes.maskLayer.style.height="".concat(t.clientHeight,"px"),this._panes.maskLayer.style.overflow="hidden"),t.appendChild(e),"absolute"!==w.getCurrentStyle(t).position&&(t.style.position="relative")},n._createContainer=function(t){var e=w.create("div"),n=e.style;return n.position="absolute",n.top=n.left="0",n.zIndex=t||"0",e},n.calcMobileFovy=function(t){var e=this.getContainerSize(),n=e.width,r=e.height,i=240/Math.pow(2,t),o=n/2/Math.tan(g(i/2)),a=Math.atan2(r/2,o);return 2*y(a)},n.calcPCFovy=function(t){return 90-15*(t-1)},o(e,[{key:"imageZoom",get:function(){return this.calcDisplayZoom().imgZoom}},{key:"panoId",get:function(){return this.panoData?this.panoData.panoId:""}},{key:"panoNorthDir",get:function(){return this.panoData?this.panoData.northDir:0}},{key:"position",get:function(){return this.panoData&&"number"==typeof this.panoData.panoX&&"number"==typeof this.panoData.panoY?new f(this.panoData.panoX,this.panoData.panoY):null}}]),e}(Or),ua={dom:null,anchor:null,width:null,height:null,altitude:2,sphereZ:null,useUV:!1},ha=function(t){function e(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(n=t.call(this)||this).visible=!0,n.worldCoord=void 0,n.pov=void 0,n.id=n.genId(),n._pano=void 0,n.lastPanoPosition=null,n.initialized=!1,n.position=void 0,n.options=void 0,n.position=e,n.options=Object.assign({},ua,r),n.pov=null,n}c(e,t);var n=e.prototype;return n.getPov=function(){return this.pov},n.genId=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;return Number("".concat(Math.random().toString().substr(3,t)).concat(Date.now())).toString(36)},n.init=function(t){t&&!this.initialized&&(this._pano=t,this.lastPanoPosition=this._pano.position,this.worldCoord=this.options.useUV?this.calcCoordsByUV():this.calcCoordsByMC(),this.worldCoord&&(this.initialized=!0,this.add(),this.draw()))},n.calcCoordsByMC=function(){var t=this._pano.position;if(t&&this.position){var e,n=this.position,r=n.lng-t.lng,i=n.lat-t.lat,o=Math.atan2(r,i);o<0&&(o+=2*Math.PI),o=Math.round(y(o));var a=500,s=this.options,u=s.sphereZ,h=s.altitude;null===u?e=25*h:(e=u||0,a=Math.sqrt(Math.pow(r,2)+Math.pow(i,2)+Math.pow(e,2)));var c=y(Math.asin(e/a));c=c>90?90:c<-90?-90:c;var l=_(o+this._pano.panoNorthDir),f=this.radius,d=Math.cos(g(c))*f;d=Math.round(100*d)/100;var p=Math.cos(g(l))*d,v=Math.sin(g(c))*f,m=Math.sin(g(l))*d;return this.pov={heading:o,pitch:c},Vt(p,v,m)}},n.calcCoordsByUV=function(){if(this.position){var t=this.radius,e=this.position,n=xi(e,2),r=n[0],i=n[1],o=2*r*Math.PI,a=(i-.5)*Math.PI,s=Math.cos(a)*Math.cos(o)*t,u=Math.sin(a)*t,h=Math.cos(a)*Math.sin(o)*t;return this.pov={heading:_(y(o)-this._pano.panoNorthDir),pitch:y(a)},Vt(s,u,h)}},n.add=function(){var t=this.options,e=t.width,n=t.height;if(this.dom){var r=this._pano,i=this.dom;i.style.position="absolute",r.getPanes().overlayLayer.appendChild(i),"number"!=typeof e&&(this.options.width=i.clientWidth),"number"!=typeof n&&(this.options.height=i.clientHeight),r.dispatchEvent({type:"onoverlaydomadded",overlay:this})}},n.remove=function(){var t=this.dom;t&&t.parentNode&&t.parentNode.removeChild(t)},n.povToPointGL=function(){if(!this.worldCoord)return null;var t=this._pano,e=t.camera,n=t.getContainerSize(),r=n.width,i=n.height;return po(e,this.worldCoord,r,i)},n.draw=function(){if(this.initialized&&this.visible&&this._pano&&this._pano.panoData&&this.dom){var t=this.lastPanoPosition,e=this._pano.position;t.lng===e.lng&&t.lat===e.lat||(this.lastPanoPosition=e,this.worldCoord=this.options.useUV?this.calcCoordsByUV():this.calcCoordsByMC());var n=this.dom,r=this.povToPointGL();if(n.style.visibility="hidden",r){var i=this.calcAnchor(),o="".concat(r[0]-i.width,"px"),a="".concat(r[1]-i.height,"px");if(isNaN(r[0])||isNaN(r[1]))return;n.style.visibility="visible",n.style.webkitTransform="translate(".concat(o,", ").concat(a,")"),n.style.transform="translate(".concat(o,", ").concat(a,")")}}},n.handleClick=function(){this.dispatchEvent("click")},n.calcAnchor=function(){var t=this.options,e=t.anchor,n=t.width,r=void 0===n?0:n,i=t.height;return e||new l(r/2,(void 0===i?0:i)/2)},n.show=function(){this.visible=!0,this.dom&&(this.dom.style.display="")},n.hide=function(){this.visible=!1,this.dom&&(this.dom.style.display="none")},o(e,[{key:"radius",get:function(){return this._pano?this._pano.opts.radius:0}},{key:"dom",get:function(){return this.options.dom}}]),e}(Or),ca=function(t){function e(e,n){var r=n.position,i=n.altitude,o=void 0===i?2:i,a=n.costomStyle,s=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=document.createElement("div"),r={backgroundColor:"rgba(29, 29, 29, 0.8)",fontSize:"14px",padding:"7px 14px",height:"19px",color:"#fff",whiteSpace:"nowrap",borderRadius:"4px"};return m(n.style,r,e),n.innerText=t,n}(e,void 0===a?{}:a);return t.call(this,r,{dom:s,altitude:o})||this}return c(e,t),e}(ha);t.Converters=mo,t.Engines=Qi,t.EventType=d,t.PanoLabel=ca,t.PanoOverlay=ha,t.PanoramaService=function(){var t=this;this.getPanoById=function(e,n){var r;r="".concat(tt.SERVICE_URL,"?qt=sdata&sid=").concat(e,"&").concat($("/")),t.request(r).then((function(t){n&&n(t)})).catch((function(t){n&&n(null)}))},this.getPanoByLocation=function(e,n,r){var i;i="".concat(tt.SERVICE_URL,"?qt=qsdata&x=").concat(e.lng,"&y=").concat(e.lat).concat(n?"&r="+n:"","&action=1&").concat($("/")),t.request(i).then((function(t){r&&r(t)})).catch((function(t){r&&r(null)}))},this.request=function(t){return T(t,{},{jsonp:"fn"})}},t.Point=f,t.getPanoControl=function(t,e){var n,r,i,o=(e=e||{}).imgPath||"//api.map.baidu.com/images/";function a(e){e.call(this),this.defaultAnchor=t.ControlAnchor.TOP_RIGHT,this.defaultOffset=new t.Size(10,10),this._isOn=!1}return n=a,r=t.Control,(i=Object.create(r.prototype)).constructor=n,n.prototype=i,m(a.prototype,{initialize:function(t){return this._map=t,this._render(),this._bind(),this._container},_render:function(){var t=this,n=w.create("div");n.innerHTML='<span style="position:relative;top:33px;">全景</span>',n.title="进入全景",m(n.style,{width:"49px",height:"51px",color:"#565656",background:'url("'.concat(o,'st-control.png")'),position:"absolute",cursor:"pointer",fontFamily:"arial,sans-serif",fontSize:"13px",textAlign:"center",boxShadow:"0px 0px 3px rgba(0, 0, 0, 0.3)",MozBoxShadow:"0px 0px 3px rgba(0, 0, 0, 0.3)",WebkitBoxShadow:"0px 0px 3px rgba(0, 0, 0, 0.3)"}),this._container=n;var r=this._map.getContainer();r.appendChild(n);var i={visible:!1};e.imgPath&&(i.imgPath=[e.imgPath]),e.tileBaseUrl&&(i.tileBaseUrls=[e.tileBaseUrl]),this._pano=new sa(r,i),this._pano.addCloseButton((function(){t.isMapEnableWheelZoom&&t._map.enableScrollWheelZoom()}));var a=this._scout=w.create("div");m(a.style,{position:"absolute",width:"24px",height:"41px",cursor:"pointer",backgroundImage:'url("'.concat(o,'st-scout.png")'),backgroundRepeat:"no-repeat",backgroundPosition:"-24px 0",overflow:"hidden",display:"none",zIndex:11}),r.appendChild(a);var s=this._infoWindow=w.create("div");m(s.style,{position:"absolute",width:"112px",height:"119px",backgroundImage:'url("'.concat(o,'st-infowindow.gif")'),backgroundRepeat:"no-repeat",backgroundPosition:"0 0",display:"none",cursor:"pointer",zIndex:12});var u=this._thumb=w.create("img");s.appendChild(u),u.src=o+"st-noresult.png",m(u.style,{width:"100px",height:"75px",left:"6px",top:"6px",position:"absolute"});var h=this._stDescription=w.create("div");m(h.style,{position:"absolute",top:"85px",fontFamily:"arial,sans-serif",fontSize:"13px",paddingLeft:"6px"}),s.appendChild(h),r.appendChild(s)},_updateView:function(){var t=this._container.style;this._isOn||this._isOver?(t.backgroundPosition="-49px 0",t.color="#fff"):(t.backgroundPosition="0 0",t.color="#565656")},_bind:function(){var n=this;this._pano.on("dataload",(function(t){var r=t.data;r?(n._currentSvId=r.panoId,e.tileBaseUrl?n._thumb.src="".concat(e.tileBaseUrl,"?&sid=").concat(r.panoId,"&pos=0_0&z=0"):n._thumb.src="//apisv0.bdimg.com/?qt=pdata&sid=".concat(r.panoId,"&pos=0_0&z=0&from=H5&").concat($("/")),n._stDescription.innerHTML=r.roadName):(n._currentSvId=null,n._thumb.src=o+"st-noresult.png",n._stDescription.innerHTML="")}));var r=this;v.isPc&&(this._container.addEventListener("mouseover",(function(){r._isOver=!0,r._updateView()})),this._container.addEventListener("mouseout",(function(){r._isOver=!1,r._updateView()}))),this._container.addEventListener("click",(function(){r._isOn?r._close():r._open()})),this._map.getContainer().addEventListener("mousemove",(function(e){if(r._isOn){var n=(e=window.event||e).pageX||e.clientX,i=e.pageY||e.clientY,a=function(t){for(var e={left:0,top:0};t&&t.offsetParent;)e.left+=t.offsetLeft,e.top+=t.offsetTop,t=t.offsetParent;return e}(r._map.container),s=new qo(n-a.left,i-a.top),u=r._map.pixelToPoint(s);if(""!==r._scout.style.display&&v.isPc&&(r._scout.style.display="",r._infoWindow.style.display=""),r._scout.style.left=s.x-12+"px",r._scout.style.top=s.y-41-2+"px",r._prePixel=r._curPixel,r._curPixel=s,r._prePixel){var h=s.x-r._prePixel.x;h>0?r._scout.style.backgroundPosition="-48px 0":h<0&&(r._scout.style.backgroundPosition="0 0")}r._curPixel.y<170?r._infoStatus=2:r._infoStatus=1,r._curPixel.x<66&&(r._infoStatus=3),r._curPixel.x>r._map.getSize().width-56-10&&(r._infoStatus=4);var c=1===r._infoStatus||2===r._infoStatus?112:126,l=1===r._infoStatus||2===r._infoStatus?119:105;1!==r._infoStatus&&2!==r._infoStatus||(r._infoWindow.style.left=r._curPixel.x-Math.round(c/2)+"px",1===r._infoStatus?(r._infoWindow.style.top=r._curPixel.y-l-42+"px",r._infoWindow.style.backgroundPosition="0 0",r._thumb.style.top="6px",r._thumb.style.bottom="",r._stDescription.style.top="85px",r._stDescription.style.bottom=""):(r._infoWindow.style.top=r._curPixel.y+2+"px",r._infoWindow.style.backgroundPosition="-112px 0",r._thumb.style.top="",r._thumb.style.bottom="6px",r._stDescription.style.top="",r._stDescription.style.bottom="85px"),r._infoWindow.style.width="112px",r._infoWindow.style.height="119px",r._thumb.style.left="6px",r._stDescription.style.left="0"),3!==r._infoStatus&&4!==r._infoStatus||(r._infoWindow.style.top=r._curPixel.y-Math.round(l/2)-20+"px",3===r._infoStatus?(r._infoWindow.style.left=r._curPixel.x+12+"px",r._infoWindow.style.backgroundPosition="0 -119px",r._thumb.style.left="20px",r._stDescription.style.left="14px"):(r._infoWindow.style.left=r._curPixel.x-12-c+"px",r._infoWindow.style.backgroundPosition="-126px -119px",r._thumb.style.left="6px",r._stDescription.style.left="0"),r._infoWindow.style.width="126px",r._infoWindow.style.height="105px"),r._infoWindow.style.backgroundImage='url("'.concat(o,'st-infowindow.gif")'),r._timerId&&(clearTimeout(r._timerId),r._timerId=null),r._timerId=setTimeout((function(){r._currentPoint=u,r._scout.style.backgroundPosition="-24px 0";var e=r._map.lnglatToMercator(u.lng,u.lat);r._pano.setPosition(new t.Point(e[0],e[1]))}),200)}})),this._map.addEventListener("click",(function(t){r._isOn&&v.isMobile&&(r._pano.setPosition(t.point),r._pano.show(),r._close()),r._isOn&&r._currentSvId&&(r._pano.setId(r._currentSvId),r._pano.show(),r._map.config.enableWheelZoom&&(r._map.disableScrollWheelZoom(),r.isMapEnableWheelZoom=!0),r._close())}))},_open:function(){this._isOn||(this._isOn=!0,this._map.addTileLayer(this._panoCoverageLayer),v.isPc&&(this._preDefaultCursor=this._map.getDefaultCursor(),this._preDraggingCursor=this._map.getDraggingCursor(),this._map.setDefaultCursor("pointer"),this._map.setDraggingCursor("pointer"))),this._updateView()},_close:function(){this._isOn&&(this._map.removeTileLayer(this._panoCoverageLayer),v.isPc&&(this._scout.style.display="none",this._infoWindow.style.display="none",this._map.setDefaultCursor(this._preDefaultCursor),this._map.setDraggingCursor(this._preDraggingCursor)),this._isOn=!1),this._updateView()}}),new a(t.Control)},t.getStreetViewCoverageLayer=function(t){var e=new t.TileLayer({transparentPng:!0,dataType:1,cacheSize:32});return e.zIndex=110,e.getTilesUrl=window.PANORAMA_URL?function(t,e){var n=window.PANORAMA_URL+"/tile",r=t.x,i=t.y;return window.BMAPGL_84&&(i=Math.pow(2,e)-i-1),"".concat(n,"?customid=panorama&x=").concat(r,"&y=").concat(i,"&z=").concat(e,"&type=WGS84")}:function(t,e){var n=["//apisv0.bdimg.com/","//apisv1.bdimg.com/"],r=(Math.abs(t.x)+Math.abs(t.y))%n.length;return"".concat(n[r],"?udt=").concat("20150114","&qt=tile&styles=").concat("pl","&x=").concat(t.x,"&y=").concat(t.y,"&z=").concat(e).replace(/-(\d+)/gi,"M$1")+"&"+$("/",{isCounter:!1})},e},t.init=function(t,e){return new sa(t,e)},Object.defineProperty(t,"__esModule",{value:!0})})(Pano={});
window.BMapGL=window.BMapGL||{};(function(bp,e2){var ey=ey||{version:"20150702",emptyFn:function(){}};(function(){ey._log=[];var i=0;var T={};ey.BaseClass=function(jj){T[(this.hashCode=(jj||ey.BaseClass.guid()))]=this};ey.BaseClass.guid=function(){return"mz_"+(i++).toString(36)};ey.BaseClass.create=function(){var jj=new ey.BaseClass();jj.decontrol();return jj};var e=ey.instance=ey.I=function(jj){return T[jj]};ey.BaseClass.prototype.dispose=function(){if(this.hashCode){delete T[this.hashCode]}for(var jj in this){if(typeof this[jj]!="function"){delete this[jj]}}};ey.BaseClass.prototype.getHashCode=function(){if(!this.hashCode){T[(this.hashCode=ey.BaseClass.guid())]=this}return this.hashCode};ey.BaseClass.prototype.decontrol=function(){delete T[this.hashCode]};ey.BaseClass.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"};ey.BaseClass.prototype._wlog=function(jk,jl){var jj=ey._log;if(jj.length>100){jj.reverse().length=50;jj.reverse()}jj[jj.length]="["+jk+"]["+(this._className||"Object")+" "+this.hashCode+"] "+jl}})();Function.prototype.inherits=function(jj,T){var e,jk,jm=this.prototype,jl=function(){};jl.prototype=jj.prototype;jk=this.prototype=new jl();if(typeof(T)=="string"){jk._className=T}for(e in jm){jk[e]=jm[e]}this.prototype.constructor=jm.constructor;jm=jl=null;return jk};ey.BaseEvent=function(e,i){this.type=e;this.returnValue=true;this.target=i||null;this.currentTarget=this.srcElement=null;this.cancelBubble=false;this.domEvent=null};ey.BaseClass.prototype.on=ey.BaseClass.prototype.addEventListener=function(T,i){if(typeof i!=="function"){return this._wlog("error","addEventListener:"+i+" is not a function")}if(!this._listeners){this._listeners={}}var e=this._listeners;if(T.indexOf("on")!==0){T="on"+T}if(typeof e[T]!=="object"){e[T]={}}var jj=i.hashCode||ey.BaseClass.guid();i.hashCode=jj;if(e[T][jj]){this._wlog("warning","repeat key:"+jj)}e[T][jj]=i};ey.BaseClass.prototype.off=ey.BaseClass.prototype.removeEventListener=function(T,i){if(typeof i=="function"){i=i.hashCode}else{if(typeof i!=="string"&&typeof i!=="undefined"){return}}if(!this._listeners){this._listeners={}}if(T.indexOf("on")!=0){T="on"+T}var e=this._listeners;if(!e[T]){return}if(i===undefined){e[T]={};return}if(e[T][i]){delete e[T][i]}};ey.BaseClass.prototype.fire=ey.BaseClass.prototype.dispatchEvent=function(jj){if(!this._listeners){this._listeners={}}var T,e=this._listeners,jk=jj.type;jj.target=jj.srcElement=jj.target||jj.srcElement||this;jj.currentTarget=this;if(typeof this[jk]=="function"){this[jk](jj)}if(typeof e[jk]=="object"){for(T in e[jk]){if(typeof e[jk][T]=="function"){e[jk][T].call(this,jj)}}}return jj.returnValue};ey.BaseEvent.prototype.inherit=function(T){var i=this;this.domEvent=T=window.event||T;i.clientX=T.clientX||T.pageX;i.clientY=T.clientY||T.pageY;i.offsetX=T.offsetX||T.layerX;i.offsetY=T.offsetY||T.layerY;i.screenX=T.screenX;i.screenY=T.screenY;i.ctrlKey=T.ctrlKey||T.metaKey;i.shiftKey=T.shiftKey;i.altKey=T.altKey;return i};ey.Browser=(function(){var T=navigator.userAgent;var jk=0;var e=0;var jl=0;var i=0;var jp=0;var jn=0;var jo=0;var jm=0;var jj=0;var jq=0;if(typeof window.opera==="object"&&/Opera(\s|\/)(\d+(\.\d+)?)/.test(T)){jl=parseFloat(RegExp.$2)}else{if(/OPR(\/(\d+)(\..?)?)/.test(T)){jl=parseInt(RegExp.$2,10)}else{if(/Edge\/((\d+)\.\d+)/.test(T)){jk=parseInt(RegExp.$2,10)}else{if(/MSIE (\d+(\.\d+)?)/.test(T)){e=parseFloat(RegExp.$1)}else{if(T.indexOf("Trident")>-1&&/rv:(\d+(\.\d+)?)/.test(T)){e=parseInt(RegExp.$1,10)}else{if(/Firefox(\s|\/)(\d+(\.\d+)?)/.test(T)){jp=parseFloat(RegExp.$2)}else{if(navigator.vendor==="Netscape"&&/Netscape(\s|\/)(\d+(\.\d+)?)/.test(T)){jo=parseFloat(RegExp.$2)}else{if(T.indexOf("Safari")>-1&&/Version\/(\d+(\.\d+)?)/.test(T)){i=parseFloat(RegExp.$1)}}}}}}}}if(T.indexOf("Trident")>-1&&/Trident\/(\d+(\.\d+)?)/.test(T)){jm=parseInt(RegExp.$1,10)}else{if(!e&&!jk&&T.indexOf("Gecko")>-1&&T.indexOf("KHTML")===-1&&/rv\:(\d+(\.\d+)?)/.test(T)){jj=parseFloat(RegExp.$1)}else{if(!jk&&/chrome\/(\d+(\.\d+)?)/i.test(T)){jn=parseFloat(RegExp.$1)}else{if(!jk&&/AppleWebKit\/(\d+(\.\d+)?)/.test(T)){jq=parseInt(RegExp.$1,10)}}}}var jr={edge:jk,ie:e,firefox:jp,netscape:jo,opera:jl,safari:i,chrome:jn,gecko:jj,trident:jm,webkit:jq};return jr})();window.FeBrowser=ey.Browser;ey.Dom={};ey.Dom.createDom=function(i,e){if(ey.isIE&&e&&e.name){i="<"+i+' name="'+ey.String.escapeHTML(e.name)+'">'}var T=document.createElement(i);if(e){ey.Dom.setProperties(T,e)}return T};ey.Dom.getOffset=function(jj){var jm=ey.Dom.getOwnerDocument(jj);var jl=ey.isGecko>0&&jm.getBoxObjectFor&&ey.Dom.getStyle(jj,"position")=="absolute"&&(jj.style.top===""||jj.style.left==="");var jn={left:0,top:0};var i=(ey.isIE&&!ey.isStrict)?jm.body:jm.documentElement;if(jj==i){return jn}var T=null;var jk;if(jj.getBoundingClientRect){jk=jj.getBoundingClientRect();jn.left=jk.left+Math.max(jm.documentElement.scrollLeft,jm.body.scrollLeft);jn.top=jk.top+Math.max(jm.documentElement.scrollTop,jm.body.scrollTop);jn.left-=jm.documentElement.clientLeft;jn.top-=jm.documentElement.clientTop;if(ey.isIE&&!ey.isStrict){jn.left-=2;jn.top-=2}}else{if(jm.getBoxObjectFor&&!jl){jk=jm.getBoxObjectFor(jj);var e=jm.getBoxObjectFor(i);jn.left=jk.screenX-e.screenX;jn.top=jk.screenY-e.screenY}else{T=jj;do{jn.left+=T.offsetLeft;jn.top+=T.offsetTop;if(ey.isWebkit>0&&ey.Dom.getStyle(T,"position")=="fixed"){jn.left+=jm.body.scrollLeft;jn.top+=jm.body.scrollTop;break}T=T.offsetParent}while(T&&T!=jj);if(ey.isOpera>0||(ey.isWebkit>0&&ey.Dom.getStyle(jj,"position")=="absolute")){jn.top-=jm.body.offsetTop}T=jj.offsetParent;while(T&&T!=jm.body){jn.left-=T.scrollLeft;if(!ey.isOpera||T.tagName!="TR"){jn.top-=T.scrollTop}T=T.offsetParent}}}return jn};ey.Dom.getOwnerDocument=function(e){return e.nodeType==9?e:e.ownerDocument||e.document};ey.Dom.setProperties=function(i,e){ey.each(e,function(jj,T){ey.Dom._setProperty(i,T,jj)})};ey.Dom._setProperty=function(i,e,T){if(e=="style"){i.style.cssText=T}else{if(e=="class"){i.className=T}else{if(e=="for"){i.htmlFor=T}else{if(e in ey.Dom._DIRECT_ATTRIBUTE_MAP){i.setAttribute(ey.Dom._DIRECT_ATTRIBUTE_MAP[e],T)}else{i[e]=T}}}}};ey.Dom._DIRECT_ATTRIBUTE_MAP={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",height:"height",width:"width",usemap:"useMap",frameborder:"frameBorder"};ey.G=function(){for(var T=[],jj=arguments.length-1;jj>-1;jj--){var jk=arguments[jj];T[jj]=null;if(typeof jk=="object"&&jk&&jk.dom){T[jj]=jk.dom}else{if((typeof jk=="object"&&jk&&jk.tagName)||jk==window||jk==document){T[jj]=jk}else{if(typeof jk=="string"&&(jk=document.getElementById(jk))){T[jj]=jk}}}}return T.length<2?T[0]:T};ey.ac=function(e,i){if(!(e=this.G(e))){return}i=this.trim(i);if(!new RegExp("(^| )"+i.replace(/(\W)/g,"\\$1")+"( |$)").test(e.className)){e.className=e.className.split(/\s+/).concat(i).join(" ")}};ey.addClassName=ey.ac;ey.each=function(jl,e){if(typeof e!="function"){return jl}if(jl){if(jl.length===undefined){for(var T in jl){e.call(jl[T],jl[T],T)}}else{for(var jj=0,jk=jl.length;jj<jk;jj++){e.call(jl[jj],jl[jj],jj)}}}return jl};ey.extend=function(jl,jj){if(jl&&jj&&typeof(jj)=="object"){for(var jk in jj){jl[jk]=jj[jk]}var T=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];for(var e=0,i;e<T.length;e++){i=T[e];if(Object.prototype.hasOwnProperty.call(jj,i)){jl[i]=jj[i]}}}return jl};ey.hide=function(){ey.each(arguments,function(e){if(e=ey.G(e)){e.style.display="none"}})};ey.inherit=function(jn,jj,T){var jm=jn.prototype;var jl=function(){};jl.prototype=jj.prototype;var jk=jn.prototype=new jl();if(typeof T=="string"){jk._className=T}for(var e in jm){jk[e]=jm[e]}jn.prototype.constructor=jm.constructor;jm=null;return jk};ey.isIE=0;(function(){if(navigator.userAgent.indexOf("MSIE")>0&&!window.opera){/MSIE (\d+(\.\d+)?)/.test(navigator.userAgent);ey.isIE=parseFloat(RegExp.$1)}})();ey.rc=function(e,i){if(!(e=this.G(e))){return}i=this.trim(i);var T=e.className.replace(new RegExp("(^| +)"+i.replace(/(\W)/g,"\\$1")+"( +|$)","g"),"$2");if(e.className!=T){e.className=T}};ey.removeClassName=ey.rc;ey.show=function(){this.each(arguments,function(e){if(e=ey.G(e)){e.style.display=""}})};ey.trim=function(e){return e.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")};ey.getElementsByClassName=function(e,i){if(e.getElementsByClassName){return e.getElementsByClassName(i)}else{return(function T(jq,jo){if(jo==null){jo=document}var jn=[],jm=jo.getElementsByTagName("*"),jj=jm.length,jp=new RegExp("(^|\\s)"+jq+"(\\s|$)"),jl,jk;for(jl=0,jk=0;jl<jj;jl++){if(jp.test(jm[jl].className)){jn[jk]=jm[jl];jk++}}return jn})(i,e)}};ey.toggleClass=function(e,i){if(ey.hasClass(e,i)){ey.removeClassName(e,i)}else{ey.addClassName(e,i)}};ey.hasClass=function(jj,T){if(!jj||!jj.className||typeof jj.className!="string"){return false}var i=-1;try{i=jj.className==T||jj.className.search(new RegExp("(\\s|^)"+T+"(\\s|$)"))}catch(jk){return false}return i>-1};ey.insertHTML=function(jj,e,T){jj=ey.G(jj);if(jj===null){return jj}var i,jk;if(jj.insertAdjacentHTML){jj.insertAdjacentHTML(e,T)}else{i=jj.ownerDocument.createRange();e=e.toUpperCase();if(e=="AFTERBEGIN"||e=="BEFOREEND"){i.selectNodeContents(jj);i.collapse(e=="AFTERBEGIN")}else{jk=e=="BEFOREBEGIN";i[jk?"setStartBefore":"setEndAfter"](jj);i.collapse(jk)}i.insertNode(i.createContextualFragment(T))}return jj};if(typeof HTMLElement!="undefined"&&HTMLElement.prototype.__lookupGetter__&&!HTMLElement.prototype.__lookupGetter__("children")&&!window.opera){try{HTMLElement.prototype.__defineGetter__("children",function(){for(var T=[],jj=0,jl,jk=0,e=this.childNodes.length;jk<e;jk++){jl=this.childNodes[jk];if(jl.nodeType==1){T[jj++]=jl;if(jl.name){if(!T[jl.name]){T[jl.name]=[]}T[jl.name][T[jl.name].length]=jl}if(jl.id){T[jl.id]=jl}}}return T})}catch(iC){}}if(typeof(HTMLElement)!="undefined"&&!window.opera&&HTMLElement.prototype&&!HTMLElement.prototype.insertAdjacentHTML){HTMLElement.prototype.insertAdjacentHTML=function(i,T){var jj=this.ownerDocument.createRange();jj.setStartBefore(this);jj=jj.createContextualFragment(T);switch(i){case"beforeBegin":this.parentNode.insertBefore(jj,this);break;case"afterBegin":this.insertBefore(jj,this.firstChild);break;case"beforeEnd":this.appendChild(jj);break;case"afterEnd":if(!this.nextSibling){this.parentNode.appendChild(jj)}else{this.parentNode.insertBefore(jj,this.nextSibling)}break}}}if(typeof HTMLElement!="undefined"&&!window.opera){HTMLElement.prototype.contains=function(e){if(!e){return false}if(e==this){return true}while(e=e.parentNode){if(e==this){return true}}return false}}if(!ey.Browser.ie&&typeof Event!="undefined"&&!window.opera){Event.prototype.__defineSetter__("returnValue",function(e){if(!e){this.preventDefault()}return e});Event.prototype.__defineSetter__("cancelBubble",function(e){if(e){this.stopPropagation()}return e})}ey.each=function(jk,jj){if(bH(jj)){for(var T=0,e=jk.length;T<e;T++){if(jj.call(jk,jk[T],T)===false){break}}}return jk};ey.Platform={x11:0,macintosh:0,windows:0,android:0,iphone:0,ipad:0};for(var iA in ey.Platform){if(ey.Platform.hasOwnProperty(iA)){ey.Platform[iA]=new RegExp(iA,"i").test(window.navigator.userAgent)?1:0}}if(typeof(ey.Dom)==="undefined"){ey.Dom={}}ey.Dom.getComputedStyle=function(i,e){var jj=i.nodeType==9?i:i.ownerDocument||i.document,T;if(jj.defaultView&&jj.defaultView.getComputedStyle){T=jj.defaultView.getComputedStyle(i,null);if(T){return T[e]||T.getPropertyValue(e)}}else{if(i.currentStyle){return i.currentStyle[e]||""}}return""};var ff=ey.BaseEvent;var cN=ey.BaseClass;cN.prototype.toString=function(){return this._className||""};ey.on=function(T,i,e){if(!(T=ey.G(T))){return T}i=i.replace(/^on/,"");if(T.addEventListener){T.addEventListener(i,e,false)}else{if(T.attachEvent){T.attachEvent("on"+i,e)}}return T};ey.un=function(T,i,e){if(!(T=ey.G(T))){return T}i=i.replace(/^on/,"");if(T.removeEventListener){T.removeEventListener(i,e,false)}else{if(T.detachEvent){T.detachEvent("on"+i,e)}}return T};ey.hc=function(jj,T){if(!jj||!jj.className||typeof jj.className!="string"){return false}var i=-1;try{i=jj.className==T||jj.className.search(new RegExp("(\\s|^)"+T+"(\\s|$)"))}catch(jk){return false}return i>-1};ey.isEmptyObject=function(T){if(Object.prototype.toString.call(T)==="[object Object]"){for(var e in T){return false}return true}else{return false}};var bG=window.location.protocol==="http:"?"http:":"https:";var d6={fontFamily:'Arial,Helvetica,"PingFang SC","Hiragino Sans GB",STHeiti,sans-serif',mapStyleNameIdPair:{"default":0,"grayed-out":1},mapHost:bG+"//map.baidu.com",apiHost:bG+"//api.map.baidu.com",apiIMG:bG+"//api.map.baidu.com/images",staticHost:bG+"//webmap0.bdimg.com",imgPath:bG+"//webmap0.bdimg.com/image/api/",tileDomain:[bG+"//maponline0.bdimg.com",bG+"//maponline1.bdimg.com",bG+"//maponline2.bdimg.com",bG+"//maponline3.bdimg.com"],panoTilePath:"//apisv1.bdimg.com/",optDomain:"http://10.120.25.45:8017",rasterTilePath:"/tile/",vectorTilePath:"/pvd/",originTilePath:[bG+"//pcor.baidu.com"],stylePath:"//maponline0.bdimg.com/sty/",getIconSetPath:function(e){var i="map_icons2x/";if(typeof e==="string"&&this.mapStyleNameIdPair[e]>0){i="map_icons2x_"+(this.mapStyleNameIdPair[e]-1)+"/"}return bG+this.stylePath+i},getMapStyleFiles:function(T){var jk=true;if(typeof T==="string"&&T!=="default"){jk=false}var jl=jk?"":"_"+(this.mapStyleNameIdPair[T]-1);var i=bq();var jj="udt="+i.udt+"&v="+i.ver;var e=bG+this.stylePath;return[e+"icons_2x"+jl+".js?"+jj,e+"fs"+jl+".js?"+jj,e+"indoor_fs.js?"+jj]},tvc:{ditu:{normal:{version:"088",updateDate:"20210726"},satellite:{version:"009",updateDate:"20210726"},normalTraffic:{version:"081",updateDate:"20210726"},satelliteTraffic:{version:"083",updateDate:"20210726"},mapJS:{version:"104",updateDate:"20210726"},satelliteStreet:{version:"083",updateDate:"20210726"},panoClick:{version:"1033",updateDate:"20180108"},panoUdt:{version:"20180108",updateDate:"20180108"},panoSwfAPI:{version:"20150123",updateDate:"20150123"},panoSwfPlace:{version:"20141112",updateDate:"20141112"},earthVector:{version:"001",updateDate:"20210726"}}},msv:{mapstyle:{updateDate:"20210726",version:"001"}}};d6.imgResources={blankGIF:d6.staticHost+"/res/litemapapi/v1d1/images/blank.gif?20170501",markerPng:d6.staticHost+"/res/litemapapi/v1d1/images/marker.png?20170501",locPng:d6.staticHost+"/res/litemapapi/v1d1/images/loc.png?20180918",locNewPng:d6.staticHost+"/res/litemapapi/v1d1/images/loc_new.png?20190314",zoomPng:d6.staticHost+"/res/litemapapi/v1d1/images/zoombtn.png?20180918",mapLogoPng:d6.staticHost+"/res/litemapapi/v1d1/images/logo-2x.png?20190226"};var w=d6;var it="ruler.cur";if(ey.Browser.ie||ey.Browser.edge){ey.extend(w,{distCursor:"url("+w.imgPath+it+"),crosshair",defaultCursor:"url("+w.imgPath+"openhand.cur),default",draggingCursor:"url("+w.imgPath+"closedhand.cur),move"})}else{if(ey.Browser.firefox){ey.extend(w,{distCursor:"url("+w.imgPath+it+"),crosshair",defaultCursor:"-moz-grab",draggingCursor:"-moz-grabbing"})}else{if(ey.Browser.chrome||ey.Browser.safari){ey.extend(w,{distCursor:"url("+w.imgPath+it+") 2 6,crosshair",defaultCursor:"url("+w.imgPath+"openhand.cur) 8 8,default",draggingCursor:"url("+w.imgPath+"closedhand.cur) 8 8,move"});if(ey.Platform.macintosh){w.defaultCursor="-webkit-grab";w.draggingCursor="-webkit-grabbing"}}else{ey.extend(w,{distCursor:"url("+w.imgPath+it+"),crosshair",defaultCursor:"url("+w.imgPath+"openhand.cur),default",draggingCursor:"url("+w.imgPath+"closedhand.cur),move"})}}}bp=bp||{};bp.version="gl";bp._register=[];bp.register=function(e){this._register[this._register.length]=e};bp.guid=1;bp.getGUID=function(e){return(e||"")+bp.guid++};var eo=window.BMAP_AUTHENTIC_KEY||"";function M(e,i,jj){var T=new Date();T.setTime(T.getTime()+jj*24*60*60*1000);document.cookie=e+"="+escape(i)+";expires="+T.toGMTString()}function aV(e,i){if(navigator.cookieEnabled){return M(e,i,30)}if(localStorage){return localStorage.setItem(e,i)}if(sessionStorage){return sessionStorage.setItem(e,i)}}bp.getSeckeyCid=function(){var i=+new Date();var e=bG+"//dlswbr.baidu.com/heicha/mw/abclite-2063-s.js?_t="+i;gf.load(e,h0)};function h0(){if(window.___abvk){aV("SECKEY_ABVK",window.___abvk)}}window.__abbaidu_2063_cb=function(i){var e=JSON.parse(i);aV("BMAP_SECKEY",e.data)};bp.bmapVerifyCbk=function(jk){if(jk&&jk.error!==0){bp=null;BMapGL=null;var jl="百度未授权使用地图API，可能是因为您提供的密钥不是有效的百度地图开放平台密钥，或此密钥未对本应用的百度地图JavaScriptAPI授权。您可以访问如下网址了解如何获取有效的密钥：https://lbs.baidu.com/apiconsole/key#。";switch(jk.error){case 101:jl="您所使用的密钥ak有问题，不支持jsapi服务，可以访问该网址了解如何获取有效密钥：http://lbsyun.baidu.com/apiconsole/key#。";break;case 102:jl="MCODE参数不存在，mobile类型MCODE参数必需，详情查看：http://lbsyun.baidu.com/apiconsole/key#。";break;case 200:jl="APP不存在，AK有误请检查再重试，详情查看：http://lbsyun.baidu.com/apiconsole/key#。";break;case 201:jl="APP被您禁用啦，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。";break;case 202:jl="APP被管理员删除啦，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。";break;case 203:jl="APP类型错误，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。";break;case 210:jl="APP IP校验失败，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。";break;case 220:jl="APP Referer校验失败。请检查该ak设置的白名单与访问所有的域名是否一致。详情查看：http://lbsyun.baidu.com/apiconsole/key#";break;case 230:jl="APP Mcode码校验失败，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。";break;case 240:jl="APP服务被禁用了，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。";break;case 250:jl="该用户不存在... 请登录 https://lbs.baidu.com 的控制台，注册成为开发者申请ak吧。";break;case 251:jl="该用户被自己删除啦，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情。";break;case 252:jl="该用户被管理员删除啦，可以访问 http://lbsyun.baidu.com/apiconsole/key# 了解如何获取有效密钥，或请联系我们了解详情。";break;case 260:jl="您所使用的密钥AK不包含该服务呢，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看服务选择情况，或请联系我们了解详情。";break;case 261:jl="您所使用的密钥AK的该服务被禁用啦，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看服务选择情况，或请联系我们了解详情。";break;case 401:jl="您所使用的AK并发超限了，请登录 http://lbsyun.baidu.com/cashier/quota#/home 了解详情。";break;case 302:jl="您所使用的AK天配额超限了，请登录 http://lbsyun.baidu.com/cashier/quota#/home 了解详情。";break}alert(jl);var T=document.getElementsByClassName("bmap-container");if(T){for(var jj=0;jj<T.length;jj++){var e=T[jj];if(e&&e.firstChild&&e.firstChild.id==="platform"){e.innerText=""}}}}};bp.frequencyCbk=function(e){if(e){window.QTFrequency=e}};bp.verify=function(){var e=w.apiHost+"/?qt=verify&v=gl&type=webgl&ak="+eo+"&callback="+e2+".bmapVerifyCbk";gf.load(e)};bp.frequency=function(){};bp.apiLoad=bp.apiLoad||function(){};function hs(i,e){this._size=i;this._cache=[];this._totalGetTimes=0;this._totalHitTimes=0;this._options={clearCallback:null,removeOldCallback:null};e=e||{};for(var T in e){if(e.hasOwnProperty(T)){this._options[T]=e[T]}}}hs.prototype.setData=function(T,jj){var e=this._cache;var i=this._size;if(i===0){return}if(e.length>i){this._removeOld()}if(!e[T]){e.push(jj)}e[T]=jj;jj._key_=T};hs.prototype.getHitRate=function(){return Math.round(this._totalHitTimes/this._totalGetTimes*1000)/1000};hs.prototype.getData=function(i){var e=this._cache[i];if(e){this._totalHitTimes++}this._totalGetTimes++;return e};hs.prototype.removeData=function(jk){if(this._options.clearCallback){this._options.clearCallback(this._cache[jk])}var T=this._cache;var jl=T[jk];for(var jj=0,e=T.length;jj<e;jj++){if(T[jj]===jl){T.splice(jj,1);break}}delete T[jk]};hs.prototype._removeOld=function(){var e=this._cache;var jk=Math.round(this._size*0.6);for(var jj=0;jj<jk;jj++){var T=e[jj]._key_;if(this._options.clearCallback){this._options.clearCallback(e[T])}delete e[T]}e.splice(0,jk);if(this._options.removeOldCallback){this._options.removeOldCallback()}};hs.prototype.clear=function(){var T=this._cache;for(var jk=0,e=T.length;jk<e;jk++){var jj=T[jk]._key_;if(this._options.clearCallback){this._options.clearCallback(T[jj])}delete T[jj]}this._cache=T=[]};hs.prototype.forEach=function(jj){var T=this._cache;for(var jl=0,e=T.length;jl<e;jl++){var jk=T[jl]._key_;jj(T[jk])}};hs.prototype.getBatch=function(jk){var e=[];for(var jj=0,T=jk.length;jj<T;jj++){if(this.getData(jk[jj])){e[e.length]=this.getData(jk[jj])}}return e};hs.prototype.clearExcept=function(jl){var T=this._cache;for(var e=T.length,jk=e-1;jk>=0;jk--){var jj=this._cache[jk]._key_;if(!jl[jj]){T.splice(jk,1);if(this._options.clearCallback){this._options.clearCallback(T[jj])}delete T[jj]}}};hs.prototype.getDataCount=function(){return this._cache.length};function h5(){}ey.extend(h5.prototype,{centerAndZoomIn:function(jo,T,jp){var jm=this;if(!jo&&!T){return}jo=jo||this.centerPoint;T=T||this.zoomLevel;T=this._getProperZoom(T).zoom;if(this.mapType===BMAP_EARTH_MAP){if(!this._earth){this.mapType=BMAPGL_NORMAL_MAP;this.temp.originMapType=BMAP_EARTH_MAP;function jn(){jm._earth=new bp.Earth(jm,{showRealSunlight:jm.config.showRealSunlight,showMilkyway:jm.config.showMilkyway,earthBackground:jm.config.earthBackground});jm._proxyEarthEvents();jm._changeEarthMapType(BMAP_EARTH_MAP);ey.extend(jm,bp.EarthView.prototype);if(!jm._navigationCtrl&&jm.config.showControls){jm._navigationCtrl=new bp.NavigationControl3D(jm)}delete jm.temp.originMapType}gs.load("earth",function(){if(bp["FeatureStyle"+jm.config.style]){jn()}else{jm.loadMapStyleFiles(function(){jn()})}})}}this.lastLevel=this.zoomLevel||T;this.zoomLevel=T;var jk=new ff("onload");jk.point=jo;jk.zoom=T;this.centerPoint=this.restrictCenter(new cg(jo.lng,jo.lat));if(this.centerPoint.zoom){this.zoomLevel=this.centerPoint.zoom}this.defaultZoomLevel=this.defaultZoomLevel||this.zoomLevel;this.defaultCenter=this.defaultCenter||this.centerPoint;if(!this.loaded&&!(this.temp.originMapType===BMAP_EARTH_MAP)){var i=this.config.defaultMaxBounds;var jl=new h(i,"baidu",this.mapType);var jj=new gS({mapType:this.mapType,copyright:jl,customLayer:false,baseLayer:true,tileTypeName:"web"});jj._isInnerLayer=true;this.addTileLayer(jj);if(this.mapType===BMAP_SATELLITE_MAP&&this._isHybridShow===true){this._addHybirdMap()}}this.dispatchEvent(jk);this.loaded=true;jp=jp||{};jp.callback&&jp.callback()},_setPlatformPosition:function(jp,jo,js){js=js||{};if(jp===0&&jo===0&&!js.point){return}if(isNaN(js.initMapOffsetX)){js.initMapOffsetX=this.offsetX}if(isNaN(js.initMapOffsetY)){js.initMapOffsetY=this.offsetY}var jq=jp+js.initMapOffsetX;var jn=jo+js.initMapOffsetY;if(js.point){var i=this.restrictCenter(js.point);if(!i.equals(this.centerPoint)){this.centerPoint=i.clone();this.fire(new ff("oncenter_changed"))}}else{var jj=this.offsetX-jq;var e=this.offsetY-jn;var T=this.getZoomUnits();var jm=this.centerPoint.lng;var jl=this.centerPoint.lat;var jk=new cg(jm,jl);this.centerPoint=this.restrictCenter(new cg(jk.lng+jj*T,jk.lat-e*T),T);this.fire(new ff("oncenter_changed"));if(this.zoomLevel<10){jq=this.offsetX-(this.centerPoint.lng-jk.lng)/T;jn=this.offsetY+(this.centerPoint.lat-jk.lat)/T}}this.offsetX=jq;this.offsetY=jn;var jr=this.platform.style;jr.left=jq+"px";jr.top=jn+"px";this.maskLayer.style.left=-jq+"px";this.maskLayer.style.top=-jn+"px";if(js.dispatchEvent!==false){this.dispatchEvent(new ff("onmoving"))}},zoomTo:function(e,jm,jq){jq=jq||{};jq.zoomCenter=jm;if(jq.noAnimation!==true){this.deepZoomTo(e,jq);return}if(typeof e!=="number"){return}var jk=dU[this.mapType];if(!jk){return}var T=e;e=this._getProperZoom(e).zoom;if(e===this.zoomLevel){var jn=new ff("onzoomexceeded");jn.targetZoom=T;this.dispatchEvent(jn);jq.callback&&jq.callback();return}this.lastLevel=this.zoomLevel;if(jm){this.temp._cPoint=jm;this.temp._cPixel=this.pointToPixelIn(jm)}else{if(this.getInfoWindow()){var jp=this.getInfoWindow().getPoint();this.temp._cPixel=this.pointToPixelIn(jp);this.temp._cPoint=jp}}if(this.config.zoomCenter){jm=this.config.zoomCenter;this.temp._cPoint=jm;this.temp._cPixel=this.pointToPixelIn(jm)}if(jm||this.temp.infoWin&&this.temp.infoWin.isOpen()){var i=this.temp._cPoint;var jo=this.temp._cPixel;var jj=this.getZoomUnits(e);var jl=new cg(i.lng+jj*(this.width/2-jo.x),i.lat-jj*(this.height/2-jo.y));this.centerPoint=this.restrictCenter(jl,jj,e);if(this.centerPoint.zoom){e=this.centerPoint.zoom}}if(jq.fireEvent!==false){this.dispatchEvent(new ff("onzoomstart"))}if(e!==this.zoomLevel){this.zoomLevel=e;this.dispatchEvent(new ff("onzooming"));this.dispatchEvent(new ff("onzoomstartcode"))}if(jq.fireEvent!==false){this.dispatchEvent(new ff("onzoomend"))}if(jq.callback){jq.callback()}},deepZoomMedia:function(e){var i=this;if(!i.temp.isStdCtrlBusy){i.temp.isStdCtrlBusy=true;i.deepZoomTo(i.zoomLevel+e);setTimeout(function(){i.temp.isStdCtrlBusy=false},400)}},deepZoomTo:function(jn,jj){jj=jj||{};var jl=jn-this.zoomLevel;var jk=this._getProperZoom(jn);if(jk.exceeded){var e=new ff("onzoomexceeded");e.targetZoom=jn;this.dispatchEvent(e);return}var i;if(jj.zoomCenter){i=this.pointToPixelIn(jj.zoomCenter)}else{if(this.getInfoWindow()){i=this.pointToPixelIn(this.getInfoWindow().getPoint(),{zoom:this.lastLevel})}else{var i=new eS(this.width/2,this.height/2)}}this.lastLevel=this.zoomLevel;var jm=this.deepZoom||new ax(this);var T=jl>0?1:-1;jm.zoomMap(i,jl,T,null,jj)},flyToIn:function(jo,e){if(e===this.zoomLevel){this.panToIn(jo);return}var jl=this._getProperZoom(e);if(jl.exceeded){var jp=new ff("onzoomexceeded");jp.targetZoom=e;this.dispatchEvent(jp);return}var jn=e-this.zoomLevel;var T=new eS(this.width/2,this.height/2);var i=this.pointToPixelIn(jo);var jm=new id(i.x-T.x,i.y-T.y);this.lastLevel=this.zoomLevel;if(Math.abs(jn)>=4||Math.abs(jm.width)>this.width||Math.abs(jm.height)>this.height){this.centerAndZoomIn(jo,e);return}var jk=this.deepZoom||new ax(this);var jj=jn>0?1:-1;jk.zoomMap(i,jn,jj,jm)},panToIn:function(i,T){T=T||{};if(!i||i.equals(this.centerPoint)){T.callback&&T.callback();return}var jj=this.pointToPixelIn(i);var e=Math.round(this.width/2);var jk=Math.round(this.height/2);if(Math.abs(e-jj.x)>this.width||Math.abs(jk-jj.y)>this.height||T.noAnimation===true){this._panToIn(e-jj.x,jk-jj.y,i);T.callback&&T.callback()}else{this._panBy(e-jj.x,jk-jj.y,T)}},_panToIn:function(i,e,jj){var T=this.temp;if(T.operating===true){return}if(T.dragAni){T.dragAni.stop();T.dragAni=null;this.dispatchEvent(new ff("onmoveend"))}this.dispatchEvent(new ff("onmovestart"));this._setPlatformPosition(i,e,{point:jj});this.dispatchEvent(new ff("onmoveend"))},panBy:function(i,e,T){T=T||{};i=Math.round(i)||0;e=Math.round(e)||0;if(Math.abs(i)<=this.width&&Math.abs(e)<=this.height&&T.noAnimation!==true){this._panBy(i,e,T)}else{this._panToIn(i,e);T.callback&&T.callback()}},_panBy:function(i,e,jk){if(this.temp.operating===true){return}jk=jk||{};this.dispatchEvent(new ff("onmovestart"));var jj=this;var T=jj.temp;T.pl=jj.offsetX;T.pt=jj.offsetY;if(T.tlPan){T.tlPan.cancel()}if(T.dragAni){T.dragAni.stop();T.dragAni=null;this.dispatchEvent(new ff("onmoveend"))}T.tlPan=new e8({fps:jk.fps||jj.config.fps,duration:jk.duration||jj.config.actionDuration,transition:jk.transition||f3.easeInOutQuad,render:function(jl){this.terminative=jj.temp.operating;if(jj.temp.operating){return}jj._setPlatformPosition(Math.ceil(i*jl),Math.ceil(e*jl),{initMapOffsetX:T.pl,initMapOffsetY:T.pt})},finish:function(jl){jj.dispatchEvent(new ff("onmoveend"));jj.temp.tlPan=false;if(jj.temp.stopArrow===true){jj.temp.stopArrow=false;if(jj.temp.arrow!==0){jj._arrow()}}jk.callback&&jk.callback()}})},getCenterIn:function(){return this.centerPoint},getZoom:function(){return this.zoomLevel},setTilt:function(){},getTilt:function(){return this._tilt},setHeading:function(){},getHeading:function(){return this._heading},restrictCenter:function(jr,i,e){this.isRestrict=false;i=i||this.getZoomUnits();e=e||this.zoomLevel;var jp=this.pixelToPointIn(new eS(this.width,0),{center:jr,zoom:e});var jn=this.pixelToPointIn(new eS(0,this.height),{center:jr,zoom:e});var js=jr.lng;var jx=jr.lat;if(this.config.restrictBounds!==null&&!this.config.restrictBounds.isEmpty()){var jw=this.config.restrictBounds;var jj=jw.getSouthWest();var ju=jw.getNorthEast();var jq=il.convertLL2MC(jj);var jl=il.convertLL2MC(ju);jr.lng=this.calcNewLngByBounds(js,jn,jp,jq.lng,jl.lng,i);jr.lat=this.calcNewLatByBounds(jx,jn,jp,jq.lat,jl.lat,i);return jr}var jo=this.pixelToPointIn(new eS(0,0),{center:jr,zoom:e});var jk=this.pixelToPointIn(new eS(0,this.height),{center:jr,zoom:e});if(this.zoomLevel<5){if(jo.lat>g5.MAX_LAT&&jk.lat<g5.MIN_LAT){this.isRestrict=true;var T=g5.MAX_LAT-jr.lat;var jm=jr.lat-g5.MIN_LAT;var jv;if(T<jm){jv=T/(this.height/2)}else{jv=jm/(this.height/2)}var jt=18-m(jv);this.zoomLevel=Math.ceil(jt);jr.zoom=Math.ceil(jt);return jr}}if(jo.lat>g5.MAX_LAT){this.isRestrict=true;jr.lat=g5.MAX_LAT-this.height/2*i}else{if(jk.lat<g5.MIN_LAT){this.isRestrict=true;jr.lat=g5.MIN_LAT+this.height/2*i}}return jr}});function g5(e,T){if(typeof e==="string"){e=document.getElementById(e)}cN.call(this);this.container=e;this.width=e.clientWidth;this.height=e.clientHeight;this.offsetX=0;this.offsetY=0;this._setStyle(e);e.unselectable="on";e.innerHTML="";ey.ac(e,"bmap-container");e.appendChild(this.render());this._initDate=new Date();this.platform=e.children[0];this.maskLayer=this.platform.children[0];this._panes={};this.centerPoint=new cg(0,0);this.zoomLevel=0;this._heading=0;this._tilt=0;this._bounds=new hk();this.lastLevel=0;this._lock=false;this._enableTiltZoom=7;this._enableHeadingZoom=7;this.defaultZoomLevel=null;this.defaultCenter=null;this.zoomEventStatus="idle";this.currentOperation=dO.idle;this._setConfig(T);this._initMapRenderType();this._animationInfo={};this._animationInfoUnstopable={};this.suspendLoad=false;this._customTileLabels=[];if(this._renderType==="webgl"){this._workerMgr=new iF(this);this._featureMgr=new bZ();ey.extend(this,x.prototype);this.jobScheduler=new bb(this);this.benchmark=new cE();this._setupWebGLMap();this.deviceInfo={hardwareInfo:{renderer:"",vendor:""}};if(cL.ifSupportWebGL._renderer){this.deviceInfo.hardwareInfo.renderer=cL.ifSupportWebGL._renderer;this.deviceInfo.hardwareInfo.vendor=cL.ifSupportWebGL._vendor}}else{ey.extend(this,h5.prototype)}if(!dU[this.config.mapType]){this.config.mapType=BMAPGL_NORMAL_MAP}if(this.config.mapType===BMAP_EARTH_MAP&&!this.config.enableEarth){if(this.forceEnableEarth()===false){this.config.mapType=BMAPGL_NORMAL_MAP}}this.mapType=this.config.mapType;this.preMapType=null;if(this.config.enableEarth){var jl=this.maskLayer.style;jl.opacity=0;jl.background="#000";if(this.config.mapType===BMAP_EARTH_MAP){jl.opacity=1}setTimeout(function(){jl.WebkitTransition=jl.transition="opacity .4s"},100)}this._isHybridShow=this.config.showStreetLayer;this.temp={operating:false,arrow:0,lastDomMoveTime:0,lastLoadTileTime:0,lastMovingTime:0,canKeyboard:false,I:function(i){return ey.I(i)},curSpots:[],curSpotsArray:[],curAreaSpot:null,spotsGuid:1,registerIndex:-1,hoverOnSpot:null,isStdCtrlBusy:false};window.InstanceCore=this.temp.I;this.platform.style.cursor=this.config.defaultCursor;this._bind();for(var jj=0;jj<bp._register.length;jj++){bp._register[jj](this)}this.temp.registerIndex=jj;var jk=this;if(this._renderType==="webgl"){gs.load("oppcgl",function(){jk._asyncRegister()})}else{gs.load("oppc",function(){jk._asyncRegister()})}if(this.config.mapType==="B_EARTH_MAP"){if(!bp.Earth){gs.load("earth",function(){})}else{jk._syncAndChangeMapType("B_EARTH_MAP")}}}g5.MAX_TILT=87;g5.MAX_DRAG_TILT=73;g5.MAX_DRAG_TILT_L2=50;g5.MIN_TILT=0;g5.MAX_LAT=19431424;g5.MIN_LAT=-16023552;g5.WORLD_SIZE_MC_HALF=20037726.372307256;g5.WORLD_SIZE_MC=g5.WORLD_SIZE_MC_HALF*2;g5.RIGHT_EDGE_POINT=new cg(g5.WORLD_SIZE_MC_HALF,0);g5.LEFT_EDGE_POINT=new cg(-g5.WORLD_SIZE_MC_HALF,0);g5.HIGH_RES_MIN_RATIO=1.2;g5.inherits(cN,"Map");var e0={NORMAL:"B_NORMAL_MAP",EARTH:"B_EARTH_MAP",SATELLITE:"B_STREET_MAP"};bp.MapTypeId=e0;ey.extend(g5.prototype,{render:function(){var e=bL("div",{id:"platform"});var jj=e.style;jj.overflow="visible";jj.position="absolute";jj.zIndex=5;jj.top=jj.left="0px";var i=bL("div",{id:"mask","class":"BMap_mask"});var T=i.style;T.position="absolute";T.top=T.left="0px";T.zIndex="9";T.overflow="hidden";T.WebkitUserSelect="none";T.width=this.width+"px";T.height=this.height+"px";e.appendChild(i);return e},_initMapRenderType:function(){var e=this.config.forceRenderType;if(e==="dom"){this._renderType="dom";return}else{if(e==="canvas"){if(cL.isModernBrowser&&!cL.ifCanvas2dInBlackList()){this._renderType="canvas";return}else{this._renderType="dom";return}}else{if(e==="webgl"){if(cL.ifSupportWebGL()){this._renderType="webgl";return}}}}if(cL.ifSupportWebGL()&&cL.ifEnableWebGLMap()){this._renderType="webgl";return}if(cL.isModernBrowser&&cL.ifEnableCanvas2dMap()){this._renderType="canvas";return}this._renderType="dom"},_setConfig:function(i){i=i||{};this.config={bottomOffset:0,clickInterval:200,enableDragging:true,enableRotate:true,enableTilt:true,enableKeyboard:false,enableDblclickZoom:true,enableContinuousZoom:true,enableWheelZoom:false,enableRotateGestures:true,enableTiltGestures:true,enablePinchZoom:true,fixCenterWhenPinch:false,enableAutoResize:true,zoomCenter:null,fps:ey.Browser.ie?30:60,zoomerDuration:240,actionDuration:450,defaultCursor:w.defaultCursor,draggingCursor:w.draggingCursor,overlayMoveCursor:"pointer",coordType:BMAP_COORD_MERCATOR,mapType:BMAPGL_NORMAL_MAP,drawer:BMAP_SYS_DRAWER,enableInertialDragging:true,drawMargin:500,drawMarginGL:500,enableFulltimeSpotClick:false,enableResizeOnCenter:false,isModernBrowser:cL.isModernBrowser,forceRenderType:"",textRenderType:null,ratio:fI()>=g5.HIGH_RES_MIN_RATIO?2:1,enableEarth:cL.ifEnableEarth(),defaultMaxBounds:new hk(new cg(-21364736,-10616832),new cg(23855104,15859712)),showControls:false,showRealSunlight:true,showMilkyway:true,earthBackground:null,showStreetLayer:true,minZoom:null,maxZoom:null,style:"default",backgroundColor:null,enableIconClick:false,autoSafeArea:false,ak:null,webgl2:false,restrictCenter:true,restrictBounds:null,smaa:true,preserveDrawingBuffer:false,privateOn:false,privateRegions:null};for(var T in i){if(i.hasOwnProperty(T)){this.config[T]=i[T];if(T==="fixCenterWhenResize"){this.config.enableResizeOnCenter=i[T]}}}if(i.style){if(i.style["styleId"]&&i.style["styleId"].length<32){this.config.style=i.style["styleId"]}else{this.config.style=i.style}}this._setTextRenderType();this._displayOptions={poi:true,poiText:true,poiIcon:true,overlay:true,layer:true,building:true,indoor:true,street:true,skyColors:["rgba(226, 237, 248, 0)","rgba(186, 211, 252, 1)"],isFlat:false,labelMargin:0};if(i.displayOptions){for(var e in i.displayOptions){if(i.displayOptions.hasOwnProperty(e)){this._displayOptions[e]=i.displayOptions[e]}}}if(this.config.restrictCenter===false){this._enableTiltZoom=0;this._enableHeadingZoom=0}},getMinZoom:function(){var T;if(dU[this.mapType][this._renderType]){T=dU[this.mapType][this._renderType].minZoom}else{T=dU[this.mapType].minZoom}if(this.config.minZoom!==null&&this.config.minZoom>=T){T=this.config.minZoom}if(this.mapType==="B_EARTH_MAP"){return T}var i=this.getSize();var e=this.worldSize(T);while(e<i.width){T++;e=this.worldSize(T)}return T},getMaxZoom:function(){var e;if(dU[this.mapType][this._renderType]){e=dU[this.mapType][this._renderType].maxZoom}else{e=dU[this.mapType].maxZoom}if(this.config.maxZoom!==null&&this.config.maxZoom<=e){e=this.config.maxZoom}else{if(this._renderType==="webgl"){e=21}}return e},_drawFrame:function(){this._webglMapScene._painter.draw()},_setupWebGLMap:function(){var e=this;gs.load("mapgl",function(){e._asyncRegister()})},_setStyle:function(i){var e=i.style;e.overflow="hidden";if(b2(i).position!=="absolute"){e.position="relative"}e.backgroundImage="url("+w.imgPath+"bg.png)";e.textAlign="left";e.touchAction=e.MSTouchAction="none"},_bind:function(){var e=this;if(e._renderType!=="webgl"){e._watchSize=function(){var T=e.getContainerSize();if(e.width!==T.width||e.height!==T.height){var jm=(T.width-e.width)/2;var jo=(T.height-e.height)/2;var jj=e.getZoomUnits();var jl=e.centerPoint;if(jl&&!e.config.enableResizeOnCenter){e.centerPoint=new cg(jl.lng+jm*jj,jl.lat-jo*jj)}e.maskLayer.style.width=(e.width=T.width)+"px";e.maskLayer.style.height=(e.height=T.height)+"px";var jk=new ff("onresize");jk.size=T;e.dispatchEvent(jk);e.fire(new ff("onsize_changed"));var i=parseInt(e.platform.style.left,10)||0;var jn=parseInt(e.platform.style.top,10)||0;if(e.currentOperation!=="undefined"&&e.currentOperation!==dO.idle&&(e.offsetX!==i||e.offsetY!==jn)){e._setPlatformPosition(i,jn)}}}}else{e._watchSize=function(){var i=e.getContainerSize();if(e.width!==i.width||e.height!==i.height){var jj=e.getSize();e.maskLayer.style.width=(e.width=i.width)+"px";e.maskLayer.style.height=(e.height=i.height)+"px";if(fI()!==e.config.ratio){e.config.ratio=fI()}var jk=new ff("onresize");jk.size=i;e.dispatchEvent(jk);var T=new ff("onsize_changed");T.size=i;T.oldSize=jj;e.fire(T)}}}if(e.config.enableAutoResize){e.temp.autoResizeTimer=setInterval(e._watchSize,16)}this.on("size_changed",function(){var i=e.getMinZoom();if(e.zoomLevel<i){e.setZoomIn(i,{noAnimation:true})}});this.on("zoom_changed",function(){this.dispatchEvent(new ff("onzooming"))})},addControl:function(e){if(e&&bH(e._i)){e._i(this);this.dispatchEvent(new ff("onaddcontrol",e))}},removeControl:function(e){if(e&&bH(e.remove)){e.remove();this.dispatchEvent(new ff("onremovecontrol",e))}},addContextMenu:function(e){if(e){e.initialize(this);this.dispatchEvent(new ff("onaddcontextmenu",e))}},removeContextMenu:function(e){if(e){this.dispatchEvent(new ff("onremovecontextmenu",e));e.remove()}},addDistrictLayer:function(e){if(e){e.initialize(this)}},removeDistrictLayer:function(e){if(e){e.removeDistrict(this,e)}},addOverlay:function(i){if(i&&bH(i._i)){var T=new ff("onbeforeaddoverlay",i);T.overlay=i;this.dispatchEvent(T);i._i(this);T=new ff("onaddoverlay",i);T.overlay=i;this.dispatchEvent(T)}},removeOverlay:function(i){if(i&&bH(i.remove)){if(i instanceof b4){if(this.stencil){this.stencil=null}}var T=new ff("onremoveoverlay",i);T.overlay=i;i.remove();this.dispatchEvent(T)}},clearOverlays:function(){this.dispatchEvent(new ff("onclearoverlays"))},addTileLayer:function(jk){if(!jk){return}for(var jj=0,e=this.tileMgr.tileLayers.length;jj<e;jj++){var T=this.tileMgr.tileLayers[jj];if(T===jk||T.getMapType()===jk.getMapType()){return}}jk.initialize(this);this.dispatchEvent(new ff("onaddtilelayer",jk))},removeTileLayer:function(e){if(e){e.remove();this.dispatchEvent(new ff("onremovetilelayer",e))}},addGeoJSONLayer:function(e){if(e&&e instanceof aE){e.init(this)}},removeGeoJSONLayer:function(e){if(e&&e instanceof aE){e.remove()}},getTileLayer:function(e){if(this.tileMgr){return this.tileMgr.getTileLayer(e)}return null},setMapType:function(e){var i=this;if(this.mapType===e||this._mapTypeChanging){return}if(e===BMAP_EARTH_MAP&&!this.config.enableEarth){return}if(this._earth&&this._earth.getLock()){return}this._mapTypeChanging=true;this.preMapType=this.mapType;this._boundsInPreMapType=this.getBoundsIn();if(this.preMapType===BMAP_SATELLITE_MAP){this._preStreetLayerShow=this._isHybridShow}if(e===BMAP_EARTH_MAP){if(!bp.Earth){gs.load("earth",function(){i._syncAndChangeMapType(e)});return}i._syncAndChangeMapType(e)}else{if(this.preMapType!==BMAP_EARTH_MAP){this._changeFlatMapType(e);this._mapTypeChanging=false}else{this._setMapTypeStatus(e,function(T,jj){var jk=i._earth.getEarthCanvas();i._changeFlatMapType(e,this.preMapType);if(i._mapTypeChangAni){i._mapTypeChangAni.stop()}i._mapTypeChangAni=c2.start({el:jk,style:"opacity",startValue:1,endValue:0,duration:200,callback:function(){i._mapTypeChangAni=null;i._mapTypeChanging=false}});T=il.convertLL2MC(T);if(i._renderType==="webgl"){ey.extend(i,x.prototype);i.setCenterIn(T,{noAnimation:true});i.setZoomIn(jj,{noAnimation:true})}else{ey.extend(i,h5.prototype);i.centerAndZoomIn(T,jj)}})}}},_changeFlatMapType:function(jm){if(!jm||!dU[jm]){return}var ju=this.preMapType;this.mapType=jm;var jj=this.getTileLayer(ju);if(jj){this.removeTileLayer(jj)}else{if(this.tileMgr.tileLayers.length){var jt=this.getTileLayer("B_NORMAL_MAP");if(jt){this.removeTileLayer(jt)}else{jt=this.getTileLayer("B_SATELLITE_MAP");jt&&this.removeTileLayer(jt)}}}this._preStreetLayerShow=this.config.showStreetLayer;if(ju===BMAP_SATELLITE_MAP&&this._preStreetLayerShow){this._removeHybirdMap()}if(this.mapType!==BMAP_EARTH_MAP||this._renderType!=="webgl"||this.baseLayerAdded!==true){var T=new hk(new cg(-21364736,-10616832),new cg(23855104,15859712));var jr=new h(T,"baidu",jm);var jk=new gS({mapType:this.mapType,copyright:jr,dataType:this.mapType===BMAP_SATELLITE_MAP?f8:g3,customLayer:this.mapType===BMAP_SATELLITE_MAP,baseLayer:true,transparentPng:true,tileTypeName:this.mapType===BMAP_SATELLITE_MAP?"web":"na"});jk._isInnerLayer=true;jk.setZIndex(0);this.addTileLayer(jk);if(this._renderType==="webgl"&&!this.baseLayerAdded){this.baseLayerAdded=true}}if(jm===BMAP_SATELLITE_MAP){this._featureMgr.clearLabelOverlayData();this._featureMgr.setLabelData([]);if(this._preStreetLayerShow===true||typeof this._preStreetLayerShow==="undefined"){this._addHybirdMap()}}var jo=this.tileMgr.tileLayers;for(var jn=0,jl=jo.length;jn<jl;jn++){var jp=jo[jn];var js=jp.tilesDiv;if(!js){continue}if(!jp._isInnerLayer&&js.style.visibility==="hidden"){js.style.visibility=""}}var jq=new ff("onmaptypechange");jq.zoomLevel=this.zoomLevel;jq.mapType=jm;jq.exMapType=ju;this.dispatchEvent(jq)},showStreetLayer:function(e){e?this._addHybirdMap():this._removeHybirdMap()},hideStreetLayer:function(e){this._hideStreetLayerOptions=e;this._removeHybirdMap(e)},_addHybirdMap:function(){this._isHybridShow=true;if(this.mapType==="B_EARTH_MAP"){if(this._earth){this._earth.showStreetLayer()}return}if(this._hybridTileLayer){this.addTileLayer(this._hybridTileLayer);var jm=new ff("onstreetlayer_show");this.dispatchEvent(jm);return}var jk=new hk(new cg(-21364736,-10616832),new cg(23855104,15859712));var T=new h(jk,"",BMAP_HYBRID_MAP);var i=new gS({copyright:T,transparentPng:true,tileTypeName:"web"});i._isInnerLayer=true;var jj=this.isCanvasMap();i.getTilesUrl=function(jn,js){var jq=dU.B_STREET_MAP;var jr=iY("ditu","satelliteStreet");var jo=jr.ver;var e=jr.udt;var jp=jq.tileUrls[Math.abs(jn.x+jn.y)%jq.tileUrls.length]+"?qt=vtile&x="+(jn.x+"").replace(/-/gi,"M")+"&y="+(jn.y+"").replace(/-/gi,"M")+"&z="+js+"&styles=sl&v="+jo+"&udt="+e+"$scaler="+fI()+"&showtext="+(jj?0:1);return jp};this._isHybridShow=true;this.addTileLayer(i);this._hybridTileLayer=i;var jl=new ff("onstreetlayer_show");this.dispatchEvent(jl)},_removeHybirdMap:function(i){this._isHybridShow=false;if(this.mapType==="B_EARTH_MAP"){if(this._earth){this._earth.hideStreetLayer(i)}return}if(this._hybridTileLayer){this.removeTileLayer(this._hybridTileLayer);var T=new ff("onstreetlayer_hide");this.dispatchEvent(T)}},isStreetLayerShow:function(){return this._isHybridShow},getTileId:function(e,jl){var jj=dU[this.mapType];if(typeof jj!=="object"){return null}var T=jj.baseUnits*Math.pow(2,(jj.zoomLevelBase-jl));var jk=parseInt(e.lng/T,10);var i=parseInt(e.lat/T,10);return{row:jk,column:i,level:jl}},reset:function(){this.centerAndZoomIn(this.defaultCenter,this.defaultZoomLevel,true)},setOptions:function(i){i=i||{};var jk=this;for(var jj in i){if(i.hasOwnProperty(jj)){var T=true;if(typeof i[jj]!=="object"){T=i[jj]!==this.config[jj]}this.config[jj]=i[jj];if(jj==="fixCenterWhenResize"){this.config.enableResizeOnCenter=i[jj]}if(!T){continue}switch(jj){case"style":case"styleUrl":var e={os:i.style.os,sv:i.style.sv};if(jj==="style"&&i.styleUrl){break}this.fire(new ff("onstyle_willchange"));this.loadMapStyleFiles(function(){var jl=new ff("onlayer_update");jl.name="na";jk.fire(jl)},e);break;case"enableAutoResize":if(i[jj]===true){this.enableAutoResize()}else{this.disableAutoResize()}break;case"displayOptions":this.setDisplayOptions(i[jj]);break}}}},setPrivateStatus:function(i){if(typeof i==="boolean"){if(this.config.privateOn!==i){this.config.privateOn=i;var e=new ff("onlayer_update");e.name="na";this.fire(e)}}},getPrivateStatus:function(){return this.config.privateOn},setPrivateRegions:function(jk){if(jk&&jk instanceof Array){var jj=true;for(var T=0;T<jk.length;T++){if(jk[T] instanceof cs){continue}else{jj=false;break}}if(jj){this.config.privateRegions=jk;var e=new ff("onlayer_update");e.name="na";this.fire(e)}}},getPrivateRegions:function(){if(!this.config.privateRegions){return null}else{return this.config.privateRegions}},enableDragging:function(){this.config.enableDragging=true},disableDragging:function(){this.config.enableDragging=false},enableInertialDragging:function(){this.config.enableInertialDragging=true},disableInertialDragging:function(){this.config.enableInertialDragging=false},enableScrollWheelZoom:function(){this.config.enableWheelZoom=true},disableScrollWheelZoom:function(){this.config.enableWheelZoom=false},enableContinuousZoom:function(){this.config.enableContinuousZoom=true},disableContinuousZoom:function(){this.config.enableContinuousZoom=false},enableResizeOnCenter:function(){this.config.enableResizeOnCenter=true},disableResizeOnCenter:function(){this.config.enableResizeOnCenter=false},enableDoubleClickZoom:function(){this.config.enableDblclickZoom=true},disableDoubleClickZoom:function(){this.config.enableDblclickZoom=false},enableKeyboard:function(){this.config.enableKeyboard=true},disableKeyboard:function(){this.config.enableKeyboard=false},getSize:function(){return new id(this.width,this.height)},enablePinchToZoom:function(){this.config.enablePinchZoom=true},disablePinchToZoom:function(){this.config.enablePinchZoom=false},enableTilt:function(){this.config.enableTilt=true},disableTilt:function(){this.config.enableTilt=false},enableRotate:function(){this.config.enableRotate=true},disableRotate:function(){this.config.enableRotate=false},enableAutoResize:function(){this.config.enableAutoResize=true;this._watchSize();if(!this.temp.autoResizeTimer){this.temp.autoResizeTimer=setInterval(this._watchSize,16)}},disableAutoResize:function(){this.config.enableAutoResize=false;if(this.temp.autoResizeTimer){clearInterval(this.temp.autoResizeTimer);this.temp.autoResizeTimer=null}},checkResize:function(){this._watchSize()},resize:function(){this._watchSize()},getContainerSize:function(){return new id(this.container.clientWidth,this.container.clientHeight)},_getProperZoom:function(T){if(!T){T=this.zoomLevel}var i=this.getMinZoom();var e=this.getMaxZoom();var jj=false;if(T<i){jj=true;T=i}if(T>e){jj=true;T=e}if(this._renderType!=="webgl"){T=Math.round(T)}return{zoom:T,exceeded:jj}},getContainer:function(){return this.container},getZoomUnits:function(T){if(this.mapType===BMAP_EARTH_MAP){return Math.pow(2,18-this._earth.getImageZoom())}var e=dU[this.mapType];if(typeof e!=="object"){return null}var i=T||this.zoomLevel;return Math.pow(2,(e.zoomLevelBase-i))},pointToPixelIn:function(ju,jw){if(!ju){return}jw=jw||{};if(this.mapType===BMAP_EARTH_MAP){var jl;if(!ju._llPt){jl=il.convertMC2LL(ju);ju._llPt=jl}jl=ju._llPt;var jq=null;var jk=null;if(typeof jw.zoom==="number"){var jt=this._earth;var jv=jt._getEarthZoomByImgZoom(jw.zoom);if(jv<=3){jq=jt._generateTmpPMatrix(jv)}jk=jt._generateTmpMVMatrix(jt.getCenter(),jv)}var jm=this._earth.fromLatLngToPixel(jl,{useRound:false,isCalcOnBack:true,matrixInfo:{modelViewMatrix:jk,projectionMatrix:jq}});return jm}if((this._heading%360===0&&this._tilt===0)||!this._webglMapCamera){var js=this.getZoomUnits(jw.zoom);var jo=jw.center||this.centerPoint;var jj=this.width/2;var jn=this.height/2;var jr;if(ju.lng*jo.lng<0){var i=Math.abs(ju.lng-jo.lng);var e=(eB._mc180X*2-i)/js;if(jo.lng<0){jr=jj-e}else{jr=jj+e}}else{jr=(ju.lng-jo.lng)/js+jj}var jp=(jo.lat-ju.lat)/js+jn;if(jw.useRound!==false){jr=Math.round(jr);jp=Math.round(jp)}return new eS(jr,jp)}var T=this._webglMapCamera.fromMCToScreenPixel(ju.lng,ju.lat,jw);if(jw.useRound===false){return T}T.x=Math.round(T.x);T.y=Math.round(T.y);return T},pixelToPointIn:function(e,jq){if(!e){return}jq=jq||{};if(this.mapType===BMAP_EARTH_MAP){if(typeof jq.zoom==="number"){var jo=this._earth;var jl=null;var T=null;var jp=jo._getEarthZoomByImgZoom(jq.zoom);if(jp<=3){jl=jo._generateTmpPMatrix(jp)}T=jo._generateTmpMVMatrix(jo.getCenter(),jp)}var i=this._earth.fromPixelToLatLng(e,{matrixInfo:{modelViewMatrix:T,projectionMatrix:jl}});if(i===null){return null}return il.convertLL2MC(i)}if((this._heading%360!==0||this._tilt>0)&&this._webglMapCamera){return this._webglMapCamera.fromScreenPixelToMC(e.x,e.y,jq)}var jm=jq.center||this.centerPoint;var jn=this.getZoomUnits(jq.zoom);var jk=jm.lng+jn*(e.x-this.width/2);var jj=jm.lat-jn*(e.y-this.height/2);return new cg(jk,jj)},pointToOverlayPixelIn:function(e,jj){jj=jj||{};var T=this.pointToPixelIn(e,{zoom:jj.zoom,center:jj.center,forLabel:true,frustumTest:true,useRound:jj.useRound});if(!T){return}if(jj.fixPosition&&this.mapType!=="B_EARTH_MAP"){var jk=this.getSize();var i=this.worldSize(jj.zoom);if(T.x>jk.width){while(T.x>jk.width){T.x-=i}}else{if(T.x<0){while(T.x<0){T.x+=i}}}}if(this._renderType==="webgl"){return T}T.x-=this.offsetX;T.y-=this.offsetY;return T},overlayPixelToPointIn:function(i,e){if(!i){return}var T=i.clone();if(this._renderType!=="webgl"){T.x+=this.offsetX;T.y+=this.offsetY}return this.pixelToPointIn(T,e)},getProjection:function(){return new il()},lnglatToMercator:function(e,jj){var i=new cg(e,jj);var T=il.convertLL2MC(i);return[T.lng,T.lat]},mercatorToLnglat:function(i,e){if(isNaN(i)||isNaN(e)){return[]}i=parseFloat(i);e=parseFloat(e);var jj=new cg(i,e);var T=il.convertMC2LL(jj);return[T.lng,T.lat]},getBoundsIn:function(){var jw=arguments[0];if(this.mapType===BMAP_EARTH_MAP&&this._earth){var jq=this._earth.getCustomBounds();if(!jq){return this.config.defaultMaxBounds}var jp=jq.getSouthWest();var e=jq.getNorthEast();if(jp.lng>e.lng){e.lng=180}var jN=il.convertLL2MC(jp);var jD=il.convertLL2MC(e);var jt=this.config.defaultMaxBounds;var jC=Math.max(jN.lng,jt.sw.lng);var jB=Math.max(jN.lat,jt.sw.lat);var jv=Math.min(jD.lng,jt.ne.lng);var ju=Math.min(jD.lat,jt.ne.lat);var jy=new hk(new cg(jC,jB),new cg(jv,ju));jy.pointBottomLeft=new cg(jC,jB);jy.pointBottomRight=new cg(jv,jB);jy.pointTopLeft=new cg(jC,ju);jy.pointTopRight=new cg(jv,ju);jy.setMinMax();jy.makeNormalizedPoint(this._earth.getHeading());return jy}jw=jw||{};var jk=jw.margins||[0,0,0,0];var jI=this.pixelToPointIn({x:jk[3],y:this.height-jk[2]},jw);var jM=this.pixelToPointIn({x:this.width-jk[1],y:jk[0]},jw);var jA=typeof jw.heading==="number"?jw.heading:(this._heading%360);var T=typeof jw.tilt==="number"?jw.tilt:this._tilt;var js=this._webglMapCamera;if((jA===0&&T===0)||!js){this._bounds.setSouthWest(jI);this._bounds.setNorthEast(jM);this._bounds.pointBottomLeft=jI;this._bounds.pointBottomRight=new cg(jM.lng,jI.lat);this._bounds.pointTopRight=jM;this._bounds.pointTopLeft=new cg(jI.lng,jM.lat);this._bounds.setMinMax();this._bounds.makeNormalizedPoint(jA);return this._bounds}var jz=this.pixelToPointIn({x:jk[3],y:jk[0]},jw);var jj=js.getPosition();var jO=Math.sqrt(Math.pow(jz.lng-jj[0],2)+Math.pow(jz.lat-jj[1],2));var jJ=this.getZoomUnits();var jQ=jO/jJ;var jG=js._frustumSideLen;var jo=js._fovy;if(jQ>jG||(90-T)<jo/2){var jP=[jz.lng-jj[0],jz.lat-jj[1]];if((90-T)<jo/2){jP[0]=-jP[0];jP[1]=-jP[1]}var jH=jG*jJ;var jn=[jP[0]/jO*jH+jj[0],jP[1]/jO*jH+jj[1]];var jE=[jM.lng-jj[0],jM.lat-jj[1]];if((90-T)<jo/2){jE[0]=-jE[0];jE[1]=-jE[1]}var jl=[jE[0]/jO*jH+jj[0],jE[1]/jO*jH+jj[1]];jz.lng=jn[0];jz.lat=jn[1];jM.lng=jl[0];jM.lat=jl[1]}var jx=this.pixelToPointIn({x:this.width-jk[1],y:this.height-jk[2]},jw);var jF=[jI,jM,jz,jx];var jL=jF[0].lng;var jR=jF[0].lat;var jm=jF[0].lng;var jr=jF[0].lat;for(var jK=1;jK<4;jK++){if(jF[jK].lng<jL){jL=jF[jK].lng}if(jF[jK].lng>jm){jm=jF[jK].lng}if(jF[jK].lat<jR){jR=jF[jK].lat}if(jF[jK].lat>jr){jr=jF[jK].lat}}this._bounds.setSouthWest(new cg(jL,jR));this._bounds.setNorthEast(new cg(jm,jr));this._bounds.pointTopLeft=jz;this._bounds.pointTopRight=jM;this._bounds.pointBottomRight=jx;this._bounds.pointBottomLeft=jI;this._bounds.makeNormalizedPoint(jA);this._bounds.setMinMax();return this._bounds},isLoaded:function(){return !!this.loaded},_getBestLevel:function(i,js){var jl=0;if(this._renderType==="webgl"&&!bK()){jl=100}var jm=js.margins||[10,10,10,10];var jj=js.zoomFactor||0;var jn=jm[1]+jm[3];var jk=jm[0]+jm[2];var e=this.getMinZoom();var jr=this.getMaxZoom();var jq=i.toSpan();var jp=jq.width/(this.width-jn-jl);var jo=jq.height/(this.height-jk-jl);var T=18-m(Math.max(jp,jo));if(T<e){T=e}if(T>jr){T=jr}T+=jj;if(this._renderType!=="webgl"){T=Math.floor(T)}return T},getViewportIn:function(js,jk){if(this.mapType===BMAP_EARTH_MAP){js=js||[];var jm=[];for(var jt=0;jt<js.length;jt++){if(!js[jt]){continue}jm.push(il.convertMC2LL(js[jt]))}var ju=this._earth.getViewportIn(jm,jk);var jj=ju.center;var jq=ju.zoom;var jy=il.convertLL2MC(jj);return{center:jy,zoom:jq}}var jo={center:this.getCenterIn(),zoom:this.getZoom()};if(!js||js.length===0){return jo}jk=jk||{};var jn;if(js instanceof hk){jn=js}else{var jl=js;jn=new hk();for(var jr=jl.length-1;jr>=0;jr--){jn.extend(jl[jr])}if(jn.isEmpty()){return jo}}var jx=jn.getCenter();var e=this._getBestLevel(jn,jk);if(jk.margins){var T=jk.margins;var jw=(T[1]-T[3])/2;var jp=(T[0]-T[2])/2;var jv=this.getZoomUnits(e);jx.lng=jx.lng+jv*jw;jx.lat=jx.lat+jv*jp}return{center:jx,zoom:e}},setViewportIn:function(jj,jk){if(this.mapType===BMAP_EARTH_MAP){var jo;if(jj&&jj.center){var T=il.convertMC2LL(jj.center);var jm=this._earth._getEarthZoomByImgZoom(jj.zoom,T);jo={center:T,zoom:jm}}else{jo=[];for(var jl=0;jl<jj.length;jl++){var jn=il.convertMC2LL(jj[jl]);jo[jl]=new ca(jn.lat,jn.lng)}}this._earth.setViewportIn(jo,jk);return}var e;if(jj&&jj.center){e=jj}else{e=this.getViewportIn(jj,jk)}jk=jk||{};if(this._renderType==="webgl"){this.centerAndZoomIn(e.center,e.zoom,jk);return}if(e.zoom===this.zoomLevel&&jk.enableAnimation!==false){this.panToIn(e.center,{duration:200,callback:jk.callback})}else{this.centerAndZoomIn(e.center,e.zoom,jk)}},addSpots:function(T,i){if(!T||T.length===0){return}i=i||{};var jl=i.zIndex||0;var jk=typeof i.enableMultiResponse==="undefined"?true:!!i.enableMultiResponse;this.spotsPool=this.spotsPool||{};var e="sp"+(this.temp.spotsGuid++);this.spotsPool[e]={spots:T.slice(0),zIndex:jl,enableMultiResponse:jk};var jj=this;gs.load("hotspot",function(){jj._asyncRegister()});return e},getSpots:function(e){return this.spotsPool[e]&&this.spotsPool[e].spots||[]},removeSpots:function(e){if(!e||!this.spotsPool[e]){return}delete this.spotsPool[e]},clearSpots:function(){delete this.spotsPool},getIconByClickPosition:function(i){if(!this.config.enableIconClick||!this._spotsMgr){return null}var e=this._spotsMgr.getSpotsByScreenPosition(i);if(e[0]&&e[0].userdata){var T=e[0].userdata;return{name:T.name,uid:T.uid,position:T.iconPoint||e[0].pt}}return null},setBounds:function(e){dU[this.mapType].bounds=e.clone()},getCoordType:function(){return this.config.coordType},getPanes:function(){return this._panes},getInfoWindow:function(){if(this.temp.infoWin&&this.temp.infoWin.isOpen()){return this.temp.infoWin}return null},getDistanceIn:function(jk,e){if(!jk||!e){return}if(jk.equals(e)){return 0}if(this.mapType===BMAP_EARTH_MAP){var jj=il.convertMC2LL(jk);var T=il.convertMC2LL(e);return this._earth.getDistance(jj,T)}var i=il.getDistanceByMC(jk,e);return i},getOverlays:function(){var jl=[];var jm=this._overlays;var jk=this._customOverlays;if(jm){for(var jj in jm){if(jm[jj] instanceof ec){jl.push(jm[jj])}}}if(jk){for(var T=0,e=jk.length;T<e;T++){jl.push(jk[T])}}return jl},getMapType:function(){return this.mapType},getMapCoordType:function(){return this.coordType},_asyncRegister:function(){for(var e=this.temp.registerIndex;e<bp._register.length;e++){bp._register[e](this)}this.temp.registerIndex=e},setDefaultCursor:function(e){this.config.defaultCursor=e;if(this.platform){this.platform.style.cursor=this.config.defaultCursor}},getDefaultCursor:function(){return this.config.defaultCursor},setOverlayMoveCursor:function(e){this.config.overlayMoveCursor=e},getOverlayMoveCursor:function(){return this.config.overlayMoveCursor},setDraggingCursor:function(e){this.config.draggingCursor=e},getDraggingCursor:function(){return this.config.draggingCursor},_syncAndChangeMapType:function(e){var i=this;if(i._renderType==="webgl"&&i.getTilt()>g5.MAX_DRAG_TILT_L2){i.setTilt(g5.MAX_DRAG_TILT_L2,{callback:function(){i._changeEarthMapType(e)}})}else{i._changeEarthMapType(e)}},_changeEarthMapType:function(T){var jj=this;var jm=jj.tileMgr.tileLayers;if(this._mapTypeChangAni){this._mapTypeChangAni.stop()}var jl;if(this._earth){jl=this._earth.getEarthCanvas()}if(!this._earth){this.maskLayer.style.opacity=1;this.maskLayer.style.zIndex=999;this.maskLayer.style.background="#000"}this._mapTypeChangAni=new e8({duration:400,render:function(e){if(!jj._earth){return}jl.style.opacity=e},finish:function(){for(var e=jm.length-1,jn=e;jn>=0;jn--){var jp=jm[jn].tilesDiv;if(jp){jp.style.visibility="hidden"}if(jm[jn]._isInnerLayer&&jj._renderType!=="webgl"){jj.removeTileLayer(jm[jn])}}jj._mapTypeChangAni=null;jj._mapTypeChanging=false;function jo(){var jt=jj.getZoom()-2;var ju=jj.getCenterIn();var jr=il.convertMC2LL(ju);jj._earth=new bp.Earth(jj,{center:jr,zoom:jt,showRealSunlight:jj.config.showRealSunlight,showMilkyway:jj.config.showMilkyway,earthBackground:jj.config.earthBackground});jj._proxyEarthEvents();var jq=jj.mapType;jj.mapType=T;var js=new ff("onmaptypechange");js.zoomLevel=this.zoomLevel;js.mapType=T;js.exMapType=jq;jj.dispatchEvent(js);jj._setMapTypeStatus(T);ey.extend(jj,bp.EarthView.prototype);if(!jj._navigationCtrl&&jj.config.showControls){jj._navigationCtrl=new eA(jj)}}if(!jj._earth){if(bp["FeatureStyle"+jj.config.style]){jo()}else{jj.loadMapStyleFiles(function(){jo()})}}if(parseInt(jj.maskLayer.style.opacity,10)===1){setTimeout(function(){jj.maskLayer.style.zIndex=9;jj.maskLayer.style.opacity=0},1000)}}});if(!this._earth){return}var i=this.mapType;this.mapType=T;var jk=new ff("onmaptypechange");jk.zoomLevel=this.zoomLevel;jk.mapType=T;jk.exMapType=i;this.dispatchEvent(jk);jj._setMapTypeStatus(T);ey.extend(jj,bp.EarthView.prototype)},getMapStyleId:function(){if(typeof this.config.style==="string"){return this.config.style}return this.config.mapStyleId||"custom"},_setMapTypeStatus:function(T){var jn=arguments[1];if(T===BMAP_EARTH_MAP){var jl=this._earth.getEarthCanvas();if(jl){jl.style.display=""}var jo={noAnimation:true};this._earth.setCenter(il.convertMC2LL(this.centerPoint),jo);this._earth.setImageZoom(this.zoomLevel,jo);this._earth.setTilt(this.getTilt(),jo);this._earth.setHeading(this.getHeading(),jo)}else{if(this.preMapType===BMAP_EARTH_MAP&&this._earth){var jm=this._earth;var jj=jm.getMapZoom();var jk=jm._imageRawZoom||jj;var i=jk-jj;var e=jm.getCenter();if(this._renderType==="webgl"){this._tilt=jm.getTilt();if(this.zoomLevel>7){this._heading=jm.getHeading();jn&&jn(e,jj);return}if(jm.getHeading()!==0){jm.setTilt(this.getTilt());jm.setHeading(this.getHeading(),{callback:function(){jn&&jn(e,jj)}})}else{jn&&jn(e,jj)}return}if(i<0.1&&jm.getTilt()===0&&jm.getHeading()===0){jn&&jn(e,jj);return}jm.setTilt(0);jm.setHeading(0);jm.setZoom(jm.getZoom()-i,{callback:function(){jn&&jn(e,jj)}})}}},_proxyEarthEvents:function(){var jk=this;var jl=this._earth;jl.on("tilesload",function(i){jk.fire(i)});jl.on("centerandzoom",function(i){jk.dispatchEvent(new ff("onmoveend"));jk.dispatchEvent(new ff("onzoomend"))});function jj(i){jk.fire(i)}var e=["zoomstart","zoomend","tilesload","sunlighttime_change","sunlighttime_clear","centerandzoom","animation_start","animation_stop","movestart","moveend","moving","dragstart","dragend","dragging"];for(var T=0;T<e.length;T++){jl.on(e[T],jj)}},forceEnableEarth:function(){this.config.forceEnableEarth=true;this.config.enableEarth=cL.ifEnableEarth(true);this.dispatchEvent(new ff("forceenableearth"));return this.config.enableEarth},setLock:function(e){if(this.mapType===BMAP_EARTH_MAP){this._earth.setLock(e)}this._lock=e},getLock:function(){if(this.mapType===BMAP_EARTH_MAP){return this._earth.getLock()}return this._lock},getEarth:function(){return this._earth},isSupportEarth:function(){return this.config.enableEarth},isCanvasMap:function(){return !!(this._renderType==="canvas"&&this.getMapType()!=="B_EARTH_MAP")},getCanvasMapCoordByUid:function(jk){if(this._renderType==="webgl"){var jl=this.tileMgr.tileLayers;for(var jj=0;jj<jl.length;jj++){if(jl[jj].labelProcessor){return jl[jj].labelProcessor.getLabelByUid(jk,"")}}return null}var e=this.canvas2dMapMgr._labelClick;var T=e.findLabelByUid(jk);return T?new cg(T.iconPos.geoX,T.iconPos.geoY):null},loadBizData:function(i){var e=new ff("onloadbizdata");e.data=i;this.dispatchEvent(e)},unloadBizData:function(){var e=new ff("onunloadbizdata");this.dispatchEvent(e)},zoomIn:function(e){this.setZoomIn(this.zoomLevel+1,{zoomCenter:e})},zoomOut:function(e){this.setZoomIn(this.zoomLevel-1,{zoomCenter:e})},setMaxZoom:function(e){if(this._renderType==="webgl"){this.config.maxZoom=e<=21?e:21}else{this.config.maxZoom=e<=19?e:19}},setMinZoom:function(e){this.config.minZoom=e>=3?e:3},setCenterIn:function(e,i){this.panToIn(e,i)},getRenderType:function(){return this._renderType},getSolarInfo:function(jj){jj=jj||this._initDate;var T=e6(jj);var e=il.convertLL2MC(new cg(T[0],T[1]));var jr=e.latLng;var jm=bp.Projection.convertMC2LL(this.centerPoint);var jo=jj.getUTCHours();var jq=jo+24*jm.lng/360;var jp=jq-12;var jn=jp*60*0.25;var jl=Math.asin(Math.sin(hR(jm.lat))*Math.sin(hR(jr.lat))+Math.cos(hR(jm.lat))*Math.cos(hR(jr.lat))*Math.cos(hR(jn)));var jk=Math.asin(Math.sin(hR(jn))*Math.cos(hR(jr.lat))/Math.cos(jl));var i="north";if(jm.lat<jr.lat){i="south"}return{zenith:e,solarAltitude:jl,solarAzimuth:jk,centerPosition:i,position:e}},setDisplayOptions:function(T){if(!T){return}for(var e in this._displayOptions){if(this._displayOptions.hasOwnProperty(e)){if(typeof T[e]==="boolean"||(e==="skyColors"&&typeof T.skyColors==="object")||(e==="labelMargin"&&typeof T.labelMargin==="number")){this._displayOptions[e]=T[e]}}}var i=this.getMapType();if(i===e0.NORMAL){this.fire(new ff("ondisplayoptions_changed"))}else{if(i===e0.EARTH&&this._earth){this._earth.fire(new ff("ondisplayoptions_changed"))}}},getHorizonPosY:function(e){if(!e||!this._webglMapCamera){return null}var i=this._webglMapCamera.fromMCToScreenPixel(e.lng,e.lat,{heading:0});return i.y},getIndoorInfo:function(){if(!this._indoorMgr){return}return this._indoorMgr.getData()},showIndoor:function(e,T){var i=new ff("onindoor_status_changed");i.uid=e;i.floor=T;this.fire(i)},addAreaSpot:function(e,T){if(!e||e.length===0){return}T=T||{};this.areaSpots=this.areaSpots||{};var i=T.id||("sp"+(this.temp.spotsGuid++));this.areaSpots[i]={spot:e,userData:T.userData};var jj=this;gs.load("hotspot",function(){jj._asyncRegister()});return i},getAreaSpot:function(e){if(this.areaSpots&&this.areaSpots[e]){return this.areaSpots[e]}return null},removeAreaSpot:function(e){if(!e||!this.areaSpots[e]){return}delete this.areaSpots[e]},clearAreaSpots:function(){this.areaSpots={}},resetSpotStatus:function(){this.fire(new ff("onspot_status_reset"))},hightlightSpotByUid:function(e,T){var i=new ff("onspot_highlight");i.uid=e;i.tilePosStr=T;this.fire(i)},setZoomIn:function(i,e){e=e||{};this.zoomTo(i,e.zoomCenter||null,e)},restrictBounds:function(e){if(e instanceof hk){this.config.restrictBounds=e;this.restrictCenter(this.getCenterIn());this.fire(new ff("oncenter_changed"))}},getCurrentMaxTilt:function(){var e=this.zoomLevel;if(this.mapType==="B_EARTH_MAP"){return g5.MAX_DRAG_TILT_L2}if(this.config.restrictCenter===false){return g5.MAX_DRAG_TILT}if(e>=19){return g5.MAX_DRAG_TILT}else{if(e<=18){if(e<this._enableTiltZoom){if(e>=this._enableTiltZoom-2){return(1-(this._enableTiltZoom-e)/2)*g5.MAX_DRAG_TILT_L2}return 0}return g5.MAX_DRAG_TILT_L2}else{return(g5.MAX_DRAG_TILT-g5.MAX_DRAG_TILT_L2)*(e-18)+g5.MAX_DRAG_TILT_L2}}},worldSize:function(i){var e=i||this.zoomLevel;return g5.WORLD_SIZE_MC/this.getZoomUnits(e)},setTrafficOn:function(e){if(e&&Number(e)>1){iM.setZIndex(Number(e))}this.addTileLayer(iM)},setTrafficOff:function(){this.removeTileLayer(iM)},showOverlayContainer:function(){this.setDisplayOptions({overlay:true})},hideOverlayContainer:function(){this.setDisplayOptions({overlay:false})},addLabelsToMapTile:function(T){for(var e=0;e<T.length;e++){if(typeof T[e].type==="undefined"){T[e].type="fixed"}if(typeof T[e].rank!=="number"){T[e].rank=50000}T[e].pt=T[e].position;T[e].custom=true;T[e].processedInZoom=0;this._customTileLabels.push(T[e])}this.dispatchEvent(new ff("onadd_tile_labels"))},removeLabelsFromMapTile:function(T){for(var jj=0;jj<T.length;jj++){for(var e=0;e<this._customTileLabels.length;e++){if(this._customTileLabels[e].uid===T[jj]){this._customTileLabels.splice(e,1)}}}this.dispatchEvent(new ff("onremove_tile_labels"))},clearLabels:function(){this._customTileLabels.length=0;this.dispatchEvent(new ff("onclear_labels"))},loadMapStyleFiles:function(jl,e){this.customLoaded=false;var T=this.config.style;var jk=this.config.styleUrl;var jj=this;this._setTextRenderType();if(typeof T==="string"&&!jk){if(bp["FeatureStyle"+T]){this.customLoaded=true;jj.fire(new ff("onstyle_loaded"));jl();return}bp["FeatureStyle"+T]=window.FeatureStyle;bp["iconSetInfo"+T]=window.iconSetInfo_high;bp.indoorStyle=window.indoorStyle;gf.load(w.getMapStyleFiles(T),function(){if(jj.config.style===T){bp["FeatureStyle"+T]=window.FeatureStyle;bp["iconSetInfo"+T]=window.iconSetInfo_high;bp.indoorStyle=window.indoorStyle;jj.customLoaded=true;jj.fire(new ff("onstyle_loaded"));jl()}})}else{var i=T;t.init(jj);t.getStyleJson(i,function(jn){var js=eo;var ju=bp.getGUID("custom");jj.config.mapStyleId=ju;var jq={};ey.extend(jq,jn);var jo=Math.floor(jj.getZoom());var jr;window["styleCbk_"+ju]=function(jv,jw){if(jw!==jr){return}if(typeof jv==="string"){jv=JSON.parse(jv)}t.onStyleDataBack(jv,jo,ju,jq,js,bp["customStyleInfo_"+ju]);jj.customLoaded=true;jj.fire(new ff("onstyle_loaded"));jl()};bp["customStyleInfo_"+ju]={zoomRegion:{},zoomStyleBody:[],zoomFrontStyle:{}};var jt=t.getStyleUrl(jn,js,"styleCbk_"+ju,jo,e,bp["customStyleInfo_"+ju]);var jm=jt.split("?")[0];jr=jt.split("?")[1];if(jk){jm=jk;jr=jm.split("?")[1]}if(!bp.iconSetInfoCustom){var jp=w.getMapStyleFiles("default");jp.splice(1,1);gf.load(jp,function(){bp.iconSetInfoCustom=window.iconSetInfo_high;bp.indoorStyle=window.indoorStyle;if(jm.indexOf("jsonp")>"-1"){gf.load(jm)}else{bp["customStyleInfo_"+ju].xhr=hr.post(jm,jr,window["styleCbk_"+ju])}})}else{if(jm.indexOf("jsonp")>"-1"){gf.load(jm)}else{bp["customStyleInfo_"+ju].xhr=hr.post(jm,jr,window["styleCbk_"+ju])}}})}},getFeatureStyleTags:function(){var e=[];var jk=Object.keys(bp);for(var jj=0;jj<jk.length;jj++){var T=jk[jj];if(T.indexOf("FeatureStyle")>-1&&bp[T]){e.push(T)}}return e},setCopyrightOffset:function(jj,i){var T=new ff("oncopyrightoffsetchange",{logo:jj,cpy:i});this.dispatchEvent(T)},_setTextRenderType:function(e){if(e){this.config.textRenderType=e;return}if(this.config.textRenderType!==null){return}if(bK()){this.config.textRenderType="canvas"}else{if(typeof this.config.style==="string"){this.config.textRenderType="image"}else{this.config.textRenderType="canvas"}}},destroy:function(){this._destroyed=true;this.fire(new ff("ondestroy"))},centerAndZoom:function(e,jm,T){if(Object.prototype.toString.call(jm)!=="[object Undefined]"){jm=parseInt(jm,10)}if(typeof e==="string"){var jj=this;var jl=new a7();jl.getPoint(e,function(jn){e=jn;var jo=il.convertLL2MC(e);jj.centerAndZoomIn(jo,jm,T)})}else{if(this.config.coordType===BMAP_COORD_GCJ02){var jk=hK(e,3);var i=il.convertLL2MC(jk)}else{var i=il.convertLL2MC(e)}this.centerAndZoomIn(i,jm,T)}},pointToPixel:function(e,T){var i=il.convertLL2MC(e);var jj={};ey.extend(jj,T);if(jj&&jj.center){jj.center=il.convertLL2MC(jj.center)}return this.pointToPixelIn(i,jj)},pixelToPoint:function(T,i){var jj={};ey.extend(jj,i);if(jj&&jj.center){jj.center=il.convertLL2MC(jj.center)}var e=this.pixelToPointIn(T,jj);return il.convertMC2LL(e)},pointToOverlayPixel:function(e,T){var i=il.convertLL2MC(e);var jj={};ey.extend(jj,T);if(jj&&jj.center){jj.center=il.convertLL2MC(jj.center)}return this.pointToOverlayPixelIn(i,jj)},overlayPixelToPoint:function(T,i){var jj={};ey.extend(jj,i);if(jj&&jj.center){jj.center=il.convertLL2MC(jj.center)}var e=this.overlayPixelToPointIn(T,jj);return il.convertMC2LL(e)},setViewport:function(T,jj){var e;if(T&&T.center){e={};ey.extend(e,T);e.center=il.convertLL2MC(e.center)}else{e=[];for(var jk=0;jk<T.length;jk++){e[jk]=il.convertLL2MC(T[jk])}}this.setViewportIn(e,jj)},getViewport:function(jl,jj){var T;if(jl&&jl.length){T=[];for(var jk=0;jk<jl.length;jk++){T[jk]=il.convertLL2MC(jl[jk])}}else{if(jl instanceof hk){T=new hk(il.convertLL2MC(jl.getSouthWest()),il.convertLL2MC(jl.getNorthEast()));T.setMinMax()}}var e=this.getViewportIn(T,jj);e.center=il.convertMC2LL(e.center);return e},getDistance:function(jk,T){var i=il.convertLL2MC(jk);var jj=il.convertLL2MC(T);var e=this.getDistanceIn(i,jj);return e},setCenter:function(e,T){if(typeof e==="string"){var jj=this;var jl=new a7();jl.getPoint(e,function(jm){e=jm;var jn=il.convertLL2MC(e);jj.setCenterIn(jn,T)})}else{if(this.config.coordType===BMAP_COORD_GCJ02){var jk=hK(e,3);var i=il.convertLL2MC(jk)}else{var i=il.convertLL2MC(e)}this.setCenterIn(i,T)}},setZoom:function(T,e){var i={};ey.extend(i,e);if(i&&i.zoomCenter){i.zoomCenter=il.convertLL2MC(i.zoomCenter)}this.setZoomIn(T,i)},flyTo:function(e,jk,T){if(this.config.coordType===BMAP_COORD_GCJ02){var jj=hK(e,3);var i=il.convertLL2MC(jj)}else{var i=il.convertLL2MC(e)}this.flyToIn(i,jk,T)},panTo:function(e,T){var i=il.convertLL2MC(e);this.panToIn(i,T)},getCenter:function(){var e=this.getCenterIn();if(this.config.coordType===BMAP_COORD_GCJ02){var i=il.convertMC2LL(e);return ei(i)}return il.convertMC2LL(e)},getBounds:function(){var e=this.getBoundsIn();var i=new hk(il.convertMC2LL(e.getSouthWest()),il.convertMC2LL(e.getNorthEast()));return i},setMapStyleV2:function(e){if(typeof e==="string"){this._setTextRenderType("image")}else{this._setTextRenderType("canvas")}this.setOptions({style:e})},startViewAnimation:function(T){var e=T._options.delay;var i=this;setTimeout(function(){T._start(i)},e)},pauseViewAnimation:function(e){e._pause(this)},continueViewAnimation:function(e){e._continue(this)},cancelViewAnimation:function(e){e._cancel(this)},getMapScreenshot:function(){return this._webglMapScene._painter._canvas.toDataURL()}});window.BMAP_NORMAL_MAP="B_NORMAL_MAP";window.BMAPGL_NORMAL_MAP="B_NORMAL_MAP";window.BMAP_SATELLITE_MAP="B_SATELLITE_MAP";window.BMAP_HYBRID_MAP="B_STREET_MAP";window.BMAP_EARTH_MAP="B_EARTH_MAP";window.BMAP_NONE_MAP="B_NONE_MAP";window.BMAP_COORD_MERCATOR=1;window.BMAP_COORD_GCJ02=2;window.BMAP_SYS_DRAWER=0;window.BMAP_SVG_DRAWER=1;window.BMAP_VML_DRAWER=2;window.BMAP_CANVAS_DRAWER=3;var t={environment:"jsapi",map:null,ontilesloaded:false,onstyle_loaded:false,init:function(i){var e=this;e.map=i;this.changeCopyright();this.setEnvironment(e.map.config.style);this.resetEventListener()},resetEventListener:function(){var e=this;this.ontilesloaded=false;this.onstyle_loaded=false;e.map.addEventListener("ontilesloaded",e.checkLoadedStatus);e.map.addEventListener("onstyle_loaded",e.checkLoadedStatus)},checkLoadedStatus:function(i){t[i.type]=true;if(t.ontilesloaded&&t.onstyle_loaded){this.dispatchEvent(new ff("onstylechangetilesloaded"));this.removeEventListener("ontilesloaded",t.checkLoadedStatus);this.removeEventListener("onstyle_loaded",t.checkLoadedStatus)}},changeCopyright:function(){var e=this;if(e.map.cpyCtrl){e.map.cpyCtrl.hide();if(e.environment!=="customEditor"){e.map.setCopyrightOffset(new id(1,1))}}else{e.map.addEventListener("oncopyrightaddend",function(){e.map.cpyCtrl.hide();if(e.environment!=="customEditor"){e.map.setCopyrightOffset(new id(1,1))}})}},setEnvironment:function(e){if(e.customEditor){this.environment="customEditor";aO.map=this.map}else{if(e.sharing){this.environment="sharing"}else{if(e.preview){this.environment="preview"}else{this.environment="jsapi"}}}},getStyleJson:function(jj,jl){var jk=this;if(jj.styleJson){jl&&jl(jj.styleJson)}else{if(jj.styleId){var i=jj.styleId;var e=(Math.random()*100000).toFixed(0);bp["_cbk_si_phpui"+e]=function(jn){var jm=[];if(jn.result&&jn.result["error"]===0&&jn.content&&jn.content["status"]===0){jm=jk.parseJson(jn.content["data"]["json"]);jl&&jl(jm)}else{jl&&jl("default")}};bp["_cbk_si_api"+e]=function(jn){var jm=[];if(jn.status===0){if(jn.info){jm=jk.parseJson(jn.info["json"])}else{jm=jk.parseJson(jn.data["json"])}jl&&jl(jm)}else{jl&&jl("default")}};var T="";switch(this.environment){case"jsapi":T=d6.apiHost+"/?qt=custom_map&v=3.0&style_id="+i+"&type=publish&ak="+eo;T+="&callback="+e2+"._cbk_si_phpui"+e;break;case"sharing":T+="/apiconsole/custommap/getSharingJson";T+="?styleid="+i+"&type=edit";T+="&ck="+e2+"._cbk_si_api"+e;break;case"preview":T+="/apiconsole/custommap/getJson";T+="?styleid="+i+"&type=edit";T+="&ck="+e2+"._cbk_si_api"+e;break}gf.load(T)}else{jl&&jl("default")}}},parseJson:function(T){if(T===null||T===""){return[]}var i={t:"featureType",e:"elementType",v:"visibility",c:"color",o:"opacity",l:"lightness",s:"saturation",w:"weight",z:"level",h:"hue",f:"fontsize",zri:"curZoomRegionId",zr:"curZoomRegion"};var jk={all:"all",g:"geometry","g.f":"geometry.fill","g.s":"geometry.stroke",l:"labels","l.t.f":"labels.text.fill","l.t.s":"labels.text.stroke","l.t":"labels.text","l.i":"labels.icon","g.tf":"geometry.topfill","g.sf":"geometry.sidefill"};var jj=T.split(",");var e=jj.map(function(jo){var jn=jo.split("|").map(function(ju){var js=i[ju.split(":")[0]];var jr=(jk[ju.split(":")[1]]?jk[ju.split(":")[1]]:ju.split(":")[1]);switch(jr){case"poi":jr="poilabel";break;case"districtlabel":jr="districtlabel";break}var jt={};jt[js]=jr;return jt});var jl=jn[0];var jq=1;if(jn[1]["elementType"]){jq=2;ey.extend(jl,jn[1])}var jp={};for(var jm=jq;jm<jn.length;jm++){ey.extend(jp,jn[jm])}return ey.extend(jl,{stylers:jp})});return e},getStyleUrl:function(i,jm,jk,T,jj,jo){this.styleJson=i;var e=w.apiHost+"/custom/v2/mapstyle?version="+4+"&ak="+jm+"&qt=custom_v2&is_all=true&is_new=1&";var jn=this.styleJson2styleStringV2(i,T,jo);e+="styles="+encodeURIComponent(jn);if(jj&&jj.os&&jj.sv){e+="&os="+jj.os+"&sv="+jj.sv}var jl=new Date()["getTime"]();e+="&timeStamp="+jl;e+=iz()(e);return e},styleJson2styleStringV2:function(e,jr,jn){var js={featureType:"t",elementType:"e",visibility:"v",color:"c",opacity:"o",lightness:"l",saturation:"s",weight:"w",level:"z",hue:"h",fontsize:"f"};var jt={all:"all",geometry:"g","geometry.fill":"g.f","geometry.stroke":"g.s",labels:"l","labels.text.fill":"l.t.f","labels.text.stroke":"l.t.s","labels.text":"l.t","labels.icon":"l.i","geometry.topfill":"g.tf","geometry.sidefill":"g.sf"};var ju=[];for(var jj=this.map.getMinZoom();jj<=this.map.getMaxZoom();jj++){jn.zoomFrontStyle[jj]={}}jn.zoomFrontStyle.main={};var T=false;for(var jj=0;!!e[jj];jj++){var jq=e[jj];if(this.isOnlyZoomStyler(jq)){continue}jr=this.getFrontZoom(jq,jr);if((jq.featureType==="land"||jq.featureType==="all"||jq.featureType==="background")&&typeof jq.elementType==="string"&&(jq.elementType==="geometry"||jq.elementType==="geometry.fill"||jq.elementType==="all")&&jq.stylers&&!T){if(jq.stylers["color"]){jn.bmapLandColor=jq.stylers["color"]}if(jq.stylers["opacity"]){jn.bmapLandColor=jq.stylers["opacity"]}if(jq.stylers["visibility"]&&jq.stylers["visibility"]==="off"){jn.bmapLandColor="#00000000"}if(jq.featureType==="land"){T=true}}if(jq.featureType==="building"&&typeof jq.elementType==="string"&&jq.elementType==="geometry.fill"){jn.buildingFill=true}if(jq.featureType==="roadarrow"&&jq.elementType==="labels.icon"&&jq.stylers){var jo=jq.stylers["visibility"];jn.zoomFrontStyle[jr]["bmapRoadarrowVisibility"]=jo}var jk={};ey.extend(jk,jq);var jm=jk.stylers;delete jk.stylers;ey.extend(jk,jm);var jl=[];for(var jp in js){if(jk[jp]){if(this.isEditorZoomKeys(jp)){continue}if(jp==="elementType"){jl.push(js[jp]+":"+jt[jk[jp]])}else{switch(jk[jp]){case"poilabel":jk[jp]="poi";break;case"districtlabel":jk[jp]="label";break}jl.push(js[jp]+":"+jk[jp])}}}if(jl.length>2){ju.push(jl.join("|"))}}return ju.join(",")},getFrontZoom:function(i,e){var T=i.stylers["level"];if(T===undefined){return"main"}else{return parseInt(T,10)}},isZoomConfig:function(e){var i=e.stylers["level"];if(i===undefined){return false}else{return true}},isOnlyZoomStyler:function(e){var i={};ey.extend(i,e.stylers);delete i.curZoomRegionId;delete i.curZoomRegion;delete i.level;if(ey.isEmptyObject(i)){return true}else{return false}},isSelectZoom:function(i,e){var T=i.stylers["level"];if(T===undefined){return true}else{if(T===e+""){return true}else{return false}}},isEditorZoomKeys:function(e){var i={curZoomRegionId:true,curZoomRegion:true};if(i[e]){return true}else{return false}},getZoomRegion:function(e,i){var jj=e.stylers["level"];var T={};ey.extend(T,i);if(jj===undefined){return T}else{T[parseInt(jj,10)]=true;return T}},onStyleDataBack:function(jk,e,i,jj,jm,T){if(jk.status!==0){return}if(jk.data.style.length===3){if(!T.baseFs){T.baseFs=jk.data.style}bp.StyleBody=jk.data.style[2]}else{bp.StyleBody=jk.data.style}var jl=T.baseFs;bp["FeatureStyle"+i]=jl;this.updateFrontFeatureStyle(T)},updateFrontFeatureStyle:function(T){if(T.zoomFrontStyle.main["bmapRoadarrowVisibility"]){for(var e=this.map.getMinZoom();e<=this.map.getMaxZoom();e++){if(!T.zoomFrontStyle[e]["bmapRoadarrowVisibility"]){T.zoomFrontStyle[e]["bmapRoadarrowVisibility"]=T.zoomFrontStyle.main["bmapRoadarrowVisibility"]}}}}};var aO={map:null,labelCache:{},calcDrawMc:function(T,i,e){var jj=[];switch(i){case"fill":jj=this.calcFill(T,e);break;case"line":break;case"building3d":jj=this.calcBuilding3d(T,e);break}return jj},calcFill:function(jk,T){var jl=[];for(var jj=0;jj<jk.length;jj=jj+5){var e=this.coordToMc({x:jk[jj],y:jk[jj+1]},T.row,T.col,T.mercatorSize,T.baseTileSize);jl.push(e[0],e[1])}return jl},calcLine:function(jk,T){var jl=[];var jm=new Int16Array(jk.buffer);for(var jj=0;jj<jm.length;jj=jj+10){var e=this.coordToMc({x:jm[jj]/10,y:jm[jj+1]/10},T.row,T.col,T.mercatorSize,T.baseTileSize);jl.push(e[0],e[1])}return jl},calcBuilding3d:function(jl,T){var jm=[];var jj={};for(var jk=0;jk<jl.length/2;jk=jk+7){if(jl[jk]===jl[jk-7]&&jl[jk+1]===jl[jk-6]){continue}if(jj[jl[jk].toString()+jl[jk+1].toString()]){continue}jj[jl[jk].toString()+jl[jk+1].toString()]=true;var e=this.coordToMc({x:jl[jk],y:jl[jk+1]},T.row,T.col,T.mercatorSize,T.baseTileSize);jm.push(e[0],e[1])}return jm},coordToMc:function(jk,jj,e,i,T){return[jk.x*(i/T)+e*i,jk.y*(i/T)+jj*i]},addDrawIntoAreaSpots:function(e,jk){if(t.environment!=="customEditor"){return}if(!jk.styleIds){return}for(var T=0;T<jk.styleIds.length;T++){var jn=0;if(T>0){jn=jk.verticesLength[T-1]}end=jk.verticesLength[T];var jl=[];var jj="";if(jk.vertex){jl=jk.vertex;jj="building3d"}else{if(jk.data[0]){jl=jk.data[0];jj=jk.type}else{continue}}var jm=this.calcDrawMc(jl.slice(jn,end),jj,e);this.map.addAreaSpot(jm,{userData:{styleId:jk.styleIds[T],type:"mapstyle"}})}},addLabelIntoAreaSpots:function(e){if(t.environment!=="customEditor"){return}for(var jk=0;jk<e.length;jk++){var jl=e[jk];for(var jj=0;jj<jl.fixedLabel.length;jj++){var T=jl.fixedLabel[jj];if(!T._mcBds){continue}var jm=[T._mcBds[0].lng,T._mcBds[0].lat,T._mcBds[0].lng,T._mcBds[1].lat,T._mcBds[1].lng,T._mcBds[1].lat,T._mcBds[1].lng,T._mcBds[0].lat];if(!this.labelCache[jm.join()]){this.labelCache[jm.join()]=true;this.map.addAreaSpot(jm,{userData:{styleId:T.styleId,type:"mapstyle",name:T.name}})}}}}};function b6(i,e,jj,T){this.cx=3*i;this.bx=3*(jj-i)-this.cx;this.ax=1-this.cx-this.bx;this.cy=3*e;this.by=3*(T-e)-this.cy;this.ay=1-this.cy-this.by;this.p1x=i;this.p1y=T;this.p2x=jj;this.p2y=T}b6.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e};b6.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e};b6.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx};b6.prototype.solveCurveX=function(e,jo){if(typeof jo==="undefined"){jo=0.000001}var jn;var jm;var jk;var T;var jj;for(jk=e,jj=0;jj<8;jj++){T=this.sampleCurveX(jk)-e;if(Math.abs(T)<jo){return jk}var jl=this.sampleCurveDerivativeX(jk);if(Math.abs(jl)<0.000001){break}jk=jk-T/jl}jn=0;jm=1;jk=e;if(jk<jn){return jn}if(jk>jm){return jm}while(jn<jm){T=this.sampleCurveX(jk);if(Math.abs(T-e)<jo){return jk}if(e>T){jn=jk}else{jm=jk}jk=(jm-jn)*0.5+jn}return jk};b6.prototype.solve=function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))};var f3={};function e8(T){var e={duration:1000,fps:30,delay:0,transition:f3.linear,dropLastAnimation:false};if(T){for(var jj in T){e[jj]=T[jj]}}if(T.beginTime){this._beginTime=T.beginTime}this._callbacks=[];this._options=e;if(e.delay){var jk=this;setTimeout(function(){jk._doStart()},e.delay)}else{this._doStart()}this._pauseTime=0}e8.INFINITE="INFINITE";e8.prototype._doStart=function(){if(this._isPausing){var e=performance.now()||new Date().getTime();this._pauseTime+=e-this._isPausing;this._isPausing=undefined}if(window.requestAnimationFrame){var i=this;i._timer=window.requestAnimationFrame(function(T){i._loop(T)})}else{this._beginTime=new Date().getTime();if(this._options.duration===e8.INFINITE){this._endTime=null}else{this._endTime=this._beginTime+this._options.duration}this._loop()}};e8.prototype._loop=function(jj){var jm=this;jj=jj||new Date().getTime();jj=jj-this._pauseTime;if(!this._beginTime){this._beginTime=jj}if(!this._endTime&&typeof this._options.duration==="number"){this._endTime=this._beginTime+this._options.duration}if(jm._endTime!==null&&jj>=jm._endTime){if(jm._options.dropLastAnimation===false){jm._options.render(jm._options.transition(1),1,jj)}if(typeof jm._options.finish==="function"){jm._options.finish(jj,this)}for(var jl=0,e=jm._callbacks.length;jl<e;jl++){jm._callbacks[jl]()}return}var jk;if(typeof jm._options.duration==="number"){jk=(jj-jm._beginTime)/jm._options.duration;jm.schedule=jm._options.transition(jk)}else{jk=jj-jm._beginTime;jm.schedule=0}jm._options.render(jm.schedule,jk,jj);if(!jm.terminative){if(window.requestAnimationFrame){jm._timer=requestAnimationFrame(function T(i){jm._loop(i)})}else{jm._timer=setTimeout(function(){jm._loop()},1000/jm._options.fps)}}};e8.prototype.stop=function(i,e){this.terminative=true;if(this._timer){if(window.cancelAnimationFrame){cancelAnimationFrame(this._timer)}else{clearTimeout(this._timer)}this._timer=null;if(typeof this._options.onStop==="function"){this._options.onStop(e)}}if(i){this._endTime=this._beginTime;this._loop()}};e8.prototype.pause=function(){if(!this._isPausing){this.stop();this.terminative=undefined;this._isPausing=performance.now()||new Date().getTime()}};e8.prototype.cancel=function(){this.stop()};e8.prototype.append=function(e){this._callbacks.push(e);return this};f3={_p1:1,_p2:1*1.525,linear:function(e){return e},reverse:function(e){return 1-e},easeInQuad:function(e){return e*e},easeInCubic:function(e){return Math.pow(e,3)},easeInBiquad:function(e){return Math.pow(e,4)},easeInBack:function(e){return e*e*((f3._p1+1)*e-f3._p1)},easeOutQuad:function(e){return -(e*(e-2))},easeOutCubic:function(e){return Math.pow((e-1),3)+1},easeOutBiquad:function(e){return 1-Math.pow((e-1),4)},easeOutBack:function(e){return((e=e-1)*e*((f3._p1+1)*e+f3._p1)+1)},easeInOutQuad:function(e){if(e<0.5){return e*e*2}else{return -2*(e-2)*e-1}},easeInOutCubic:function(e){if(e<0.5){return Math.pow(e,3)*4}else{return Math.pow(e-1,3)*4+1}},easeInOutBiquad:function(e){if(e<0.5){return Math.pow(e,4)*8}else{return 1-(Math.pow(e-1,4)*8)}},easeInOutSine:function(e){return(1-Math.cos(Math.PI*e))/2}};f3.ease=(function(){var e=new b6(0.4,0,0.6,1);return function(i){return e.solve(i)}})();f3["ease-in"]=f3.easeInQuad;f3["ease-out"]=f3.easeOutQuad;var c2={start:function(jp){var jj=jp.el;var e=jp.style;var i=jp.startValue;var jm=jp.endValue;var jk=jp.duration||1400;var jl=jp.transition||f3.linear;var jo=jp.callback;var jn=jm-i;var T=jp.unit||"";return new e8({fps:60,duration:jk,transition:jl,render:function(jq){jj.style[e]=i+jn*jq+T},finish:function(){jo&&jo()}})}};function n(jk,T){cN.call(this);this.keyframes=jk;var e={duration:1000,delay:0,transition:f3.linear,interation:1};if(T){for(var jj in T){e[jj]=T[jj]}}this._options=e}n.inherits(cN,"ViewAnimation");n.prototype._start=function(jl){var T=this;T.map=jl;var jk=new ff("onanimationstart");T.dispatchEvent(jk);this._initStatus(T.map);var jj=this._options.duration;var i=this._options.interation;var jm=this._options.transition;var jn=0;T.poiStatus=T.map._displayOptions.poi;if(T.poiStatus){T.map.setDisplayOptions({poi:false})}T.map.viewAnimationTime=new Date().getTime();this.animation=new e8({duration:jj,transition:jm,start:function(e){},render:function(jo,e){if(jo===0){T._initStatus(T.map)}else{T._setViewByRate(jo)}},finish:function(jp,jo){if(++jn<i||i==="INFINITE"){var jq=new ff("onanimationiterations");T.dispatchEvent(jq);delete jo._beginTime;delete jo._endTime;jo._doStart()}else{var jq=new ff("onanimationend");T.dispatchEvent(jq);delete T.map.viewAnimationTime;T.map.setDisplayOptions({poi:T.poiStatus})}}})};n.prototype._getTotalDuration=function(e,i){if(e===e8.INFINITE){return e8.INFINITE}else{return e*i}};n.prototype._initStatus=function(e){if(this.keyframes[0]){e.setCenter(this.keyframes[0].center,{noAnimation:true});e.setZoom(this.keyframes[0].zoom,{noAnimation:true});e.setTilt(this.keyframes[0].tilt,{noAnimation:true});e.setHeading(this.keyframes[0].heading,{noAnimation:true})}};n.prototype._setViewByRate=function(jj){for(var e=0;e<this.keyframes.length-1;e++){var jk=this.keyframes[e];var T=this.keyframes[e+1];if(jj>=jk.percentage&&jj<T.percentage){this.map.setHeading(this._getHeadingDelta(jk,T,jj),{noAnimation:true});this.map.setTilt(this._getTiltDelta(jk,T,jj),{noAnimation:true});this.map.setCenter(this._getCenterDelta(jk,T,jj),{noAnimation:true});this.map.setZoom(this._getZoomDelta(jk,T,jj),{noAnimation:true})}}};n.prototype._getHeadingDelta=function(T,i,e){var jk=(e-T.percentage)/(i.percentage-T.percentage);var jj=T.heading+(i.heading-T.heading)*jk;return jj};n.prototype._getTiltDelta=function(T,i,e){var jk=(e-T.percentage)/(i.percentage-T.percentage);var jj=T.tilt+(i.tilt-T.tilt)*jk;return jj};n.prototype._getCenterDelta=function(T,i,e){var jk=(e-T.percentage)/(i.percentage-T.percentage);var jj=T.center.add(i.center.sub(T.center).mult(jk));return jj};n.prototype._getZoomDelta=function(jj,T,i){var jk=(i-jj.percentage)/(T.percentage-jj.percentage);var e=jj.zoom+(T.zoom-jj.zoom)*jk;return e};n.prototype._pause=function(e){this.animation.pause()};n.prototype._continue=function(e){this.animation._doStart()};n.prototype._cancel=function(T){T.setDisplayOptions({poi:this.poiStatus});this.animation.cancel();delete T.viewAnimationTime;var i=new ff("onanimationcancel");this.dispatchEvent(i)};var cp=undefined;var e3={is64Bit:function(){if(/Windows/.test(navigator.userAgent)){if(/Win64; x64/.test(navigator.userAgent)){return true}else{if(/WOW64/.test(navigator.userAgent)){return true}else{return false}}}return true},isIOS112:function aX(e){return/11_2/.test(navigator.userAgent)},canUseWebAssembly:function(i){if(cp!==undefined){i&&i(cp);return}if(window.WebAssembly&&this.is64Bit()){if(window.disableWebAssembly===true){cp=false;i&&i(cp)}else{if(!cc()){cp=true;i&&i(cp)}else{if(this.isIOS112()){cp=false;i&&i(cp)}else{var e=new Uint8Array([0,97,115,109,1,0,0,0,1,133,128,128,128,0,1,96,0,1,127,3,130,128,128,128,0,1,0,4,132,128,128,128,0,1,112,0,0,5,131,128,128,128,0,1,0,1,6,129,128,128,128,0,0,7,145,128,128,128,0,2,6,109,101,109,111,114,121,2,0,4,109,97,105,110,0,0,10,138,128,128,128,0,1,132,128,128,128,0,0,65,42,11]);WebAssembly.instantiate(e).then(function(T){cp=true;i&&i(cp)},function(T){cp=false;i&&i(cp)})}}}}else{cp=false;i&&i(cp)}}};var aA={};bp.Utils=aA;function jb(e){return e.style}function hm(i){if(ey.Browser.ie>0){i.unselectable="on";i.selectstart=function(){return false};i.onmousedown=function(T){T.preventDefault();return false}}else{var e=jb(i);e.MozUserSelect="none";e.WebkitUserSelect="none";i.addEventListener("mousedown",function(T){T.preventDefault()},false)}}function aJ(e){return e&&e.parentNode&&e.parentNode.nodeType!==11}function bB(i,e){i.insertAdjacentHTML("beforeEnd",e);return i.lastChild}function fj(T,i){var jj=document.createElement("div");jj.innerHTML=i;var e=jj.childNodes[0];return T.parentNode.insertBefore(e,T)}function ad(i){i=i||window.event;i.stopPropagation?i.stopPropagation():i.cancelBubble=true}function b(i){i=i||window.event;i.preventDefault?i.preventDefault():i.returnValue=false;return false}function gM(i){ad(i);return b(i)}function gj(){var e=document.documentElement;var i=document.body;if(e&&(e.scrollTop||e.scrollLeft)){return[e.scrollTop,e.scrollLeft]}else{if(i){return[i.scrollTop,i.scrollLeft]}else{return[0,0]}}}function hE(jk){if(!jk){return}jk.onload=jk.onerror=null;var T=jk.attributes,jj,e,jl;if(T){e=T.length;for(jj=0;jj<e;jj+=1){jl=T[jj].name;if(typeof jk[jl]==="function"){jk[jl]=null}}}T=jk.children;if(T){e=T.length;for(jj=0;jj<e;jj+=1){hE(jk.children[jj])}}}function fm(i,jm,jl){var jk=jm.lng-jl.lng;var jj=jm.lat-jl.lat;if(jk===0){return Math.abs(i.lng-jm.lng)}if(jj===0){return Math.abs(i.lat-jm.lat)}var T=jj/jk;var e=jm.lat-T*jm.lng;return Math.abs(T*i.lng-i.lat+e)/Math.sqrt(T*T+1)}function b3(i,e){if(!i||!e){return}return Math.round(Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2)))}function d2(i,e){if(!i||!e){return 0}return Math.round(Math.sqrt(Math.pow(i.lng-e.lng,2)+Math.pow(i.lat-e.lat,2)))}function eK(T,i){var e=Math.round((T.x+i.x)/2);var jj=Math.round((T.y+i.y)/2);return new eS(e,jj)}function ix(e,T){var i=[];T=T||function(jk){return jk};for(var jj in e){i.push(jj+"="+T(e[jj]))}return i.join("&")}function bL(T,i,jl){var jm=document.createElement(T);if(jl){jm=document.createElementNS(jl,T)}i=i||{};for(var jj in i){var jk={"for":"htmlFor","class":"cssClass"}[jj]||jj;if(jj==="style"){jm.style.cssText=i[jj];continue}if(jj==="class"){ey.ac(jm,i[jj]);continue}if(jm.setAttribute){jm.setAttribute(jk,i[jj])}else{try{jm[jk]=i[jj]}catch(jm){}}}return jm}function b2(e){if(e.currentStyle){return e.currentStyle}else{if(e.ownerDocument&&e.ownerDocument.defaultView){return e.ownerDocument.defaultView.getComputedStyle(e,null)}}}function bH(e){return typeof e==="function"}function fH(e){return e===void 0}function iK(e,i){return Object.prototype.hasOwnProperty.call(e,i)}function f(jk,jl){if(fH(jk.length)){for(var jj in jk){if(iK(jk,jj)){jl.call(null,jj,jk[jj])}}}else{var T=jk.length;if(T){for(var e=0;e<T;e++){jl.call(null,e,jk[e])}}}}function ak(i,e){if(!e){return i}f(e,function(T,jj){i[T]=jj});return i}var gw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function cZ(jk){var T="";var jr;var jp;var jn="";var jq;var jo;var jm;var jl="";var jj=0;var e=/[^A-Za-z0-9+/=]/g;if(!jk||e.exec(jk)){return jk}jk=jk.replace(/[^A-Za-z0-9+/=]/g,"");do{jq=gw.indexOf(jk.charAt(jj++));jo=gw.indexOf(jk.charAt(jj++));jm=gw.indexOf(jk.charAt(jj++));jl=gw.indexOf(jk.charAt(jj++));jr=(jq<<2)|(jo>>4);jp=((jo&15)<<4)|(jm>>2);jn=((jm&3)<<6)|jl;T=T+String.fromCharCode(jr);if(jm!==64){T=T+String.fromCharCode(jp)}if(jl!==64){T=T+String.fromCharCode(jn)}jr=jp=jn="";jq=jo=jm=jl=""}while(jj<jk.length);return T}function iw(e){return btoa(encodeURIComponent(e))}function ft(e){return decodeURIComponent(atob(e))}(function(e){if(!e.Utils){e.Utils={}}var i=e.Utils;i.format=(function(){function T(jm,jl,jn){var jk=jn[+jl];return typeof(jk)==="function"?jk(jl):jk}function jj(jm,jl,jn){var jp=jl;var jq=[];var jk=jl.split(":");if(jk.length===2){jp=jk[0];jq.push(jk[1])}var jo=typeof(jn[jp]);if(jo==="function"){return jn[jp].apply(undefined,jq)}else{if(jo==="undefined"){return jm}else{return String(jn[jp])}}}return function(jk,jl){var jn=jl.splice?T:jj;var jm=jk.splice?jk.join(""):jk;return jm.replace(/{([a-zA-Z0-9_$:.]+)}/g,function(jp,jo){return jn(jp,jo,jl)})}})();i.ErrorMonitor=function(jj,T,jk){};e3.canUseWebAssembly(function(T){i.canUseWebAssembly=T})})(bp);function bK(){return(cc()||he())}function cc(){var e=navigator.userAgent;if(e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1){return true}return false}function he(){var e=navigator.userAgent;if(e.indexOf("Android")>-1){return true}return false}function hR(e){return e*Math.PI/180}function eJ(e){return e/Math.PI*180}function bt(e,jk){var jj=Math.pow(10,jk);if(typeof e==="number"){return Math.round(e*jj)/jj}for(var T=0;T<e.length;T++){e[T]=bt(e[T],jk)}return e}function bX(T,i,e){if(T<i){T=i}else{if(T>e){T=e}}return T}function dP(e,i){while(e<0){e+=i}return e%i}function ha(i,e){return(i>=0&&e>=0)||(i<0&&e<0)}function G(i){if(i._gl){return i._gl}var e={alpha:true,antialias:false,failIfMajorPerformanceCaveat:false,preserveDrawingBuffer:false,stencil:false};var T=i.getContext("webgl",e)||i.getContext("experimental-webgl",e);i._gl=T;return T}function hP(jj,T){for(var e=0;e<T.length;e++){ey.on(jj,T[e],ad)}}function es(i,T,e){T[e]=i.getUniformLocation(T,e)}function bN(jk,jl,e,T,i){var jj="";switch(i){case"mat4":jk.uniformMatrix4fv(jl[e],false,T);return;case"v3":jj="uniform3fv";break;case"f":jj="uniform1f";break;case"i":jj="uniform1i";break}if(jj===""){throw"error"}jk[jj](jl[e],T)}function gV(jr,e){while(jr<0){jr+=360}jr=jr%360;var jj=e.width;var jq=e.height;var jm=jj;var T=jq;if(jr<90){var i=Math.sin(hR(jr))*jj;var jo=Math.sin(hR(jr))*jq;var jp=Math.cos(hR(jr))*jj;var jl=Math.cos(hR(jr))*jq;var jm=Math.ceil(jp+jo);var T=Math.ceil(i+jl)}else{if(jr<180){var jr=jr-90;var i=Math.sin(hR(jr))*jj;var jo=Math.sin(hR(jr))*jq;var jp=Math.cos(hR(jr))*jj;var jl=Math.cos(hR(jr))*jq;var jm=Math.ceil(i+jl);var T=Math.ceil(jp+jo)}else{if(jr<270){var jr=jr-180;var i=Math.sin(hR(jr))*jj;var jo=Math.sin(hR(jr))*jq;var jp=Math.cos(hR(jr))*jj;var jl=Math.cos(hR(jr))*jq;var jm=Math.ceil(jp+jo);var T=Math.ceil(i+jl)}else{var jr=jr-270;var i=Math.sin(hR(jr))*jj;var jo=Math.sin(hR(jr))*jq;var jp=Math.cos(hR(jr))*jj;var jl=Math.cos(hR(jr))*jq;var jm=Math.ceil(i+jl);var T=Math.ceil(jp+jo)}}}var jn=jm-jj;var jk=T-jq;return[0-jn/2,0-jk/2,jj+jn/2,jq+jk/2]}function bW(e){if(e.toDataURL()===bW._blankData){return true}return false}function P(jk,jj,T){var i=[T.lng-jk.lng,T.lat-jk.lat];var e=[jj.lng-jk.lng,jj.lat-jk.lat];return i[0]*e[1]-i[1]*e[0]}function ib(jl,jk,T){var e;var jm;var jj;var i;if(jl.lng<jk.lng){e=jl.lng;jj=jk.lng}else{e=jk.lng;jj=jl.lng}if(jl.lat<jk.lat){jm=jl.lat;i=jk.lat}else{jm=jk.lat;i=jl.lat}if(T.lng<e||T.lng>jj||T.lat<jm||T.lat>i){return false}return true}function ik(jn,jm,jl,jj){var jk=P(jl,jj,jn);var T=P(jl,jj,jm);var i=P(jn,jm,jl);var e=P(jn,jm,jj);if(jk*T<0&&i*e<0){return true}else{if(jk===0&&ib(jl,jj,jn)){return true}else{if(T===0&&ib(jl,jj,jm)){return true}else{if(i===0&&ib(jn,jm,jl)){return true}else{if(e===0&&ib(jn,jm,jj)){return true}else{return false}}}}}}function gY(T,i){var e=i.parentNode;if(e.lastChild===i){e.appendChild(T)}else{e.insertBefore(T,i.nextSibling)}}function dv(jp,jq){if(jq===0){return jp}var jo=0;var jm=0;if(!jp){throw"异常"}if(jp.length===0){return[]}for(var jk=1,T=jp.length-1;jk<T;jk++){var jn=fm(jp[jk],jp[0],jp[jp.length-1]);if(jn>jo){jm=jk;jo=jn}}var e=[];if(jo>=jq){var js=jp.slice(0,jm);var jr=jp.slice(jm,jp.length);var jl=dv(js,jq);var jj=dv(jr,jq);for(var jk=0,T=jl.length;jk<T;jk++){e.push(jl[jk])}for(var jk=0,T=jj.length;jk<T;jk++){e.push(jj[jk])}}else{e.push(jp[0]);e.push(jp[jp.length-1])}return e}function m(e){if(Math.log2){return Math.log2(e)}return Math.log(e)/Math.LN2}function cS(T,i,e){return Math.min(e,Math.max(i,T))}function aj(e,i){if(!i){return e}var jl=i[0];var jk=i[1];var jj=i[2];var T=i[3];var jn=[];var jm=[];jn[0]=T*e[0]+jj*e[2];jn[1]=e[1];jn[2]=-jj*e[0]+T*e[2];jm[0]=jn[0];jm[1]=jk*jn[1]-jl*jn[2];jm[2]=jl*jn[1]+jk*jn[2];return jm}var k=Math.PI/180;var ge=180/Math.PI;function e6(T){var i=(T-Date.UTC(2000,0,1,12))/86400000/36525;var e=(d3.utcDay.floor(T)-T)/86400000*360-180;return[e-eV(i)*ge,dB(i)*ge]}function eV(jj){var jk=bh(jj);var i=dH(jj);var T=hM(jj);var jl=Math.tan(hL(jj)/2);jl*=jl;return jl*Math.sin(2*T)-2*jk*Math.sin(i)+4*jk*jl*Math.sin(i)*Math.cos(2*T)-0.5*jl*jl*Math.sin(4*T)-1.25*jk*jk*Math.sin(2*i)}function dB(e){return Math.asin(Math.sin(hL(e))*Math.sin(bl(e)))}function bl(e){return i6(e)-(0.00569+0.00478*Math.sin((125.04-1934.136*e)*k))*k}function i6(e){return hM(e)+iq(e)}function dH(e){return(357.52911+e*(35999.05029-0.0001537*e))*k}function hM(i){var e=(280.46646+i*(36000.76983+i*0.0003032))%360;return(e<0?e+360:e)/180*Math.PI}function iq(i){var e=dH(i);return(Math.sin(e)*(1.914602-i*(0.004817+0.000014*i))+Math.sin(e+e)*(0.019993-0.000101*i)+Math.sin(e+e+e)*0.000289)*k}function hL(e){return c8(e)+0.00256*Math.cos((125.04-1934.136*e)*k)*k}function c8(e){return(23+(26+(21.448-e*(46.815+e*(0.00059-e*0.001813)))/60)/60)*k}function bh(e){return 0.016708634-e*(0.000042037+1.267e-7*e)}function fI(){return window.devicePixelRatio||1}function hY(T){var i;var e;var jj;if(T>=0){jj=Math.floor(T/65536)*65536;i=jj;e=T-jj}else{jj=Math.floor(-T/65536)*65536;i=-jj;e=T+jj}return[i,e]}function ck(e){if(e.lng>=0&&e.lat>=0){return new cg(e.lng-10000000,e.lat-6000000)}if(e.lng>=0&&e.lat<0){return new cg(e.lng-10000000,e.lat+6000000)}if(e.lng<0&&e.lat>=0){return new cg(e.lng+10000000,e.lat-6000000)}if(e.lng<0&&e.lat<0){return new cg(e.lng+10000000,e.lat+6000000)}}var hv=null;if(window.performance&&window.performance.now){hv=function(){return performance.now()}}else{if(Date.now){hv=function(){return Date.now()}}else{hv=function(){return(new Date).getTime()}}}function g9(jj,e,i){var T="mouseWheel";if(ey.Platform.macintosh){if(!isNaN(jj)&&(jj<10||jj!==120)&&(e%1===0&&e<5)){T="padScroll"}if(ey.Browser.firefox&&(e%1===0&&e<5&&i===0)){T="padScroll"}}if(ey.Browser.safari&&jj===12){T="mouseWheel"}return T}function bC(js,jn){var jr=js[0];var jq=js[1];var jj=false;for(var jm=0,jl=jn.length-2;jm<jn.length;jm+=2){var jp=jn[jm];var jk=jn[jm+1];var jo=jn[jl];var T=jn[jl+1];var e=((jk>jq)!==(T>jq))&&(jr<(jo-jp)*(jq-jk)/(T-jk)+jp);if(e){jj=!jj}jl=jm}return jj}function am(jk,jm){var e=jm.length;var T=0;var jl=false;for(var jj=0;jj<e;jj++){T=(jj===e-1)?0:T+1;if((jm[jj].lat!==jm[T].lat)&&(((jk.lat>=jm[jj].lat)&&(jk.lat<jm[T].lat))||((jk.lat>=jm[T].lat)&&(jk.lat<jm[jj].lat)))&&(jk.lng<(jm[T].lng-jm[jj].lng)*(jk.lat-jm[jj].lat)/(jm[T].lat-jm[jj].lat)+jm[jj].lng)){jl=!jl}}return jl}function dt(T,e,i,jj){jj=jj||0.4;if(T>i){T=Math.pow(T-i+1,jj)+i-1}else{if(T<e){T=e-Math.pow(e-T+1,jj)+1}}return T}function eu(jn){var jl="";for(var T=0;T<jn.length;T++){var jo=jn.charCodeAt(T)<<1;var e=jo.toString(2);var jk=e.length;var jr=e;if(jk<8){jr="00000000"+e;jr=jr.substr(e.length,8)}jl+=jr}var jp=5-jl.length%5;var jj=[];for(var T=0;T<jp;T++){jj[T]="0"}jl=jj.join("")+jl;var jq=[];for(var T=0;T<jl.length/5;T++){var jo=jl.substr(T*5,5);var jm=parseInt(jo,2)+50;jq.push(String.fromCharCode(jm))}return jq.join("")+jp.toString()}function iY(T,i){var e=bp.TILE_VERSION||window.TILE_VERSION;if(!e||!e[T]||!e[T][i]||!e[T][i].version||!e[T][i].updateDate){e=w.tvc}return{ver:e[T][i].version,udt:e[T][i].updateDate}}function bq(){var e=bp.MSV||window.MSV;if(!e||!e.mapstyle||!e.mapstyle.updateDate||!e.mapstyle.version){e=w.msv}return{ver:e.mapstyle.version,udt:e.mapstyle.updateDate}}function dc(e,jk){var jj=e.slice(0);for(var T=0;T<jj.length;T++){jj[T]+=jk}return jj}var gq=null;function gF(e){if(gq){return}e.fire(new ff("onloadtile"));gq=setTimeout(function(){gq=null},1000)}function aC(){if(y("//map.baidu.com")||y("//maps.baidu.com")||y("//ditu.baidu.com")){return true}return false}aA.inMapHost=aC();if(typeof window._inMapHost==="boolean"){aA.inMapHost=window._inMapHost}function y(i){var T=window.location;var e=document.createElement("a");e.href=i;return e.hostname===T.hostname&&e.port===T.port&&e.protocol===T.protocol}var dA=[72.685732,0.193351,136.10888,54.392257];var ex=[72.6892532,0.1939743381,136.1168614,54.392257];var s=[72.69566833,0.1999420909,136.1232863,54.39791217];var hN=158;var c1=[98.789081,122.948721,107.857301,118.082148,119.126627,128.021934,79.939914,99.021873,119.912937,122.084572,127.906381,130.933385,106.496057,108.066113,119.818772,126.367919,111.789929,119.311401,100.742164,102.220151,99.853589,100.781289,97.522631,98.834615,99.092638,99.892947,122.905967,123.761867,123.716213,125.494726,123.723977,124.755034,125.475833,126.398284,125.471687,126.065118,130.817003,133.605851,127.900156,128.656536,128.646633,129.625389,132.88057,134.104549,117.365548,119.230813,116.073074,117.416898,114.406274,116.123791,116.479038,119.591534,110.566812,111.851324,74.465162,79.993155,82.858046,91.345214,85.71485,98.969834,127.651377,129.532029,129.462275,130.209769,133.716214,134.731053,134.366834,135.103133,130.854579,131.32966,115.499125,117.530421,115.765224,116.734157,108.524336,110.601747,121.351282,124.612037,126.151954,127.332751,91.273562,95.604179,79.87318,82.935667,76.413314,78.336484,78.275229,79.993668,83.956612,85.725267,85.500637,89.346601,97.990127,98.94176,106.641956,108.599215,111.386259,111.810312,111.578597,111.803167,115.99273,117.010413,116.24461,116.675246,119.422198,119.909078,120.646056,121.38098,120.335038,120.662183,124.579855,125.773243,126.207803,126.774849,95.565331,102.037736,95.576121,96.158028,95.556699,97.799055,91.296205,93.348146,93.321994,94.690522,89.339313,90.540241,82.263039,82.882528,78.335615,80.023512,76.623947,78.352608,73.495149,74.48155,74.846872,76.479412,91.560058,94.871116,88.759515,89.235995,83.237883,83.965264,82.292123,83.246813,81.876477,83.253307,80.75212,81.463265,86.463409,88.267232,102.199623,104.225963,112.153727,116.823265,108.965663,113.021145,111.166575,117.972799];var c0=[22.548416,42.276971,17.227969,22.7346,41.292761,50.741667,30.365133,42.324913,21.701924,22.69335,42.4176,48.936335,21.429059,22.648399,50.650499,52.914825,42.20449,45.199078,21.13391,22.568612,21.441033,22.583349,23.73862,25.298628,22.00409,22.563095,38.97849,41.338631,40.287973,41.330108,39.732801,40.343252,40.966852,41.323446,40.719312,41.05937,44.869472,48.009884,41.336325,42.443362,42.008104,42.434713,45.873151,48.205746,45.132322,46.784582,45.133383,46.392803,45.148771,45.740273,47.478161,50.064393,42.216229,43.461282,37.014302,40.662281,42.219985,47.31417,27.726965,30.466651,48.911271,49.642488,48.831706,49.434487,46.941762,48.37425,47.651781,48.463782,42.851964,44.905396,47.598273,48.438467,48.409141,48.901651,42.22756,42.906402,52.821047,53.578094,50.701837,51.654278,42.292419,44.392214,42.295918,45.385017,34.680866,37.027803,30.743515,37.066586,28.245649,30.406053,47.270872,48.497371,25.238932,27.778469,42.215754,42.540416,43.427677,44.689208,44.685587,44.994131,48.878657,49.318659,49.281099,49.624515,50.710468,51.306809,52.90717,53.331981,52.903016,53.107959,52.900867,53.250033,51.638073,52.400678,42.229657,42.691928,43.061242,43.891083,42.663095,43.074222,44.37174,45.180155,44.375135,44.974219,47.3035,48.053221,45.352401,46.807875,40.563053,42.040289,40.581871,41.405172,38.516328,40.178756,35.790476,37.02337,26.825605,27.761303,27.197399,27.74932,29.147561,30.37813,29.570893,30.062042,30.045026,30.380952,29.998038,30.385203,48.487385,49.16832,22.395733,22.598229,7.441114,11.501436,3.767491,9.000793,12.642067,17.406563];var bT=[98.795985,122.960792,107.867379,118.093451,119.139658,128.035888,79.948212,99.029524,119.923388,122.094977,127.918527,130.94789,106.50606,108.076783,119.8329,126.382207,111.803567,119.324928,100.749858,102.227985,99.860885,100.788921,97.529435,98.841564,99.100017,99.90035,122.917416,123.774367,123.728314,125.507211,123.736065,124.767299,125.488463,126.410675,125.484326,126.07764,130.830784,133.620042,127.912178,128.668957,128.658937,129.638599,132.894179,134.119086,117.379378,119.244569,116.086736,117.431212,114.420233,116.137458,116.492775,119.605527,110.579401,111.86488,74.468228,80.001908,82.867432,91.353788,85.721075,98.976964,127.664757,129.546833,129.476893,130.22449,133.730358,134.745235,134.381034,135.1178,130.868117,131.34409,115.513245,117.544751,115.779271,116.748045,108.536254,110.614326,121.365534,124.626434,126.165992,127.347013,91.281869,95.611754,79.879648,82.945041,76.413314,78.345207,78.275229,80.002329,83.956612,85.734098,85.510186,89.356499,97.997001,98.948845,106.653208,108.610811,111.400183,111.824179,111.592224,111.817136,116.00682,117.024631,116.258574,116.689291,119.436876,119.922961,120.659806,121.395479,120.349116,120.676014,124.59389,125.787788,126.221756,126.788962,95.572955,102.046581,95.583772,96.165551,95.564318,97.806095,91.30446,93.356438,93.330319,94.698145,89.349129,90.548677,82.268802,82.892025,78.335615,80.032266,76.625755,78.361413,73.498248,74.490992,74.846872,76.488771,91.563521,94.878444,88.768214,89.244787,83.247076,83.974127,82.29595,83.256003,81.885315,83.26249,80.760619,81.472404,86.470983,88.276988,102.207537,104.234614,112.164795,116.833667,108.965663,113.032246,111.166575,117.983363];var bR=[22.551183,42.284787,17.227969,22.738314,41.300981,50.749638,30.368087,42.332701,21.705055,22.696452,42.426047,48.944674,21.432184,22.651387,50.657409,52.92296,42.212192,45.206905,21.137031,22.57186,21.444502,22.586566,23.741571,25.301472,22.006806,22.56637,38.985114,41.346531,40.295617,41.338581,39.740021,40.351012,40.974644,41.331562,40.726852,41.067192,44.877158,48.018285,41.344597,42.451798,42.016305,42.443235,45.880906,48.214001,45.140027,46.792775,45.141083,46.400433,45.156418,45.748281,47.485889,50.071879,42.223667,43.469487,37.019867,40.668675,42.226823,47.321605,27.72944,30.469853,48.919002,49.650614,48.840188,49.443166,46.949801,48.382798,47.660603,48.472692,42.859946,44.913298,47.605896,48.445914,48.41698,48.909667,42.23507,42.914193,52.8281,53.585952,50.709311,51.662219,42.29968,44.399225,42.302746,45.391958,34.680866,37.03377,30.743515,37.07228,28.245649,30.408935,47.277693,48.504255,25.241528,27.780726,42.223363,42.548418,43.435888,44.696952,44.693193,45.00187,48.886267,49.326755,49.288642,49.632304,50.717486,51.314369,52.914204,53.33964,52.910094,53.115926,52.908382,53.258095,51.64533,52.408305,42.236825,42.699126,43.068466,43.898632,42.670403,43.082219,44.379045,45.187742,44.382336,44.981379,47.310362,48.06019,45.359099,46.814439,40.569751,42.047741,40.587956,41.41263,38.519192,40.185033,35.790476,37.029005,26.825605,27.763896,27.199658,27.751649,29.150192,30.381073,29.573886,30.065162,30.047775,30.384089,30.001277,30.388525,48.494118,49.173841,22.398528,22.601198,7.441114,11.505968,3.767491,9.005209,12.642067,17.410886];var Y=95;var cI=[110.3961374,105.0743788,96.8991824,95.61810411,93.82412598,91.3892353,91.38931858,89.08325955,87.22469808,86.26278402,85.17353,85.23741211,82.86627441,81.90481038,79.59687147,80.39829237,79.93319363,77.80279948,75.2557704,73.49357829,73.1892532,73.87758816,74.4064738,74.10215224,75.46409695,76.77739692,78.28299615,78.15499485,78.37920654,78.89145345,79.69282199,81.19938178,81.80830295,83.89093424,85.94149523,87.86447266,89.03414958,90.05918132,91.10026937,92.15733832,93.74361735,95.82597331,97.95655545,97.12363037,98.2129739,99.2068571,101.6587874,102.5239084,102.2356106,105.0249238,106.0992342,107.8617093,111.6439372,109.591869,112.284586,117.7961157,118.9495128,114.2076584,118.693565,123.1475225,122.730705,120.9361393,123.4207441,122.3787782,122.1385425,121.5904281,121.1773763,120.6805404,120.2483355,122.795807,122.8759077,121.3060262,122.1392177,123.7418799,126.4177599,128.5647409,129.7194884,131.2259136,131.9950494,133.6289931,135.6168614,131.3875545,130.8743365,128.6303223,126.0997773,124.4015375,122.22161,119.6586483,119.7866827,118.5685878,116.5177976,114.819101,119.0812964,116.453265,111.7431171];var cG=[43.2190351,42.38053385,43.17417589,44.42226915,45.09863634,45.56708116,47.33599718,48.68832709,49.62448486,48.9482175,48.4800472,47.33564399,47.43948676,46.03452067,45.20221788,43.34563043,42.32965739,41.39690972,40.82972331,39.95567654,39.25892877,38.36098768,38.05441569,37.16878445,36.38899414,35.36126817,34.30953451,32.58503879,31.56975694,30.77800266,30.43559814,29.7744892,30.0931977,28.71103299,27.70739665,27.5775472,27.01096137,27.77857883,27.50707954,26.50328315,26.70387804,27.95548557,27.29428901,23.64685493,23.62310601,21.67493381,20.77751465,21.32070991,22.1824113,22.31232964,22.51316054,16.80037679,13.19749864,0.6939743381,1.541660428,10.50208252,15.58926975,17.89090007,19.94928467,22.18490153,25.37285292,25.61456434,30.62532552,31.08099284,31.89238173,32.50092692,32.80325765,34.25546956,35.15486138,36.90170139,37.8348272,37.941604,38.6480797,38.96797201,40.98146918,41.25573296,42.07218153,42.49132813,44.65259766,44.69330702,48.62286865,48.09383952,49.19628499,50.03402317,53.27678901,53.62976345,53.89420546,52.98933322,52.01872884,50.23210259,50.18807048,47.49769857,47.34362712,46.50502143,45.24770128];var eg=[98.7895,122.954182,107.860913,118.087007,119.133165,128.029533,79.941749,99.023087,119.916883,122.08841,127.912143,130.941471,106.499502,108.070244,119.826245,126.375818,111.797006,119.318387,100.743285,102.221517,99.854448,100.782445,97.522928,98.835028,99.093518,99.893783,122.910927,123.767769,123.721954,125.50077,123.729657,124.760724,125.481902,126.404079,125.477737,126.071019,130.824331,133.613395,127.905767,128.662524,128.652527,129.6321,132.887552,134.11249,117.37297,119.237999,116.080154,117.424589,114.413586,116.130948,116.486264,119.598927,110.5728,111.858437,74.465162,79.995337,82.860821,91.347291,85.716024,98.970481,127.658331,129.540202,129.470528,130.21808,133.723748,134.738785,134.374555,135.111443,130.861475,131.337438,115.506627,117.538123,115.772783,116.741632,108.529656,110.60782,121.358945,124.619773,126.159424,127.340582,91.275275,95.605228,79.874427,82.938601,76.413314,78.338763,78.275229,79.995765,83.956612,85.727511,85.503554,89.349858,97.990418,98.942257,106.646704,108.604437,111.393667,111.817723,111.585811,111.810645,116.000232,117.018216,116.252108,116.682705,119.430384,119.916417,120.653168,121.38883,120.342727,120.669383,124.587426,125.781376,126.215282,126.782323,95.566367,102.040026,95.577158,96.159009,95.557772,97.799728,91.298032,93.350057,93.323794,94.691771,89.342471,90.542019,82.264229,82.885485,78.335615,80.025844,76.623947,78.355027,73.495149,74.484473,74.846872,76.482208,91.560117,94.871859,88.761692,89.23822,83.240549,83.967602,82.292367,83.2495,81.878825,83.256003,80.75421,81.465955,86.465421,88.270356,102.201019,104.228033,112.158282,116.827153,108.965663,113.025767,111.166575,117.97687];var ef=[22.545421,42.279053,17.226272,22.731982,41.294917,50.743316,30.361986,42.326603,21.699185,22.690751,42.419757,48.938435,21.426505,22.64567,50.651745,52.916705,42.20641,45.201064,21.131326,22.565685,21.438288,22.580379,23.735785,25.295582,22.001087,22.560315,38.979333,41.340757,40.28938,41.332289,39.734164,40.344718,40.968803,41.325813,40.721073,41.061503,44.871533,48.012179,41.338366,42.445601,42.010343,42.436934,45.875217,48.208327,45.134237,46.786509,45.135376,46.394665,45.150734,45.742257,47.480099,50.065931,42.217982,43.46329,37.014057,40.662848,42.221079,47.315558,27.723432,30.46385,48.913298,49.644555,48.83396,49.436824,46.944059,48.376613,47.654503,48.466331,42.854333,44.907682,47.600253,48.440245,48.410926,48.903468,42.229292,42.908294,52.822466,53.58012,50.703491,51.656037,42.29378,44.393379,42.296912,45.385809,34.679282,37.027699,30.740622,37.066377,28.241967,30.403134,47.271949,48.49848,25.235818,27.774976,42.217425,42.542102,43.429763,44.691016,44.687044,44.995758,48.880431,49.320551,49.282865,49.626267,50.711607,51.308382,52.908547,53.333963,52.904419,53.109706,52.902338,53.251938,51.639701,52.402205,42.231045,42.693581,43.062756,43.892771,42.664519,43.075927,44.372942,45.1815,44.376327,44.975476,47.304623,48.054453,45.353174,46.808493,40.563653,42.041556,40.582164,41.4064,38.51618,40.179105,35.789745,37.023144,26.825402,27.757641,27.193806,27.745766,29.144229,30.375186,29.567889,30.059102,30.041938,30.378006,29.995047,30.382338,48.48834,49.169021,22.392816,22.595333,7.439914,11.500161,3.766676,9.000793,12.640512,17.406563];var fe=3000;var gi=0.00002;var gh=0.000003;var h8=0.0174532925194;var g1=0.0065;var g0=0.006;var dk=40000;var e4=0;var ir=1;var ar=2;var ho=3;var eX=4;var gI=1e-10;var hU=6370996.81;var fh=100000000;function gQ(T,jk,i,jj){var e=arguments.length;this.ll={};this.ru={};if(e===0){}else{if(e===4){this.normalize(T,jk,i,jj)}}}gQ.prototype.contains=function(e){if(e.lng>this.ll.lng&&e.lng<this.ru.lng&&e.lat>this.ll.lat&&e.lat<this.ru.lat){return ho}if(Math.abs(e.lng-this.ll.lng)<gI||Math.abs(e.lng-this.ru.lng)<gI||Math.abs(e.lat-this.ll.lat)<gI||Math.abs(e.y-this.ru.lat)>gI){return ar}return e4};gQ.prototype.normalize=function(i,jj,e,T){if(i>e){this.ll.lng=e;this.ru.lng=i}else{this.ll.lng=i;this.ru.lng=e}if(jj>T){this.ll.lat=T;this.ru.lat=jj}else{this.ll.lat=jj;this.ru.lat=T}};function d7(i,jj,e,T){this.sp={lng:i,lat:jj};this.ep={lng:e,lat:T};this.mbr=new gQ(i,jj,e,T)}function hw(jj,e,jl,jk){for(var T=0;T<jk;T=T+2){if(jj.lng>=e[T]&&jj.lng<=e[T+1]&&jj.lat>=jl[T]&&jj.lat<=jl[T+1]){return true}}return false}function fN(jo){var i=jo.lng;var jn=jo.lat;var jj=Math.sqrt(i*i+jn*jn);var jl=Math.atan2(jn,i);var T=jj+fX(jn);var jk=jl+fW(i);var e=T*Math.cos(jk);var jm=T*Math.sin(jk);return{lng:e+g1,lat:jm+g0}}function aR(jo){var i=jo.lng-g1;var jn=jo.lat-g0;var jj=Math.sqrt(i*i+jn*jn);var jl=Math.atan2(jn,i);var T=jj-fX(jn);var jk=jl-fW(i);var e=T*Math.cos(jk);var jm=T*Math.sin(jk);return{lng:e,lat:jm}}function fX(e){return Math.sin(e*fe*h8)*gi}function fW(e){return Math.cos(e*fe*h8)*gh}function al(T,i,e){return((i.lng-T.lng)*(e.lat-T.lat)-(e.lng-T.lng)*(i.lat-T.lat))}function g6(i,e){return Math.abs(i-e)<=gI}function f4(jj,T){var i=jj.lat*h8;var jo=jj.lng*h8;var e=T.lat*h8;var jn=T.lng*h8;var jl=Math.cos(i)*Math.cos(e);var jk=Math.cos(jo)*Math.cos(jn);var jq=Math.sin(i)*Math.sin(e);var jp=Math.sin(jo)*Math.sin(jn);var jr=jl*jk+jl*jp+jq;if(jr<-1){jr=-1}else{if(jr>1){jr=1}}var jm=Math.acos(jr)*hU;return jm}function g(jn,jm){var i=jn.lat*h8;var e=jm.lat*h8;var jj=jn.lng*h8;var T=jm.lng*h8;var jl=i-e;var jk=jj-T;var jo=Math.sin(jl/2)*Math.sin(jl/2)+Math.cos(i)*Math.cos(e)*Math.sin(jk/2)*Math.sin(jk/2);return 2*Math.asin(Math.sqrt(jo))*hU}function f2(jo,T){var jq=br(jo,T);var jp=180;var jn=90;var jm=-180;var jk=-90;var jl=T.sp;var jj=T.ep;jp=jl.lng<jj.lng?jl.lng:jj.lng;jn=jl.lat<jj.lat?jl.lat:jj.lat;jm=jl.lng<jj.lng?jl.lng:jj.lng;jk=jl.lat<jj.lat?jl.lat:jj.lat;if(jq.lng<=jm&&jq.lng>=jp&&jq.lng<=jk&&jq.lat>=jn){return f4(jo,jq)}else{var i=g(jo,T.sp);var e=g(jo,T.ep);return i<e?i:e}}function aS(i,e){}function bv(i,jj,e,T){return Math.sqrt((i-e)*(i-e)+(jj-T)*(jj-T))}function br(ju,jm){var jl=ju.lng;var jt=ju.lat;var jk=jm.sp.lng;var js=jm.sp.lat;var T=jm.ep.lng;var jq=jm.ep.lat;var jr=jq-js;var jp=jk-T;if(g6(jr,0)&&g6(jp,0)){return jm.sp}var jo=T*js-jk*jq;var jn=jp*jl-jr*jt;var e=jr*jr-jp*jp;var jj=jp*jn-jr*jo;var i=jr*jn+jp*jo;return{lng:jj/e,lat:-i/e}}function bz(jj){var T=0;for(var e=0;e<Y;++e){if(cG[e]<=jj.lat){if(cG[(e+1)%Y]>jj.lat){if(al({lng:cI[e],lat:cG[e]},{lng:cI[(e+1)%Y],lat:cG[(e+1)%Y]},jj)>0){++T}}}else{if(cG[(e+1)%Y]<=jj.lat){if(al({lng:cI[e],lat:cG[e]},{lng:cI[(e+1)%Y],lat:cG[(e+1)%Y]},jj)<0){--T}}}}return T===0?e4:ho}function i1(jj){var jm={};if(jj.lng<ex[0]-0.4||jj.lat<ex[1]-0.4||jj.lng>ex[2]+0.4||jj.lat>ex[3]+0.4){jm.lng=jj.lng;jm.lat=jj.lat;return jm}else{if(hw(jj,eg,ef,hN)){jm=fN(jj);return jm}}var e=0;var jp=dk;var T=0;var jn=new gQ();var jo=1;if(bz(jj)===e4){for(var jl=0;jl<Y;++jl){var jk=new d7(cI[jl],cG[jl],cI[(jl+1)%Y],cG[(jl+1)%Y]);jn.ll.lng=jk.mbr.ll.lng-0.5;jn.ll.lat=jk.mbr.ll.lat-0.5;jn.ru.lng=jk.mbr.ru.lng+0.5;jn.ru.lat=jk.mbr.ru.lat+0.5;if(jn.contains(jj)===e4){continue}T=f2(jj,jk);if(T<jp){jp=T}}if(jp<dk){e=(dk-jp)/dk;jo=2}}else{jo=3;e=1}var jq=fN(jj);jm={lng:jj.lng+(jq.lng-jj.lng)*e,lat:jj.lat+(jq.lat-jj.lat)*e};return jm}function ez(i){var T={};if(i.lng<s[0]-0.4||i.lat<s[1]-0.4||i.lng>s[2]+0.4||i.lat>s[3]+0.4){T.lng=i.lng;T.lat=i.lat;return T}else{if(hw(i,bT,bR,hN)){T=aR(i);return T}}var e=i1(i);if(i.lng===e.lng&&i.lat===e.lng){T.lng=i.lng;T.lat=i.lat;return T}return decryptPt1(i,i1)}function hK(i,e){if(e===3&&i instanceof cg){var T=i1(i);return new cg(T.lng,T.lat)}else{return i}}function ei(i,e){if(e===3&&i instanceof cg){var T=ez(i);return new cg(T.lng,T.lat)}else{if(e===5&&i instanceof cg){return new cg(i.lng,i.lat)}else{return i}}}function l(jl){var jm=JSON.stringify(jl);var jk=0,T,jj,e;if(jm.length===0){return jk}for(T=0,e=jm.length;T<e;T++){jj=jm.charCodeAt(T);jk=((jk<<5)-jk)+jj;jk|=0}return jk}function cJ(){var i=new Date().getTime();var e="xxxyxxxy".replace(/[xy]/g,function(jj){var T=(i+Math.random()*16)%16|0;i=Math.floor(i/16);return(jj=="x"?T:(T&3|8)).toString(16)});return e}function iz(){var T=function(jD,jC){var jB={"\x63\x65\x6c\x61\x63":"\x63\x65\x65","\x65\x65\x65\x68\x6c":function(jF,jE){return jF!==jE},"\x69\x6d\x65\x61\x63":"\x61\x65\x6c","\x69\x63\x69\x68\x68":"\x6c\x64\x6d","\x61\x64\x65\x61\x63":"\x61\x63\x65","\x78\x6c\x69\x68\x65":function(jF,jE){return jF(jE)},"\x6d\x64\x68\x68\x6d":function(jF,jE){return jF+jE},"\x61\x6c\x69\x6c\x64":function(jF,jE){return jF+jE},"\x68\x65\x65\x61\x64":"\x43\x68\x61\x72","\x65\x65\x61\x78\x61":function(jG,jF,jE){return jG(jF,jE)},"\x65\x68\x6d\x63\x61":function(jF,jE){return jF<jE}};var jy="\x31\x2e\x31\x2e\x32";function jw(jF,jK){var jI=jB["\x63\x65\x6c\x61\x63"];while(jB["\x65\x65\x65\x68\x6c"](jI,"\x6c\x63\x65\x65")){switch(jI){case"\x63\x65\x65":var jE=jF["\x6c\x65\x6e\x67\x74\x68"];jI=jB["\x69\x6d\x65\x61\x63"];break;case jB["\x69\x63\x69\x68\x68"]:return jG;case jB["\x61\x64\x65\x61\x63"]:for(var jJ=0;jJ<jE;jJ++){var jH=jB["\x78\x6c\x69\x68\x65"](jK,jF[jJ]);jG["\x70\x75\x73\x68"](jH)}jI=jB["\x69\x63\x69\x68\x68"];break;case jB["\x69\x6d\x65\x61\x63"]:var jG=[];jI="\x61\x63\x65";break}}}var jA,jz,jx,jv,ju,jt=decodeURIComponent,js=jB["\x68\x65\x65\x61\x64"],jr="";var jq=[T];jA="\x64\x65";jz="\x66\x72";jx="\x6f";ju=jz+jx+"\x6d";jv=jB["\x61\x6c\x69\x6c\x64"]("\x43\x6f",jA);var jp=function(jE){return jB["\x6d\x64\x68\x68\x6d"](jE,jr)["\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72"][jB["\x6d\x64\x68\x68\x6d"](jB["\x61\x6c\x69\x6c\x64"](ju,js),jv)](jE)};var jo=function(jE){return jw(jE,function(jF){return jB["\x78\x6c\x69\x68\x65"](jp,jF)})};var jn=jo["\x63\x61\x6c\x6c"](jp,[39,34,37,96,60,120,97,65,98,66,99,67,100,68,101,69,102,70,103,110,109,111,112,48,49,50,51,52,53,54,55,56,57]);var jm=jB["\x65\x65\x61\x78\x61"](jw,[28782,27702,26416,25167,24183],function(jE){return jB["\x78\x6c\x69\x68\x65"](jt,jE)});var jl=jo["\x63\x61\x6c\x6c"](jm,[22354,22749,24415,23346,22257,22688,24306,25174,23595,25547,22984,25690,22212,27547,21594,27210,23090,29193,22394,29368,29532,29459,29530,24146,24500,26352,27441,28788,29370,27673,26925,25249,24430]),jk={};jm=jo(jm);var jj=new RegExp(jm["\x6a\x6f\x69\x6e"]("\x7c"));for(var jA=0;jB["\x65\x68\x6d\x63\x61"](jA,jn["\x6c\x65\x6e\x67\x74\x68"]);jA++){jk[jl[jA]]=jn[jA]}jC=jB["\x65\x65\x61\x78\x61"](jw,jC["\x73\x70\x6c\x69\x74"](jr),function(jE){return jk[jE]||jE})["\x6a\x6f\x69\x6e"](jr);return jw(jC["\x73\x70\x6c\x69\x74"](jj),function(jE){return jt(jE)})}(this,"\u56c4\u58a0\u735c\u545a\u735c\u624f\x6c\u545a\u72b8\u577a\x74\x68\u6c36\u7209\u72ba\x4c\u66f0\x4f\u6c19\x52\u6c19\u6256\u6b9b\u62a1\u5f6e\u5f6e\u5e52\x4f\u624f\x69\u58a0\u545a\u5ef2\x69\u6730\x48\u5e52\u6256\u5f6e\x50\u62a1\x50\u692d\x59\u6c19\u6256\u63cb\x51\x4f\u5e52\u5e77\x73\x75\u5c2b\x73\x74\x72\u5e77\u5ef2\u5ef2\u735c\u735c\u58a0\u6c36\x69\u72b8\u56c4\u545a\u58a0\x4f\u5a32\u5e77\u545a\u59c8\u545a\u545a\u5ef2\u6730\u59c8\u735c\x68\u545a\u545a");(function(jl,jk){var jj=function(jm){while(--jm){jl.push(jl.shift())}};jj(++jk)}(T,122));var i=function(jl,jk){jl=jl-0;var jj=T[jl];return jj};function e(jo){var jm={"\x69\x78\x65\x61\x69":i("0x0"),"\x61\x61\x6d\x6d\x78":function(jq,jp){return jq+jp},"\x65\x63\x65\x65\x61":function(jq,jp){return jq(jp)},"\x63\x6d\x68\x65\x65":"\x26\x73\x69\x67\x6e\x3d","\x64\x78\x6d\x65\x6d":function(jq,jp){return jq-jp}};var jl=jm[i("0x1")];var jk=i("0x2");var jj=jo[i("0x3")](jm[i("0x4")](jo[i("0x5")]("\x3f"),1));var jn=md5(jm["\x61\x61\x6d\x6d\x78"](jm[i("0x6")](md5,jj+jl),jk));return jm[i("0x4")](jm[i("0x7")],jn["\x73\x75\x62\x73\x74\x72\x69\x6e\x67"](jm[i("0x8")](jn[i("0x9")],12)))}return e}function gs(){}ey.extend(gs,{Request:{INITIAL:-1,WAITING:0,LOADED:1,COMPLETED:2},Dependency:{poly:["marker"],layer:["poly"],hotspot:["poly"],infowindow:["marker","hotspot"],simpleInfowindow:["marker"],tools:["marker","poly"],mapgl:["glcommon","poly"],earth:["glcommon"],control:["scommon"],scommon:[],localSearch:["scommon"],otherSearch:["scommon"],route:["scommon"],buslineSearch:["route"],autocomplete:["scommon"]},MD5Mapping:{control:"qctzov",marker:"kyjodu",poly:"yaemyt",layer:"$layer$",infowindow:"cy1rh5",simpleInfowindow:"dfmx5h",hotspot:"u2xnms",menu:"jpxpe4",tools:"b2soi5",oppc:"v1ixod",oppcgl:"2tf5mp",mapgl:"xfb2kr",markeranimation:"34psja",earth:"ew4urd",glcommon:"ccphqh",localSearch:"saceic",scommon:"fu3q1f",otherSearch:"5lla0h",route:"vpnoxn",buslineSearch:"vp1mz3",autocomplete:"2y55u2"},Config:{baseUrl:w.apiHost+"/getmodules?v=1.0&type=webgl",jsModPath:(aA.inMapHost?"":w.mapHost)+"/res/newui/",timeout:5000},delayFlag:false,Module:{modules:{},modulesNeedToLoad:[]},_getMd5ModsStr:function(jl){var jk=[];for(var jn=0,T=jl.length;jn<T;jn++){var jm=jl[jn];var e=this.MD5Mapping[jm];var jj="$"+jm+"$";if(e!==jj){jk.push(jm+"_"+e)}}return jk.join(",")},load:function(i,jl,jj){var e=this.getModuleInfo(i);if(e.status===this.Request.COMPLETED){if(jj===true){jl()}}else{if(e.status===this.Request.INITIAL){this.combine(i);this.addToLoadQueue(i);var T=this;if(T.delayFlag===false){T.delayFlag=true;setTimeout(function(){var jm=T.Config.baseUrl+"&mod="+T._getMd5ModsStr(T.Module.modulesNeedToLoad);gf.load(jm);T.Module.modulesNeedToLoad.length=0;T.delayFlag=false},1)}e.status=this.Request.WAITING;function jk(jo){var jn=T.getModuleInfo(i);if(jn.status!==T.Request.COMPLETED){if(window.map){var jm=new ff("onmod_timeout");jm.timeout=jo/1000;jm.moduleName=i;window.map.fire(jm)}}}setTimeout(jk,this.Config.timeout,this.Config.timeout);setTimeout(jk,this.Config.timeout*2,this.Config.timeout*2)}if(jl){e.callbacks.push(jl)}}},combine:function(e){if(e&&this.Dependency[e]){var jj=this.Dependency[e];for(var T=0;T<jj.length;T++){this.combine(jj[T]);if(!this.Module.modules[jj[T]]){this.addToLoadQueue(jj[T])}}}},addToLoadQueue:function(e){var i=this.getModuleInfo(e);if(i.status===this.Request.INITIAL){i.status=this.Request.WAITING;this.Module.modulesNeedToLoad.push(e)}},run:function(T,jj){var jn=this.getModuleInfo(T);var jq=this.Dependency[T];if(jq){for(var jl=0;jl<jq.length;jl++){var jm=this.getModuleInfo(jq[jl]);if(jm.status!==this.Request.COMPLETED){jm.modsNeedToRun.push({name:T,code:jj});return}}}try{eval(jj)}catch(jo){return}jn.status=this.Request.COMPLETED;for(var jl=0,jk=jn.callbacks.length;jl<jk;jl++){jn.callbacks[jl]()}jn.callbacks.length=0;for(jl=0;jl<jn.modsNeedToRun.length;jl++){var jp=jn.modsNeedToRun[jl];this.run(jp.name,jp.code)}jn.modsNeedToRun.length=0},getModuleInfo:function(i){var e;if(!this.Module.modules[i]){this.Module.modules[i]={status:this.Request.INITIAL,callbacks:[],modsNeedToRun:[]}}e=this.Module.modules[i];return e}});window._jsload=function(jk,jl){var i=gs.getModuleInfo(jk);i.status=gs.Request.LOADED;if(jl!==""){gs.run(jk,jl)}else{if(window.map){var e=new ff("ongetmodules_fail");e.moduleName=jk;window.map.fire(e)}var T=document.createElement("script");var jj=gs.MD5Mapping[jk];T.src=gs.Config.jsModPath+jk+"_"+jj+".js";document.getElementsByTagName("head")[0].appendChild(T)}};function cE(){this._timeData={}}var bn;if(typeof window!=="undefined"){bn=window}else{bn=self}cE.prototype.mark=function(e){this._timeData[e]=this._getTime()};cE.prototype.getMark=function(e){return this._timeData[e]};cE.prototype.getTime=function(i,e){return parseFloat((this._timeData[e]-this._timeData[i]).toFixed(2))};cE.prototype.print=function(){};cE.prototype.clear=function(){this._timeData={}};if(bn.performance&&bn.performance.now){cE.prototype._getTime=function(){return performance.now()}}else{cE.prototype._getTime=function(){return Date.now()}}!function(i,T){T(i.d3=i.d3||{})}(window,function(jW){function ke(kl,km,T,kk){function e(i){return kl(i=new Date(+i)),i}return e.floor=e,e.ceil=function(i){return kl(i=new Date(i-1)),km(i,1),kl(i),i},e.round=function(i){var kn=e(i),ko=e.ceil(i);return ko-i>i-kn?kn:ko},e.offset=function(i,kn){return km(i=new Date(+i),null==kn?1:Math.floor(kn)),i},e.range=function(ko,i,kn){var kp=[];if(ko=e.ceil(ko),kn=null==kn?1:Math.floor(kn),!(i>ko&&kn>0)){return kp}do{kp.push(new Date(+ko))}while(km(ko,kn),kl(ko),i>ko);return kp},e.filter=function(i){return ke(function(kn){for(;kl(kn),!i(kn);){kn.setTime(kn-1)}},function(kn,ko){for(;--ko>=0;){for(;km(kn,1),!i(kn);){}}})},T&&(e.count=function(i,kn){return jY.setTime(+i),j2.setTime(+kn),kl(jY),kl(j2),Math.floor(T(jY,j2))},e.every=function(i){return i=Math.floor(i),isFinite(i)&&i>0?i>1?e.filter(kk?function(kn){return kk(kn)%i===0}:function(kn){return e.count(0,kn)%i===0}):e:null}),e}function j3(e){return ke(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,T){i.setDate(i.getDate()+7*T)},function(i,T){return(T-i-(T.getTimezoneOffset()-i.getTimezoneOffset())*jX)/kb})}function jV(e){return ke(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,T){i.setUTCDate(i.getUTCDate()+7*T)},function(i,T){return(T-i)/kb})}var jY=new Date,j2=new Date,j9=ke(function(){},function(i,T){i.setTime(+i+T)},function(i,T){return T-i});j9.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?ke(function(i){i.setTime(Math.floor(i/e)*e)},function(i,T){i.setTime(+i+T*e)},function(i,T){return(T-i)/e}):j9:null};var ki=j9.range,kg=1000,jX=60000,kd=3600000,j5=86400000,kb=604800000,jp=ke(function(e){e.setTime(Math.floor(e/kg)*kg)},function(i,T){i.setTime(+i+T*kg)},function(i,T){return(T-i)/kg},function(e){return e.getUTCSeconds()}),kf=jp.range,j4=ke(function(e){e.setTime(Math.floor(e/jX)*jX)},function(i,T){i.setTime(+i+T*jX)},function(i,T){return(T-i)/jX},function(e){return e.getMinutes()}),jx=j4.range,jR=ke(function(i){var T=i.getTimezoneOffset()*jX%kd;0>T&&(T+=kd),i.setTime(Math.floor((+i-T)/kd)*kd+T)},function(i,T){i.setTime(+i+T*kd)},function(i,T){return(T-i)/kd},function(e){return e.getHours()}),ka=jR.range,jH=ke(function(e){e.setHours(0,0,0,0)},function(i,T){i.setDate(i.getDate()+T)},function(i,T){return(T-i-(T.getTimezoneOffset()-i.getTimezoneOffset())*jX)/j5},function(e){return e.getDate()-1}),jo=jH.range,jE=j3(0),jG=j3(1),jk=j3(2),jC=j3(3),jr=j3(4),jU=j3(5),j1=j3(6),jm=jE.range,jT=jG.range,jv=jk.range,jQ=jC.range,j6=jr.range,jS=jU.range,kh=j1.range,j8=ke(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(i,T){i.setMonth(i.getMonth()+T)},function(i,T){return T.getMonth()-i.getMonth()+12*(T.getFullYear()-i.getFullYear())},function(e){return e.getMonth()}),kj=j8.range,jB=ke(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(i,T){i.setFullYear(i.getFullYear()+T)},function(i,T){return T.getFullYear()-i.getFullYear()},function(e){return e.getFullYear()});jB.every=function(e){return isFinite(e=Math.floor(e))&&e>0?ke(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,T){i.setFullYear(i.getFullYear()+T*e)}):null};var ju=jB.range,jZ=ke(function(e){e.setUTCSeconds(0,0)},function(i,T){i.setTime(+i+T*jX)},function(i,T){return(T-i)/jX},function(e){return e.getUTCMinutes()}),jJ=jZ.range,jI=ke(function(e){e.setUTCMinutes(0,0,0)},function(i,T){i.setTime(+i+T*kd)},function(i,T){return(T-i)/kd},function(e){return e.getUTCHours()}),jF=jI.range,jD=ke(function(e){e.setUTCHours(0,0,0,0)},function(i,T){i.setUTCDate(i.getUTCDate()+T)},function(i,T){return(T-i)/j5},function(e){return e.getUTCDate()-1}),jA=jD.range,jz=jV(0),jy=jV(1),jw=jV(2),jt=jV(3),js=jV(4),jn=jV(5),jl=jV(6),jj=jz.range,jP=jy.range,kc=jw.range,j0=jt.range,j7=js.range,jO=jn.range,jN=jl.range,jM=ke(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(i,T){i.setUTCMonth(i.getUTCMonth()+T)},function(i,T){return T.getUTCMonth()-i.getUTCMonth()+12*(T.getUTCFullYear()-i.getUTCFullYear())},function(e){return e.getUTCMonth()}),jL=jM.range,jq=ke(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(i,T){i.setUTCFullYear(i.getUTCFullYear()+T)},function(i,T){return T.getUTCFullYear()-i.getUTCFullYear()},function(e){return e.getUTCFullYear()});jq.every=function(e){return isFinite(e=Math.floor(e))&&e>0?ke(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,T){i.setUTCFullYear(i.getUTCFullYear()+T*e)}):null};var jK=jq.range;jW.timeInterval=ke,jW.timeMillisecond=j9,jW.timeMilliseconds=ki,jW.utcMillisecond=j9,jW.utcMilliseconds=ki,jW.timeSecond=jp,jW.timeSeconds=kf,jW.utcSecond=jp,jW.utcSeconds=kf,jW.timeMinute=j4,jW.timeMinutes=jx,jW.timeHour=jR,jW.timeHours=ka,jW.timeDay=jH,jW.timeDays=jo,jW.timeWeek=jE,jW.timeWeeks=jm,jW.timeSunday=jE,jW.timeSundays=jm,jW.timeMonday=jG,jW.timeMondays=jT,jW.timeTuesday=jk,jW.timeTuesdays=jv,jW.timeWednesday=jC,jW.timeWednesdays=jQ,jW.timeThursday=jr,jW.timeThursdays=j6,jW.timeFriday=jU,jW.timeFridays=jS,jW.timeSaturday=j1,jW.timeSaturdays=kh,jW.timeMonth=j8,jW.timeMonths=kj,jW.timeYear=jB,jW.timeYears=ju,jW.utcMinute=jZ,jW.utcMinutes=jJ,jW.utcHour=jI,jW.utcHours=jF,jW.utcDay=jD,jW.utcDays=jA,jW.utcWeek=jz,jW.utcWeeks=jj,jW.utcSunday=jz,jW.utcSundays=jj,jW.utcMonday=jy,jW.utcMondays=jP,jW.utcTuesday=jw,jW.utcTuesdays=kc,jW.utcWednesday=jt,jW.utcWednesdays=j0,jW.utcThursday=js,jW.utcThursdays=j7,jW.utcFriday=jn,jW.utcFridays=jO,jW.utcSaturday=jl,jW.utcSaturdays=jN,jW.utcMonth=jM,jW.utcMonths=jL,jW.utcYear=jq,jW.utcYears=jK,Object.defineProperty(jW,"__esModule",{value:!0})});function eI(e){this._elemType=e;this._objCollection={}}eI.prototype.get=function(){var i=null;for(var e in this._objCollection){if(this._objCollection[e]&&this._objCollection[e]._free===true){this._objCollection[e]._free=false;return this._objCollection[e]}}i=bL(this._elemType);e=bp.getGUID("obj_pool_");this._objCollection[e]=i;return i};eI.prototype.free=function(e){if(!e){return}e._free=true;if(e.tagName.toLowerCase()==="img"){e.src="";e.crossOrigin=null;e.onload=e.onerror=null}};eI.prototype.clear=function(){for(var e in this._objCollection){if(this._objCollection[e]&&this._objCollection[e].tagName.toLowerCase==="img"){this._objCollection[e].onload=this._objCollection[e].onerror=null}}this._objCollection={}};var hr={get:function(i,jk,e,T){var jj=new XMLHttpRequest();jj.open("GET",i,true);jj.timeout=10000;jj.ontimeout=function(){T&&T()};jj.onreadystatechange=function(jl){if(this.readyState===4){if(this.status===200){jk&&jk(jj.responseText)}else{e&&e()}}};jj.send()},post:function(i,jl,jk,e,T){var jj=new XMLHttpRequest();jj.open("POST",i,true);jj.setRequestHeader("Content-type","application/x-www-form-urlencoded");jj.timeout=10000;jj.ontimeout=function(){T&&T()};jj.onreadystatechange=function(jm){if(this.readyState===4){if(this.status===200){jk&&jk(jj.responseText,jl)}else{e&&e()}}};jj.send(jl);return jj}};var gf=(function(e){function i(jl,T,jk){if(jl.indexOf("v=")===-1){jl+="&v=gl"}var jj=bL("script",{src:jl,type:"text/javascript",charset:"utf-8"});if(jj.addEventListener){jj.addEventListener("load",function(jn){var jm=jn.target;jm.parentNode.removeChild(jm);T&&T()},false);jj.addEventListener("error",function(jn){if(jn){var jm=jn.target;jm&&jm.parentNode&&jm.parentNode.removeChild(jm)}jk&&jk(null)},false)}else{if(jj.attachEvent){jj.attachEvent("onreadystatechange",function(jn){var jm=window.event.srcElement;if(jm&&(jm.readyState==="loaded"||jm.readyState==="complete")){jm.parentNode.removeChild(jm)}T&&T()})}}e.getElementsByTagName("head")[0].appendChild(jj)}return{load:function(jm,T,jj){if(typeof jm==="string"){i(jm,T,jj)}else{if(jm.length>0){var jl=jm.length;for(var jk=0;jk<jl;jk++){i(jm[jk],function(){jl--;if(jl===0&&T){T()}})}}}}}})(window.document);function hl(){}hl.instances={};hl.getInstance=function(i,T){if(hl.instances[i]){return hl.instances[i]}var e=new je(i,T);hl.instances[i]=e;return e};function je(e,i){this._name=e;this._baseZoom=18;this._opts={tileSize:256};ey.extend(this._opts,i||{})}je.mapZoomBaseIndex=[8,8,8,8,7,7,6,6,5,5,4,3,3,3,2,2,1,1,0,0,0,0,0,0,0,0];je.baseScaleZoom=[19,17,15,12,10,9,7,5,3];je.baseScaleZoomMercatorSize=[512,2048,4096,32768,65536,262144,1048576,4194304,8388608];je.mapZoomBaseZoomMapping=[3,3,3,3,5,5,7,7,9,9,10,12,12,12,15,15,17,17,19,19,19,19,19,19,19,19];je.mapZoomStartZoomMapping=[3,3,3,3,4,4,6,6,8,8,10,11,11,11,14,14,16,16,18,18,18,18,18,18,18,18];je.baseScaleTileSize=[1024,1024,512,512,256,512,512,512,256];je.mapZoomTileSize=[256,256,256,256,256,512,256,512,256,512,256,256,512,1024,256,512,512,1024,512,1024,2048,4096,4096*2,4096*2*2,4096*2*2*2,4096*2*2*2*2];je.baseZoomInfo={"3":[3],"5":[4,5],"7":[6,7],"9":[8,9],"10":[10],"12":[11,12,13],"15":[14,15],"17":[16,17],"19":[18,19,20,21,22,23,24,25]};je.prototype={getName:function(){return this._name},getTileSize:function(e){e=Math.floor(e);if(e<3){e=3}if(this._name==="na"){return je.mapZoomTileSize[e]}return this._opts.tileSize},getBaseTileSize:function(i){i=Math.floor(i);if(this._name==="na"){var e=je.mapZoomBaseZoomMapping[i];return je.mapZoomTileSize[e]}return this._opts.tileSize},getDataZoom:function(e){e=Math.floor(e);if(this._name==="na"){return je.mapZoomBaseZoomMapping[e]}return e},getZoomUnits:function(e){return Math.pow(2,(this._baseZoom-e))},getMercatorSize:function(T,i){if(this._name==="na"){T=Math.floor(T);var e=je.mapZoomBaseIndex[T];return je.baseScaleZoomMercatorSize[e]}return this._opts.tileSize*this.getZoomUnits(i)},getBaseZoom:function(){return this._baseZoom},getParentTile:function(jj,jp,jo,T,i){if(this._name==="na"){var jk=je.baseZoomInfo[jo];T--;if(jk.indexOf(T)>-1){return{col:jj,row:jp,zoom:jo,useZoom:T}}else{var jm=je.mapZoomBaseIndex[jo];var jl=je.baseScaleZoom[jm+1];if(!jl){return null}var jn=this.getFactorByZooms(jl,jo);var e=je.baseZoomInfo[jl];return{col:Math.floor(jj/jn),row:Math.floor(jp/jn),zoom:jl,useZoom:e[e.length-1]}}return null}if(jo-1<i){return null}return{col:Math.floor(jj/2),row:Math.floor(jp/2),zoom:jo-1,useZoom:jo-1}},getChildTiles:function(jk,jm,e,T,jt,jz){if(this._name==="na"){var jj=je.baseZoomInfo[e];T+=jz;if(jj.indexOf(T)>-1){return[{col:jk,row:jm,zoom:e,useZoom:T}]}else{var jx=0;var ju=e;while(jx<jz){var jy=je.mapZoomBaseIndex[ju];var jo=je.baseScaleZoom[jy-1];if(!jo){return null}var jp=je.baseZoomInfo[jo];if(jp[jz-1]){var jq=[];var js=this.getFactorByZooms(e,jo);var i=jk*js;var jr=jm*js;for(var jw=0;jw<js;jw++){var jl=i+jw;for(var jv=0;jv<js;jv++){var jn=jr+jv;jq.push({col:jl,row:jn,zoom:jo,useZoom:jp[jz-1]})}}return jq}jx+=jp.length;if(jz===jp.length){ju=jo}}}return null}var jq=[];if(e+jz>jt){return null}var js=Math.pow(2,jz);var i=jk*js;var jr=jm*js;var jo=e+jz;var jq=[];for(var jw=0;jw<2;jw++){var jl=i+jw;for(var jv=0;jv<2;jv++){var jn=jr+jv;jq.push({col:jl,row:jn,zoom:jo,useZoom:jo})}}return jq},getFactorByZooms:function(i,jj){var T=je.mapZoomBaseIndex[i];var jk=je.mapZoomBaseIndex[jj];var e=je.baseScaleZoomMercatorSize[T];var jl=je.baseScaleZoomMercatorSize[jk];return e/jl}};var cL={};var V=["swiftshader","microsoft basic render driver"];var gL=["intel","nvidia","amd","apple","geforce"];function f6(e){e=e.toLowerCase();if(V.indexOf(e)>=0){return true}if(e.indexOf("mobile")>=0){return true}return false}function ch(T){T=T.toLowerCase();for(var e=0;e<gL.length;e++){if(T.indexOf(gL[e])>=0){return true}}return false}function jd(e){if(!e){return false}if(f6(e)){return false}if(ch(e)){return true}return false}cL.ifEnableEarth=function(i){var e=cL.ifEnableEarth;if(!i&&typeof e._enable==="boolean"){return e._enable}if(cL.ifSupportWebGL()){e._enable=true;return true}e._enable=false;return false};cL.ifEnableWebGLMap=function(i){var e=cL.ifEnableWebGLMap;if(!i&&typeof e._enable==="boolean"){return e._enable}if(cL.ifSupportWebGL()){if(aA.inMapHost){e._enable=true;return true}else{if(window.Blob||window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder){e._enable=true;return true}else{e._enable=false;return false}}}e._enable=false;return false};cL.params={};cL.ifSupportWebGL=function(){var i=cL.ifSupportWebGL;if(typeof i._supportWebGL==="boolean"){return i._supportWebGL}if(!window.WebGLRenderingContext){i._supportWebGL=false;return false}var T=document.createElement("canvas");T.width=300;T.height=150;var jk=null;var jq={alpha:true,antialias:false,failIfMajorPerformanceCaveat:true,preserveDrawingBuffer:false,stencil:false};try{jk=T.getContext("webgl",jq)||T.getContext("experimental-webgl",jq)}catch(jm){i._supportWebGL=false}if(jk===null){i._supportWebGL=false}else{i._supportWebGL=true;var jo=jk.getExtension("WEBGL_debug_renderer_info");var jn="";if(jo){jn=jk.getParameter(jo.UNMASKED_RENDERER_WEBGL);if(jd(jn)===true){i._supportWebGL=true}var jp=jk.getParameter(jo.UNMASKED_VENDOR_WEBGL);i._renderer=jn;i._vendor=jp}if(!jo&&ey.Browser.firefox){i._supportWebGL=true}if(!jo&&ey.Platform.macintosh){i._supportWebGL=true}if(jk.drawingBufferWidth!==T.width||jk.drawingBufferHeight!==T.height){i._supportWebGL=false}if(jk.getParameter(jk.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<4){i._supportWebGL=false}var jj=jk.getParameter(jk.MAX_TEXTURE_SIZE);cL.params.maxTextureSize=jj;if(jj<4096){i._supportWebGL=false}var jl=jk.getParameter(jk.MAX_TEXTURE_IMAGE_UNITS);if(jl<8){i._supportWebGL=false}if(!jk.getShaderPrecisionFormat||jk.getShaderPrecisionFormat(jk.FRAGMENT_SHADER,jk.HIGH_FLOAT).precision<23){i._supportWebGL=false}}return i._supportWebGL};cL.ifSupportCanvas2d=function(){var jk=cL.ifSupportCanvas2d;if(typeof jk.supportCanvas2d==="boolean"){return jk.supportCanvas2d}var T=document.createElement("canvas");var i=null;try{i=T.getContext("2d")}catch(jj){jk.supportCanvas2d=false}if(i===null){jk.supportCanvas2d=false}else{jk.supportCanvas2d=true}return jk.supportCanvas2d};cL.ifCanvas2dInBlackList=function(){return true};cL.ifEnableCanvas2dMap=function(){return false;var i=navigator.userAgent;var e=0;var jj=0;var jk=0;if(/macintosh/ig.test(i)){var T=0;if(/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(i)&&!/chrome/i.test(i)){T=parseInt((RegExp["\x241"]||RegExp["\x242"]),10)}if(T>0){return false}return true}if(/windows nt (\d+\.\d)/ig.test(i)){jj=parseFloat(RegExp.$1);if(jj>=6.1){if(/chrome\/(\d+\.\d)/i.test(i)){e=parseFloat(RegExp.$1);if(e>=31){return true}}if(/MSIE (\d+(\.\d+)?)/.test(i)){jk=parseFloat(RegExp.$1);if(jk>=10){return true}}if(/Firefox/.test(i)){return true}if(/rv:11.0/ig.test(i)){return true}if(/edge/ig.test(i)){return true}}}return false};cL.ifSupportCSS3=function(jn,i){var jm=document.createElement("div");var jl="Webkit Moz O ms".split(" ");var e=jl.length;var T="";var jj=jm.style;if(jn in jj){T=jn}jn=jn.replace(/^[a-z]/,function(jo){return jo.toUpperCase()});while(e--){var jk=jl[e]+jn;if(jk in jj){T=jk;break}}if(i){return T}else{return T.length>0?true:false}};cL.isModernBrowser=cL.ifSupportCanvas2d()&&cL.ifSupportCSS3("transform");function at(i,e){this._size=i;this._curSize=0;this._cache={};this._least=null;this._most=null;this._options={clearCallback:null,removeOldCallback:null};e=e||{};for(var T in e){this._options[T]=e[T]}this._getDataTimes=0;this._hitTimes=0}at.prototype.setData=function(jj,jl){var i=this._cache;var T=this._size;if(T===0){return}var e=this._curSize;if(e===T){this._removeOld()}var jk;if(!i[jj]){jk={key:jj,data:jl,older:null,newwer:null};i[jj]=jk;if(this._least===null){this._least=jk}if(this._most===null){this._most=jk}this._curSize++}else{jk=i[jj];jk.data=jl;if(this._most===jk){return}jk.older&&(jk.older.newer=jk.newer);jk.newer&&(jk.newer.older=jk.older);if(this._least===jk){this._least=jk.newer}}if(this._most&&this._most!==jk){this._most.newer=jk;jk.older=this._most;this._most=jk;jk.newer=null}};at.prototype.getData=function(e){var i=this._cache[e];this._getDataTimes++;if(i){this._hitTimes++;var T=i.data;if(this._most===i){return T}i.older&&(i.older.newer=i.newer);i.newer&&(i.newer.older=i.older);if(this._least===i){this._least=i.newer}this._most.newer=i;i.older=this._most;i.newer=null;this._most=i;return T}return null};at.prototype.getAllData=function(){return this._cache};at.prototype.getHitRate=function(){return this._hitTimes/this._getDataTimes};at.prototype.removeData=function(i){var e=this._cache;var T=e[i];if(!T){return}if(this._options.clearCallback){this._options.clearCallback(T.data,T.key)}T.older&&(T.older.newer=T.newer);T.newer&&(T.newer.older=T.older);if(this._least===T){this._least=T.newer}if(this._most===T){this._most=T.older}delete e[i];this._curSize--};at.prototype._removeOld=function(){var e=this._cache;var jj=Math.round(this._size*0.6);var T=0;while(this._least&&T<jj){var i=this._least;this._least=i.newer;i.newer&&(i.newer.older=null);if(this._options.clearCallback){this._options.clearCallback(i.data,i.key)}delete e[i.key];T++}this._curSize-=T;if(this._options.removeOldCallback){this._options.removeOldCallback()}};at.prototype.clear=function(){var e=this._cache;var i=this._least;if(this._options.clearCallback){while(i){this._options.clearCallback(i.data,i.key);i=i.newer}}this._least=this._most=null;this._cache={};this._curSize=0};at.prototype.forEach=function(e){var i=this._least;while(i){e(i.data);i=i.newer}};at.prototype.clearExcept=function(i){var e=this._cache;var T=this._least;while(T){if(!i[T.key]){if(this._options.clearCallback){this._options.clearCallback(T.data,T.key)}T.older&&(T.older.newer=T.newer);T.newer&&(T.newer.older=T.older);if(this._least===T){this._least=T.newer}if(this._most===T){this._most=T.older}delete e[T.key];this._curSize--}T=T.newer}};!function(T,i){"object"==typeof bp&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(T="undefined"!=typeof globalThis?globalThis:T||self).gcoord=i()}(this,(function(){
/* *****************************************************************************
        Copyright (c) Microsoft Corporation.

        Permission to use, copy, modify, and/or distribute this software for any
        purpose with or without fee is hereby granted.

        THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
        REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
        AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
        INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
        LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
        OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
        PERFORMANCE OF THIS SOFTWARE.
        ***************************************************************************** */
var jX=function(){return(jX=Object.assign||function(j2){for(var i,T=1,j4=arguments.length;T<j4;T++){for(var j3 in i=arguments[T]){Object.prototype.hasOwnProperty.call(i,j3)&&(j2[j3]=i[j3])}}return j2}).apply(this,arguments)},jI=Math.sin,jK=Math.cos,jO=Math.sqrt,jN=Math.abs,j1=Math.PI,jT=6378245,jH=0.006693421622965823;function jW(T,i){return T>=72.004&&T<=137.8347&&i>=0.8293&&i<=55.8271}function jZ(j4,j3){var j7,i,j9,T=(j9=300+(j7=j4-105)+2*(i=j3-35)+0.1*j7*j7+0.1*j7*i+0.1*jO(jN(j7)),j9+=2*(20*jI(6*j7*j1)+20*jI(2*j7*j1))/3,(j9+=2*(20*jI(j7*j1)+40*jI(j7/3*j1))/3)+2*(150*jI(j7/12*j1)+300*jI(j7/30*j1))/3),j2=function(kc,kb){var ka=2*kc-100+3*kb+0.2*kb*kb+0.1*kc*kb+0.2*jO(jN(kc));return ka+=2*(20*jI(6*kc*j1)+20*jI(2*kc*j1))/3,ka+=2*(20*jI(kb*j1)+40*jI(kb/3*j1))/3,ka+2*(160*jI(kb/12*j1)+320*jI(kb*j1/30))/3}(j4-105,j3-35),j6=j3/180*j1,j5=jI(j6),j8=jO(j5=1-jH*j5*j5);return[T=180*T/(jT/j8*jK(j6)*j1),j2=180*j2/(jT*(1-jH)/(j5*j8)*j1)]}function jQ(j2){var i=j2[0],T=j2[1];if(!jW(i,T)){return[i,T]}var j3=jZ(i,T);return[i+j3[0],T+j3[1]]}function jJ(j4){var j8=j4[0],T=j4[1];if(!jW(j8,T)){return[j8,T]}for(var j2=[j8,T],j6=j2[0],j3=j2[1],j7=jQ([j6,j3]),j5=j7[0]-j8,j9=j7[1]-T;jN(j5)>0.000001||jN(j9)>0.000001;){j5=(j7=jQ([j6-=j5,j3-=j9]))[0]-j8,j9=j7[1]-T}return[j6,j3]}var jU=Math.sin,jV=Math.cos,jr=Math.atan2,jY=Math.sqrt,jG=3000*Math.PI/180;function jM(j2){var i=j2[0]-0.0065,T=j2[1]-0.006,j4=jY(i*i+T*T)-0.00002*jU(T*jG),j3=jr(T,i)-0.000003*jV(i*jG);return[j4*jV(j3),j4*jU(j3)]}function jv(j2){var i=j2[0],T=j2[1],j4=jY(i*i+T*T)+0.00002*jU(T*jG),j3=jr(T,i)+0.000003*jV(i*jG);return[j4*jV(j3)+0.0065,j4*jU(j3)+0.006]}var jD=180/Math.PI,jm=Math.PI/180,jo=6378137,j0=20037508.342789244;function jA(i){return[i[0]*jD/jo,(0.5*Math.PI-2*Math.atan(Math.exp(-i[1]/jo)))*jD]}function jP(j2){var i=Math.abs(j2[0])<=180?j2[0]:j2[0]-360*(j2[0]<0?-1:1),T=[jo*i*jm,jo*Math.log(Math.tan(0.25*Math.PI+0.5*j2[1]*jm))];return T[0]>j0&&(T[0]=j0),T[0]<-j0&&(T[0]=-j0),T[1]>j0&&(T[1]=j0),T[1]<-j0&&(T[1]=-j0),T}var jz,jy,jx,jF,ju,jj,jE=Math.abs,jR=[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],jt=[75,60,45,30,15,0],jl=[[1.410526172116255e-8,0.00000898305509648872,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-0.03801003308653,17337981.2],[-7.435856389565537e-9,0.000008983055097726239,-0.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,0.00000898305509983578,0.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,0.32710905363475,6856817.37],[-1.981981304930552e-8,0.000008983055099779535,0.03278182852591,40.31678527705744,0.65659298677277,-4.44255534477492,0.85341911805263,0.12923347998204,-0.04625736007561,4482777.06],[3.09191371068437e-9,0.000008983055096812155,0.00006995724062,23.10934304144901,-0.00023663490511,-0.6321817810242,-0.00663494467273,0.03430082397953,-0.00466043876332,2555164.4],[2.890871144776878e-9,0.000008983055095805407,-3.068298e-8,7.47137025468032,-0.00000353937994,-0.02145144861037,-0.00001234426596,0.00010322952773,-0.00000323890364,826088.5]],jS=[[-0.0015702102444,111320.7020616939,1704480524535203,-10338987376042340,26112667856603880,-35149669176653700,26595700718403920,-10725012454188240,1800819912950474,82.5],[0.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[0.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[0.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-0.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-0.0003218135878613132,111320.7020701615,0.00369383431289,823725.6402795718,0.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,0.37238884252424,7.45]];function js(j3,T,j2){var j5=jE(T)/j2[9],j4=j2[0]+j2[1]*jE(j3),i=j2[2]+j2[3]*j5+j2[4]*Math.pow(j5,2)+j2[5]*Math.pow(j5,3)+j2[6]*Math.pow(j5,4)+j2[7]*Math.pow(j5,5)+j2[8]*Math.pow(j5,6);return[j4*=j3<0?-1:1,i*=T<0?-1:1]}function jL(j2){for(var i=j2[0],T=j2[1],j4=[],j3=0;j3<jt.length;j3++){if(jE(T)>jt[j3]){j4=jS[j3];break}}return js(i,T,j4)}function jq(j2){for(var i=j2[0],T=j2[1],j4=[],j3=0;j3<jR.length;j3++){if(T>=jR[j3]){j4=jl[j3];break}}return js(i,T,j4)}function jp(T,i){if(!T){throw new Error(i)}}function jB(i){return !!i&&"[object Array]"===Object.prototype.toString.call(i)}function jw(i){return !isNaN(Number(i))&&null!==i&&!jB(i)}function jn(){for(var j2=[],i=0;i<arguments.length;i++){j2[i]=arguments[i]}var T=j2.length-1;return function(){for(var j3=[],j5=0;j5<arguments.length;j5++){j3[j5]=arguments[j5]}for(var j4=T,e=j2[T].apply(null,j3);j4--;){e=j2[j4].call(null,e)}return e}}function jk(kj,j8,ka){if(void 0===ka&&(ka=!1),null!==kj){for(var kd,kc,km,kf,j7,ki,kl,ke,j9=0,kg=0,kh=kj.type,j3="FeatureCollection"===kh,kk="Feature"===kh,j6=j3?kj.features.length:1,kb=0;kb<j6;kb++){j7=(ke=!!(kl=j3?kj.features[kb].geometry:kk?kj.geometry:kj)&&"GeometryCollection"===kl.type)?kl.geometries.length:1;for(var j5=0;j5<j7;j5++){var j4=0,T=0;if(null!==(kf=ke?kl.geometries[j5]:kl)){var j2=kf.type;switch(j9=!ka||"Polygon"!==j2&&"MultiPolygon"!==j2?0:1,j2){case null:break;case"Point":if(!1===j8(ki=kf.coordinates,kg,kb,j4,T)){return !1}kg++,j4++;break;case"LineString":case"MultiPoint":for(ki=kf.coordinates,kd=0;kd<ki.length;kd++){if(!1===j8(ki[kd],kg,kb,j4,T)){return !1}kg++,"MultiPoint"===j2&&j4++}"LineString"===j2&&j4++;break;case"Polygon":case"MultiLineString":for(ki=kf.coordinates,kd=0;kd<ki.length;kd++){for(kc=0;kc<ki[kd].length-j9;kc++){if(!1===j8(ki[kd][kc],kg,kb,j4,T)){return !1}kg++}"MultiLineString"===j2&&j4++,"Polygon"===j2&&T++}"Polygon"===j2&&j4++;break;case"MultiPolygon":for(ki=kf.coordinates,kd=0;kd<ki.length;kd++){for(T=0,kc=0;kc<ki[kd].length;kc++){for(km=0;km<ki[kd][kc].length-j9;km++){if(!1===j8(ki[kd][kc][km],kg,kb,j4,T)){return !1}kg++}T++}j4++}break;case"GeometryCollection":for(kd=0;kd<kf.geometries.length;kd++){if(!1===jk(kf.geometries[kd],j8,ka)){return !1}}break;default:throw new Error("Unknown Geometry Type")}}}}}}!function(i){i.WGS84="WGS84",i.WGS1984="WGS84",i.EPSG4326="WGS84",i.GCJ02="GCJ02",i.AMap="GCJ02",i.BD09="BD09",i.BD09LL="BD09",i.Baidu="BD09",i.BMap="BD09",i.BD09MC="BD09MC",i.BD09Meter="BD09MC",i.EPSG3857="EPSG3857",i.EPSG900913="EPSG3857",i.EPSG102100="EPSG3857",i.WebMercator="EPSG3857",i.WM="EPSG3857"}(jj||(jj={}));var jC={WGS84:{to:(jz={},jz[jj.GCJ02]=jQ,jz[jj.BD09]=jn(jv,jQ),jz[jj.BD09MC]=jn(jL,jv,jQ),jz[jj.EPSG3857]=jP,jz)},GCJ02:{to:(jy={},jy[jj.WGS84]=jJ,jy[jj.BD09]=jv,jy[jj.BD09MC]=jn(jL,jv),jy[jj.EPSG3857]=jn(jP,jJ),jy)},BD09:{to:(jx={},jx[jj.WGS84]=jn(jJ,jM),jx[jj.GCJ02]=jM,jx[jj.EPSG3857]=jn(jP,jJ,jM),jx[jj.BD09MC]=jL,jx)},EPSG3857:{to:(jF={},jF[jj.WGS84]=jA,jF[jj.GCJ02]=jn(jQ,jA),jF[jj.BD09]=jn(jv,jQ,jA),jF[jj.BD09MC]=jn(jL,jv,jQ,jA),jF)},BD09MC:{to:(ju={},ju[jj.WGS84]=jn(jJ,jM,jq),ju[jj.GCJ02]=jn(jM,jq),ju[jj.EPSG3857]=jn(jP,jJ,jM,jq),ju[jj.BD09]=jq,ju)}};return jX(jX({},jj),{CRSTypes:jj,transform:function(j6,j4,j5){if(jp(!!j6,"The args[0] input coordinate is required"),jp(!!j4,"The args[1] original coordinate system is required"),jp(!!j5,"The args[2] target coordinate system is required"),j4===j5){return j6}var j8=jC[j4];jp(!!j8,"Invalid original coordinate system: "+j4);var j7=j8.to[j5];jp(!!j7,"Invalid target coordinate system: "+j5);var T=typeof j6;if(jp("string"===T||"object"===T,"Invalid input coordinate type: "+T),"string"===T){try{j6=JSON.parse(j6)}catch(j4){throw new Error("Invalid input coordinate: "+j6)}}var j3=!1;jB(j6)&&(jp(j6.length>=2,"Invalid input coordinate: "+j6),jp(jw(j6[0])&&jw(j6[1]),"Invalid input coordinate: "+j6),j6=j6.map(Number),j3=!0);var j2=j7;return j3?j2(j6):(jk(j6,(function(j9){var i;i=j2(j9),j9[0]=i[0],j9[1]=i[1]})),j6)}})}));var gW={ColorRefTable:{aliceblue:["#f0f8ff","rgb(240,248,255)"],antiquewhite:["#faebd7","rgb(250,235,215)"],aqua:["#00ffff","rgb(0,255,255)"],aquamarine:["#7fffd4","rgb(127,255,212)"],azure:["#f0ffff","rgb(240,255,255)"],beige:["#f5f5dc","rgb(245,245,220)"],bisque:["#ffe4c4","rgb(255,228,196)"],black:["#000000","rgb(0,0,0)"],blanchedalmond:["#ffebcd","rgb(255,235,205)"],blue:["#0000ff","rgb(0,0,255)"],blueviolet:["#8a2be2","rgb(138,43,226)"],brown:["#a52a2a","rgb(165,42,42)"],burlywood:["#deb887","rgb(222,184,135)"],cadetblue:["#5f9ea0","rgb(95,158,160)"],chartreuse:["#7fff00","rgb(127,255,0)"],chocolate:["#d2691e","rgb(210,105,30)"],coral:["#ff7f50","rgb(255,127,80)"],cornflowerblue:["#6495ed","rgb(100,149,237)"],cornsilk:["#fff8dc","rgb(255,248,220)"],crimson:["#dc143c","rgb(220,20,60)"],cyan:["#00ffff","rgb(0,255,255)"],darkblue:["#00008b","rgb(0,0,139)"],darkcyan:["#008b8b","rgb(0,139,139)"],darkgoldenrod:["#b8860b","rgb(184,134,11)"],darkgray:["#a9a9a9","rgb(169,169,169)"],darkgreen:["#006400","rgb(0,100,0)"],darkgrey:["#a9a9a9","rgb(169,169,169)"],darkkhaki:["#bdb76b","rgb(189,183,107)"],darkmagenta:["#8b008b","rgb(139,0,139)"],darkolivegreen:["#556b2f","rgb(85,107,47)"],darkorange:["#ff8c00","rgb(255,140,0)"],darkorchid:["#9932cc","rgb(153,50,204)"],darkred:["#8b0000","rgb(139,0,0)"],darksalmon:["#e9967a","rgb(233,150,122)"],darkseagreen:["#8fbc8f","rgb(143,188,143)"],darkslateblue:["#483d8b","rgb(72,61,139)"],darkslategray:["#2f4f4f","rgb(47,79,79)"],darkslategrey:["#2f4f4f","rgb(47,79,79)"],darkturquoise:["#00ced1","rgb(0,206,209)"],darkviolet:["#9400d3","rgb(148,0,211)"],deeppink:["#ff1493","rgb(255,20,147)"],deepskyblue:["#00bfff","rgb(0,191,255)"],dimgray:["#696969","rgb(105,105,105)"],dimgrey:["#696969","rgb(105,105,105)"],dodgerblue:["#1e90ff","rgb(30,144,255)"],firebrick:["#b22222","rgb(178,34,34)"],floralwhite:["#fffaf0","rgb(255,250,240)"],forestgreen:["#228b22","rgb(34,139,34)"],fuchsia:["#ff00ff","rgb(255,0,255)"],gainsboro:["#dcdcdc","rgb(220,220,220)"],ghostwhite:["#f8f8ff","rgb(248,248,255)"],gold:["#ffd700","rgb(255,215,0)"],goldenrod:["#daa520","rgb(218,165,32)"],gray:["#808080","rgb(128,128,128)"],green:["#008000","rgb(0,128,0)"],greenyellow:["#adff2f","rgb(173,255,47)"],grey:["#808080","rgb(128,128,128)"],honeydew:["#f0fff0","rgb(240,255,240)"],hotpink:["#ff69b4","rgb(255,105,180)"],indianred:["#cd5c5c","rgb(205,92,92)"],indigo:["#4b0082","rgb(75,0,130)"],ivory:["#fffff0","rgb(255,255,240)"],khaki:["#f0e68c","rgb(240,230,140)"],lavender:["#e6e6fa","rgb(230,230,250)"],lavenderblush:["#fff0f5","rgb(255,240,245)"],lawngreen:["#7cfc00","rgb(124,252,0)"],lemonchiffon:["#fffacd","rgb(255,250,205)"],lightblue:["#add8e6","rgb(173,216,230)"],lightcoral:["#f08080","rgb(240,128,128)"],lightcyan:["#e0ffff","rgb(224,255,255)"],lightgoldenrodyellow:["#fafad2","rgb(250,250,210)"],lightgray:["#d3d3d3","rgb(211,211,211)"],lightgreen:["#90ee90","rgb(144,238,144)"],lightgrey:["#d3d3d3","rgb(211,211,211)"],lightpink:["#ffb6c1","rgb(255,182,193)"],lightsalmon:["#ffa07a","rgb(255,160,122)"],lightseagreen:["#20b2aa","rgb(32,178,170)"],lightskyblue:["#87cefa","rgb(135,206,250)"],lightslategray:["#778899","rgb(119,136,153)"],lightslategrey:["#778899","rgb(119,136,153)"],lightsteelblue:["#b0c4de","rgb(176,196,222)"],lightyellow:["#ffffe0","rgb(255,255,224)"],lime:["#00ff00","rgb(0,255,0)"],limegreen:["#32cd32","rgb(50,205,50)"],linen:["#faf0e6","rgb(250,240,230)"],magenta:["#ff00ff","rgb(255,0,255)"],maroon:["#800000","rgb(128,0,0)"],mediumaquamarine:["#66cdaa","rgb(102,205,170)"],mediumblue:["#0000cd","rgb(0,0,205)"],mediumorchid:["#ba55d3","rgb(186,85,211)"],mediumpurple:["#9370db","rgb(147,112,219)"],mediumseagreen:["#3cb371","rgb(60,179,113)"],mediumslateblue:["#7b68ee","rgb(123,104,238)"],mediumspringgreen:["#00fa9a","rgb(0,250,154)"],mediumturquoise:["#48d1cc","rgb(72,209,204)"],mediumvioletred:["#c71585","rgb(199,21,133)"],midnightblue:["#191970","rgb(25,25,112)"],mintcream:["#f5fffa","rgb(245,255,250)"],mistyrose:["#ffe4e1","rgb(255,228,225)"],moccasin:["#ffe4b5","rgb(255,228,181)"],navajowhite:["#ffdead","rgb(255,222,173)"],navy:["#000080","rgb(0,0,128)"],oldlace:["#fdf5e6","rgb(253,245,230)"],olive:["#808000","rgb(128,128,0)"],olivedrab:["#6b8e23","rgb(107,142,35)"],orange:["#ffa500","rgb(255,165,0)"],orangered:["#ff4500","rgb(255,69,0)"],orchid:["#da70d6","rgb(218,112,214)"],palegoldenrod:["#eee8aa","rgb(238,232,170)"],palegreen:["#98fb98","rgb(152,251,152)"],paleturquoise:["#afeeee","rgb(175,238,238)"],palevioletred:["#db7093","rgb(219,112,147)"],papayawhip:["#ffefd5","rgb(255,239,213)"],peachpuff:["#ffdab9","rgb(255,218,185)"],peru:["#cd853f","rgb(205,133,63)"],pink:["#ffc0cb","rgb(255,192,203)"],plum:["#dda0dd","rgb(221,160,221)"],powderblue:["#b0e0e6","rgb(176,224,230)"],purple:["#800080","rgb(128,0,128)"],red:["#ff0000","rgb(255,0,0)"],rosybrown:["#bc8f8f","rgb(188,143,143)"],royalblue:["#4169e1","rgb(65,105,225)"],saddlebrown:["#8b4513","rgb(139,69,19)"],salmon:["#fa8072","rgb(250,128,114)"],sandybrown:["#f4a460","rgb(244,164,96)"],seagreen:["#2e8b57","rgb(46,139,87)"],seashell:["#fff5ee","rgb(255,245,238)"],sienna:["#a0522d","rgb(160,82,45)"],silver:["#c0c0c0","rgb(192,192,192)"],skyblue:["#87ceeb","rgb(135,206,235)"],slateblue:["#6a5acd","rgb(106,90,205)"],slategray:["#708090","rgb(112,128,144)"],slategrey:["#708090","rgb(112,128,144)"],snow:["#fffafa","rgb(255,250,250)"],springgreen:["#00ff7f","rgb(0,255,127)"],steelblue:["#4682b4","rgb(70,130,180)"],tan:["#d2b48c","rgb(210,180,140)"],teal:["#008080","rgb(0,128,128)"],thistle:["#d8bfd8","rgb(216,191,216)"],tomato:["#ff6347","rgb(255,99,71)"],turquoise:["#40e0d0","rgb(64,224,208)"],violet:["#ee82ee","rgb(238,130,238)"],wheat:["#f5deb3","rgb(245,222,179)"],white:["#ffffff","rgb(255,255,255)"],whitesmoke:["#f5f5f5","rgb(245,245,245)"],yellow:["#ffff00","rgb(255,255,0)"],yellowgreen:["#9acd32","rgb(154,205,50)"]},regGroup:{hex:/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,rgb:/rgb\(\s*(\d|\d\d|1\d\d|2[0-4]\d|25[0-5])\s*,\s*(\d|\d\d|1\d\d|2[0-4]\d|25[0-5])\s*,\s*(\d|\d\d|1\d\d|2[0-4]\d|25[0-5])\s*\)/,rgba:/rgba\(\s*(\d|\d\d|1\d\d|2[0-4]\d|25[0-5])\s*,\s*(\d|\d\d|1\d\d|2[0-4]\d|25[0-5])\s*,\s*(\d|\d\d|1\d\d|2[0-4]\d|25[0-5])\s*,\s*(0|1|0\.[1-9])\s*\)/},parseHexToRgbaArray:function(jl){var jm=jl.replace("#","");if(jm.length===3){jm+="f"}else{if(jm.length===6){jm+="ff"}}var e=[];var jk=jm.length;var jj=jk===8?2:1;for(var T=0;T<jk;T=T+jj){if(jj===2){e.push(parseInt(jm.slice(T,T+2),16))}else{e.push(parseInt(jm.slice(T,T+1)+jm.slice(T,T+1),16))}}return e},parseRgbaStrToArray:function(i){var e=[0,0,0,255];if(i.indexOf("rgba(")===0){var jj=i.replace("rgba(","").replace(")","");var T=jj.split(",");e[0]=parseInt(T[0],10);e[1]=parseInt(T[1],10);e[2]=parseInt(T[2],10);e[3]=Math.round(parseFloat(T[3])*255)}else{if(i.indexOf("rgb(")===0){var jj=i.replace("rgb(","").replace(")","");var jk=jj.split(",");e[0]=parseInt(jk[0],10);e[1]=parseInt(jk[1],10);e[2]=parseInt(jk[2],10);e[3]=255}}return e},parseHexAndOpacityToRgbaArray:function(jk,jl){var T=[];var jo=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;var jn=jk.toLowerCase();if(jo.test(jn)){if(jn.length===4){var e="#";for(var jm=1;jm<4;jm++){e+=jn.slice(jm,jm+1).concat(jn.slice(jm,jm+1))}jn=e}for(var jj=1;jj<7;jj+=2){T.push(parseInt(jn.slice(jj,jj+2),16))}T.push(jl)}return T},parseCSSColor:function(e){if(e.indexOf("#")===0){return gW.parseHexToRgbaArray(e)}return gW.parseRgbaStrToArray(e)},rgbToHSV:function(jk){var e=jk[0]/255;var T=jk[1]/255;var jl=jk[2]/255;var jo=Math.max(e,T,jl);var jj=Math.min(e,T,jl);var jn=jo-jj;var i;if(jn===0){i=0}else{if(jo===e){i=60*(((T-jl)/jn)%6)}else{if(jo===T){i=60*((jl-e)/jn+2)}else{if(jo===jl){i=60*((e-T)/jn+4)}}}}var jp=jo===0?0:(jn/jo);var jm=jo;while(i<0){i+=360}return[i,jp,jm]},hsvToRGB:function(jj){var jn=jj[2]*jj[1];var T=jn*(1-Math.abs((jj[0]/60)%2-1));var i=jj[2]-jn;var jk=jj[0];var jm;var jl;var e;if(jk>=0&&jk<60){jm=jn;jl=T;e=0}else{if(jk>=60&&jk<120){jm=T;jl=jn;e=0}else{if(jk>=120&&jk<180){jm=0;jl=jn;e=T}else{if(jk>=180&&jk<240){jm=0;jl=T;e=jn}else{if(jk>=240&&jk<300){jm=T;jl=0;e=jn}else{if(jk>=300&&jk<360){jm=jn;jl=0;e=T}}}}}}jm=(jm+i)*255>255?255:(jm+i)*255;jl=(jl+i)*255>255?255:(jl+i)*255;e=(e+i)*255>255?255:(e+i)*255;return[Math.round(jm),Math.round(jl),Math.round(e)]},formatColorCssToRgbaArray:function(jl,T,jj){jj=(typeof jj!=="boolean")?true:jj;if(typeof jl!=="string"){return jj?[0,0,0,1]:[0,0,0,255]}var i=(jl||"Black").trim().toLowerCase();var e=[];var jk=gW.ColorRefTable[i];if(jk!==undefined){i=jk[0]}e=gW.parseCSSColor(i);if(T!==undefined&&!isNaN(Number(T))){T=Number(T);e[3]=gW.fitTo(T,0,1)}else{e[3]=Number((e[3]/255).toFixed(2))}if(!jj){e[3]=Math.floor(e[3]*255)}return e},fitTo:function(T,i,e){if(T<i){T=i}else{if(T>e){T=e}}return T},generateColorRamp:function(e,jp,jq,jj,jv){jq=jq||[];jj=jj||"#ccc";jv=jv||1;const T=document.createElement("canvas");const jw=T.getContext("2d");T.width=256;T.height=jv;const jl=jp[0];const js=jp[jp.length-1];if(e.length===jp.length){const jt=jw.createLinearGradient(0,0,256,1);for(var jo=0;jo<e.length;++jo){var ju=(jp[jo]-jl)/(js-jl);jt.addColorStop(ju,e[jo])}jw.fillStyle=jt;jw.fillRect(0,0,256,jv)}else{if(e.length-jp.length===-1){var jn=0;var jk=1;for(var jo=0;jo<e.length;++jo){var jr=(jp[jk]-jl)/(js-jl);var ju=Math.floor(jr*256);jw.fillStyle=e[jo];jw.fillRect(jn,0,ju,jv);jn=ju;jk++}}else{jw.fillStyle=jj||"#ccc";jw.fillRect(0,0,256,jv)}}if(e.length-jp.length<=-1&&jq.length===2){jw.fillStyle=jj||"#ccc";var jr=(jq[0]-jl)/(js-jl);var ju=Math.floor(jr*256);jw.fillRect(0,0,ju,jv);jr=(jq[1]-jl)/(js-jl);ju=Math.floor(jr*256);jw.fillRect(ju,0,255,jv)}var jm=new Uint8Array(new Uint8ClampedArray(jw.getImageData(0,0,256,jv).data));return{canvas:T,data:jm,width:256,height:jv}},validateColor:function(e,i){return gW.regGroup[i].test(e)},convert2rgba:function(e,i){if(i===undefined){i=1}if(gW.validateColor(e,"rgba")){return e}if(gW.validateColor(e,"rgb")){e=e.replace(/rgb/g,"rgba");e=e.replace(/\)/,","+i+")");return e}var T=gW.formatColorCssToRgbaArray(e,i,true);return"rgba("+T.join(",")+")"}};(function(jl){function jv(jA,jD){var jC=(jA&65535)+(jD&65535);var jB=(jA>>16)+(jD>>16)+(jC>>16);return(jB<<16)|(jC&65535)}function ju(jA,jB){return(jA<<jB)|(jA>>>(32-jB))}function jp(jF,jC,jB,jA,jE,jD){return jv(ju(jv(jv(jC,jF),jv(jA,jD)),jE),jB)}function e(jC,jB,jG,jF,jA,jE,jD){return jp((jB&jG)|(~jB&jF),jC,jB,jA,jE,jD)}function jm(jC,jB,jG,jF,jA,jE,jD){return jp((jB&jF)|(jG&~jF),jC,jB,jA,jE,jD)}function js(jC,jB,jG,jF,jA,jE,jD){return jp(jB^jG^jF,jC,jB,jA,jE,jD)}function jy(jC,jB,jG,jF,jA,jE,jD){return jp(jG^(jB|~jF),jC,jB,jA,jE,jD)}function T(jK,jF){jK[jF>>5]|=128<<(jF%32);jK[((jF+64)>>>9<<4)+14]=jF;var jC;var jE;var jD;var jB;var jA;var jJ=1732584193;var jI=-271733879;var jH=-1732584194;var jG=271733878;for(jC=0;jC<jK.length;jC+=16){jE=jJ;jD=jI;jB=jH;jA=jG;jJ=e(jJ,jI,jH,jG,jK[jC],7,-680876936);jG=e(jG,jJ,jI,jH,jK[jC+1],12,-389564586);jH=e(jH,jG,jJ,jI,jK[jC+2],17,606105819);jI=e(jI,jH,jG,jJ,jK[jC+3],22,-1044525330);jJ=e(jJ,jI,jH,jG,jK[jC+4],7,-176418897);jG=e(jG,jJ,jI,jH,jK[jC+5],12,1200080426);jH=e(jH,jG,jJ,jI,jK[jC+6],17,-1473231341);jI=e(jI,jH,jG,jJ,jK[jC+7],22,-45705983);jJ=e(jJ,jI,jH,jG,jK[jC+8],7,1770035416);jG=e(jG,jJ,jI,jH,jK[jC+9],12,-1958414417);jH=e(jH,jG,jJ,jI,jK[jC+10],17,-42063);jI=e(jI,jH,jG,jJ,jK[jC+11],22,-1990404162);jJ=e(jJ,jI,jH,jG,jK[jC+12],7,1804603682);jG=e(jG,jJ,jI,jH,jK[jC+13],12,-40341101);jH=e(jH,jG,jJ,jI,jK[jC+14],17,-1502002290);jI=e(jI,jH,jG,jJ,jK[jC+15],22,1236535329);jJ=jm(jJ,jI,jH,jG,jK[jC+1],5,-165796510);jG=jm(jG,jJ,jI,jH,jK[jC+6],9,-1069501632);jH=jm(jH,jG,jJ,jI,jK[jC+11],14,643717713);jI=jm(jI,jH,jG,jJ,jK[jC],20,-373897302);jJ=jm(jJ,jI,jH,jG,jK[jC+5],5,-701558691);jG=jm(jG,jJ,jI,jH,jK[jC+10],9,38016083);jH=jm(jH,jG,jJ,jI,jK[jC+15],14,-660478335);jI=jm(jI,jH,jG,jJ,jK[jC+4],20,-405537848);jJ=jm(jJ,jI,jH,jG,jK[jC+9],5,568446438);jG=jm(jG,jJ,jI,jH,jK[jC+14],9,-1019803690);jH=jm(jH,jG,jJ,jI,jK[jC+3],14,-187363961);jI=jm(jI,jH,jG,jJ,jK[jC+8],20,1163531501);jJ=jm(jJ,jI,jH,jG,jK[jC+13],5,-1444681467);jG=jm(jG,jJ,jI,jH,jK[jC+2],9,-51403784);jH=jm(jH,jG,jJ,jI,jK[jC+7],14,1735328473);jI=jm(jI,jH,jG,jJ,jK[jC+12],20,-1926607734);jJ=js(jJ,jI,jH,jG,jK[jC+5],4,-378558);jG=js(jG,jJ,jI,jH,jK[jC+8],11,-2022574463);jH=js(jH,jG,jJ,jI,jK[jC+11],16,1839030562);jI=js(jI,jH,jG,jJ,jK[jC+14],23,-35309556);jJ=js(jJ,jI,jH,jG,jK[jC+1],4,-1530992060);jG=js(jG,jJ,jI,jH,jK[jC+4],11,1272893353);jH=js(jH,jG,jJ,jI,jK[jC+7],16,-155497632);jI=js(jI,jH,jG,jJ,jK[jC+10],23,-1094730640);jJ=js(jJ,jI,jH,jG,jK[jC+13],4,681279174);jG=js(jG,jJ,jI,jH,jK[jC],11,-358537222);jH=js(jH,jG,jJ,jI,jK[jC+3],16,-722521979);jI=js(jI,jH,jG,jJ,jK[jC+6],23,76029189);jJ=js(jJ,jI,jH,jG,jK[jC+9],4,-640364487);jG=js(jG,jJ,jI,jH,jK[jC+12],11,-421815835);jH=js(jH,jG,jJ,jI,jK[jC+15],16,530742520);jI=js(jI,jH,jG,jJ,jK[jC+2],23,-995338651);jJ=jy(jJ,jI,jH,jG,jK[jC],6,-198630844);jG=jy(jG,jJ,jI,jH,jK[jC+7],10,1126891415);jH=jy(jH,jG,jJ,jI,jK[jC+14],15,-1416354905);jI=jy(jI,jH,jG,jJ,jK[jC+5],21,-57434055);jJ=jy(jJ,jI,jH,jG,jK[jC+12],6,1700485571);jG=jy(jG,jJ,jI,jH,jK[jC+3],10,-1894986606);jH=jy(jH,jG,jJ,jI,jK[jC+10],15,-1051523);jI=jy(jI,jH,jG,jJ,jK[jC+1],21,-2054922799);jJ=jy(jJ,jI,jH,jG,jK[jC+8],6,1873313359);jG=jy(jG,jJ,jI,jH,jK[jC+15],10,-30611744);jH=jy(jH,jG,jJ,jI,jK[jC+6],15,-1560198380);jI=jy(jI,jH,jG,jJ,jK[jC+13],21,1309151649);jJ=jy(jJ,jI,jH,jG,jK[jC+4],6,-145523070);jG=jy(jG,jJ,jI,jH,jK[jC+11],10,-1120210379);jH=jy(jH,jG,jJ,jI,jK[jC+2],15,718787259);jI=jy(jI,jH,jG,jJ,jK[jC+9],21,-343485551);jJ=jv(jJ,jE);jI=jv(jI,jD);jH=jv(jH,jB);jG=jv(jG,jA)}return[jJ,jI,jH,jG]}function jt(jB){var jC;var jA="";var jD=jB.length*32;for(jC=0;jC<jD;jC+=8){jA+=String.fromCharCode((jB[jC>>5]>>>(jC%32))&255)}return jA}function jo(jB){var jD;var jA=[];jA[(jB.length>>2)-1]=undefined;for(jD=0;jD<jA.length;jD+=1){jA[jD]=0}var jC=jB.length*8;for(jD=0;jD<jC;jD+=8){jA[jD>>5]|=(jB.charCodeAt(jD/8)&255)<<(jD%32)}return jA}function jn(jA){return jt(T(jo(jA),jA.length*8))}function jz(jC,jF){var jB;var jE=jo(jC);var jA=[];var jD=[];var jG;jA[15]=jD[15]=undefined;if(jE.length>16){jE=T(jE,jC.length*8)}for(jB=0;jB<16;jB+=1){jA[jB]=jE[jB]^909522486;jD[jB]=jE[jB]^1549556828}jG=T(jA.concat(jo(jF)),512+jF.length*8);return jt(T(jD.concat(jG),512+128))}function jx(jD){var jC="0123456789abcdef";var jB="";var jA;var jE;for(jE=0;jE<jD.length;jE+=1){jA=jD.charCodeAt(jE);jB+=jC.charAt((jA>>>4)&15)+jC.charAt(jA&15)}return jB}function jq(jA){return unescape(encodeURIComponent(jA))}function jj(jA){return jn(jq(jA))}function jr(jA){return jx(jj(jA))}function i(jA,jB){return jz(jq(jA),jq(jB))}function jw(jA,jB){return jx(i(jA,jB))}function jk(jB,jC,jA){if(!jC){if(!jA){return jr(jB)}return jj(jB)}if(!jA){return jw(jC,jB)}return i(jC,jB)}if(typeof define==="function"&&define.amd){define(function(){return jk})}else{if(typeof module==="object"&&module.exports){module.exports=jk}else{jl.md5=jk}}})(this);var cr={levels:{INFO:"info",WARNING:"warning",ERROR:"error"},category:{JS:"js",RESOURCE:"resource",AJAX:"ajax"},config:{jsError:true,resourceError:true,ajaxError:true},hosts:"api.map.baidu.com|webmap0.bdimg.com|maponline0.bdimg.com|",ignoreUrl:"api.map.baidu.com/images/blank.gif",sender:true,collections:[],sendError:function(){},init:function(i,e,T){this.hosts+=i?i:"";ak&&ak(this.config,e);this.sender=true;if(T){this.sender=false}this.hosts=this.urlScope(this.hosts);this.sendError=this.notifyError();var jj=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};this.config.jsError&&this.handleJavaScriptError(jj);this.config.resourceError&&this.handleResourceError(jj);this.config.ajaxError&&this.handleAjaxError(jj)},handleJavaScriptError:function(T){var e=this;var i=T.onerror;T.onerror=function(jn,jm,jj,jl,jk){if(e.isFetch(e.category.JS)&&e.hostExit(jm)){if(jk&&jk.stack){e.sendError({title:jn,msg:jk.stack,category:e.category.JS,level:e.levels.ERROR})}else{if(typeof jn==="string"){e.sendError({title:jn,msg:JSON.stringify({resourceUrl:jm,rowNum:jj,colNum:jl}),category:"js",level:e.levels.ERROR})}}}if(i&&bH(i)){i&&i.apply(T,arguments)}}},handleResourceError:function(i){var e=this;i.addEventListener("error",function(jl){if(jl){var jm=jl.target||jl.srcElement;var jk=jm instanceof HTMLScriptElement||jm instanceof HTMLLinkElement||jm instanceof HTMLImageElement;if(!jk){if(!i.onerror){var T=jl.filename||null;if(!e.isFetch(e.category.JS)||!e.hostExit(T)){return}if(jl.error&&jl.error.stack){e.sendError({title:jl.message,msg:jl.error.stack,category:e.category.JS,level:e.levels.ERROR})}else{if(typeof jl.message==="string"){e.sendError({title:jl.message,msg:JSON.stringify({resourceUrl:T,rowNum:jl.lineno,colNum:jl.cowno}),category:e.category.JS,level:e.levels.ERROR})}}}return}var jj=jm.src||jm.href;if(e.isFetch(e.category.RESOURCE)&&e.hostExit(jj)){e.sendError({title:jm.nodeName,msg:jj,category:e.category.RESOURCE,level:e.levels.ERROR})}}},true)},handleAjaxError:function(jl){var e=this;var jk=jl.location.protocol;if(jk==="file:"){return}if(!jl.XMLHttpRequest){return}var i=jl.XMLHttpRequest;var T=i.prototype.send;var jj=function(jn){if(jn&&jn.currentTarget&&jn.currentTarget.status!==200){var jm=jn.target.responseURL;if(e.isFetch(e.category.AJAX)&&e.hostExit(jm)){e.sendError({title:jm,msg:JSON.stringify({response:jn.target.response,responseURL:jm,status:jn.target.status,statusText:jn.target.statusText}),category:e.category.AJAX,level:e.levels.ERROR})}}};i.prototype.send=function(){if(this["addEventListener"]){this["addEventListener"]("error",jj);this["addEventListener"]("load",jj);this["addEventListener"]("abort",jj)}else{var jm=this["onreadystatechange"];this["onreadystatechange"]=function(jn){if(this.readyState===4){jj(jn)}jm&&jm.apply(this,arguments)}}return T.apply(this,arguments)}},notifyError:function(T){var i=T||1000;this._idleWorkerTicker=(function(jj){return function(){jj.runJob()}})(this);var e=this;return function(jk){if(jk.url){if(!e.isFetch(jk.category)){return}var jj=jk.url||"";if(!e.hostExit(jj)){return}delete jk.url}if(!navigator.onLine){return}e.collections.push(jk);e.checkJob(i)}},runJob:function(){if(this.collections.length===0){clearInterval(this.idleWork);this.idleWork=null;return}var jk=this.collections.slice(0,2);var T=iw(JSON.stringify({dataset:jk}));var jj=new Date().getTime();var i=d6.apiIMG+"/blank.gif?product=jsapi&v=gl&l="+T+"&ak="+eo+"&t="+jj;if(this.sender){try{var jm=document.createElement("div");jm.style="width:0;height:0;visibility: hidden;opacity: 0;z-index:-999;background-image: url("+i+");";document.querySelector("BODY").appendChild(jm);setTimeout(function(){document.querySelector("BODY").removeChild(jm)})}catch(jl){}}this.collections.splice(0,2);if(this.collections.length===0){clearInterval(this.idleWork);this.idleWork=null}},checkJob:function(e){if(!this.idleWork&&this._idleWorkerTicker){this.idleWork=setInterval(this._idleWorkerTicker,e)}},urlScope:function(jj){var T={};var jl=Object.keys(w);if(w&&jl.length>0){for(var jk in w){if(w[jk]&&(typeof w[jk]!=="function")){T[jk]=w[jk]}}}try{var jn=JSON.stringify(T);if(jn.length>2){return jj+"|"+jn}else{return jj}}catch(jm){return jj}},hostExit:function(i){try{if(i&&i.indexOf("//")===0){i=window.location.protocol+i}var T=new URL(i);if(!T||!T.host){return false}var jk=T.host+T.pathname;if(this.ignoreUrl.indexOf(jk)===-1&&this.hosts.indexOf(T.host)>-1){return true}return false}catch(jj){return false}},isFetch:function(e){return this.config[e+"Error"]||false}};bp.fetchDebug=cr;var i4={request:function(jr,jn,jj,ju,jl){var jo=new Date()["getTime"]();var jq=(Math.random()*100000)["toFixed"](0);bp._rd["_cbk"+jq]=function(jv){if(jv.result&&jv.result["error"]&&jv.result["error"]===202){alert("该AK因为恶意行为已经被管理员封禁！");return}jj=jj||{};jr&&jr(jv,jj);delete bp._rd["_cbk"+jq]};ju=ju||"";var jt;var jk;if(jj&&jj.useEncodeURI){jt=ix(jn,encodeURI);jk=ix(jn)}else{jt=ix(jn,encodeURIComponent);jk=ix(jn)}var i=w.apiHost+"/"+ju+"?"+jt+"&ie=utf-8&oue=1&fromproduct=jsapi";var jp=w.apiHost+"/"+ju+"?"+jk+"&ie=utf-8&oue=1&fromproduct=jsapi";if(!jl){i+="&res=api";jp+="&res=api"}i+="&callback="+e2+"._rd._cbk"+jq;jp+="&callback="+e2+"._rd._cbk"+jq;var jm=window.___abvk?window.___abvk:i4.getSeckeyCidItem("SECKEY_ABVK");var e=i4.getSeckeyCidItem("BMAP_SECKEY");var js=encodeURIComponent(jm+","+e);var T=jm+","+e;i+="&ak="+eo+"&v=gl&seckey="+js+"&timeStamp="+jo;jp+="&ak="+eo+"&v=gl&seckey="+T+"&timeStamp="+jo;i+=iz()(jp);gf.load(i)},getSeckeyCidItem:function(i){if(navigator.cookieEnabled){var T=new RegExp("(^| )"+i+"=([^;]*)(;|$)");var e=document.cookie.match(T);if(e){return unescape(e[2])}return -1}if(localStorage){return localStorage.getItem(i)?localStorage.getItem(i):-1}if(sessionStorage){return sessionStorage.getItem(i)?localStorage.getItem(i):-1}}};window.srqtimer=null;window.firstTime=true;window.srqcount=0;bp._rd={};var cW={request:function(jm,e){if(e){var jl=(Math.random()*100000).toFixed(0);BMapGL._rd["_cbk"+jl]=function(jo){e&&e(jo);delete BMapGL._rd["_cbk"+jl]};jm+="&callback=BMapGL._rd._cbk"+jl}function jk(jp){var jo;var jq=new RegExp("(^| )"+jp+"=([^;]*)(;|$)");if(jo=document.cookie.match(jq)){return unescape(jo[2])}else{return -1}}if(jm.indexOf("v=")===-1){jm+="&v=gl"}var T=window.___abvk?window.___abvk:this.getSeckeyCidItem("SECKEY_ABVK");var jn=this.getSeckeyCidItem("BMAP_SECKEY");var i=encodeURIComponent(T+","+jn);jm+="&seckey="+i;var jj=bL("script",{src:jm,type:"text/javascript",charset:"utf-8"});if(jj.addEventListener){jj.addEventListener("load",function(jp){var jo=jp.target;jo.parentNode.removeChild(jo)},false);jj.addEventListener("error",function(jo){e&&e([,,,,,])},false)}else{if(jj.attachEvent){jj.attachEvent("onreadystatechange",function(jp){var jo=window.event.srcElement;if(jo&&(jo.readyState=="loaded"||jo.readyState=="complete")){jo.parentNode.removeChild(jo)}})}}document.getElementsByTagName("head")[0].appendChild(jj);jj=null},getSeckeyCidItem:function(i){if(navigator.cookieEnabled){var T=new RegExp("(^| )"+i+"=([^;]*)(;|$)");var e=document.cookie.match(T);if(e){return unescape(e[2])}return -1}if(localStorage){return localStorage.getItem(i)?localStorage.getItem(i):-1}if(sessionStorage){return sessionStorage.getItem(i)?localStorage.getItem(i):-1}}};function ga(){this._map=null;this._container;this._type="control";this.blockInfoWindow=true;this._visible=true}ga.inherits(cN,"Control");ey.extend(ga.prototype,{initialize:function(e){this._map=e;if(this._container){if(this._opts&&this._opts.container){this._opts.container.appendChild(this._container)}else{e.container.appendChild(this._container)}return this._container}return},_i:function(e){if(!this._container&&this.initialize&&bH(this.initialize)){this._container=this.initialize(e)}this._opts=this._opts||{printable:false};this._setStyle();this._setPosition();if(this._container){this._container._jsobj=this}},_setStyle:function(){var i=this._container;if(i){var e=i.style;e.position="absolute";e.zIndex=this._cZIndex||"10";e.MozUserSelect="none";if(!this._opts.printable){ey.ac(i,"BMap_noprint")}ey.on(i,"contextmenu",gM)}},remove:function(){this._map=null;if(!this._container){return}this._container.parentNode&&this._container.parentNode.removeChild(this._container);this._container._jsobj=null;this._container=null},_render:function(e){if(this._opts&&this._opts.container){this._container=bB(this._opts.container,'<div unselectable="on"></div>')}else{var i='<div unselectable="on"></div>';if(e&&e.config.autoSafeArea&&cc()){this._safeAreaContainer=bB(this._map.container,i);this._safeAreaContainer.style.position="absolute";this._safeAreaContainer.style.bottom="env(safe-area-inset-bottom)";this._container=bB(this._safeAreaContainer,i)}else{this._container=bB(this._map.container,i)}}if(this._visible===false){this._container.style.display="none"}return this._container},_setPosition:function(){this.setAnchor(this._opts.anchor)},setAnchor:function(jj){if(this.anchorFixed||typeof jj!=="number"||isNaN(jj)||jj<BMAP_ANCHOR_TOP_LEFT||jj>BMAP_ANCHOR_BOTTOM_RIGHT){jj=this.defaultAnchor}this._opts.offset=this._opts.offset||this.defaultOffset;var T=this._opts.anchor;this._opts.anchor=jj;if(!this._container){return}var jl=this._container;var e=this._opts.offset.width;var jk=this._opts.offset.height;jl.style.left=jl.style.top=jl.style.right=jl.style.bottom="auto";switch(jj){case BMAP_ANCHOR_TOP_LEFT:jl.style.top=jk+"px";jl.style.left=e+"px";break;case BMAP_ANCHOR_TOP_RIGHT:jl.style.top=jk+"px";jl.style.right=e+"px";break;case BMAP_ANCHOR_BOTTOM_LEFT:jl.style.bottom=jk+"px";jl.style.left=e+"px";break;case BMAP_ANCHOR_BOTTOM_RIGHT:jl.style.bottom=jk+"px";jl.style.right=e+"px";break;default:break}var i=["TL","TR","BL","BR"];ey.rc(this._container,"anchor"+i[T]);ey.ac(this._container,"anchor"+i[jj])},getAnchor:function(){return this._opts.anchor},setOffset:function(e){if(!e){return}this._opts=this._opts||{};this._opts.offset=new id(e.width,e.height);if(!this._container){return}this.setAnchor(this._opts.anchor)},getOffset:function(){return this._opts.offset},getDom:function(){return this._container},show:function(){if(this._visible===true){return}this._visible=true;if(this._container){this._container.style.display=""}this.dispatchEvent(new ff("onshow"))},hide:function(){if(this._visible===false){return}this._visible=false;if(this._container){this._container.style.display="none"}this.dispatchEvent(new ff("onhide"))},isPrintable:function(){return !!this._opts.printable},isVisible:function(){if(!this._container&&!this._map){return false}return !!this._visible},_asyncLoadCode:function(){var e=this;gs.load("control",function(){if(e._asyncDraw){e._asyncDraw()}})}});var dR={TOP_LEFT:0,TOP_RIGHT:1,BOTTOM_LEFT:2,BOTTOM_RIGHT:3};bp.ControlAnchor=dR;window.BMAP_ANCHOR_TOP_LEFT=0;window.BMAP_ANCHOR_TOP_RIGHT=1;window.BMAP_ANCHOR_BOTTOM_LEFT=2;window.BMAP_ANCHOR_BOTTOM_RIGHT=3;function fA(e){ga.call(this);e=e||{};this._opts={printable:false};ey.extend(this._opts,e);this._copyrightCollection=[];this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT;this.defaultOffset=new id(5,2);this.setAnchor(e.anchor);this._canShow=true;this.sateMapStyle=false;this.blockInfoWindow=false;this._asyncLoadCode()}fA.inherits(ga,"CopyrightControl");ey.extend(fA.prototype,{initialize:function(e){this._map=e;return this._container},addCopyright:function(jj){var e={minZoom:0,bounds:null,content:"",mapType:""};for(var T in jj){e[T]=jj[T]}if(this._map){var jm=e.minZoom;if(jm===-1||jm<this._map.getMinZoom()||jm>this._map.getMaxZoom()){e.minZoom=this._map.getMinZoom()}if(e.mapType!==""&&!dU[e.mapType]){e.mapType=BMAPGL_NORMAL_MAP}}var jk=this.getCopyright(jj.id);if(jk){for(var jl in e){jk[jl]=e[jl]}}else{this._copyrightCollection.push(e)}},getCopyright:function(jj){for(var T=0,e=this._copyrightCollection.length;T<e;T++){if(this._copyrightCollection[T].id===jj){return this._copyrightCollection[T]}}},addSateMapStyle:function(){this.sateMapStyle=true;if(this._container){ey.ac(this._container,"BMap_cpyCtrl_w")}},removeSateMapStyle:function(){this.sateMapStyle=false;if(this._container){ey.rc(this._container,"BMap_cpyCtrl_w")}}});function bk(e){ga.call(this);e=e||{};this.canCheckSize=e.canCheckSize===false?false:true;this.curCityName="";this.curCityCode="";this.defaultOffset=new id(10,10);this.defaultAnchor=dR.TOP_LEFT;this.onChangeBefore=[];this.onChangeAfter=[];this.onChangeSuccess=[];this._opts={printable:false,offset:e.offset||this.defaultOffset,anchor:e.anchor||this.defaultAnchor,expand:!!(e.expand)};if(e.onChangeBefore&&bH(e.onChangeBefore)){this.onChangeBefore.push(e.onChangeBefore)}if(e.onChangeAfter&&bH(e.onChangeAfter)){this.onChangeAfter.push(e.onChangeAfter)}if(e.onChangeSuccess&&bH(e.onChangeSuccess)){this.onChangeSuccess.push(e.onChangeSuccess)}this.setAnchor(e.anchor);this._asyncLoadCode()}bk.inherits(ga,"CityListControl");ey.extend(bk.prototype,{initialize:function(e){this._map=e;return this._container}});function ji(e){ga.call(this);e=e||{};this._opts={printable:false};this._opts=ey.extend(ey.extend(this._opts,{unit:"metric"}),e);this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT;this.defaultOffset=new id(81,18);if(bK()){this.defaultOffset=new id(75,10)}this.setAnchor(e.anchor);this._units={metric:{name:"metric",conv:1,incon:1000,u1:"米",u2:"公里"},us:{name:"us",conv:3.2808,incon:5280,u1:"英尺",u2:"英里"}};this.sateMapStyle=false;if(!this._units[this._opts.unit]){this._opts.unit="metric"}this._scaleText=null;this._numberArray={};this._asyncLoadCode()}window.BMAP_UNIT_METRIC="metric";window.BMAP_UNIT_IMPERIAL="us";ji.inherits(ga,"ScaleControl");ey.extend(ji.prototype,{initialize:function(e){this._map=e;return this._container},setUnit:function(e){this._opts.unit=this._units[e]&&this._units[e].name||this._opts.unit},getUnit:function(){return this._opts.unit},addSateMapStyle:function(){this.sateMapStyle=true;var e=this._container;if(e){ey.ac(e.children[0],"dark")}},removeSateMapStyle:function(){this.sateMapStyle=false;var e=this._container;if(e){ey.rc(e.children[0],"dark")}}});window.BMAP_NAVIGATION_CONTROL_LARGE=0;window.BMAP_NAVIGATION_CONTROL_SMALL=1;window.BMAP_NAVIGATION_CONTROL_PAN=2;window.BMAP_NAVIGATION_CONTROL_ZOOM=3;window.BMAP_NAVIGATION_CONTROL_ANIM=4;function iP(e){ga.call(this);e=e||{};this._opts={printable:false};ey.extend(this._opts,e);this.controlHeight=[{width:65,height:227,zoomHeight:227,zoomWidth:37,sliderHeight:180},{width:65,height:47,zoomHeight:(this._opts.forceNew===true)?56:47,zoomWidth:37,sliderHeight:0},{width:37,height:57,zoomHeight:0,zoomWidth:0,sliderHeight:0},{width:26,height:56,zoomHeight:56,zoomWidth:6,sliderHeight:0},{width:56,height:47,zoomHeight:47,zoomWidth:37,sliderHeight:180}];this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT;this.defaultOffset=new id(10,10);this.setAnchor(e.anchor);this.setType(e.type);this._maxTotalZoomLv=19;this._minZoomLevel=-1;this._maxZoomLevel=-1;this._totalZoomLv=-1;this._sliderInterval=10;this._sliderHeight=180;this._minBarY=1;this._maxBarY=-1;this._curBarY=-1;this._zoomDom=null;this._zoomBtnDom=null;this._sliderDom=null;this._sliderBaseDom=null;this._cZIndex="1100";this._asyncLoadCode()}iP.inherits(ga,"NavigationControl");ey.extend(iP.prototype,{initialize:function(e){this._map=e;return this._container},setType:function(e){if(typeof e=="number"&&e>=BMAP_NAVIGATION_CONTROL_LARGE&&e<=BMAP_NAVIGATION_CONTROL_ANIM){this._opts.type=e}else{this._opts.type=BMAP_NAVIGATION_CONTROL_LARGE}},getType:function(){return this._opts.type}});function u(i){ga.call(this);i=i||{};this._opts={printable:false};this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT;this.defaultOffset=new id(10,10);this.setAnchor(i.anchor);this._opts=ey.extend(ey.extend(this._opts,{offset:this.defaultOffset,enableSwitch:true}),i);var e=this;gs.load("control",function(){e._asyncDraw()})}u.inherits(ga,"MapTypeControl");ey.extend(u.prototype,{initialize:function(e){this._map=e;return this._container},showStreetLayer:function(e){this._map.showStreetLayer(e)}});function ip(e){ga.call(this);e=e||{};this._opts={};this._opts=ey.extend(this._opts,e);this._zoomInDisabled=false;this._zoomOutDisabled=false;this._zoomInTapped=false;this._zoomOutTapped=false;this.defaultAnchor=dR.BOTTOM_RIGHT;this.defaultOffset=new id(15,20);this.setAnchor(e.anchor);this._asyncLoadCode()}ip.inherits(ga,"ZoomControl");ey.extend(ip.prototype,{initialize:function(e){this._map=e;return this._container}});function fS(e){ga.call(this);e=e||{};this._opts={autoZoom:true,autoViewport:true};this._opts=ey.extend(this._opts,e);this.defaultAnchor=dR.BOTTOM_LEFT;this.defaultOffset=new id(10,50);this.watchPosition=this._opts.watchPosition||false;this.useCompass=this._opts.useCompass||false;this.locMarker=null;this.locLevel=16;this.setAnchor(this._opts.anchor);this.onLocationStart=e.onLocationStart||null;this._asyncLoadCode()}fS.inherits(ga,"LocationControl");ey.extend(fS.prototype,{initialize:function(e){this._map=e;return this._container},startLocation:function(){this._startLocationCalled=true},stopLocationTrace:function(){},setOptions:function(e){e=e||{};ey.extend(this._opts,e)}});function bs(e){ga.call(this);e=e||{};this._opts={};this._opts=ey.extend(this._opts,e);this.defaultAnchor=dR.BOTTOM_LEFT;this.defaultOffset=new id(5,15);if(bK()){this.defaultOffset=new id(10,10)}this.setAnchor(e.anchor)}bs.inherits(ga,"LogoControl");ey.extend(bs.prototype,{initialize:function(i){this._map=i;var e=this._container=document.createElement("div");e.innerHTML='<img src="'+w.apiHost+'/images/logo_hd.png"  style="height:21px;width:62px;"/>';i.getContainer().appendChild(e);return e}});function an(e,i){this._map=e;this._indoorInfo=i;this._visible=true;this._adjustVisible=true;this._isMobile=bK();this._sizeConfig={FLOOR_BTN_HEIGHT:this._isMobile?35:26,SWITCH_ARROW_HEIGHT:this._isMobile?20:15};this._init()}an.prototype._init=function(){this._render();this._bindDom();this._bind();this._adjustDisplayHeight();var e=new ff("onindoor_bar_show");e.uid=this._indoorInfo.uid;this._map.dispatchEvent(e)};an.prototype._render=function(){if(!this._indoorInfo){return}var jn=this._isMobile;var e=this._div=bL("div");ey.ac(e,"floor-select-container");jn&&ey.ac(e,"mobile");jn&&ey.ac(e,"all-border-radius");var i=this._btnTop=bL("button");ey.ac(i,"floor-switch-top");ey.ac(i,"top-border-radius");var jl=bL("div");ey.ac(jl,"floor-switch-top-icon");i.appendChild(jl);var jk=this._btnBottom=bL("button");var T=bL("div");ey.ac(T,"floor-switch-bottom-icon");jk.appendChild(T);ey.ac(jk,"floor-switch-bottom");ey.ac(jk,"bottom-border-radius");var jj=this._floorsContainer=bL("div");ey.ac(jj,"floors-container");jj.appendChild(this._createFloorsDom());this._div.appendChild(i);this._div.appendChild(jj);this._div.appendChild(jk);var jo=0;if(this._btnTop.style.display===""){jo=2*this._sizeConfig.SWITCH_ARROW_HEIGHT}this._div.style.height=parseInt(this._floorsContainer.style.height,10)+jo+"px";this._map.getContainer().appendChild(this._div);if(!jn){var jm=this;setTimeout(function(){jm._div.style.right="20px"},20)}};an.prototype._createFloorsDom=function(){if(!this._indoorInfo){return}var T=this._ol=bL("ol");var jl=this._indoorInfo.currentFloor;for(var jk=this._indoorInfo.floors.length-1;jk>=0;jk--){var jm=this._indoorInfo.floors[jk].floorName;var e=bL("li");var jj=bL("button");ey.ac(jj,"btn-select-floor");if(jk===jl){ey.ac(jj,"selected")}jj.setAttribute("data-floor",jk);jj.innerHTML=jm;e.appendChild(jj);T.appendChild(e)}return T};an.prototype._updateUI=function(){if(!this._ol){this._render();this._bind();this._adjustDisplayHeight();return}this._ol=null;this._ol=this._createFloorsDom();this._floorsContainer.innerHTML="";this._floorsContainer.appendChild(this._ol);this._adjustDisplayHeight()};an.prototype._bindDom=function(){var e=this;ey.on(this._floorsContainer,"click",function(jj){var T=jj.target||jj.srcElement;if(T.tagName.toLowerCase()==="button"){e._map.showIndoor(e._indoorInfo.uid,parseInt(T.getAttribute("data-floor"),10));var i=new ff("onindoor_bar_click");i.uid=e._indoorInfo.uid;e._map.dispatchEvent(i)}});ey.on(this._floorsContainer,"mouseover",function(T){var i=T.target;if(i.tagName.toLowerCase()==="button"){ey.ac(i,"hover")}});ey.on(this._floorsContainer,"mouseout",function(T){var i=T.target;if(i.tagName.toLowerCase()==="button"){ey.rc(i,"hover")}});ey.on(this._floorsContainer,"touchstart",function(T){var i=T.target;if(i.tagName.toLowerCase()==="button"){ey.ac(i,"onmousedown")}});ey.on(this._floorsContainer,"touchend",function(T){var i=T.target;if(i.tagName.toLowerCase()==="button"){ey.rc(i,"onmousedown")}});ey.on(this._btnTop,"mouseover",function(i){if(this._disable){return}ey.ac(this,"hover")});ey.on(this._btnTop,"mouseout",function(i){ey.rc(this,"hover")});ey.on(this._btnBottom,"mouseover",function(i){if(this._disable){return}ey.ac(this,"hover")});ey.on(this._btnBottom,"mouseout",function(i){ey.rc(this,"hover")});ey.on(this._btnTop,"touchstart",function(i){if(this.className.indexOf("disable")>-1){return}ey.ac(this,"onmousedown")});ey.on(this._btnTop,"touchend",function(i){ey.rc(this,"onmousedown")});ey.on(this._btnBottom,"touchstart",function(i){if(this.className.indexOf("disable")>-1){return}ey.ac(this,"onmousedown")});ey.on(this._btnBottom,"touchend",function(i){ey.rc(this,"onmousedown")});ey.on(this._btnTop,"click",function(i){e._setBarSliderTop(parseInt(e._ol.style.top,10)+26)});ey.on(this._btnBottom,"click",function(i){e._setBarSliderTop(parseInt(e._ol.style.top,10)-26)});ey.on(this._div,"mousemove",ad);ey.on(this._div,"wheel",gM);ey.on(this._div,"mousewheel",gM);this._map.addEventListener("resize",function(){e._adjustDisplayHeight()})};an.prototype._adjustDisplayHeight=function(){if(!this._indoorInfo){return}var jl=this._map.getSize().height;var jm=this._sizeConfig.FLOOR_BTN_HEIGHT;var jn=jl-291-100;if(this._isMobile){jn=jl-12-108-this._map.config.bottomOffset}var e=this._indoorInfo.floors.length;var T=e*jm;var jj=e;var jp=0;var jq=this._floorsContainer.children[0];if(T>jn){this._showArrow=true;ey.rc(jq.children[0].children[0],"top-border-radius");ey.rc(jq.children[e-1].children[0],"bottom-border-radius")}else{this._showArrow=false;ey.ac(jq.children[0].children[0],"top-border-radius");ey.ac(jq.children[e-1].children[0],"bottom-border-radius")}while(T>jn){if(jj===0){break}jj--;jp=2*this._sizeConfig.SWITCH_ARROW_HEIGHT;T=jj*jm+jp}this._currentDisplayHeight=T;if(jj<3){this._setAdjustVisbile(false)}else{this._setAdjustVisbile(true)}this._floorsContainer.style.height=jj*jm+"px";var jk=this._indoorInfo.currentFloor;var i=e-jk;var jo=jk-1;this._div.style.height=parseInt(this._floorsContainer.style.height,10)+jp+"px";var jr=-(e-(jk+Math.round(jj/2)))*jm;this._setBarSliderTop(jr);if(jj<e){ey.show(this._btnTop);ey.show(this._btnBottom)}else{ey.hide(this._btnTop);ey.hide(this._btnBottom);this._setBarSliderTop(0)}if(this._isMobile){this._div.style.bottom=108+this._map.config.bottomOffset+"px"}};an.prototype._setBarSliderTop=function(jj){var T=26;var i=this._indoorInfo.floors.length;var e=i*T;if(this._currentDisplayHeight){if(this._showArrow){e=this._currentDisplayHeight-30}else{e=this._currentDisplayHeight}}if(e-jj>=i*T){jj=e-i*T;ey.ac(this._btnBottom,"disable");ey.rc(this._btnBottom,"hover");this._btnBottom._disable=true}else{ey.rc(this._btnBottom,"disable");this._btnBottom._disable=false}if(jj>=0){jj=0;ey.ac(this._btnTop,"disable");ey.rc(this._btnTop,"hover");this._btnTop._disable=true}else{ey.rc(this._btnTop,"disable");this._btnTop._disable=false}this._ol.style.top=jj+"px"};an.prototype._setAdjustVisbile=function(e){if(this._adjustVisible===e){return}this._adjustVisible=e;if(e&&this._visible){this._div.style.right="20px"}else{this._div.style.right="-30px"}};an.prototype._bind=function(){var i=this._map;var e=this;i.on("indoor_status_changed",function(jn){if(e._visible===false){return}var T=e._ol;var jl=jn.uid;if(!jl){return}var jm=jn.floor;for(var jk=0;jk<T.children.length;jk++){var jj=T.children[jk].children[0];if(parseInt(jj.getAttribute("data-floor"),10)===jm){ey.ac(jj,"selected")}else{ey.rc(jj,"selected")}}});i.on("zoomend",function(T){if(this.getZoom()<17){e._setAdjustVisbile(false)}else{e._setAdjustVisbile(true)}})};an.prototype.setInfo=function(e){if(this._indoorInfo&&this._indoorInfo.uid===e.uid){return}this._indoorInfo=e;this._updateUI()};an.prototype.show=function(){if(this._visible===true){return}this._visible=true;if(!this._isMobile){this._div.style.right="20px"}else{this._div.style.display=""}var e=new ff("onindoor_bar_show");e.uid=this._indoorInfo.uid;this._map.dispatchEvent(e)};an.prototype.hide=function(){if(this._visible===false){return}this._visible=false;if(!this._isMobile){this._div.style.right="-30px"}else{this._div.style.display="none"}};function eA(e){this._opts=e||{};this.defaultOffset=new id(2,80);this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT;if(this._opts.anchor===undefined){this.setAnchor(this.defaultAnchor)}else{this.setAnchor(this._opts.anchor)}this._firstAnimation=true}eA.inherits(ga,"NavigationControl3D");ey.extend(eA.prototype,{initialize:function(T){this._map=T;this._createDom();this._bindDom();this._bind();if(!bK()){this._headingControl=new hV(this._map,this._div)}this._tiltControl=new cy(this._map,this._div);this._render();var i=this._map.getMapType();var e=this;if(i==="B_EARTH_MAP"||this._map._renderType==="webgl"){e._div.style.opacity="1";e._div.style.visibility="visible"}else{e._div.style.opacity="0";e._div.style.visibility="hidden"}return this._container},_createDom:function(){var i=this._div=document.createElement("div");this._container=i;var e=i.style;e.position="absolute";e.zIndex=5;e.width="52px";e.height="82px";e.right="-3px";e.bottom="79px";e.opacity="0";e.visibility="hidden";e.WebkitTransition=e.transition="opacity .3s ease-out,visibility .3s ease-out"},_render:function(){var e=document.getElementById("map-operate");if(e){e.appendChild(this._div)}else{this._map.getContainer().appendChild(this._div)}},_bindDom:function(){this._div.addEventListener("mousemove",ad)},_bind:function(){if(this._map._renderType==="webgl"){return}var e=this;this._map.on("maptypechange",function(){if(this.mapType==="B_EARTH_MAP"){if(e._firstAnimation){e._firstAnimation=false;setTimeout(function(){e._div.style.opacity="1";e._div.style.visibility="visible"},300)}else{e._div.style.opacity="1";e._div.style.visibility="visible"}}else{e._div.style.opacity="0";e._div.style.visibility="hidden"}})}});function hV(T,i){this._map=T;this._target=T;var jj=T.temp.originMapType||T.mapType;if(jj==="B_EARTH_MAP"&&T._earth){this._target=T._earth}this._outContainer=i||T.getContainer();this._imgRatio=fI()>=g5.HIGH_RES_MIN_RATIO?2:1;this._imgPath=w.imgPath+"earth-navi-control-pc4"+(this._imgRatio===2?"-2x.png":".png");this._enabled=true;var e=this;this._setHeadingOptions={callback:function(){e._target.setLock(false)}};this._init()}ey.extend(hV.prototype,{_init:function(){this._createDom();this._render();this._bindDom();this._bind();this._updateUI();this._checkEnable()},_checkEnable:function(){if(this._target.getZoom()>=this._target._enableHeadingZoom){this.enable()}else{this.disable()}},_createDom:function(){var i=this._div=bL("div");var e=i.style;e.position="absolute";e.zIndex=5;e.top="0";e.left="0";e.width="52px";e.height="54px";e.background="url("+this._imgPath+") no-repeat";e.backgroundSize="266px auto";this._rotateCCW=this._createButton();this._rotateCCW.title="逆时针转动";e=this._rotateCCW.style;e.left="2px";e.top="5px";e.zIndex="1";e.width="15px";e.height="42px";e.backgroundPosition="-75px -5px";this._rotateCW=this._createButton();this._rotateCW.title="顺时针转动";e=this._rotateCW.style;e.right="2px";e.top="5px";e.zIndex="1";e.width="15px";e.height="42px";e.backgroundPosition="-75px -5px";e.WebkitTransform=e.transform="scaleX(-1)";this._compass=this._createButton();this._compass.title="恢复正北方向";e=this._compass.style;e.left="19px";e.top="4px";e.width="14px";e.height="44px";e.backgroundPosition="-56px -4px";e.WebkitTransform=e.transform="rotate(0deg)";this._div.appendChild(this._rotateCCW);this._div.appendChild(this._compass);this._div.appendChild(this._rotateCW);this._domRendered=true},_createButton:function(){var e=bL("button");var i=e.style;i.position="absolute";i.outline="none";i.border="none";i.background="url("+this._imgPath+") no-repeat";i.backgroundSize="266px auto";i.cursor="pointer";return e},_render:function(){this._outContainer.appendChild(this._div)},enable:function(){this._enabled=true;if(this._domRendered){this._rotateCCW.style.cursor="pointer";this._rotateCCW.style.opacity=1;this._rotateCW.style.cursor="pointer";this._rotateCW.style.opacity=1;this._compass.style.cursor="pointer";this._compass.style.opacity=1}},disable:function(){this._enabled=false;if(this._domRendered){this._rotateCCW.style.cursor="";this._rotateCCW.style.opacity=0.4;this._rotateCW.style.cursor="";this._rotateCW.style.opacity=0.4;this._compass.style.cursor="";this._compass.style.opacity=0.4}},_bindDom:function(){hP(this._div,["mousedown","click","dblclick"]);var i=this._map;var e=this;this._rotateCW.addEventListener("click",function(){if(e._isOperating||e._enabled===false){return}if(e._target.getLock()){return}if(e._target.getHeading()===360){e._target.setHeading(0)}e._target.setLock(true);e._target.setHeading(e._target.getHeading()+90,e._setHeadingOptions);i.fire(new ff("onrotatecwclick"))},false);this._rotateCCW.addEventListener("click",function(){if(e._isOperating||e._enabled===false){return}if(e._target.getLock()){return}if(e._target.getHeading()===-360){e._target.setHeading(0)}e._target.setLock(true);e._target.setHeading(e._target.getHeading()-90,e._setHeadingOptions);i.fire(new ff("onrotateccwclick"))},false);this._rotateCW.addEventListener("mouseover",function(){if(e._enabled===false){return}this.style.backgroundPosition="-89px -5px"},false);this._rotateCW.addEventListener("mouseout",function(){if(e._enabled===false){return}this.style.backgroundPosition="-75px -5px"},false);this._rotateCCW.addEventListener("mouseover",function(){if(e._enabled===false){return}this.style.backgroundPosition="-89px -5px"},false);this._rotateCCW.addEventListener("mouseout",function(){if(e._enabled===false){return}this.style.backgroundPosition="-75px -5px"},false);this._compass.addEventListener("click",function(){if(e._isOperating||e._enabled===false){return}if(e._target.getLock()){return}e._target.setLock(true);var T=false;if(e._target.getTilt()!==0){T=true;e._target.setTilt(0,e._setHeadingOptions)}if(e._target.getHeading()%360!==0){T=true;e._target.resetHeading(e._setHeadingOptions)}if(!T){e._target.setLock(false)}i.fire(new ff("oncompassclick"))},false)},_bind:function(){var e=this;this._bindTarget(this._target);if(this._map._renderType==="webgl"){this._map.addEventListener("maptypechange",function(i){if(this.mapType==="B_EARTH_MAP"){e._target=e._map._earth}else{e._target=e._map}e._bindTarget(e._target);e._checkEnable()})}},_bindTarget:function(i){if(i===this._map&&this._mapBinded){return}if(i===this._map._earth&&this._earthBinded){return}var e=this;i.addEventListener("heading_changed",function(T){e._updateUI()});i.addEventListener("animation_start",function(T){e._isOperating=true});i.addEventListener("animation_end",function(T){e._isOperating=false});i.on("load",function(){e._checkEnable()});i.on("zoom_changed",function(){e._checkEnable()});if(i===this._map){this._mapBinded=true}else{this._earthBinded=true}},_updateUI:function(){var e=this._target.getHeading();var i=this._compass.style;i.WebkitTransform=i.transform="rotate("+e+"deg)"},hide:function(){this._div.style.display="none"},show:function(){this._div.style.display="block"}});function cy(T,i){this._map=T;this._target=T;var jj=T.temp.originMapType||T.mapType;if(jj==="B_EARTH_MAP"&&T._earth){this._target=T._earth}this._outContainer=i||T.getContainer();this._imgRatio=fI()>=g5.HIGH_RES_MIN_RATIO?2:1;this._imgPath=w.imgPath+"gl-navi-control-pc4"+(this._imgRatio===2?"-2x.png":".png");this._enabled=true;var e=this;this._setTiltOptions={callback:function(){e._target.setLock(false)}};this._init()}ey.extend(cy.prototype,{_init:function(){this._createDom();this._render();this._bindDom();this._bind();this._checkEnable()},_checkEnable:function(){if(this._target.getZoom()>=this._target._enableTiltZoom){this.enable()}else{this.disable()}},_createDom:function(){var e=this._div=bL("button");e.title="倾斜";var i=e.style;i.position="absolute";i.zIndex=5;i.outline="none";i.border="none";i.cursor="pointer";i.width="26px";i.height="26px";i.top="56px";i.right="13px";i.background="url("+this._imgPath+") no-repeat #fff";i.backgroundSize="266px auto";i.backgroundPosition="-110px 1px";i.boxShadow="1px 2px 1px rgba(0, 0, 0, 0.15)"},enable:function(){this._enabled=true;if(this._div){this._div.style.cursor="pointer"}this._updateUI()},disable:function(){this._enabled=false;if(this._div){this._div.style.cursor=""}this._updateUI()},_render:function(){this._outContainer.appendChild(this._div)},_bindDom:function(){var e=this;this._div.addEventListener("mousedown",function(jj){if(!e._enabled){return}if(e._target.getLock()){return}var i=e._target.getTilt();var T;if(i===e._map.getCurrentMaxTilt()){T="out"}else{if(i===0){T="in"}else{T=e._preTrend?e._preTrend:"in"}}e._curTrend=T;e._clickTimer=setTimeout(function(){e._map.fire(new ff("ontiltmsdown"));e._tiltAni=new e8({duration:9999999,render:function(jk){i=e._target.getTilt();if(T==="in"&&i<e._map.getCurrentMaxTilt()){e._target.setTilt(i+1,{noAnimation:true})}else{if(T==="out"&&i>0){e._target.setTilt(i-1,{noAnimation:true})}}},finish:function(){e._tiltAni=null}});e._clickTimer=null},200);jj.stopPropagation()},false);this._div.addEventListener("mouseup",function(i){if(!e._enabled){return}if(e._tiltAni){e._tiltAni.stop()}e._preTrend=e._curTrend},false);this._div.addEventListener("click",function(jj){if(!e._enabled){return}if(!e._clickTimer){return}if(e._target.getLock()){return}clearTimeout(e._clickTimer);e._map.fire(new ff("ontiltclick"));var i=e._target.getTilt();e._target.setLock(true);jj.stopPropagation();var T=e._map.getCurrentMaxTilt();if(e._curTrend==="in"){e._target.setTilt(T,e._setTiltOptions)}else{if(e._curTrend==="out"){e._target.setTilt(0,e._setTiltOptions)}else{if(i<T){e._target.setTilt(T,e._setTiltOptions)}else{e._target.setTilt(0,e._setTiltOptions)}}}},false);this._div.addEventListener("mouseover",function(i){if(!e._enabled){return}e._mouseOver=true;e._updateUI()},false);this._div.addEventListener("mouseout",function(i){if(!e._enabled){return}e._mouseOver=false;e._updateUI()},false);hP(this._div,["mousedown","click","dblclick"])},_bind:function(){var e=this;var i=this._map;this._bindTarget(this._target);if(this._map._renderType==="webgl"){this._map.addEventListener("maptypechange",function(T){if(this.mapType==="B_EARTH_MAP"){e._target=e._map._earth}else{e._target=e._map}e._bindTarget(e._target);e._checkEnable()})}},_bindTarget:function(i){if(i===this._map&&this._mapBinded){return}if(i===this._map._earth&&this._earthBinded){return}var e=this;i.on("load",function(){e._checkEnable()});i.on("zoom_changed",function(){e._checkEnable()});i.on("tilt_changed",function(){e._updateUI()});if(i===this._map){this._mapBinded=true}else{this._earthBinded=true}},_updateUI:function(){var T=this._target.getTilt();var i=0;var jj=0;var e=0;if(T>0){i=78}if(this._mouseOver){e=52}if(this._enabled===false){jj=26;e=0;i=0}var jk="-"+(110+i+jj+e)+"px 1px";this._div&&(this._div.style.backgroundPosition=jk);if(this._enabled){if(T>0){this._div&&(this._div.title="恢复")}else{this._div&&(this._div.title="倾斜")}}else{this._div&&(this._div.title="请放大地图后操作")}},hide:function(){this._div.style.display="none"},show:function(){this._div.style.display="block"}});function gJ(i){cN.call(this);this._opts={container:null,cursor:"default"};this._opts=ey.extend(this._opts,i);this._type="contextmenu";this._map=null;this._container;this._left=0;this._top=0;this._items=[];this._rItems=[];this._dividers=[];this._enable=true;this.curPixel=null;this.curPoint=null;this._isOpen=false;var e=this;gs.load("menu",function(){e._draw()})}gJ.inherits(cN,"ContextMenu");ey.extend(gJ.prototype,{initialize:function(e){this._map=e},remove:function(){this._map=null},addItem:function(jk,e){if(!jk||jk._type!="menuitem"||jk._text==""||jk._width<=0){return}for(var jj=0,T=this._items.length;jj<T;jj++){if(this._items[jj]===jk){return}}if(e===undefined||e>this._items.length-1){e=-1}jk._insertIndex=e;if(e===-1){this._items.push(jk);this._rItems.push(jk)}else{this._items.splice(e,0,jk);this._rItems.splice(e,0,jk)}},removeItem:function(jj){if(!jj||jj._type!="menuitem"){return}for(var T=0,e=this._items.length;T<e;T++){if(this._items[T]===jj){this._items[T].remove();this._items.splice(T,1);delete jj._insertIndex;e--}}for(var T=0,e=this._rItems.length;T<e;T++){if(this._rItems[T]===jj){this._rItems[T].remove();this._rItems.splice(T,1);delete jj._insertIndex;e--}}},addSeparator:function(e){if(e===undefined||e>this._items.length-1){e=-1}var i={_type:"divider",_dIndex:this._dividers.length,_insertIndex:e};this._dividers.push({dom:null});if(e===-1){this._items.push(i)}else{this._items.splice(e,0,i)}},removeSeparator:function(T){if(!this._dividers[T]){return}for(var jj=0,e=this._items.length;jj<e;jj++){if(this._items[jj]&&this._items[jj]._type=="divider"&&this._items[jj]._dIndex==T){this._items.splice(jj,1);e--}if(this._items[jj]&&this._items[jj]._type=="divider"&&this._items[jj]._dIndex>T){this._items[jj]._dIndex--}}this._dividers.splice(T,1)},getDom:function(){return this._container},show:function(){if(this._isOpen==true){return}this._isOpen=true},hide:function(){if(this._isOpen==false){return}this._isOpen=false},setCursor:function(e){if(!e){return}this._opts.cursor=e},getItem:function(e){return this._rItems[e]},enable:function(){this._enable=true},disable:function(){this._enable=false}});function hi(T,jj,i){if(!T||!jj||typeof jj!="function"){return}cN.call(this);this._opts={width:100,id:""};i=i||{};this._opts.width=(i.width*1)?i.width:100;this._opts.id=i.id?i.id:"";this._text=T+"";this._callback=jj;this._map=null;this._type="menuitem";this._contextmenu=null;this._container=null;this._enabled=true;var e=this;gs.load("menu",function(){e._draw()})}hi.inherits(cN,"MenuItem");ey.extend(hi.prototype,{initialize:function(e,i){this._map=e;this._contextmenu=i},remove:function(){this._contextmenu=null;this._map=null},setText:function(e){if(!e){return}this._text=e+""},getDom:function(){return this._container},enable:function(){this._enabled=true},disable:function(){this._enabled=false}});function hk(e,i){this.setSouthWest(e);this.setNorthEast(i)}ey.extend(hk.prototype,{isEmpty:function(){return this.sw===null&&this.ne===null},equals:function(e){if(!e||e.isEmpty()||this.isEmpty()){return false}return this.sw.equals(e.sw)&&this.ne.equals(e.ne)},containsBounds:function(e){if(!e||e.isEmpty()||this.isEmpty()){return false}return(e.sw.lng>this.sw.lng&&e.ne.lng<this.ne.lng&&e.sw.lat>this.sw.lat&&e.ne.lat<this.ne.lat)},getCenter:function(){if(this.isEmpty()){return null}return new cg((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)},intersects:function(T){if(!T||T.isEmpty()||this.isEmpty()){return null}if(Math.max(T.sw.lng,T.ne.lng)<Math.min(this.sw.lng,this.ne.lng)||Math.min(T.sw.lng,T.ne.lng)>Math.max(this.sw.lng,this.ne.lng)||Math.max(T.sw.lat,T.ne.lat)<Math.min(this.sw.lat,this.ne.lat)||Math.min(T.sw.lat,T.ne.lat)>Math.max(this.sw.lat,this.ne.lat)){return null}var jk=Math.max(this.sw.lng,T.sw.lng);var i=Math.min(this.ne.lng,T.ne.lng);var jj=Math.max(this.sw.lat,T.sw.lat);var e=Math.min(this.ne.lat,T.ne.lat);return new hk(new cg(jk,jj),new cg(i,e))},setMinMax:function(){this.minX=this.sw?this.sw.lng:null;this.minY=this.sw?this.sw.lat:null;this.maxX=this.ne?this.ne.lng:null;this.maxY=this.ne?this.ne.lat:null},containsPoint:function(e){if(!e){return}return(e.lng>=this.sw.lng&&e.lng<=this.ne.lng&&e.lat>=this.sw.lat&&e.lat<=this.ne.lat)},extend:function(e){if(!e){return}var i=e.lng;var T=e.lat;if(!this.sw){this.sw=e.clone()}if(!this.ne){this.ne=e.clone()}if(this.sw.lng>i){this.sw.lng=i}if(this.ne.lng<i){this.ne.lng=i}if(this.sw.lat>T){this.sw.lat=T}if(this.ne.lat<T){this.ne.lat=T}},getMin:function(){return this.sw},getMax:function(){return this.ne},getSouthWest:function(){return this.sw},getNorthEast:function(){return this.ne},setSouthWest:function(e){this.sw=e?e.clone():null},setNorthEast:function(e){this.ne=e?e.clone():null},clone:function(){return new hk(this.sw,this.ne)},toSpan:function(){if(this.isEmpty()){return new id(0,0)}return new id(Math.abs(this.ne.lng-this.sw.lng),Math.abs(this.ne.lat-this.sw.lat))},div:function(e){if(!e||e.isEmpty()||this.isEmpty()){return 0}return((this.ne.lng-this.sw.lng)*(this.ne.lat-this.sw.lat))/((e.ne.lng-e.sw.lng)*(e.ne.lat-e.sw.lat))},makeNormalizedPoint:function(e){this.normalizedTopLeft=this.pointTopLeft.clone();this.normalizedTopRight=this.pointTopRight.clone();this.normalizedBottomRight=this.pointBottomRight.clone();this.normalizedBottomLeft=this.pointBottomLeft.clone();while(e<0){e+=360}e=e%360;if(e>=0&&e<90||e>=270&&e<360){if(this.normalizedTopRight.lng<this.normalizedTopLeft.lng){this.normalizedTopRight.lng+=g5.WORLD_SIZE_MC}if(this.normalizedBottomRight.lng<this.normalizedBottomLeft.lng){this.normalizedBottomRight.lng+=g5.WORLD_SIZE_MC}}else{if(this.normalizedTopLeft.lng<this.normalizedTopRight.lng){this.normalizedTopLeft.lng+=g5.WORLD_SIZE_MC}if(this.normalizedBottomLeft.lng<this.normalizedBottomRight.lng){this.normalizedBottomLeft.lng+=g5.WORLD_SIZE_MC}}},toString:function(){return"Bounds"}});function cg(e,i){if(isNaN(e)){e=cZ(e);e=isNaN(e)?0:e}if(typeof e==="string"){e=parseFloat(e)}if(isNaN(i)){i=cZ(i);i=isNaN(i)?0:i}if(typeof i==="string"){i=parseFloat(i)}this.lng=e;this.lat=i}cg.prototype.equals=function(i){if(!i){return false}var jj=Math.abs(this.lat-i.lat);var T=Math.abs(this.lng-i.lng);var e=1e-8;if(jj<e&&T<e){return true}return false};cg.prototype.clone=function(){return new cg(this.lng,this.lat)};cg.prototype.add=function(e){return new cg(this.lng+e.lng,this.lat+e.lat)};cg.prototype.sub=function(e){return new cg(this.lng-e.lng,this.lat-e.lat)};cg.prototype.mult=function(e){return new cg(this.lng*e,this.lat*e)};cg.prototype.div=function(e){return new cg(this.lng/e,this.lat/e)};cg.prototype.mag=function(){return Math.sqrt(this.lng*this.lng+this.lat*this.lat)};cg.prototype.toString=function(){return"Point"};function il(){}ey.extend(il,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[86,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,0.00000898305509648872,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-0.03801003308653,17337981.2],[-7.435856389565537e-9,0.000008983055097726239,-0.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,0.00000898305509983578,0.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,0.32710905363475,6856817.37],[-1.981981304930552e-8,0.000008983055099779535,0.03278182852591,40.31678527705744,0.65659298677277,-4.44255534477492,0.85341911805263,0.12923347998204,-0.04625736007561,4482777.06],[3.09191371068437e-9,0.000008983055096812155,0.00006995724062,23.10934304144901,-0.00023663490511,-0.6321817810242,-0.00663494467273,0.03430082397953,-0.00466043876332,2555164.4],[2.890871144776878e-9,0.000008983055095805407,-3.068298e-8,7.47137025468032,-0.00000353937994,-0.02145144861037,-0.00001234426596,0.00010322952773,-0.00000323890364,826088.5]],LL2MC:[[-0.0015702102444,111320.7020616939,1704480524535203,-10338987376042340,26112667856603880,-35149669176653700,26595700718403920,-10725012454188240,1800819912950474,82.5],[0.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[0.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[0.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-0.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-0.0003218135878613132,111320.7020701615,0.00369383431289,823725.6402795718,0.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,0.37238884252424,7.45]],getDistanceByMC:function(jl,jj){if(!jl||!jj){return 0}var i;var jk;var e;var T;jl=this.convertMC2LL(jl);if(!jl){return 0}i=hR(jl.lng);jk=hR(jl.lat);jj=this.convertMC2LL(jj);if(!jj){return 0}e=hR(jj.lng);T=hR(jj.lat);return this.getDistance(i,e,jk,T)},getDistanceByLL:function(jl,jj){if(!jl||!jj){return 0}jl.lng=this.getLoop(jl.lng,-180,180);jl.lat=this.getRange(jl.lat,-80,84);jj.lng=this.getLoop(jj.lng,-180,180);jj.lat=this.getRange(jj.lat,-80,84);var i;var e;var jk;var T;i=hR(jl.lng);jk=hR(jl.lat);e=hR(jj.lng);T=hR(jj.lat);return this.getDistance(i,e,jk,T)},proximityCovertMC2LL:function(e){if(e===null){return e}if(e.lng<180&&e.lng>-180&&e.lat<90&&e.lat>-90){return e}return this.convertMC2LL(e)},convertMC2LL:function(e){if(e===null){return e}if(!e){return new cg(0,0)}var T;var jk;T=new cg(Math.abs(e.lng),Math.abs(e.lat));for(var jj=0;jj<this.MCBAND.length;jj++){if(T.lat>=this.MCBAND[jj]){jk=this.MC2LL[jj];break}}var jl=this.convertor(e,jk);return new ca(jl.lat,jl.lng)},convertLL2MC:function(jm){if(!jm){return new cg(0,0)}var jo=jm.lat;var jj=jm.lng;jj=this.getLoop(jm.lng,-180,180);jo=bX(jo,-85,85);var jl;for(var jk=0;jk<this.LLBAND.length;jk++){if(jo>=this.LLBAND[jk]){jl=this.LL2MC[jk];break}}if(!jl){for(jk=0;jk<this.LLBAND.length;jk++){if(jo<=-this.LLBAND[jk]){jl=this.LL2MC[jk];break}}}var T=new cg(jj,jo);var jn=this.convertor(T,jl);var e=new cg(jn.lng,jn.lat);e.latLng=new ca(jm.lat,jm.lng);return e},convertor:function(T,jj){if(!T||!jj){return}var e=jj[0]+jj[1]*Math.abs(T.lng);var i=Math.abs(T.lat)/jj[9];var jk=jj[2]+jj[3]*i+jj[4]*i*i+jj[5]*i*i*i+jj[6]*i*i*i*i+jj[7]*i*i*i*i*i+jj[8]*i*i*i*i*i*i;e*=(T.lng<0?-1:1);jk*=(T.lat<0?-1:1);return new cg(e,jk)},getDistance:function(i,e,jj,T){return this.EARTHRADIUS*Math.acos((Math.sin(jj)*Math.sin(T)+Math.cos(jj)*Math.cos(T)*Math.cos(e-i)))},getRange:function(T,i,e){if(i!=null){T=Math.max(T,i)}if(e!=null){T=Math.min(T,e)}return T},getLoop:function(T,i,e){while(T>e){T-=e-i}while(T<i){T+=e-i}return T},tileToBoundRange:function(T){var i=T.col;var jq=T.row;var jp=T.baseTileSize;var jn=Math.pow(2,(18-T.zoom));var jl={lbx:i*jp,lby:jq*jp,rtx:(i+1)*jp,rty:(jq+1)*jp};var e={lbx:jl.lbx*jn,lby:jl.lby*jn,rtx:jl.rtx*jn,rty:jl.rty*jn};var jo=new cg(e.lbx,e.lby);var jk=new cg(e.rtx,e.rty);var jj=this.convertMC2LL(jo);var jm=this.convertMC2LL(jk);return{MC:new hk(jo,jk),LL:new hk(jj,jm)}}});ey.extend(il.prototype,{lnglatToMercator:function(e){return il.convertLL2MC(e)},lngLatToPoint:function(e){var i=il.convertLL2MC(e);return new eS(i.lng,i.lat)},mercatorToLnglat:function(e){return il.convertMC2LL(e)},pointToLngLat:function(i){var e=new cg(i.x,i.y);var T=il.convertMC2LL(e);return new ca(T.lat,T.lng)},pointToPixel:function(i,jl,jk,jj){if(!i){return}i=this.lnglatToMercator(i);var T=this.getZoomUnits(jl);var e=Math.round((i.lng-jk.lng)/T+jj.width/2);var jm=Math.round((jk.lat-i.lat)/T+jj.height/2);return new eS(e,jm)},mercatorToPixel:function(jl,jk,jj,T){if(!jl){return}var i=this.getZoomUnits(jk);var e=Math.round((jl.lng-jj.lng)/i+T.width/2);var jm=Math.round((jj.lat-jl.lat)/i+T.height/2);return new eS(e,jm)},pixelToPoint:function(jj,jm,jl,jk){if(!jj){return}var i=this.getZoomUnits(jm);var T=jl.lng+i*(jj.x-jk.width/2);var jn=jl.lat-i*(jj.y-jk.height/2);var e=new cg(T,jn);return this.mercatorToLnglat(e)},tileToBound:function(jj,jn){var i=jj.col;var jq=jj.row;var jp=jj.baseTileSize;var jo=this.getZoomUnits(jj.zoom);var T={x:Math.round(jn.lng/jo),y:Math.round(jn.lat/jo)};var jl={lbx:i*jp,lby:jq*jp,rtx:(i+1)*jp,rty:(jq+1)*jp};var e={lbx:jn.lng+(jl.lbx-T.x)*jo,lby:jn.lat+(jl.lby-T.y)*jo,rtx:jn.lng+(jl.rtx-T.x)*jo,rty:jn.lat+(jl.rty-T.y)*jo};var jk=il.convertMC2LL(new cg(e.lbx,e.lby));var jm=il.convertMC2LL(new cg(e.rtx,e.rty));return{MC:new hk(new cg(e.lbx,e.lby),new cg(e.rtx,e.rty)),LL:new hk(jk,jm)}},getZoomUnits:function(e){return Math.pow(2,(18-e))},setCoordType:function(e){this.coordsType=e}});function de(){}ey.extend(de,{RADIUS:6378137,EXTENT4326:[-180,-90,180,90],WORLD_EXTENT:[-180,-85,180,85],HALF_SIZE:20037508.342789244,METERS_PER_UNIT:111319.49079327358,EXTENT3857:[-20037508.342789244,-20037508.342789244,20037508.342789244,20037508.342789244],MAX_SAFE_Y:238107693.26496765,origin:[-20037508.342789244,20037508.342789244],size:156543.03392804097,gridSize:[256,256],resolutions:[156543.03392804097,78271.51696402048,39135.75848201024,19567.87924100512,9783.93962050256,4891.96981025128,2445.98490512564,1222.99245256282,611.49622628141,305.748113140705,152.8740565703525,76.43702828517625,38.21851414258813,19.109257071294063,9.554628535647032,4.777314267823516,2.388657133911758,1.194328566955879,0.5971642834779395,0.29858214173896974,0.14929107086948487,0.07464553543474244,0.03732276771737122],gridScaleFrom3857ToBDMC:0.5971642834779395,gridScaleFromBDMCTo3857:1.674581061974954,calcResolutions:function(i){if(this.resolutions.length-1<i){this.resolutions=[];for(var e=0;e<i;++e){this.resolutions.push(this.size/Math.pow(2,e))}}return this.resolutions},forEachTileCoord:function(jq,jp,T,jn){var e=this.getTileRangeForExtentFactory(jq,jp,T);for(var jl=e.minX,jo=e.maxX;jl<=jo;++jl){for(var jk=e.minY,jm=e.maxY;jk<=jm;++jk){jn([jp,jl,jk])}}},getTileRangeForExtentFactory:function(T,jk,i,jj){var e;switch(i.source){case"BD09MC":if(i.target==="EPSG3857"){e=this.getBDTileRangeForExtentAndZ(T,jk,jj)}else{e=this.getTileRangeForExtentAndZ(T,jk,jj)}break;case"EPSG3857":e=this.getTileRangeForExtentAndZ(T,jk,jj);break;default:e=this.getTileRangeForExtentAndZ(T,jk,jj);break}return e},getBDTileRangeForExtentAndZ:function(T,jk,jj){var i=[0,0,0];this.getBDTileCoordForXYAndZ_(T[0],T[1],jk,false,i);var e=i[1];var jl=i[2];this.getBDTileCoordForXYAndZ_(T[2],T[3],jk,true,i);return this.createOrUpdateTileRange(e,i[1],jl,i[2],jj)},getTileRangeForExtentAndZ:function(T,jk,jj){var i=[0,0,0];this.getTileCoordForXYAndZ_(T[0],T[3],jk,false,i);var e=i[1];var jl=i[2];this.getTileCoordForXYAndZ_(T[2],T[1],jk,true,i);return this.createOrUpdateTileRange(e,i[1],jl,i[2],jj)},getBDTileCoordForXYAndZ_:function(e,jn,jl,jk,jj){var jm=256*Math.pow(2,(18-jl));var T=e/jm;var i=jn/jm;if(jk){T=Math.ceil(T)-1;i=Math.ceil(i)-1}else{T=Math.floor(T);i=Math.floor(i)}return this.createOrUpdateTileCoord(jl,T,i,jj)},getTileCoordForXYAndZ_:function(jq,jp,jn,jo,e){var jr=this.origin;var i=(this.resolutions.length===0?this.calcResolutions(21)[jn]:this.resolutions[jn]);var jt=this.gridSize;var jj=jo?0.5:0;var T=jo?0.5:0;var js=Math.floor((jq-jr[0])/i+jj);var jl=Math.floor((jr[1]-jp)/i+T);var jm=js/jt[0];var jk=jl/jt[1];if(jo){jm=Math.ceil(jm)-1;jk=Math.ceil(jk)-1}else{jm=Math.floor(jm);jk=Math.floor(jk)}return this.createOrUpdateTileCoord(jn,jm,jk,e)},getTileCoordForCoordAndZ:function(T,i,e){return this.getTileCoordForXYAndZ_(T[0],T[1],i,false,e)},getTileRangeExtent:function(T,jm){var jn=this.origin;if(this.resolutions.length===0){this.calcResolutions(23)}var jk=this.resolutions[T[0]];var jo=this.gridSize;var jl=jn[0]+T[1]*jo[0]*jk;var jj=jn[1]-(T[2]+1)*jo[1]*jk;var i=jl+jo[0]*jk;var e=jj+jo[1]*jk;return this.createOrUpdateTileRange(jl,i,jj,e,jm)},getTileLeftBottomMCPoint:function(jk,T){var i=this.origin;if(this.resolutions.length===0){this.calcResolutions(23)}var jj=this.resolutions[jk[0]];var jm=this.gridSize;var e=i[0]+jk[1]*jm[0]*jj;var jn=i[1]-(jk[2]+1)*jm[1]*jj;var jl=gcoord.transform([e,jn],gcoord.EPSG3857,gcoord.BD09MC);return jl},getRangeExtent:function(i,jr,jn,jt,jj){var jo=this.calPiexlResolution(jt,jj);var jm=jr/2*jo;var jp=jn/2*jo;var jl=i[0]-jm;var T=i[0]+jm;var jk=i[1]-jp;var e=i[1]+jp;var jq=gcoord.transform([jl,jk],gcoord[jj.target],gcoord[jj.source]);var js=gcoord.transform([T,e],gcoord[jj.target],gcoord[jj.source]);return this.createOrUpdateTileRange(jq[0],js[0],jq[1],js[1])},getMousePoint:function(jm,jl,i,jk,T){var jj=jf(jm,jl);return this.calLngLatByMapViewPixelInverse(jj.clientPos,i,jl.width,jl.height,jk,T)},calLngLatByMapViewPixelInverse:function(jj,e,i,jq,jr,T){var jm=this.calPiexlResolution(jr,T);var jl=jj.x-i/2;var jk=jj.y-jq/2;var jo=e[0]+jl*jm;var jn=e[1]-jk*jm;var jp=gcoord.transform([jo,jn],gcoord[T.target],gcoord[T.source]);return jp},calPiexlResolution:function(T,i){var e;switch(i.target){case"BD09MC":e=Math.pow(2,(18-T));break;case"EPSG3857":e=this.resolutions[Math.floor(T)];break;default:e=Math.pow(2,(18-T));break}return e},getXYZCellPixelCoor:function(jm,jk,jj,i){var jo=this.gridSize;var jn;var jl;switch(i.source){case"GCJ02":case"EPSG3857":var T=Math.pow(2,jj-1)-(jk+1);var e=jm-Math.pow(2,jj-1);jn=e*jo[0];jl=T*jo[1];break;case"BD09MC":if(i.target==="EPSG3857"){jn=jm*jo[0];jl=jk*jo[1]}else{var T=Math.pow(2,jj-1)-(jk+1);var e=jm-Math.pow(2,jj-1);jn=e*jo[0];jl=T*jo[1]}default:break}return{x:jn,y:jl}},mcToPixel:function(i){var T=this.resolutions[Math.floor(zoom)];var e=i.lng/T;var jj=i.lat/T;return[e,jj]},getBaiduCellPixelCoor:function(e,jj,T){var i=256;return{x:e*i,y:jj*i}},getRelativePixelCoor:function(jl,jj){var i=this.origin;var jk=jl[0];var T=this.resolutions[Math.floor(jk)];var jm=this.gridSize;var e=i[0]/T+jl[1]*jm[0];var jn=i[1]/T-(jl[2]+1)*jm[1];return[jj[0]-e,jj[1]-jn]},getPointPixelCoor:function(e,jo,i){var jm;var jl;var T=Math.pow(2,(18-jo));var jj=this.resolutions[Math.floor(jo)];var jk=il.convertMC2LL(e);switch(i.source){case"GCJ02":var jn=gcoord.transform([jk.lng,jk.lat],gcoord.BD09LL,gcoord.GCJ02);jn=gcoord.transform(jn,gcoord.WGS84,gcoord.EPSG3857);jm=jn[0]/jj;jl=jn[1]/jj;break;case"BD09LL":case"EPSG3857":var jn=gcoord.transform([jk.lng,jk.lat],gcoord.BD09LL,gcoord.EPSG3857);jm=jn[0]/jj;jl=jn[1]/jj;break;case"BD09MC":jm=e.lng/T;jl=e.lat/T;if(i.target==="BD09MC"){jm*=de.gridScaleFromBDMCTo3857;jl*=de.gridScaleFromBDMCTo3857}default:break}return[jm,jl]},getResolutionScale:function(i,e){var T;switch(e.target){case"BD09MC":T=this.gridScaleFrom3857ToBDMC;break;case"EPSG3857":T=this.gridScaleFromBDMCTo3857;break;default:T=this.gridScaleFrom3857ToBDMC;break}return T},getBaiduResolutionScale:function(T){var i=this.resolutions[Math.floor(T)];var e=Math.pow(2,(18-T));var jj=e/i;return jj},getTileCoordCenter:function(T){var e=this.origin;if(this.resolutions.length===0){this.calcResolutions(23)}var i=this.resolutions[T[0]];var jj=this.gridSize;return[e[0]+(T[1]+0.5)*jj[0]*i,e[1]-(T[2]+0.5)*jj[1]*i,]},transformBDmcPoint:function(jk,i){i=i||{};var T=i.source||"EPSG3857";var jj=il.convertMC2LL(new cg(jk.lng,jk.lat));var e;switch(T){case"GCJ02":e=gcoord.transform([jj.lng,jj.lat],gcoord.BD09LL,gcoord.GCJ02);e=gcoord.transform(e,gcoord.WGS84,gcoord.EPSG3857);break;case"EPSG3857":e=gcoord.transform([jj.lng,jj.lat],gcoord.BD09LL,gcoord.EPSG3857);break;case"BD09MC":if(i.target==="EPSG3857"){e=gcoord.transform([jj.lng,jj.lat],gcoord.BD09LL,gcoord.EPSG3857)}else{e=[jk.lng,jk.lat]}break;default:e=gcoord.transform([jj.lng,jj.lat],gcoord.BD09LL,gcoord[T]);break}return e},transformPointArr:function(e,i,T){return gcoord.transform(e,gcoord[i||"BD09LL"],gcoord[T||"BD09MC"])},getTilesLoop:function(T,e){var i=Math.pow(2,T);while(e>i-1){e=e-i}while(e<0){e=e+i}return e},getLoopBox:function(e,jj){var i=this.HALF_SIZE*2;if(e[0]>0&&jj[2]<0){jj[2]=jj[2]+i}else{if(e[0]<0&&jj[0]>0){jj[0]=jj[0]-i}}return jj},createOrUpdateTileCoord:function(T,e,jj,i){if(i!==undefined){i[0]=T;i[1]=e;i[2]=jj;return i}else{return[T,e,jj]}},createOrUpdateTileRange:function(e,jj,jk,T,i){if(i!==undefined){i.minX=e;i.maxX=jj;i.minY=jk;i.maxY=T;return i}else{return{minX:e,maxX:jj,minY:jk,maxY:T}}},fromEPSG4326:function(T,jo,jm){var jk=T.length;var jl=jm>1?jm:2;var e=jo;if(e===undefined){if(jl>2){e=T.slice()}else{e=new Array(jk)}}for(var jj=0;jj<jk;jj+=jl){e[jj]=(this.HALF_SIZE*T[jj])/180;var jn=this.RADIUS*Math.log(Math.tan((Math.PI*(+T[jj+1]+90))/360));if(jn>this.MAX_SAFE_Y){jn=this.MAX_SAFE_Y}else{if(jn<-this.MAX_SAFE_Y){jn=-this.MAX_SAFE_Y}}e[jj+1]=jn}return e},toEPSG4326:function(T,jn,jm){var jk=T.length;var jl=jm>1?jm:2;var e=jn;if(e===undefined){if(jl>2){e=T.slice()}else{e=new Array(jk)}}for(var jj=0;jj<jk;jj+=jl){e[jj]=(180*T[jj])/this.HALF_SIZE;e[jj+1]=(360*Math.atan(Math.exp(T[jj+1]/this.RADIUS)))/Math.PI-90}return e},findParentGridAndPosition:function(jj,jt,js,jn,jo,jq,jm){if(js-1<0){return false}var ju=jj;var jp=jt;var T=js;for(var jl=1;jl<=jm;jl++){var e=this.findParent(ju,jp,T,jl);if(!e){return false}var jr=this.getTileKey(e);var jk=jn.getData(jr);if(jk&&jk.status==="ready"){if(jo[jr]){continue}jq.setData(jk,this.drawIndex,0);jo[jr]=true;return true}ju=e.col;jp=e.row;T=e.zoom}},findParent:function(i,jk,T,jj){if(T-1<0){return null}var e=i%2;var jl=jk%2;return{col:Math.floor(i/2),row:Math.floor(jk/2),sonX:e,sonY:jl,thumbLB:[e*0.5,1-jl*0.5-0.5],thumbRT:[e*0.5+0.5,1-jl*0.5],radio:Math.pow(2,jj),zoom:T-1,useZoom:T-1}},getTileKey:function(e,jj){jj=jj||{};var i=typeof jj.useZoom==="number"?jj.useZoom:e.useZoom;var T=e.style||this.mapStyleId||"default";return this.mapType+"_"+T+"_"+e.col+"_"+e.row+"_"+e.zoom+"_"+i},lon2tile:function(i,e){return(Math.floor((i+180)/360*Math.pow(2,e)))},lat2tile:function(T,i){var e=Math.tan(T*Math.PI/180)+1/Math.cos(T*Math.PI/180);return(Math.floor((1-Math.log(e)/Math.PI)/2*Math.pow(2,i)))},tile2long:function(e,i){return(e/Math.pow(2,i)*360-180)},tile2lat:function(T,e){var i=Math.PI-2*Math.PI*T/Math.pow(2,e);return(180/Math.PI*Math.atan(0.5*(Math.exp(i)-Math.exp(-i))))}});function ca(i,e){if(i<-90){i=-90}else{if(i>90){i=90}}while(e<-180){e+=360}while(e>180){e-=360}e=e||0;i=i||0;cg.call(this,e,i)}ca.inherits(cg,"LatLng");ey.extend(ca.prototype,{equals:function(e){return(this.lat===e.lat&&this.lng===e.lng)},clone:function(){return new ca(this.lat,this.lng)},add:function(e){return new ca(this.lng+e.lng,this.lat+e.lat)},sub:function(e){return new ca(this.lat-e.lat,this.lng-e.lng)},mult:function(e){return new ca(this.lng*e,this.lat*e)},div:function(e){return new ca(this.lng/e,this.lat/e)},mag:function(){return Math.sqrt(this.lng*this.lng+this.lat*this.lat)},getLngSpan:function(e){var i=this.lng;var T=Math.abs(e-i);if(T>180){T=360-T}return T},toString:function(){return"LatLng"}});function cn(e,i){if(e&&!i){i=e}this._sw=this._ne=null;this._swLng=this._swLat=null;this._neLng=this._neLat=null;if(e){this._sw=new ca(e.lat,e.lng);this._ne=new ca(i.lat,i.lng);this._swLng=e.lng;this._swLat=e.lat;this._neLng=i.lng;this._neLat=i.lat}}ey.extend(cn.prototype,{isEmpty:function(){return !this._sw||!this._ne},equals:function(e){if(this.isEmpty()){return false}return this.getSouthWest().equals(e.getSouthWest())&&this.getNorthEast().equals(e.getNorthEast())},getSouthWest:function(){return this._sw},getNorthEast:function(){return this._ne},containsBounds:function(e){if(this.isEmpty()||e.isEmpty()){return false}return(e._swLng>this._swLng&&e._neLng<this._neLng&&e._swLat>this._swLat&&e._neLat<this._neLat)},getCenter:function(){if(this.isEmpty()){return null}return new ca((this._swLat+this._neLat)/2,(this._swLng+this._neLng)/2)},intersects:function(T){if(Math.max(T._swLng,T._neLng)<Math.min(this._swLng,this._neLng)||Math.min(T._swLng,T._neLng)>Math.max(this._swLng,this._neLng)||Math.max(T._swLat,T._neLat)<Math.min(this._swLat,this._neLat)||Math.min(T._swLat,T._neLat)>Math.max(this._swLat,this._neLat)){return false}var jk=Math.max(this._swLng,T._swLng);var i=Math.min(this._neLng,T._neLng);var jj=Math.max(this._swLat,T._swLat);var e=Math.min(this._neLat,T._neLat);this._sw=new ca(jj,jk);this._ne=new ca(e,i);this._swLng=jk;this._swLat=jj;this._neLng=i;this._neLat=e;return true},containsPoint:function(e){if(this.isEmpty()){return false}return(e.lng>=this._swLng&&e.lng<=this._neLng&&e.lat>=this._swLat&&e.lat<=this._neLat)},extend:function(e){var i=e.lng;var T=e.lat;if(!this._sw){this._sw=new ca(0,0)}if(!this._ne){this._ne=new ca(0,0)}if(!this._swLng||this._swLng>i){this._sw.lng=this._swLng=i}if(!this._neLng||this._neLng<i){this._ne.lng=this._neLng=i}if(!this._swLat||this._swLat>T){this._sw.lat=this._swLat=T}if(!this._neLat||this._neLat<T){this._ne.lat=this._neLat=T}},toSpan:function(){if(this.isEmpty()){return new ca(0,0)}return new ca(Math.abs(this._neLat-this._swLat),Math.abs(this._neLng-this._swLng))},union:function(i){if(i.isEmpty()){return false}var e=i.getSouthWest();var T=i.getNorthEast();if(this._swLat>e.lat){this._swLat=e.lat}if(this._swLng>e.lng){this._swLng=e.lng}if(this._neLat<T.lat){this._neLat=T.lat}if(this._neLng<T.lng){this._neLng=T.lng}this._sw=new ca(this._swLat,this._swLng);this._ne=new ca(this._neLat,this._neLng);return true},toString:function(){return this._swLat+", "+this._swLng+", "+this._neLat+", "+this._neLng}});window.COORDINATES_WGS84=1;window.COORDINATES_WGS84_MC=2;window.COORDINATES_GCJ02=3;window.COORDINATES_GCJ02_MC=4;window.COORDINATES_BD09=5;window.COORDINATES_BD09_MC=6;window.COORDINATES_MAPBAR=7;window.COORDINATES_51=8;function fp(){}fp.inherits(cN,"Convertor");ey.extend(fp.prototype,{translate:function(i,jk,jj,T){jk=jk||1;jj=jj||5;if(i.length>10){T&&T({status:25});return}var e=w.apiHost+"/geoconv/v1/?coords=";ey.each(i,function(jl){e+=jl.lng+","+jl.lat+";"});e=e.replace(/;$/gi,"");e=e+"&from="+jk+"&to="+jj+"&v=gl&type=webgl&ak="+eo;cW.request(e,function(jm){if(jm.status===0){var jl=[];ey.each(jm.result,function(jn){jl.push(new cg(jn.x,jn.y))});delete jm.result;jm.points=jl}T&&T(jm)})}});var dO={idle:0,freeze:1,zooming:2,dragging:3,moving:4,readyToDrag:5,readyToPinch:6,pinching:7,stdMapCtrlDrag:8,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,arrowOpCodes:{37:1,38:2,39:4,40:8}};var ae={_map:null,_html:"<div class='BMap_opMask' unselectable='on'></div>",_maskElement:null,_cursor:"default",inUse:false,show:function(e){if(!this._map){this._map=e}this.inUse=true;if(!this._maskElement){this._createMask(e)}this._maskElement.style.display="block"},_createMask:function(i){if(!this._map){this._map=i}if(!this._map){return}var e=this._maskElement=bB(this._map.container,this._html);ey.on(e,"mouseup",function(T){if(T.button==2){gM(T)}});ey.on(e,"contextmenu",gM);e.style.display="none"},getDrawPoint:function(jj,jm,jk){jj=window.event||jj;var i=jj.offsetX||jj.layerX||0;var jl=parseInt(jj.offsetY)||parseInt(jj.layerY)||0;var T=jj.target||jj.srcElement;if(T!=ae.getDom(this._map)&&jm==true){while(T&&T!=this._map.container){if(!(T.clientWidth==0&&T.clientHeight==0&&T.offsetParent&&T.offsetParent.nodeName.toLowerCase()=="td")){i+=T.offsetLeft;jl+=T.offsetTop}T=T.offsetParent}}if(T!=ae.getDom(this._map)&&T!=this._map.container){return}if(typeof i==="undefined"||typeof jl==="undefined"){return}if(isNaN(i)||isNaN(jl)){return}if(jk){i=i+jk.x;jl=jl+jk.y}return this._map.pixelToPointIn(new eS(i,jl))},hide:function(){if(!this._map){return}this.inUse=false;if(this._maskElement){this._maskElement.style.display="none"}},getDom:function(e){if(!this._maskElement){this._createMask(e)}return this._maskElement},setCursor:function(e){this._cursor=e||"default";if(this._maskElement){this._maskElement.style.cursor=this._cursor}}};function aI(){this._type="overlay"}aI.inherits(ey.BaseClass,"Overlay");aI.getZIndex=function(i,e){i=i*1;if(!i){return 0}if(e){i=il.convertMC2LL(new cg(0,i)).lat}return(i*-100000)<<1};ey.extend(aI.prototype,{_i:function(e){this._map=e;if(!this.domElement&&bH(this.initialize)){this.domElement=this.initialize(e);if(this.domElement){this.domElement.style.WebkitUserSelect="none"}}this.draw()},initialize:function(e){throw"initialize方法未实现"},draw:function(){throw"draw方法未实现"},remove:function(){if(this.domElement&&this.domElement.parentNode){this.domElement.parentNode.removeChild(this.domElement)}this.domElement=null;this.dispatchEvent(new ff("onremove"))},hide:function(){this._visible=false;ey.hide(this.domElement)},show:function(){this._visible=true;ey.show(this.domElement)},getMap:function(){return this._map},dispose:function(){ey.BaseClass.prototype.decontrol.call(this)}});function ec(){ey.BaseClass.call(this);aI.call(this);this._visible=true;this._visibleInternal=true;this.zIndex=0;this.infoWindow=null;this._dblclickTime=0}ec.inherits(aI,"OverlayInternal");ey.extend(ec.prototype,{initialize:function(e){this.map=e;ey.BaseClass.call(this,this.hashCode);return null},draw:function(){},remove:function(){this.decontrol();aI.prototype.remove.call(this)},hide:function(){this._visible=false},show:function(){this._visible=true},getDom:function(){return this.domElement},getContainer:function(){return this.domElement},setClassName:function(){},setConfig:function(i){if(!i){return}for(var e in i){if(i.hasOwnProperty(e)){this._config[e]=i[e]}}},getPoint:function(T,jj){if(!T){return this.point}else{var e=jj?jj.width:0;var jk=jj?jj.height:0;if(this.map){var i=this.map.pointToPixelIn(this.point);if(this._config&&this._config.offset){i.x=i.x+this._config.offset.width+e;i.y=i.y+this._config.offset.height+jk}else{i.x=i.x+e;i.y=i.y+jk}return this.map.pixelToPointIn(i)}}},setZIndex:function(e){this.zIndex=e},isVisible:function(){if(!this.domElement){return false}return !!this._visible},enableMassClear:function(){this._config.enableMassClear=true},disableMassClear:function(){this._config.enableMassClear=false},showInternal:function(){this._visibleInternal=true},hideInternal:function(e){this._visibleInternal=false;this._hideInternalReason=e}});function aG(e){this.map=e;this._overlays={};this._overlayArray=[];this._customOverlays=[];e._overlays=this._overlays;e._overlayArray=this._overlayArray;e._customOverlays=this._customOverlays;this._zoomingOrMoving=false;this._init()}aG.prototype._init=function(){if(this.map._renderType!=="webgl"){this._createOverlayContainers()}else{this._createWebGLOverlayContainers()}this._bind()};aG.prototype._createOverlayContainers=function(){var e=this.map;e.temp.overlayDiv=e.overlayDiv=this._createOverlayDiv(e.platform,200);e.temp.overlayDivEx=e.overlayDivEx=this._createOverlayDiv(e.platform,50);e._panes.floatPane=this._createOverlayDiv(e.temp.overlayDiv,800);e._panes.markerMouseTarget=this._createOverlayDiv(e.temp.overlayDiv,700);e._panes.floatShadow=this._createOverlayDiv(e.temp.overlayDiv,600);e._panes.labelPane=this._createOverlayDiv(e.temp.overlayDiv,500);e._panes.markerPane=this._createOverlayDiv(e.temp.overlayDiv,400);if(e.isCanvasMap()){e._panes.mapPane=this._createOverlayDiv(e.temp.overlayDivEx,50)}else{e._panes.mapPane=this._createOverlayDiv(e.temp.overlayDiv,200)}};aG.prototype._createWebGLOverlayContainers=function(){var e=this.map;e.temp.overlayDiv=e.overlayDiv=this._createOverlayDiv(e.platform,200);e._panes.floatPane=this._createOverlayDiv(e.temp.overlayDiv,800);e._panes.markerMouseTarget=this._createOverlayDiv(e.temp.overlayDiv,700);e._panes.floatShadow=this._createOverlayDiv(e.temp.overlayDiv,600);e._panes.labelPane=this._createOverlayDiv(e.temp.overlayDiv,500);e._panes.markerPane=this._createOverlayDiv(e.temp.overlayDiv,400)};aG.prototype._createOverlayDiv=function(e,jj){var T=bL("div");var i=T.style;i.position="absolute";i.top=i.left=i.width=i.height="0";i.zIndex=jj;e.appendChild(T);return T};aG.prototype._bind=function(){var jk=this.map;var jj=this;function i(jm){jj.draw(jm)}if(jk._renderType!=="webgl"){jk.addEventListener("load",i);jk.addEventListener("moveend",i);jk.addEventListener("resize",i);jk.addEventListener("zoomend",i);jk.addEventListener("zooming_inner",i)}else{jk.on("update",i)}jk.addEventListener("zoomend",function(jm){if(this.mapType==="B_EARTH_MAP"){if(this._earth.getZoom()<this._earth.zoomForNight+1){this.temp.overlayDiv.style.display="none";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display="none"}}else{if(this.temp.overlayDiv.style.display==="none"){this.temp.overlayDiv.style.display="";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display=""}if(this.temp.infoWin&&this.temp.infoWin.isOpen()){this.temp.infoWin.redraw()}}}}});jk.addEventListener("oncenterandzoom",function(jm){jj.draw(jm);if(this.mapType==="B_EARTH_MAP"){if(this._earth.getZoom()<this._earth.zoomForNight+1){this.temp.overlayDiv.style.display="none";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display="none"}}else{if(this.temp.overlayDiv.style.display==="none"){this.temp.overlayDiv.style.display="";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display=""}if(this.temp.infoWin&&this.temp.infoWin.isOpen()){this.temp.infoWin.redraw()}}}}});jk.addEventListener("maptypechange",function(jm){if(this.mapType==="B_EARTH_MAP"){if(this._panes.mapPane){this._panes.mapPane.style.display="none"}if(this._earth.getZoom()<this._earth.zoomForNight+1){this.temp.overlayDiv.style.display="none";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display="none"}}else{if(this.temp.overlayDiv.style.display==="none"){this.temp.overlayDiv.style.display="";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display=""}if(this.temp.infoWin&&this.temp.infoWin.isOpen()){this.temp.infoWin.redraw()}}}if(this._panes.markerPane){this._panes.markerPane.style.display="none"}}else{if(this._panes.mapPane){this._panes.mapPane.style.display=""}if(this._panes.markerPane){this._panes.markerPane.style.display=""}if(this.temp.overlayDiv.style.display==="none"){this.temp.overlayDiv.style.display="";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display=""}if(this.temp.infoWin&&this.temp.infoWin.isOpen()){this.temp.infoWin.redraw()}}}jj.draw(jm)});jk.on("earthstatuschange",function jl(jm){jj.draw(jm)});jk.addEventListener("addoverlay",function(jq){var jn=jq.target;if(jn instanceof ec){if(!jj._overlays[jn.hashCode]){jj._overlays[jn.hashCode]=jn;jj._overlayArray.push(jn)}}else{var jp=false;for(var jo=0,jm=jj._customOverlays.length;jo<jm;jo++){if(jj._customOverlays[jo]===jn){jp=true;break}}if(!jp){jj._customOverlays.push(jn)}}});jk.addEventListener("removeoverlay",function(jp){var jn=jp.target;if(jn instanceof ec){delete jj._overlays[jn.hashCode];for(var jo=0;jo<jj._overlayArray.length;jo++){if(jj._overlayArray[jo]===jn){jj._overlayArray.splice(jo,1);break}}}else{for(var jo=0,jm=jj._customOverlays.length;jo<jm;jo++){if(jj._customOverlays[jo]===jn){jj._customOverlays.splice(jo,1);break}}}});jk.addEventListener("clearoverlays",function(jo){this.closeInfoWindow();this.closeSimpleInfoWindow();for(var jn in jj._overlays){if(jj._overlays[jn]._config.enableMassClear){this.removeOverlay(jj._overlays[jn])}}for(var jm=jj._customOverlays.length-1;jm>0;jm--){if(jj._customOverlays[jm].enableMassClear!==false){this.removeOverlay(jj._customOverlays[jm]);jj._customOverlays.splice(jm,1)}}});jk.addEventListener("infowindowopen",function(jn){var jm=this.infoWindow;if(jm){ey.hide(jm.popDom);ey.hide(jm.shadowDom)}});function T(){if(this.getMapType()==="B_EARTH_MAP"||this._renderType==="webgl"){if(jj._zoomingOrMoving===false){this._panes.markerMouseTarget.style.display="none";jj._zoomingOrMoving=true}}}function e(jo){if(this.getMapType()==="B_EARTH_MAP"||this._renderType==="webgl"){if(jj._zoomingOrMoving===true){this._panes.markerMouseTarget.style.display="";jj._zoomingOrMoving=false;for(var jn=0;jn<jj._overlayArray.length;jn++){var jm=jj._overlayArray[jn];if(jm instanceof iZ===true){jm.draw(jo)}}}}}jk.addEventListener("movestart",T);jk.addEventListener("moveend",e);jk.addEventListener("zoomstart",T);jk.addEventListener("zoomend",e);jk.addEventListener("animation_start",T);jk.addEventListener("animation_end",e);jk.addEventListener("displayoptions_changed",function(jm){if(this._displayOptions.overlay===false){this.temp.overlayDiv.style.display="none"}else{this.temp.overlayDiv.style.display=""}})};aG.prototype.draw=function(jm){jm=jm||{};if(this.map.getMapType()==="B_EARTH_MAP"){for(var jk=0;jk<this._overlayArray.length;jk++){var T=this._overlayArray[jk];if(T instanceof hQ===true){continue}if(this._zoomingOrMoving){if(T instanceof iZ===true){continue}}T.draw(jm)}}else{for(var jk=0,jj=this._overlayArray.length;jk<jj;jk++){var T=this._overlayArray[jk];if(this._zoomingOrMoving&&T instanceof iZ===true){continue}T.draw(jm)}}ey.each(this._customOverlays,function(e){e.draw(jm)});if(this.map.temp.infoWin){this.map.temp.infoWin.setPosition(jm.center,jm.zoom)}if(this.map.getMapType()!=="B_EARTH_MAP"&&this.map._renderType!=="webgl"){if(bp.DrawerSelector){var jl=bp.DrawerSelector.getDrawer(this.map);jl.setPalette()}}};bp.register(function(e){e._overlayMgr=new aG(e)});function hQ(e){ec.call(this);this._config={strokeColor:"#000",strokeWeight:2,strokeOpacity:1,strokeStyle:"solid",dashArray:null,strokeLineCap:"round",strokeLineJoin:"round",enableMassClear:true,getParseTolerance:null,getParseCacheIndex:null,enableParse:true,enableEditing:false,mouseOverTolerance:5,geodesic:false,clip:true,texture:null,textureSize:null,textureZoomWithMap:false,textureRepeat:true};this.setConfig(e);if(this._config.strokeOpacity<0||this._config.strokeOpacity>1){this._config.strokeOpacity=1}if(this._config.fillOpacity<0||this._config.fillOpacity>1){this._config.fillOpacity=1}if(this._config.strokeStyle!=="solid"&&this._config.strokeStyle!=="dashed"&&this._config.strokeStyle!=="dotted"){this._config.strokeStyle="solid"}this.domElement=null;this._bounds=new hk();this.points=[];this.greatCirclePoints=[];this._parseCache=[];this._holesCache=[];this._parseCacheGL=[];this._parseCacheGLRaw=[];this._areaCacheGL=[];this._strokeStyleInfoForGL=[[]];this._fillStyleInfoForGL="";this.vertexMarkers=[];this._temp={}}hQ.JOININDEX={miter:0,round:1,bevel:2};hQ.CAPINDEX={round:0,butt:1,square:2};hQ.inherits(ec,"Graph");hQ.getGraphPoints=function(i){var e=[];if(!i||i.length===0){return e}if(typeof i==="string"){var T=i.split(";");ey.each(T,function(jk){var jj=jk.split(",");e.push(new cg(jj[0],jj[1]))})}if(i.constructor===Array&&i.length>0){e=i}return e};hQ.parseTolerance={0:[0.09,0.005,0.0001,0.00001],1:[9000,500,20,1]};ey.extend(hQ.prototype,{initialize:function(e){this.map=e;return null},draw:function(){},setPoints:function(e){this._clearCache();this.points=hQ.getGraphPoints(e).slice(0);this._calcBounds()},setPathIn:function(e){this.setPoints(e)},_calcBounds:function(){if(!this.points){return}var e=this;e._bounds=new hk();if(!this.hasMultipleParts){ey.each(this.points,function(i){e._bounds.extend(i)})}else{ey.each(this.points,function(i){ey.each(i,function(T){e._bounds.extend(T)})})}},getPoints:function(){return this.points},getPathIn:function(){return this.points},setPointAt:function(i,e){if(!e||!this.points[i]){return}this._clearCache();this.points[i]=new cg(e.lng,e.lat);this._calcBounds()},setPositionAt:function(i,e){if(!e||!this.points[i]){return}var T=il.convertLL2MC(e);this.setPointAt(i,T)},setOptions:function(i){i=i||{};for(var e in i){if(i.hasOwnProperty(e)){this._config[e]=i[e]}}},setStrokeColor:function(e){this._config.strokeColor=e},getStrokeColor:function(){return this._config.strokeColor},setStrokeLineCap:function(e){this._config.strokeLineCap=e},getStrokeLineCap:function(){return this._config.strokeLineCap},setStrokeLineJoin:function(e){this._config.strokeLineJoin=e},getStrokeLineJoin:function(){return this._config.strokeLineJoin},setStrokeWeight:function(e){if(e>0){this._config.strokeWeight=e}},getStrokeWeight:function(){return this._config.strokeWeight},setStrokeOpacity:function(e){if(!e||e>1||e<0){return}this._config.strokeOpacity=e},getStrokeOpacity:function(){return this._config.strokeOpacity},setFillOpacity:function(e){if(e>1||e<0){return}this._config.fillOpacity=e},getFillOpacity:function(){return this._config.fillOpacity},setStrokeStyle:function(e){if(e!=="solid"&&e!=="dashed"&&e!=="dotted"){return}this._config.strokeStyle=e},getStrokeStyle:function(){return this._config.strokeStyle},setFillColor:function(e){this._config.fillColor=e||""},getFillColor:function(){return this._config.fillColor},getBoundsIn:function(){this._bounds.setMinMax();return this._bounds},getBounds:function(){var e=this.getBoundsIn();var i=new hk(il.convertMC2LL(e.getSouthWest()),il.convertMC2LL(e.getNorthEast()));i.setMinMax();return i},remove:function(){if(this.map){this.map.removeEventListener("onmousemove",this._graphMouseEvent);this.map.removeEventListener("onclick",this._graphClickEvent)}ec.prototype.remove.call(this);this._clearCache();var e=new ff("onlineupdate");e.action="remove";e.overlay=this;this.fire(e)},enableEditing:function(){if(this.points.length<2){return}this._config.enableEditing=true;var e=this;gs.load("poly",function(){e.addVertexs()},true)},disableEditing:function(){this._config.enableEditing=false;var e=this;gs.load("poly",function(){e.clearVertexs()},true)},getLength:function(){if(typeof this._length==="number"){return this._length}if(typeof this._config.totalLength==="number"){this._length=this._config.totalLength;return this._length}var T=0;if(this.points.length<=1){this._length=0;return T}for(var e=0;e<this.points.length-1;e++){T+=d2(this.points[e],this.points[e+1])}this._length=T;return T},getParsedPoints:function(){var e=this._simplification(this.points);if(this.hasMultipleParts){return e}return[e]},_simplification:function(jo){var e=this.map;var jn=this.getParseCacheIndex(e.getZoom());var jq;if(this._parseCache[jn]){jq=this._parseCache[jn]}else{var jl=jo;if(this.greatCirclePoints.length>0){jl=this.greatCirclePoints}var jk=e.config.coordType===2?1:e.config.coordType;var jm=this.getParseTolerance(e.getZoom(),jk);if(!this.hasMultipleParts){var jp=dv(jl,jm)}else{var jp=[];for(var T=0;T<jl.length;T++){var jj=dv(jl[T],jm);jp.push(jj)}}jq=this._parseCache[jn]=jp}return jq},_clearCache:function(){this._length=null;this._parseCache.length=0;this._parseCacheGL.length=0;this._parseCacheGLRaw.length=0;this._areaCacheGL.length=0},canRenderDataBeMerged:function(){var e=this._config;if(e.texture){return false}return true}});if(ey.Browser.ie&&document.namespaces&&!document.namespaces.olv){document.namespaces.add("olv","urn:schemas-microsoft-com:vml")}function dl(e){e=e.replace(/,/gm," ");e=e.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");e=e.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");e=e.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");e=e.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");e=e.replace(/([0-9])([+\-])/gm,"$1 $2");e=e.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");e=e.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 ");e=dl.compressSpaces(e);e=dl.trim(e);this.PathParser=new (function(i){this.tokens=i.split(" ");this.reset=function(){this.i=-1;this.command="";this.previousCommand="";this.start=new dl.Point(0,0);this.control=new dl.Point(0,0);this.current=new dl.Point(0,0);this.points=[];this.angles=[]};this.isEnd=function(){return this.i>=this.tokens.length-1};this.isCommandOrEnd=function(){if(this.isEnd()){return true}return this.tokens[this.i+1].match(/^[A-Za-z]$/)!=null};this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return true;break}return false};this.getToken=function(){this.i++;return this.tokens[this.i]};this.getScalar=function(){return parseFloat(this.getToken())};this.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken()};this.getPoint=function(){var T=new dl.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(T)};this.getAsControlPoint=function(){var T=this.getPoint();this.control=T;return T};this.getAsCurrentPoint=function(){var T=this.getPoint();this.current=T;return T};this.getReflectedControlPoint=function(){if(this.previousCommand.toLowerCase()!="c"&&this.previousCommand.toLowerCase()!="s"&&this.previousCommand.toLowerCase()!="q"&&this.previousCommand.toLowerCase()!="t"){return this.current}var T=new dl.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return T};this.makeAbsolute=function(T){if(this.isRelativeCommand()){T.x+=this.current.x;T.y+=this.current.y}return T};this.addMarker=function(jj,jk,T){if(T!=null&&this.angles.length>0&&this.angles[this.angles.length-1]==null){this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(T)}this.addMarkerAngle(jj,jk==null?null:jk.angleTo(jj))};this.addMarkerAngle=function(jj,T){this.points.push(jj);this.angles.push(T)};this.getMarkerPoints=function(){return this.points};this.getMarkerAngles=function(){for(var jj=0;jj<this.angles.length;jj++){if(this.angles[jj]==null){for(var T=jj+1;T<this.angles.length;T++){if(this.angles[T]!=null){this.angles[jj]=this.angles[T];break}}}}return this.angles}})(e);this.bounds=function(){return this.draw(null)};this.draw=function(jD){var jF=this.PathParser;jF.reset();var jq=new dl.BoundingBox();if(jD!=null){jD.beginPath()}while(!jF.isEnd()){jF.nextCommand();switch(jF.command){case"M":case"m":var jA=jF.getAsCurrentPoint();jF.addMarker(jA);jq.addPoint(jA.x,jA.y);if(jD!=null){jD.moveTo(jA.x,jA.y)}jF.start=jF.current;while(!jF.isCommandOrEnd()){var jA=jF.getAsCurrentPoint();jF.addMarker(jA,jF.start);jq.addPoint(jA.x,jA.y);if(jD!=null){jD.lineTo(jA.x,jA.y)}}break;case"L":case"l":while(!jF.isCommandOrEnd()){var jJ=jF.current;var jA=jF.getAsCurrentPoint();jF.addMarker(jA,jJ);jq.addPoint(jA.x,jA.y);if(jD!=null){jD.lineTo(jA.x,jA.y)}}break;case"H":case"h":while(!jF.isCommandOrEnd()){var jj=new dl.Point((jF.isRelativeCommand()?jF.current.x:0)+jF.getScalar(),jF.current.y);jF.addMarker(jj,jF.current);jF.current=jj;jq.addPoint(jF.current.x,jF.current.y);if(jD!=null){jD.lineTo(jF.current.x,jF.current.y)}}break;case"V":case"v":while(!jF.isCommandOrEnd()){var jj=new dl.Point(jF.current.x,(jF.isRelativeCommand()?jF.current.y:0)+jF.getScalar());jF.addMarker(jj,jF.current);jF.current=jj;jq.addPoint(jF.current.x,jF.current.y);if(jD!=null){jD.lineTo(jF.current.x,jF.current.y)}}break;case"C":case"c":while(!jF.isCommandOrEnd()){var jH=jF.current;var jl=jF.getPoint();var jm=jF.getAsControlPoint();var js=jF.getAsCurrentPoint();jF.addMarker(js,jm,jl);jq.addBezierCurve(jH.x,jH.y,jl.x,jl.y,jm.x,jm.y,js.x,js.y);if(jD!=null){jD.bezierCurveTo(jl.x,jl.y,jm.x,jm.y,js.x,js.y)}}break;case"S":case"s":while(!jF.isCommandOrEnd()){var jH=jF.current;var jl=jF.getReflectedControlPoint();var jm=jF.getAsControlPoint();var js=jF.getAsCurrentPoint();jF.addMarker(js,jm,jl);jq.addBezierCurve(jH.x,jH.y,jl.x,jl.y,jm.x,jm.y,js.x,js.y);if(jD!=null){jD.bezierCurveTo(jl.x,jl.y,jm.x,jm.y,js.x,js.y)}}break;case"Q":case"q":while(!jF.isCommandOrEnd()){var jH=jF.current;var jm=jF.getAsControlPoint();var js=jF.getAsCurrentPoint();jF.addMarker(js,jm,jm);jq.addQuadraticCurve(jH.x,jH.y,jm.x,jm.y,js.x,js.y);if(jD!=null){jD.quadraticCurveTo(jm.x,jm.y,js.x,js.y)}}break;case"T":case"t":while(!jF.isCommandOrEnd()){var jH=jF.current;var jm=jF.getReflectedControlPoint();jF.control=jm;var js=jF.getAsCurrentPoint();jF.addMarker(js,jm,jm);jq.addQuadraticCurve(jH.x,jH.y,jm.x,jm.y,js.x,js.y);if(jD!=null){jD.quadraticCurveTo(jm.x,jm.y,js.x,js.y)}}break;case"A":case"a":while(!jF.isCommandOrEnd()){var jH=jF.current;var jp=jF.getScalar();var jo=jF.getScalar();var T=jF.getScalar()*(Math.PI/180);var jr=jF.getScalar();var jn=jF.getScalar();var js=jF.getAsCurrentPoint();var jM=new dl.Point(Math.cos(T)*(jH.x-js.x)/2+Math.sin(T)*(jH.y-js.y)/2,-Math.sin(T)*(jH.x-js.x)/2+Math.cos(T)*(jH.y-js.y)/2);var jE=Math.pow(jM.x,2)/Math.pow(jp,2)+Math.pow(jM.y,2)/Math.pow(jo,2);if(jE>1){jp*=Math.sqrt(jE);jo*=Math.sqrt(jE)}var jw=(jr==jn?-1:1)*Math.sqrt(((Math.pow(jp,2)*Math.pow(jo,2))-(Math.pow(jp,2)*Math.pow(jM.y,2))-(Math.pow(jo,2)*Math.pow(jM.x,2)))/(Math.pow(jp,2)*Math.pow(jM.y,2)+Math.pow(jo,2)*Math.pow(jM.x,2)));if(isNaN(jw)){jw=0}var jv=new dl.Point(jw*jp*jM.y/jo,jw*-jo*jM.x/jp);var jk=new dl.Point((jH.x+js.x)/2+Math.cos(T)*jv.x-Math.sin(T)*jv.y,(jH.y+js.y)/2+Math.sin(T)*jv.x+Math.cos(T)*jv.y);var jC=function(jN){return Math.sqrt(Math.pow(jN[0],2)+Math.pow(jN[1],2))};var jy=function(jO,jN){return(jO[0]*jN[0]+jO[1]*jN[1])/(jC(jO)*jC(jN))};var jK=function(jO,jN){return(jO[0]*jN[1]<jO[1]*jN[0]?-1:1)*Math.acos(jy(jO,jN))};var jL=jK([1,0],[(jM.x-jv.x)/jp,(jM.y-jv.y)/jo]);var ju=[(jM.x-jv.x)/jp,(jM.y-jv.y)/jo];var jt=[(-jM.x-jv.x)/jp,(-jM.y-jv.y)/jo];var jI=jK(ju,jt);if(jy(ju,jt)<=-1){jI=Math.PI}if(jy(ju,jt)>=1){jI=0}var jB=1-jn?1:-1;var jG=jL+jB*(jI/2);var i=new dl.Point(jk.x+jp*Math.cos(jG),jk.y+jo*Math.sin(jG));jF.addMarkerAngle(i,jG-jB*Math.PI/2);jF.addMarkerAngle(js,jG-jB*Math.PI);jq.addPoint(js.x,js.y);if(jD!=null){var jy=jp>jo?jp:jo;var jz=jp>jo?1:jp/jo;var jx=jp>jo?jo/jp:1;jD.translate(jk.x,jk.y);jD.rotate(T);jD.scale(jz,jx);jD.arc(0,0,jy,jL,jL+jI,1-jn);jD.scale(1/jz,1/jx);jD.rotate(-T);jD.translate(-jk.x,-jk.y)}}break;case"Z":case"z":if(jD!=null){jD.closePath()}jF.current=jF.start}}return jq};this.getMarkers=function(){var jj=this.PathParser.getMarkerPoints();var jl=this.PathParser.getMarkerAngles();var jk=[];for(var T=0;T<jj.length;T++){jk.push([jj[T],jl[T]])}return jk}}dl.trim=function(e){return e.replace(/^\s+|\s+$/g,"")};dl.compressSpaces=function(e){return e.replace(/[\s\r\t\n]+/gm," ")};dl.Point=function(e,i){this.x=e;this.y=i};dl.Point.prototype.angleTo=function(e){return Math.atan2(e.y-this.y,e.x-this.x)};dl.Point.prototype.applyTransform=function(e){var i=this.x*e[0]+this.y*e[2]+e[4];var T=this.x*e[1]+this.y*e[3]+e[5];this.x=i;this.y=T};dl.BoundingBox=function(i,jj,e,T){this.x1=Number.NaN;this.y1=Number.NaN;this.x2=Number.NaN;this.y2=Number.NaN;this.x=function(){return this.x1};this.y=function(){return this.y1};this.width=function(){return this.x2-this.x1};this.height=function(){return this.y2-this.y1};this.addPoint=function(jk,jl){if(jk!=null){if(isNaN(this.x1)||isNaN(this.x2)){this.x1=jk;this.x2=jk}if(jk<this.x1){this.x1=jk}if(jk>this.x2){this.x2=jk}}if(jl!=null){if(isNaN(this.y1)||isNaN(this.y2)){this.y1=jl;this.y2=jl}if(jl<this.y1){this.y1=jl}if(jl>this.y2){this.y2=jl}}};this.addX=function(jk){this.addPoint(jk,null)};this.addY=function(jk){this.addPoint(null,jk)};this.addBoundingBox=function(jk){this.addPoint(jk.x1,jk.y1);this.addPoint(jk.x2,jk.y2)};this.addQuadraticCurve=function(jp,jo,jl,jk,jr,jq){var jn=jp+2/3*(jl-jp);var jm=jo+2/3*(jk-jo);var jt=jn+1/3*(jr-jp);var js=jm+1/3*(jq-jo);this.addBezierCurve(jp,jo,jn,jt,jm,js,jr,jq)};this.addBezierCurve=function(jx,jw,jo,jm,jt,jr,jz,jy){var jp=[jx,jw],jn=[jo,jm],jl=[jt,jr],jk=[jz,jy];this.addPoint(jp[0],jp[1]);this.addPoint(jk[0],jk[1]);for(iA=0;iA<=1;iA++){var jA=function(jE){return Math.pow(1-jE,3)*jp[iA]+3*Math.pow(1-jE,2)*jE*jn[iA]+3*(1-jE)*Math.pow(jE,2)*jl[iA]+Math.pow(jE,3)*jk[iA]};var jC=6*jp[iA]-12*jn[iA]+6*jl[iA];var jD=-3*jp[iA]+9*jn[iA]-9*jl[iA]+3*jk[iA];var jB=3*jn[iA]-3*jp[iA];if(jD==0){if(jC==0){continue}var jv=-jB/jC;if(0<jv&&jv<1){if(iA==0){this.addX(jA(jv))}if(iA==1){this.addY(jA(jv))}}continue}var jq=Math.pow(jC,2)-4*jB*jD;if(jq<0){continue}var ju=(-jC+Math.sqrt(jq))/(2*jD);if(0<ju&&ju<1){if(iA==0){this.addX(jA(ju))}if(iA==1){this.addY(jA(ju))}}var js=(-jC-Math.sqrt(jq))/(2*jD);if(0<js&&js<1){if(iA==0){this.addX(jA(js))}if(iA==1){this.addY(jA(js))}}}};this.isPointInBox=function(jk,jl){return(this.x1<=jk&&jk<=this.x2&&this.y1<=jl&&jl<=this.y2)};this.addPoint(i,jj);this.addPoint(e,T)};function eQ(i,e){this.id=bp.getGUID("symbol_icon_");this.size=(i instanceof id)?i:new id(2,2);this.anchor=(e instanceof id)?e:new id(this.size.width/2,this.size.height/2);this.data=null;this.offset=this.anchor;this.imageSize=this.size;this.imageOffset=new id(0,0);this.style={scale:1,rotation:0};this.srcSetObject={};this._initOptions={size:this.size,scale:this.style.scale,rotation:this.style.rotation};this.overlay=null;this.isReDraw=false}eQ.prototype.add=function(){const e=document.createElement("canvas");e.width=this.size.width;e.height=this.size.height;this.context=e.getContext("2d")};eQ.prototype.remove=function(){if(this.context){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height);this.context.canvas.width=0;this.context.canvas.height=0}this.context=null;this.data=null};eQ.prototype.render=function(e){return true};eQ.prototype.resetInitOptions=function(){this._initOptions=new id(this.size.width,this.size.height);this._initOptions.scale=this.style.scale;this._initOptions.rotation=this.style.rotation};eQ.prototype.update=function(){var e=this.overlay;if(e){if(e.domElement){var jj=(this.style.scale-this._initOptions.scale)/this._initOptions.scale;if(jj>=0){jj=jj+1}else{jj=1+jj}var i=this._initOptions.rotation===0?this.style.rotation:(this.style.rotation-this._initOptions.rotation);while(i<0){i+=360}var T=e.domElement.style;T.width=this._initOptions.width+"px";T.height=this._initOptions.height+"px";T.transform="rotate("+i+"deg) scale("+jj+")"}if(!this.isReDraw){this._refresh(e)}}};eQ.prototype._refresh=function(e){e.textureCoord=e.textureCoordGLMap=null;var i=new ff("onstatus_change");i.overlay=e;i.action="setIcon";i.imageUrlChanged=true;setTimeout(function(){e.fire(i)},100)};eQ.prototype.generateRenderData=function(){var i=this.offset=this.anchor;var e=this.size;var T=[];T.push(-i.width,i.height-e.height,0);T.push(e.width-i.width,i.height-e.height,0);T.push(e.width-i.width,i.height,0);T.push(-i.width,i.height-e.height,0);T.push(e.width-i.width,i.height,0);T.push(-i.width,i.height,0);return{vertex:T}};eQ.prototype.getCurrentImageUrl=function(){return this.id};eQ.prototype.getRenderData=function(){this._renderData=this.generateRenderData();return this._renderData};eQ.prototype.toString=function(){return"Symbol"};var e7={14:"m-0.00573,-10c-5.51975,0 -9.99427,4.47453 -9.99427,9.99428c0,5.51974 4.47452,9.99425 9.99427,9.99425c5.51972,0 9.99426,-4.47452 9.99426,-9.99425c0,-5.51975 -4.47453,-9.99428 -9.99426,-9.99428zm0,17.92491c-4.37412,0 -7.93132,-3.55788 -7.93132,-7.93063c0,-4.37345 3.5572,-7.93134 7.93132,-7.93134c4.37411,0 7.93062,3.55721 7.93062,7.93134c0,4.37412 -3.55789,7.93063 -7.93062,7.93063zm-0.00068,-15.4088c-0.38027,0 -0.68696,0.30807 -0.68696,0.68765l0,6.34078l-4.15752,1.81815c-0.34794,0.15266 -0.50611,0.55837 -0.35344,0.90632c0.11278,0.25787 0.36445,0.4119 0.6292,0.4119c0.09214,0 0.18635,-0.01857 0.27575,-0.05845l4.55635,-1.99279c0.00344,-0.00137 0.00619,-0.00275 0.00894,-0.00412l0.00275,-0.00138c0.01032,-0.00413 0.01581,-0.01376 0.02545,-0.01719c0.07151,-0.03576 0.13821,-0.07771 0.19185,-0.1341c0.02337,-0.02338 0.03644,-0.05364 0.05431,-0.08045c0.03301,-0.04401 0.06946,-0.08733 0.0894,-0.14028c0.0165,-0.04126 0.01787,-0.08596 0.02613,-0.12997c0.00894,-0.04469 0.02614,-0.08389 0.02614,-0.1286l0,-6.7905c0,-0.37889 -0.30807,-0.68697 -0.68833,-0.68697z",13:"m-0.00706,-9.5c-5.24281,0 -9.49294,4.25065 -9.49294,9.49294c0,5.24331 4.25014,9.49294 9.49294,9.49294c5.24281,0 9.49294,-4.24964 9.49294,-9.49294c0,-5.2423 -4.25013,-9.49294 -9.49294,-9.49294zm3.08857,3.85997c0.61044,0 1.10279,0.96873 1.10279,2.16271s-0.49384,2.1647 -1.10279,2.1647c-0.60844,0 -1.10228,-0.96873 -1.10228,-2.16372s0.49434,-2.16369 1.10228,-2.16369zm-6.28628,0c0.60844,0 1.10228,0.96873 1.10228,2.16271s-0.49284,2.1647 -1.10228,2.1647s-1.10277,-0.96873 -1.10277,-2.16372s0.49383,-2.16369 1.10277,-2.16369zm3.21167,12.16493c-1.87667,0 -3.63373,-1.14814 -5.14663,-3.14239c1.56571,1.02156 3.27993,1.59064 5.07786,1.59064c1.90905,0 3.72343,-0.63985 5.36539,-1.78497c-1.54429,2.11685 -3.35767,3.33672 -5.29662,3.33672l-0.00001,0z",12:"m9.27295,5.92958l-2.64443,-4.57961c-0.79727,-1.37992 -2.10131,-3.63983 -2.8986,-5.01973l-2.64441,-4.57858c-0.79782,-1.38093 -2.10186,-1.38093 -2.89913,0l-2.64335,4.57858c-0.79728,1.3799 -2.10188,3.63981 -2.89916,5.01973l-2.64387,4.57961c-0.79728,1.38101 -0.14472,2.50988 1.44983,2.50988l16.37221,0c1.59561,0 2.24711,-1.12887 1.45091,-2.50988l0,0zm-8.88166,0.70811l-1.56837,0l0,-1.50484l1.56837,0l0,1.50484zm-0.07527,-2.61447l-1.41621,0l-0.14044,-6.44231l1.68427,0l-0.12761,6.44231l0,0z",11:"m8.08295,-6.56414l-3.59319,0l0,-1.43586l-8.98155,0l0,1.43586l-3.59321,0c-1.0569,0 -1.915,0.85509 -1.915,1.91159l0,9.92258c0,1.05357 0.8581,1.91158 1.915,1.91158l16.16796,0c1.05692,0 1.91501,-0.85801 1.91501,-1.91158l0,-9.92258c0,-1.0565 -0.85809,-1.91159 -1.91501,-1.91159l0,0zm-8.08397,12.66884c-3.20143,0 -5.80643,-2.60031 -5.80643,-5.79596c0,-3.19569 2.605,-5.79891 5.80643,-5.79891s5.80789,2.60322 5.80789,5.79891c0,3.19565 -2.60794,5.79596 -5.80789,5.79596zm0,-9.6804c-2.15036,0 -3.89142,1.7394 -3.89142,3.88444c0,2.14503 1.74252,3.8844 3.89142,3.8844c2.1489,0 3.89141,-1.73937 3.89141,-3.8844c0,-2.14503 -1.74105,-3.88444 -3.89141,-3.88444z",10:"m0,-10c-0.20885,0 -0.39491,0.08583 -0.55177,0.24149c-0.15674,0.15536 -0.28646,0.37838 -0.39429,0.65665c-0.21586,0.55655 -0.34853,1.33844 -0.42114,2.27477c-0.07231,0.93446 -0.08474,2.02273 -0.05447,3.18765c-2.58175,1.05925 -7.81787,3.24648 -8.23854,3.73474c-0.56001,0.65029 -0.37908,1.3954 -0.15331,1.89002l8.608,-1.75235c0.18202,2.28374 0.4407,4.5455 0.66615,6.31771c-0.8418,0.24646 -2.41323,0.73303 -2.73754,1.03474c-0.4469,0.41562 -0.4469,1.75793 -0.4469,1.75793l3.52318,-0.28665c0.08286,0.57874 0.13486,0.9163 0.13486,0.9163l0.00511,0.03042l0.02778,0l0.06486,0l0.02778,0l0.00511,-0.03042c0,0 0.05185,-0.33756 0.13486,-0.9163l3.52424,0.28665c0,0 0,-1.34231 -0.44688,-1.75793c-0.32446,-0.30172 -1.89697,-0.7895 -2.73847,-1.0358c0.22484,-1.76681 0.4832,-4.02001 0.66507,-6.29634l8.50712,1.73203c0.22561,-0.49462 0.40765,-1.23973 -0.15237,-1.89002c-0.41538,-0.48221 -5.52504,-2.62071 -8.1386,-3.69423c0.03119,-1.17999 0.01971,-2.28285 -0.05353,-3.22816l0,-0.00233c-0.07263,-0.93523 -0.20545,-1.71635 -0.42114,-2.27244c-0.10784,-0.27827 -0.23634,-0.50114 -0.3932,-0.65665c-0.15689,-0.15567 -0.34293,-0.24149 -0.55195,-0.24149l0,0l0,0l0,0l0.00001,0l0,0l-0.00003,0.00001z",3:"m-10,0l10,-10l10,10l-10,10l-10,-10z",5:"M0,0 L-5,-15 0,-10 5,-15 z",6:"M0,0 L5,15 0,10 -5,15z",7:"M-5,-15 L0,0 5,-15",8:"M-5,15 L0,0 5,15",9:"m0,-24c-4.4183,0 -8,3.58167 -8,8c0,1.42102 0.3816,2.75 1.0312,3.90601c0.1079,0.19202 0.221,0.38098 0.3438,0.56299l6.625,11.53101l6.625,-11.53101c0.102,-0.151 0.19,-0.31097 0.281,-0.46899l0.063,-0.09399c0.649,-1.15601 1.031,-2.48499 1.031,-3.90601c0,-4.41833 -3.582,-8 -8,-8zm0,4c2.209,0 4,1.79089 4,4c0,2.20898 -1.791,4 -4,4c-2.2091,0 -4,-1.79102 -4,-4c0,-2.20911 1.7909,-4 4,-4z"};var bS={BMap_Symbol_SHAPE_CIRCLE:1,BMap_Symbol_SHAPE_RECTANGLE:2,BMap_Symbol_SHAPE_RHOMBUS:3,BMap_Symbol_SHAPE_STAR:4,BMap_Symbol_SHAPE_BACKWARD_CLOSED_ARROW:5,BMap_Symbol_SHAPE_FORWARD_CLOSED_ARROW:6,BMap_Symbol_SHAPE_BACKWARD_OPEN_ARROW:7,BMap_Symbol_SHAPE_FORWARD_OPEN_ARROW:8,BMap_Symbol_SHAPE_POINT:9,BMap_Symbol_SHAPE_PLANE:10,BMap_Symbol_SHAPE_CAMERA:11,BMap_Symbol_SHAPE_WARNING:12,BMap_Symbol_SHAPE_SMILE:13,BMap_Symbol_SHAPE_CLOCK:14};function dn(i,e){eQ.call(this);e=e||{};this.style={anchor:e.anchor||new id(0,0),fillColor:e.fillColor||"#000",fillOpacity:e.fillOpacity||0,scale:e.scale||1,rotation:e.rotation||0,strokeColor:e.strokeColor||"#000",strokeOpacity:e.strokeOpacity===undefined?1:e.strokeOpacity,strokeWeight:e.strokeWeight};this._type=(typeof i==="number")?i:"UserDefined";this._anchor=this.style.anchor;this._originOffset=new id(0,0);this.anchor=new id(0,0);this._rawPath=i;this._buildPath(true)}dn.inherits(eQ,"SVGSymbol");dn.generateKey=function(jj,i){if(!jj){return null}if(parseInt(jj)){jj=parseInt(jj)}if(typeof jj==="number"){if(!e7[jj]&&![0,1,2,0,4][jj]){return null}}var e={anchor:i.anchor||new id(0,0),fillColor:i.fillColor||"#000",fillOpacity:i.fillOpacity||0,scale:i.scale||1,rotation:i.rotation||0,strokeColor:i.strokeColor||"#000",strokeOpacity:i.strokeOpacity===undefined?1:i.strokeOpacity,strokeWeight:i.strokeWeight};var T=l({path:jj,style:e});return"symbol_svg_icon_"+T};ey.extend(dn.prototype,{_buildPath:function(ju){var jo=this;var jq=jo._rawPath;if(parseInt(jq)){jq=parseInt(jq)}if(e7[jq]){jq=e7[jq]}jo.id=dn.generateKey(jq,jo.style);console.log("svg-code:"+jo.id);if(!jo.id){return}switch(jq){case bS.BMap_Symbol_SHAPE_CIRCLE:var jr=jo._calSize(2),jp=jr,jz=jo.style.scale,jk=jo._anchor;this.size=new id(jr,jp);this.anchor=new id(jr/2+jk.width*jz,jp/2+jk.height*jz);jo.path=bS.BMap_Symbol_SHAPE_CIRCLE;break;case bS.BMap_Symbol_SHAPE_RECTANGLE:var jr=jo._calSize(4),jp=jo._calSize(2),jk=jo._anchor,jw=jo.style.strokeWeight!==undefined?jo.style.strokeWeight:jo.style.scale,jz=jo.style.scale;this.size=new id(jr,jp);this._originOffset=new id(Math.floor(-jw/2),Math.floor(-jw/2));this.anchor=new id(jr/2+jk.width*jz,jp/2+jk.height*jz);jo.path=bS.BMap_Symbol_SHAPE_RECTANGLE;break;case bS.BMap_Symbol_SHAPE_STAR:var jr=jo._calSize(20),jp=jr,jk=jo._anchor,jz=jo.style.scale;this.size=new id(jr,jp);this.anchor=new id(jr/2+jk.width*jz,jp/2+jk.height*jz);jo.path=bS.BMap_Symbol_SHAPE_STAR;break;default:var jq=new dl(jq),jj=jq.bounds(),jt=jo.style.rotation*Math.PI/180,jw=jo.style.strokeWeight!==undefined?jo.style.strokeWeight:jo.style.scale,jz=jo.style.scale,jk=jo._anchor;var jy=new id(Math.floor(jj.x1*jz-jw/2),Math.floor(jj.y1*jz-jw/2)),e={topleft:new eS(Math.floor(jj.x1*jz-jw/2)-jz*jk.width,Math.floor(jj.y1*jz-jw/2)-jz*jk.height),bottomleft:new eS(Math.floor(jj.x1*jz-jw/2)-jz*jk.width,Math.ceil(jj.y2*jz-jw/2)-jz*jk.height),topright:new eS(Math.ceil(jj.x2*jz+jw/2)-jz*jk.width,Math.floor(jj.y1*jz-jw/2)-jz*jk.height),bottomright:new eS(Math.ceil(jj.x2*jz+jw/2)-jz*jk.width,Math.ceil(jj.y2*jz+jw/2)-jz*jk.height)},i={},jx=[],jn=[];var jv=e.topleft.x===0?0:Math.atan(e.topleft.y/e.topleft.x),T=jv+jt;for(var js in e){var jm=Math.cos(jt)*e[js].x-Math.sin(jt)*e[js].y,jl=Math.sin(jt)*e[js].x+Math.cos(jt)*e[js].y;i[js]=new eS(jm,jl);jx.push(jm);jn.push(jl)}xmax=Math.max.apply(Math,jx),ymax=Math.max.apply(Math,jn),xmin=Math.min.apply(Math,jx),ymin=Math.min.apply(Math,jn);this.size=new id(Math.ceil(xmax-xmin),Math.ceil(ymax-ymin));this.anchor=new id(-xmin,-ymin);this._originOffset=new id(xmin-i.topleft.x,ymin-i.topleft.y);this._innerOffset=new eS(jy.width,jy.height);this._rotationAngle=jt;jo.path=jq;break}this.imageSize=new id(this.size.width,this.size.height);this.offset=this.anchor;if(ju){this.resetInitOptions()}},_calSize:function(e){if(this.style.strokeWeight){return e*this.style.scale+this.style.strokeWeight%3+this.style.strokeWeight}else{return e*this.style.scale+this.style.scale+this.style.scale%2}},render:function(T){var jp=this,jj=this.style.scale,jq,jr=this.size;if(this.context){jq=this.context;if(this.context.canvas.width/2!==this.size.width||this.context.canvas.height/2!==this.size.height){this.context.canvas.width=this.size.width*2;this.context.canvas.height=this.size.height*2}jq.clearRect(0,0,this.size.width*2,this.size.height*2);jq.fillStyle=gW.convert2rgba(jp.style.fillColor,jp.style.fillOpacity);jq.strokeStyle=gW.convert2rgba(jp.style.strokeColor,jp.style.strokeOpacity);jq.save()}else{return false}jq.scale(2,2);jq.lineCap="round";jq.lineJoin="round";jq.lineWidth=jp.style.strokeWeight||jj;if(jp._originOffset){jq.translate(-jp._originOffset.width,-jp._originOffset.height)}if(jp._rotationAngle){jq.rotate(jp._rotationAngle)}if(jp._innerOffset){jq.translate(-jp._innerOffset.x,-jp._innerOffset.y)}switch(jp.path){case bS.BMap_Symbol_SHAPE_CIRCLE:jq.arc(jr.width/2,jr.height/2,jj,0,2*Math.PI);break;case bS.BMap_Symbol_SHAPE_RECTANGLE:jq.rect(0,0,4*jj,2*jj);break;case bS.BMap_Symbol_SHAPE_STAR:jq.beginPath();var jl=jr.width/2,jn=jj*10;var jk=(2*Math.PI)/10;for(var jm=11;jm!=0;jm--){var e=jn*(jm%2+1)/2;var jo=jk*jm;jq.lineTo((e*Math.sin(jo))+jl,(e*Math.cos(jo))+jl)}jq.closePath();break;default:jq.lineWidth=jq.lineWidth/jj;jq.scale(jj,jj);jp.path.draw(jq)}jq.fill();jq.stroke();jq.restore();this.data=jq.getImageData(0,0,this.size.width*2,this.size.height*2);return true},setPath:function(e){this._rawPath=e;this._buildPath();this.update()},setAnchor:function(e){this._anchor=this.style.anchor=e;this._buildPath();this.update()},setRotation:function(e){this.style.rotation=e;this._buildPath();this.update()},setScale:function(e){this.style.scale=e;this._buildPath();this.update()},setStrokeWeight:function(e){this.style.strokeWeight=e;this._buildPath();this.update()},setStrokeColor:function(e){e=gW.convert2rgba(e,this.style.strokeOpacity);this.style.strokeColor=e;this._buildPath();this.update()},setStrokeOpacity:function(e){this.style.strokeOpacity=e;this._buildPath();this.update()},setFillOpacity:function(e){this.style.fillOpacity=e;this._buildPath();this.update()},setFillColor:function(e){this.style.fillColor=e;this._buildPath();this.update()}});bp.SymbolShapeType=bS;function iD(jl,jj,T){if(!jl||!jj){return}this.imageUrl=null;this.imageDom=null;if(typeof jl==="string"){this.imageUrl=jl}else{this.imageDom=jl;if(!this.imageDom.id){this.imageDom.id=bp.getGUID("icon_dom_")}}this.size=jj;var jk=new id(Math.floor(jj.width/2),Math.floor(jj.height/2));var i={offset:jk,imageOffset:new id(0,0)};T=T||{};for(var e in T){i[e]=T[e]}if(T.anchor){i.offset=T.anchor}this.anchor=this.offset=i.offset;this.imageOffset=i.imageOffset;this.infoWindowOffset=T.infoWindowOffset||this.offset;this.printImageUrl=T.printImageUrl||"";this.imageSize=T.imageSize||this.size;this.srcSetObject={};this.setImageSrcset(T.srcset||T.srcSet)}iD.prototype.setImageUrl=function(e){if(!e){return}this.imageUrl=e;this._renderData=null};iD.prototype.getCurrentImageUrl=function(){if(window.devicePixelRatio>1&&this.srcSetObject["2x"]){return this.srcSetObject["2x"]}return this.imageUrl};iD.prototype.setPrintImageUrl=function(e){if(!e){return}this.printImageUrl=e};iD.prototype.setSize=function(e){if(!e){return}this.size=new id(e.width,e.height);this._renderData=null};iD.prototype.setOffset=function(e){if(!e){return}this.anchor=this.offset=new id(e.width,e.height);this._renderData=null};iD.prototype.setAnchor=function(e){this.setOffset(e)};iD.prototype.setImageOffset=function(e){if(!e){return}this.imageOffset=new id(e.width,e.height);this._renderData=null};iD.prototype.setInfoWindowOffset=function(e){if(!e){return}this.infoWindowOffset=new id(e.width,e.height)};iD.prototype.setImageSize=function(e){if(!e){return}this.imageSize=new id(e.width,e.height)};iD.prototype.setImageSrcset=function(T){var e="";if(!T){return}for(var i in T){if(T.hasOwnProperty(i)){this.srcSetObject[i]=T[i];e=T[i]+" "+i+","}}this.srcSet=e};iD.prototype.toString=function(){return"Icon"};iD.prototype.generateRenderData=function(jl){var T=this.offset;var e=this.size;var jn=this.imageOffset;var jm=[];jm.push(-T.width,T.height-e.height,0);jm.push(e.width-T.width,T.height-e.height,0);jm.push(e.width-T.width,T.height,0);jm.push(-T.width,T.height-e.height,0);jm.push(e.width-T.width,T.height,0);jm.push(-T.width,T.height,0);if(jl!==0){for(var jk=0;jk<jm.length;jk+=3){var jj=vec2.fromValues(jm[jk],jm[jk+1]);vec2.rotate(jj,jj,[0,0],hR(-jl));jm[jk]=jj[0];jm[jk+1]=jj[1]}}return{vertex:jm}};iD.prototype.getRenderData=function(e){this._renderData=this.generateRenderData(e);return this._renderData};function dF(T,i){ey.BaseClass.call(this);this.content=T;this.map=null;this._config={width:0,height:0,maxWidth:600,offset:new id(0,0),title:"",maxContent:"",enableMaximize:false,enableAutoPan:true,enableCloseOnClick:true,margin:[10,10,40,10],collisions:[[10,10],[10,10],[10,10],[10,10]],ifMaxScene:false,onClosing:function(){return true}};this.setConfig(i);if(this._config.width!==0){if(this._config.width<220){this._config.width=220}if(this._config.width>730){this._config.width=730}}if(this._config.height!==0){if(this._config.height<60){this._config.height=60}if(this._config.height>650){this._config.height=650}}if(this._config.maxWidth!==0){if(this._config.maxWidth<220){this._config.maxWidth=220}if(this._config.maxWidth>730){this._config.maxWidth=730}}this.isWinMax=false;this.IMG_PATH=w.imgPath;this.overlay=null;var e=this;gs.load("infowindow",function(){e._draw()})}dF.inherits(ey.BaseClass,"InfoWindow");ey.extend(dF.prototype,{setWidth:function(e){e=e*1;if(!e&&e!==0||isNaN(e)||e<0){return}if(e!==0){if(e<220){e=220}if(e>730){e=730}}this._config.width=e},setHeight:function(e){e=e*1;if(!e&&e!==0||isNaN(e)||e<0){return}if(e!==0){if(e<60){e=60}if(e>650){e=650}}this._config.height=e},setMaxWidth:function(e){e=e*1;if(!e&&e!==0||isNaN(e)||e<0){return}if(e!==0){if(e<220){e=220}if(e>730){e=730}}this._config.maxWidth=e},setTitle:function(e){this._config.title=e||""},setContent:function(e){this.content=e||""},getContent:function(){return this.content},setMaxContent:function(e){this._config.maxContent=e||""},redraw:function(){},enableAutoPan:function(){this._config.enableAutoPan=true},disableAutoPan:function(){this._config.enableAutoPan=false},enableCloseOnClick:function(){this._config.enableCloseOnClick=true},disableCloseOnClick:function(){this._config.enableCloseOnClick=false},enableMaximize:function(){this._config.enableMaximize=true},disableMaximize:function(){this._config.enableMaximize=false},show:function(){this._visible=true},hide:function(){this._visible=false},close:function(){this.hide()},dispose:function(){ey.BaseClass.prototype.decontrol.call(this)},maximize:function(){this.isWinMax=true},restore:function(){this.isWinMax=false},setConfig:function(i){if(!i){return}for(var e in i){if(typeof(this._config[e])===typeof(i[e])){this._config[e]=i[e]}}},isVisible:function(){return this.isOpen()},isOpen:function(){return false},getPointIn:function(){if(this.overlay&&this.overlay.getPoint){return this.overlay.getPoint()}},getTitle:function(){return this._config.title||""},getPosition:function(){return this.latLng},getPoint:function(){var e=this.getPointIn();if(this.map.config.coordType===BMAP_COORD_GCJ02){var i=il.convertMC2LL(e);return ei(i)}return il.convertMC2LL(e)},getOffset:function(){return this._config.offset},dispose:function(){ey.BaseClass.prototype.decontrol.call(this)},toString:function(){return"InfoWindow"}});g5.prototype.openInfoWindow=function(T,e){T.latLng=new ca(e.lat,e.lng);var i=il.convertLL2MC(e);this.openInfoWindowIn(T,i)};g5.prototype.closeInfoWindow=function(){var e=this.temp.infoWin||this.temp._infoWin;if(e&&e.overlay){e.overlay.closeInfoWindow()}};g5.prototype.openInfoWindowIn=function(jj,e){if(!jj||jj.toString()!=="InfoWindow"||!e||e.toString()!=="Point"){return}var i=this.temp;if(!i.marker){var T=new iD(w.imgPath+"blank.gif",{width:1,height:1});i.marker=new iZ(e,{icon:T,width:1,height:1,offset:new id(0,0),infoWindowOffset:new id(0,0),clickable:false});i.marker._fromMap=1}else{i.marker.setPoint(e)}this.addOverlay(i.marker);i.marker.show();i.marker.openInfoWindow(jj)};ec.prototype.openInfoWindow=function(e){if(this.map){this.map.closeInfoWindow();e._visible=true;this.map.temp._infoWin=e;e.overlay=this;ey.BaseClass.call(e,e.hashCode)}};ec.prototype.closeInfoWindow=function(){if(this.map&&this.map.temp._infoWin){this.map.temp._infoWin._visible=false;this.map.temp._infoWin.decontrol();this.map.temp._infoWin=null}};function a5(T,i){ec.call(this);this.content=T;this.map=null;this.domElement=null;this._config={width:0,offset:new id(0,0),styles:{backgroundColor:"#fff",border:"1px solid #f00",padding:"1px",whiteSpace:"nowrap",fontSize:"12px",zIndex:"80",MozUserSelect:"none"},point:null,enableMassClear:true};i=i||{};this.setConfig(i);if(this._config.width<0){this._config.width=0}this.point=this._config.point;var e=this;gs.load("marker",function(){e._draw()})}a5.inherits(ec,"Label");ey.extend(a5.prototype,{setPoint:function(e){if(e&&e.toString()==="Point"&&!this.getMarker()){if(this.coordType===BMAP_COORD_GCJ02){var i=hK(e,3);this.point=this._config.point=new cg(i.lng,i.lat)}else{this.point=this._config.point=new cg(e.lng,e.lat)}}},setContent:function(e){this.content=e},getContent:function(e){return this.content},setOpacity:function(e){if(e>=0&&e<=1){this._config.opacity=e}},setOffset:function(e){if(!e||e.toString()!=="Size"){return}this._config.offset=new id(e.width,e.height)},getOffset:function(){return this._config.offset},setStyle:function(e){e=e||{};this._config.styles=ey.extend(this._config.styles,e)},setStyles:function(e){this.setStyle(e)},setTitle:function(e){this._config.title=e||""},getTitle:function(){return this._config.title},setMarker:function(e){if(this._marker&&this._marker!==e){this._marker._config.label=null}this._marker=e;if(e){this.point=this._config.point=e.getPoint()}else{this.point=this._config.point=null}},getMarker:function(){return this._marker||null},getPositionIn:function(){return this.getPoint()},});function hd(T,i){var jj={};for(var e in i){if(i.hasOwnProperty(e)){if(e==="position"){jj.point=il.convertLL2MC(i[e]);this.latLng=new ca(i[e]["lat"],i[e]["lng"])}else{jj[e]=i[e]}}}a5.call(this,T,jj)}hd.inherits(a5,"LabelOut");ey.extend(hd.prototype,{toString:function(){return"Label"},setPosition:function(e){this.latLng=new ca(e.lat,e.lng);var i=il.convertLL2MC(e);this.setPoint(i)},getPosition:function(){return this.latLng}});window.BMAP_ANIMATION_DROP=1;window.BMAP_ANIMATION_BOUNCE=2;function iZ(e,i){ec.call(this);i=i||{};this.delFlag=i.delFlag;this.point=e;this._rotation=0;this.map=null;this._animation=null;this.domElement=null;this.iconDom=null;this.infoWindowDom=null;this.siblingElement=null;this.textureCoord=null;this.textureCoordGLMap=null;this.collisionDetectionFailed=false;this._config={offset:new id(0,0),opacity:1,icon:null,title:"",infoWindow:null,label:null,baseZIndex:0,clickable:true,zIndexFixed:false,isTop:false,enableMassClear:true,enableDragging:false,raiseOnDrag:false,restrictDraggingArea:false,startAnimation:"",enableCollisionDetection:false,rank:0,enableDraggingMap:false};this.setOptions(i);this._isDragging=false;var T=this;gs.load("marker",function(){T._draw()})}iZ.TOP_ZINDEX=aI.getZIndex(-90)+1000000;iZ.DRAG_ZINDEX=iZ.TOP_ZINDEX+1000000;iZ._injectMethond=function(e){ey.extend(iZ.prototype,e)};iZ.inherits(ec,"Marker");ey.extend(iZ.prototype,{toString:function(){return"Marker"},setOptions:function(e){this.setConfig(e);if(!e.icon){this._config.icon=new iD(w.imgPath+"marker_red.png",new id(23,25),{offset:new id(10,25),infoWindowOffset:new id(10,0)})}},setIcon:function(e){if(e){this._config.icon=e;this.textureCoord=this.textureCoordGLMap=null}},getIcon:function(){return this._config.icon},setLabel:function(e){if(!(e instanceof a5)){return}this._config.label=e;e._config.enableMassClear=this._config.enableMassClear;e.setPoint(this.point)},getLabel:function(){return this._config.label},enableDragging:function(){this._config.enableDragging=true},disableDragging:function(){this._config.enableDragging=false},setPoint:function(e){if(e){if(this.map.config.coordType===BMAP_COORD_GCJ02){var i=hK(e,3);this.point=this._config.point=new cg(i.lng,i.lat);this.latLng=il.convertMC2LL(i)}else{this.point=this._config.point=new cg(e.lng,e.lat);this.latLng=il.convertMC2LL(e)}}},setPositionIn:function(e){this.setPoint(e)},getPositionIn:function(){return this.getPoint()},setTop:function(i,e){this._config.isTop=!!i;if(i){this._addi=e||0}},setTitle:function(e){this._config.title=e||""},getTitle:function(){return this._config.title},setOffset:function(e){if(e){this._config.offset=e}},getOffset:function(){return this._config.offset},setAnimation:function(e){this._animation=e},setRank:function(e){this._config.rank=e},getRank:function(){return this._config.rank},setRotation:function(e){while(e<0){e+=360}this._rotation=e%360},getRotation:function(){return this._rotation}});function r(e,T){this.latLng=new ca(e.lat,e.lng);var i=il.convertLL2MC(e);iZ.call(this,i,T)}r.inherits(iZ,"MarkerOut");ey.extend(r.prototype,{toString:function(){return"Marker"},toGeoJSON:function(){var i="Point";var T=[this.latLng.lng,this.latLng.lat];var e={type:"Feature",geometry:{type:i,coordinates:T},properties:this.properties};return e},updateByGeoJSON:function(T){var e=new fZ();var jl=e.readFeaturesFromObject(T)||[];for(var jj=0,jk=jl.length;jj<jk;++jj){if(jl[jj] instanceof r){this.properties=jl[jj].properties;this.setPosition(jl[jj].getPosition());break}}},setPosition:function(e){this.latLng=new ca(e.lat,e.lng);var i=il.convertLL2MC(e);this.setPositionIn(i)},getPosition:function(){return this.latLng},});window.BMAP_SHAPE_CIRCLE=1;window.BMAP_SHAPE_RECT=2;function dQ(i,e,T){ec.call(this,e,T);this.domElement=null;this.point=i;T=T||{};this._config={};this._config.height=e||0;this._config.size=typeof T.size==="number"?T.size:50;this._config.fillOpacity=typeof T.fillOpacity==="number"?T.fillOpacity:0.8;this._config.shape=typeof T.shape==="number"?T.shape:1;bX(this._config.fillOpacity,0,1);if(T.fillColor===""){this._config.fillColor=""}else{this._config.fillColor=T.fillColor?T.fillColor:"#f00"}this._config.icon=T.icon instanceof iD?T.icon:"";this._config.enableMassClear=T.enableMassClear||true;var jj=this;gs.load("marker",function(){jj._draw()})}dQ.inherits(ec,"Marker3D");ey.extend(dQ.prototype,{setPoint:function(e){if(this.map.config.coordType===BMAP_COORD_GCJ02){var T=hK(e,3);this.point=this._config.point=new cg(T.lng,T.lat);this.latLng=il.convertMC2LL(T)}else{this.point=this._config.point=new cg(e.lng,e.lat);this.latLng=il.convertMC2LL(e)}var i=new ff("onstatus_change");i.overlay=this;i.action="setPoint";this.fire(i)},setPositionIn:function(e){this.setPoint(e)},getPositionIn:function(){return this.getPoint()},setDomAttribute:function(i,T){var e=new ff("onlineupdate");e.overlay=this;this.dispatchEvent(e)}});function dN(i,e,jj){this.latLng=new ca(i.lat,i.lng);var T=il.convertLL2MC(i);dQ.call(this,T,e,jj)}dN.inherits(dQ,"Marker3d");ey.extend(dN.prototype,{toString:function(){return"Marker3D"},setHeight:function(e){this._config.height=Number(e);this.draw();var i=new ff("onlineupdate");i.overlay=this;this.dispatchEvent(i)},getHeight:function(){return this._config.height},setFillOpacity:function(e){if(e>1||e<0){return}this._config.fillOpacity=e;this.setDomAttribute("fillopacity",e)},getFillOpacity:function(){return this._config.fillOpacity},setFillColor:function(e){this._config.fillColor=e||"";this.setDomAttribute("fillcolor",e)},getFillColor:function(){return this._config.fillColor},setIcon:function(i){if(!i||!this.map){return}this._config.icon=i;if(this._config.icon){var e=this._config.icon.getCurrentImageUrl();var jj=i.getCurrentImageUrl()!==e;this._config.icon=i;this.textureCoord=this.textureCoordGLMap=null;this.draw();var T=new ff("onstatus_change");T.overlay=this;T.action="setIcon";T.imageUrlChanged=jj;this.fire(T)}},getIcon:function(){return this._config.icon},setPosition:function(e){this.latLng=new ca(e.lat,e.lng);var i=il.convertLL2MC(e);this.setPositionIn(i)},getPosition:function(){var e=this.getPositionIn();return il.convertMC2LL(e)}});function fq(T,e){hQ.call(this,e);this._normalizedBounds=new hk();this.setPoints(T);var i=this;gs.load("poly",function(){i._draw()})}fq.inherits(hQ,"Polyline");ey.extend(fq.prototype,{getBoundsIn:function(e){if(!e){this._bounds.setMinMax();return this._bounds}this._normalizedBounds.setMinMax();return this._normalizedBounds},setPoints:function(T){this._clearCache();this.points=hQ.getGraphPoints(T).slice(0);if(this._config.geodesic===true){this.greatCirclePoints.length=0;for(var e=0;e<this.points.length-1;e++){this.calcGreatCirclePoints(this.points[e],this.points[e+1])}}this._calcBounds()},_calcBounds:function(){if(!this.points){return}var e=this;e._bounds.setNorthEast(null);e._bounds.setSouthWest(null);if(e.greatCirclePoints&&e.greatCirclePoints.length>0){ey.each(e.greatCirclePoints,function(i){e._bounds.extend(i)})}else{ey.each(e.points,function(i){e._bounds.extend(i)})}e._normalizedBounds.setSouthWest(e._bounds.getSouthWest());e._normalizedBounds.setNorthEast(e._bounds.getNorthEast());if(e._normalizedBounds.sw.lng<-g5.WORLD_SIZE_MC_HALF||e._normalizedBounds.ne.lng>g5.WORLD_SIZE_MC_HALF){e._normalizedBounds.sw.lng=-g5.WORLD_SIZE_MC_HALF;e._normalizedBounds.ne.lng=g5.WORLD_SIZE_MC_HALF}},calcGreatCirclePoints:function(jj,T){var jl=jj.latLng;var jk=T.latLng;if(jl.equals(jk)){return}var e=il.getDistance(hR(jl.lng),hR(jl.lat),hR(jk.lng),hR(jk.lat));if(e<250000){return}var jp=Math.round(e/150000);var jt=this.calcAngularDistance(jl,jk);this.greatCirclePoints.push(jj);var js=jl.lng;var jr=jj;for(var jm=0;jm<jp;jm++){var jo=this.calcMiddlePoint(jl,jk,jm/jp,jt);var jq=il.convertLL2MC(jo);var jn=jq.lng;var ju=d2(jq,jr);if(ju>30037726){if(jq.lng<jr.lng){jq.lng+=g5.WORLD_SIZE_MC}else{jq.lng-=g5.WORLD_SIZE_MC}}this.greatCirclePoints.push(jq);jr=jq}var ju=d2(T,jr);if(ju>30037726){if(T.lng<jr.lng){T.lng+=g5.WORLD_SIZE_MC}else{T.lng-=g5.WORLD_SIZE_MC}}this.greatCirclePoints.push(T)},calcMiddlePoint:function(jq,jp,jr,jv){var jk=jq.lat;var jj=jp.lat;var ju=jq.lng;var js=jp.lng;var jw=hR(jk);var jt=hR(jj);var i=hR(ju);var e=hR(js);var jy=Math.sin((1-jr)*jv)/Math.sin(jv);var jx=Math.sin(jr*jv)/Math.sin(jv);var jn=jy*Math.cos(jw)*Math.cos(i)+jx*Math.cos(jt)*Math.cos(e);var jm=jy*Math.cos(jw)*Math.sin(i)+jx*Math.cos(jt)*Math.sin(e);var jl=jy*Math.sin(jw)+jx*Math.sin(jt);var T=Math.atan2(jl,Math.sqrt(Math.pow(jn,2)+Math.pow(jm,2)));var jo=Math.atan2(jm,jn);return new cg(eJ(jo),eJ(T))},calcAngularDistance:function(jk,i){var jl=hR(jk.lat);var jj=hR(i.lat);var T=hR(jk.lng);var e=hR(i.lng);return Math.acos(Math.sin(jl)*Math.sin(jj)+Math.cos(jl)*Math.cos(jj)*Math.cos(Math.abs(e-T)))}});function bd(jk,e){if(!jk||jk.length===0){return}var jj=[];for(var T=0;T<jk.length;T++){jj[T]=il.convertLL2MC(jk[T])}fq.call(this,jj,e)}bd.inherits(fq,"PolylineOut");ey.extend(bd.prototype,{toString:function(){return"Polyline"},toGeoJSON:function(){var jj="LineString";var jk=[];var jl=this.getPath();for(var T=0;T<jl.length;T++){jk.push([jl[T].lng,jl[T].lat])}var e={type:"Feature",geometry:{type:jj,coordinates:jk},properties:this.properties};return e},updateByGeoJSON:function(T){var e=new fZ();var jl=e.readFeaturesFromObject(T)||[];for(var jj=0,jk=jl.length;jj<jk;++jj){if(jl[jj] instanceof bd){this.properties=jl[jj].properties;this.setPath(jl[jj].getPath());break}}},setPath:function(jj){if(!jj||jj.length===0){return}var T=[];for(var e=0;e<jj.length;e++){T[e]=il.convertLL2MC(jj[e])}this.setPathIn(T);this._mouseEventPixels=null},getPath:function(){var e=this.getPathIn();if(!e||e.length===0){return[]}var jj=[];for(var T=0;T<e.length;T++){jj[T]=il.convertMC2LL(e[T])}return jj},getBounds:function(i){var e=this.getBoundsIn(i);var T=new hk(il.convertMC2LL(e.getSouthWest()),il.convertMC2LL(e.getNorthEast()));return T}});function gg(T,jj,e){hQ.call(this,e);this._normalizedBounds=new hk();this._cps=jj;this._path=T;this.setPoints(T);var i=this;gs.load("poly",function(){i._draw()})}gg.inherits(fq,"BezierCurve");ey.extend(gg.prototype,{getBoundsIn:function(e){if(!e){this._bounds.setMinMax();return this._bounds}this._normalizedBounds.setMinMax();return this._normalizedBounds},setPoints:function(e){this._clearCache();this.points=hQ.getGraphPoints(e).slice(0);this.points=this.calcBezierPoints(this.points,this._cps);this._calcBounds()},_calcBounds:function(){if(!this.points){return}var e=this;e._bounds.setNorthEast(null);e._bounds.setSouthWest(null);if(e.greatCirclePoints&&e.greatCirclePoints.length>0){ey.each(e.greatCirclePoints,function(i){e._bounds.extend(i)})}else{ey.each(e.points,function(i){e._bounds.extend(i)})}e._normalizedBounds.setSouthWest(e._bounds.getSouthWest());e._normalizedBounds.setNorthEast(e._bounds.getNorthEast());if(e._normalizedBounds.sw.lng<-g5.WORLD_SIZE_MC_HALF||e._normalizedBounds.ne.lng>g5.WORLD_SIZE_MC_HALF){e._normalizedBounds.sw.lng=-g5.WORLD_SIZE_MC_HALF;e._normalizedBounds.ne.lng=g5.WORLD_SIZE_MC_HALF}},getPathIn:function(){return this._path},setPathIn:function(e){this._path=e;this.setPoints(e)},getCpsIn:function(){return this._cps},setCpsIn:function(e){this._cps=e;this.setPoints(this._path)},calcBezierPoints:function(jj,jl){var T=[];for(var e=0;e<jj.length-1;e++){var jk=[jj[e],jl[e][0],jl[e][1],jj[e+1]];T=T.concat((this.bezierbetweenTwoP(jk)))}return T},bezierbetweenTwoP:function(jl){var T=100;var jk=1/T;var e=[];for(var jj=0;jj<T;jj++){e.push(this.getPointOnCubicBezier(jl,jj*jk))}return e},getPointOnCubicBezier:function(jm,jq){var i;var jl;var jj;var jr;var jk;var T;var jp;var e;var jo;var jn;jj=3*(jm[1].lng-jm[0].lng);jl=3*(jm[2].lng-jm[1].lng)-jj;i=jm[3].lng-jm[0].lng-jj-jl;T=3*(jm[1].lat-jm[0].lat);jk=3*(jm[2].lat-jm[1].lat)-T;jr=jm[3].lat-jm[0].lat-T-jk;jp=jq*jq;e=jp*jq;jo=(i*e)+(jl*jp)+(jj*jq)+jm[0].lng;jn=(jr*e)+(jk*jp)+(T*jq)+jm[0].lat;return new cg(jo,jn)}});function co(jk,jm,e){if(!jk||jk.length===0){return}this.userPath=jk;this.userCps=jm;var jj=[];for(var T=0;T<jk.length;T++){jj[T]=il.convertLL2MC(jk[T])}if(!jm||jm.length===0){return}var jl=[];for(var T=0;T<jm.length;T++){jl[T]=[];jl[T][0]=il.convertLL2MC(jm[T][0]);if(jm[T][1]){jl[T][1]=il.convertLL2MC(jm[T][1])}else{jl[T][1]=il.convertLL2MC(jm[T][0])}}gg.call(this,jj,jl,e)}co.inherits(gg,"BezierCurveOut");ey.extend(co.prototype,{toString:function(){return"BezierCurve"},setPath:function(jj){if(!jj||jj.length===0){return}this.userPath=jj;var T=[];for(var e=0;e<jj.length;e++){T[e]=il.convertLL2MC(jj[e])}this.setPathIn(T);this._mouseEventPixels=null},getPath:function(){return this.userPath;var e=this.getPathIn();if(!e||e.length===0){return[]}var jj=[];for(var T=0;T<e.length;T++){jj[T]=il.convertMC2LL(e[T])}return jj},getControlPoints:function(){return this.userCps;var e=this.getCpsIn();if(!e||e.length===0){return[]}var jj=[];for(var T=0;T<e.length;T++){jj[T]=[];jj[T][0]=il.convertMC2LL(e[T][0]);jj[T][1]=il.convertMC2LL(e[T][1])}return jj},setControlPoints:function(jj){if(!jj||jj.length===0){return}this.userCps=jj;var T=[];for(var e=0;e<jj.length;e++){T[e]=[];T[e][0]=il.convertLL2MC(jj[e][0]);if(jj[e][1]){T[e][1]=il.convertLL2MC(jj[e][1])}else{T[e][1]=il.convertLL2MC(jj[e][0])}}this.setCpsIn(T)},getBounds:function(i){var e=this.getBoundsIn(i);var T=new hk(il.convertMC2LL(e.getSouthWest()),il.convertMC2LL(e.getNorthEast()));return T}});function dW(e,T){hQ.call(this,T);this._normalizedBounds=new hk();this.setPoints(e);var i=this;gs.load("poly",function(){i._draw()})}dW.inherits(fq,"PolylineMultipart");ey.extend(dW.prototype,{setPoints:function(e){if(!e){return}this._clearCache();this.points=this._unifyArgs(e);this._calcBounds()},_unifyArgs:function(T){var e=[];var i=[];if(T.constructor===Array){if(T[0].constructor===cg){i.push(T)}else{i=T}}else{if(typeof T==="string"){i.push(T)}}ey.each(i,function(jj){e.push(hQ.getGraphPoints(jj))});return e},setPointAt:function(i,e,T){T=T||0;if(!e||!this.points[T]||!this.points[T][i]){return}this._clearCache();this.points[T][i]=new cg(e.lng,e.lat);this._calcBounds()},getBoundsIn:function(e){if(!e){this._bounds.setMinMax();return this._bounds}this._normalizedBounds.setMinMax();return this._normalizedBounds},_calcBounds:function(){if(!this.points){return}var e=this;e._bounds.setNorthEast(null);e._bounds.setSouthWest(null);if(e.greatCirclePoints&&e.greatCirclePoints.length>0){ey.each(e.greatCirclePoints,function(i){e._bounds.extend(i)})}else{ey.each(e.points,function(i){ey.each(i,function(T){e._bounds.extend(T)})})}e._normalizedBounds.setSouthWest(e._bounds.getSouthWest());e._normalizedBounds.setNorthEast(e._bounds.getNorthEast());if(e._normalizedBounds.sw.lng<-g5.WORLD_SIZE_MC_HALF||e._normalizedBounds.ne.lng>g5.WORLD_SIZE_MC_HALF){e._normalizedBounds.sw.lng=-g5.WORLD_SIZE_MC_HALF;e._normalizedBounds.ne.lng=g5.WORLD_SIZE_MC_HALF}}});function gG(T,e){hQ.call(this,e);e=e||{};if(typeof e.fillOpacity==="number"){this._config.fillOpacity=e.fillOpacity}else{this._config.fillOpacity=0.6}bX(this._config.fillOpacity,0,1);if(e.fillColor===""){this._config.fillColor=""}else{this._config.fillColor=e.fillColor?e.fillColor:"#fff"}this._parseFillCacheWebGL=[];this.setPoints(T,e);var i=this;gs.load("poly",function(){i._draw()})}gG.inherits(hQ,"Polygon");ey.extend(gG.prototype,{setPoints:function(jl){var jj=[];if(typeof jl==="string"||jl.length===1||jl[0] instanceof cg||jl[0] instanceof ca||this instanceof gn||jl.length===0){if(jl.length===1){jl=jl[0]}var e=this._processSinglePointArray(jl);this._userPoints=e.userPoints;jj=e.innerPoints;this.hasMultipleParts=false}else{this._userPoints=[];for(var jk=0;jk<jl.length;jk++){var T=this._processSinglePointArray(jl[jk]);this._userPoints.push(T.userPoints);jj.push(T.innerPoints)}this.hasMultipleParts=true}hQ.prototype.setPoints.call(this,jj)},setPathIn:function(e){this.setPoints(e)},_processSinglePointArray:function(e){var i=hQ.getGraphPoints(e).slice(0);innerPoints=i.slice(0);if(innerPoints.length>1&&!innerPoints[0].equals(innerPoints[innerPoints.length-1])){innerPoints.push(new cg(innerPoints[0].lng,innerPoints[0].lat))}return{userPoints:i,innerPoints:innerPoints}},setPointAt:function(i,e){if(!this._userPoints[i]){return}this._clearCache();this._userPoints[i]=new cg(e.lng,e.lat);this.points[i]=new cg(e.lng,e.lat);if(i===0&&!this.points[0].equals(this.points[this.points.length-1])){this.points[this.points.length-1]=new cg(e.lng,e.lat)}this._calcBounds()},setPositionAt:function(i,e){if(!this._userPoints[i]){return}var T=il.convertLL2MC(e);this.setPointAt(i,T)},getPoints:function(){var e=this._userPoints;if(e.length===0){e=this.points}return e},getPathIn:function(){return this.getPoints()}});function hW(T,e){if(!T||T.length===0){return}var i=this.setPath(T,true);gG.call(this,i,e)}hW.inherits(gG,"PolygonOut");ey.extend(hW.prototype,{toString:function(){return"Polygon"},toGeoJSON:function(){var jk="Polygon";var jl=[];var jn=this.getPath();if(this.hasMultipleParts){jk="Multi"+jk;for(var jj=0;jj<jn.length;jj++){var jm=[];for(var T=0;T<jn.length;T++){jm.push([jn[jj][T].lng,jn[jj][T].lat])}jl.push(jm)}}else{for(var jj=0;jj<jn.length;jj++){jl.push([jn[jj].lng,jn[jj].lat])}}var e={type:"Feature",geometry:{type:jk,coordinates:[jl]},properties:this.properties};return e},updateByGeoJSON:function(T){var e=new fZ();var jl=e.readFeaturesFromObject(T)||[];for(var jj=0,jk=jl.length;jj<jk;++jj){if(jl[jj] instanceof hW){this.properties=jl[jj].properties;this.setPath(jl[jj].getPath());break}}},setPath:function(jo,T){if(!jo||jo.length===0){return}var jn=[];if(typeof jo==="string"||jo[0] instanceof cg||jo[0] instanceof ca){var e=this._processSinglePointArray(jo);for(var jm=0;jm<e.innerPoints.length;jm++){jn[jm]=il.convertLL2MC(e.innerPoints[jm])}}else{for(var jm=0;jm<jo.length;jm++){var jj=this._processSinglePointArray(jo[jm]);var jl=[];for(var jk=0;jk<jj.innerPoints.length;jk++){jl[jk]=il.convertLL2MC(jj.innerPoints[jk])}jn.push(jl)}}if(T){return jn}this.setPathIn(jn);this._mouseEventPixels=null},getPath:function(){var e=this.getPathIn();if(!e||e.length===0){return[]}var jl=[];if(this.hasMultipleParts){for(var jj=0;jj<e.length;jj++){var jk=[];for(var T=0;T<e[jj].length;T++){jk[T]=il.convertMC2LL(e[jj][T])}jl.push(jk)}}else{for(var jj=0;jj<e.length;jj++){jl[jj]=il.convertMC2LL(e[jj])}}return jl}});function gn(i,e,T){this.point=i;this.radius=Math.abs(e);gG.call(this,[],T)}gn.parseTolerance={0:[0.01,0.0001,0.00001,0.000004],1:[1000,10,1,0.4]};gn.inherits(gG,"Circle");ey.extend(gn.prototype,{initialize:function(e){this.map=e;this.points=this._getPerimeterPoints(this.point,this.radius);this._calcBounds();return null},getPoint:function(){return this.point},setPoint:function(e){if(!e){return}this.point=e;this.latLng=il.convertMC2LL(e)},setCenterIn:function(e){var i=arguments[1];this.setPoint(e,i)},setRadius:function(e){this.radius=Math.abs(e)},getCenterIn:function(){return this.point},getRadius:function(){return this.radius},_getPerimeterPoints:function(e,jq){if(!e||!jq||!this.map){return[]}var T=this.map;var jn=e.lng;var jl=e.lat;var jw=il.convertMC2LL(e);jn=jw.lng;jl=jw.lat;var jx=[];var js=jq/il.EARTHRADIUS;var jp=(Math.PI/180)*jl;var jv=(Math.PI/180)*jn;for(var jo=0;jo<360;jo+=9){var jm=(Math.PI/180)*jo;var jt=Math.asin(Math.sin(jp)*Math.cos(js)+Math.cos(jp)*Math.sin(js)*Math.cos(jm));var jr=Math.atan2(Math.sin(jm)*Math.sin(js)*Math.cos(jp),Math.cos(js)-Math.sin(jp)*Math.sin(jt));var ju=((jv-jr+Math.PI)%(2*Math.PI))-Math.PI;var jk=new ca(jt*(180/Math.PI),ju*(180/Math.PI));jx.push(il.convertLL2MC(jk))}var jj=jx[0];jx.push(new cg(jj.lng,jj.lat));if(jj){this._radiusMercator=Math.sqrt(Math.pow(jj.lng-this.point.lng,2)+Math.pow(jj.lat-this.point.lat,2))}else{this._radiusMercator=this.radius}return jx}});function aL(i,e,jj){this.latLng=new ca(i.lat,i.lng);var T=il.convertLL2MC(i);gn.call(this,T,e,jj)}aL.inherits(gn,"CircleOut");ey.extend(aL.prototype,{toString:function(){return"Circle"},setCenter:function(e){this.latLng=new ca(e.lat,e.lng);var i=il.convertLL2MC(e);this.setCenterIn(i)},getCenter:function(){return this.latLng},getPath:function(){var e=this.getPathIn();if(!e||e.length===0){return[]}var jj=[];for(var T=0;T<e.length;T++){jj[T]=il.convertMC2LL(e[T])}return jj},toGeoJSON:function(){var jj="Polygon";var jk=[];var jl=this.getPath();for(var T=0;T<jl.length;T++){jk.push([jl[T].lng,jl[T].lat])}var e={type:"Feature",geometry:{type:jj,coordinates:[jk]},properties:this.properties};return e},updateByGeoJSON:function(e){}});function ja(jj,e,i){hQ.call(this,i);i=i||{};if(typeof i.topFillOpacity==="number"){this._config.topFillOpacity=i.topFillOpacity}else{this._config.topFillOpacity=0.6}if(typeof i.sideFillOpacity==="number"){this._config.sideFillOpacity=i.sideFillOpacity}else{this._config.sideFillOpacity=0.8}bX(this._config.sideFillOpacity,0,1);if(i.topFillColor===""){this._config.topFillColor=""}else{this._config.topFillColor=i.topFillColor?i.topFillColor:"#fff"}if(i.sideFillColor===""){this._config.sideFillColor=""}else{this._config.sideFillColor=i.sideFillColor?i.sideFillColor:"#fff"}this._parseFillCacheWebGL=[];this.setPoints(jj,i);this._config.altitude=e||0;var T=this;gs.load("poly",function(){T._draw()})}ja.inherits(hQ,"Prism");ey.extend(ja.prototype,{setPoints:function(jl){var jj=[];if(typeof jl==="string"||jl[0] instanceof cg||jl[0] instanceof ca||this instanceof gn||jl.length===0){var e=this._processSinglePointArray(jl);this._userPoints=e.userPoints;jj=e.innerPoints;this.hasMultipleParts=false}else{this._userPoints=[];for(var jk=0;jk<jl.length;jk++){var T=this._processSinglePointArray(jl[jk]);this._userPoints.push(T.userPoints);jj.push(T.innerPoints)}this.hasMultipleParts=true}hQ.prototype.setPoints.call(this,jj)},setPathIn:function(e){this.setPoints(e)},_processSinglePointArray:function(e){var i=hQ.getGraphPoints(e).slice(0);innerPoints=i.slice(0);if(innerPoints.length>1&&!innerPoints[0].equals(innerPoints[innerPoints.length-1])){innerPoints.push(new cg(innerPoints[0].lng,innerPoints[0].lat))}return{userPoints:i,innerPoints:innerPoints}},setPointAt:function(i,e){if(!this._userPoints[i]){return}this._clearCache();this._userPoints[i]=new cg(e.lng,e.lat);this.points[i]=new cg(e.lng,e.lat);if(i===0&&!this.points[0].equals(this.points[this.points.length-1])){this.points[this.points.length-1]=new cg(e.lng,e.lat)}this._calcBounds()},getPoints:function(){var e=this._userPoints;if(e.length===0){e=this.points}return e},getPathIn:function(){return this.getPoints()},setTopFillOpacity:function(e){if(e>1||e<0){return}this._config.topFillOpacity=e;this._setDomAttribute("topfillopacity",e)},getTopFillOpacity:function(){return this._config.topFillOpacity},setSideFillOpacity:function(e){if(e>1||e<0){return}this._config.sideFillOpacity=e;this._setDomAttribute("sidefillopacity",e)},getSideFillOpacity:function(){return this._config.sideFillOpacity},setTopFillColor:function(e){this._config.topFillColor=e||"";this._setDomAttribute("topfillcolor",e)},getTopFillColor:function(){return this._config.topFillColor},setSideFillColor:function(e){this._config.sideFillColor=e||"";this._setDomAttribute("sidefillcolor",e)},getSideFillColor:function(){return this._config.sideFillColor},setAltitude:function(e){this._config.altitude=Number(e);this.draw();var i=new ff("onlineupdate");i.overlay=this;this.dispatchEvent(i)},getAltitude:function(){return this._config.altitude}});function bj(jn,jl,jo){if(!jn||jn.length===0){return}this.userPath=jn;var e=[];if(typeof jn==="string"||jn[0] instanceof cg||jn[0] instanceof ca){var jp=this._processSinglePointArray(jn);for(var jk=0;jk<jp.innerPoints.length;jk++){e[jk]=il.convertLL2MC(jp.innerPoints[jk])}}else{for(var jk=0;jk<jn.length;jk++){var jm=this._processSinglePointArray(jn[jk]);var T=[];for(var jj=0;jj<jm.innerPoints.length;jj++){T[jj]=il.convertLL2MC(jm.innerPoints[jj])}e.push(T)}}ja.call(this,e,jl,jo)}bj.inherits(ja,"PrismOut");ey.extend(bj.prototype,{toString:function(){return"Prism"},setPath:function(jj){if(!jj||jj.length===0){return}this.userPath=jj;var T=[];for(var e=0;e<jj.length;e++){T[e]=il.convertLL2MC(jj[e])}this.setPathIn(T);this._mouseEventPixels=null},getPath:function(){return this.userPath;var e=this.getPathIn();if(!e||e.length===0){return[]}var jj=[];for(var T=0;T<e.length;T++){jj[T]=il.convertMC2LL(e[T])}return jj}});function bM(jk,i){hQ.call(this,i);i=i||{};this._config.type=i.type||"image";this._config.url=i.url||"";this._config.opacity=typeof i.opacity==="number"?i.opacity:1;this.isReDraw=i.isReDraw||false;this.drawHook=(i.drawHook instanceof Function)?i.drawHook:null;bX(this._config.opacity,0,1);if(i.type==="image"&&i.isPixelMap){this._config.isPixelMap=i.isPixelMap||false;var T=i.pixelMap||{};this._config.colors=T.colors||["#F9F871","#FFC75F","#FF9671","#FF6F91","#D65DB1","#845EC2"];this._config.positions=T.positions||[0,0.2,0.4,0.6,0.8,1];this._config.domain=T.domain||[0,255];this._config.clamp=T.clamp||this._config.domain;this._config.noData=(T.noData!==undefined)?T.noData:-99999;this._config.fomularC=T.fomularC||"float generateValue(vec4 pixel){return pixel.r * 255.;}";this._config.fomularJS=T.fomularJS||function(jl){return jl.r};this._config.maskPng=T.maskPng||null;this._config.maskData=T.maskData||-1;this._config.maskCoord=T.maskCoord||null;this.fHashcode=l({str:this._config.fomularC});var e=this.canPixelMap();if(e){this.isPixelMap=true;this.setPixelMap()}}this._parseFillCacheWebGL=[];this.setPoints(jk,i);var jj=this;gs.load("poly",function(){jj._draw()})}bM.inherits(hQ,"GroundOverlay");ey.extend(bM.prototype,{setPoints:function(i){var e=hQ.getGraphPoints(i).slice(0);this.hasMultipleParts=false;hQ.prototype.setPoints.call(this,e)},setPathIn:function(e){this.setPoints(e)},getPoints:function(){return this.points},getPathIn:function(){return this.getPoints()},canPixelMap:function(){if(this._config.colors&&this._config.positions){return true}return false},setPixelMap:function(){if(!this._config.isPixelMap||!this.canPixelMap()){return}var i=this._config.colors;var e=this._config.positions;this.pHashcode=l({colors:i,positions:e});this.pixelColorMap=gW.generateColorRamp(i,e)},setDomain:function(e){if(e instanceof Array&&e.length===2){this._config.domain=e;this.doOnceDraw()}},setClamp:function(e){if(e instanceof Array&&e.length===2){this._config.clamp=e;this.doOnceDraw()}},setMaskPng:function(i){this._config.maskPng=i;if(this.map){var e=new ff("hide");e.overlay=this;this.dispatchEvent(e);var e=new ff("show");e.overlay=this;this.dispatchEvent(e)}this.doOnceDraw()},setMaskData:function(e){this._config.maskData=e;this.doOnceDraw()},setMaskCoord:function(e){this._config.maskCoord=e;this.maskUV=null;this.doOnceDraw()},setNoData:function(e){this._config.noData=e;this.doOnceDraw()},setPositions:function(e){this._config.positions=e;this.setPixelMap();this.doOnceDraw()},setColors:function(e){this._config.colors=e;this.setPixelMap();this.doOnceDraw()},setFomular:function(e,i){if(e&&i){this._config.fomularJS=e;this._config.fomularC=i;this.fHashcode=l({str:this._config.fomularC});this.doOnceDraw()}},setIsPixelMap:function(e){this.isPixelMap=e;this.doOnceDraw()},getImagePixel:function(jj){if(!this._config.isPixelMap||!this.canPixelMap()){return null}if(!this.getImageMaskPixel(jj)){return null}if(this.imageObject){var T=Math.floor((jj.lng-this.points[3].lng)/this.lngMC);var e=Math.floor((-jj.lat+this.points[3].lat)/this.latMC);var i=Math.floor((e*this.imageObject.width+T)*4);if(T>this.imageObject.width||T<0){return null}if(e>this.imageObject.height||e<0){return null}if(i+3>this.imageObject.data.data.length){return null}return[this.imageObject.data.data[i],this.imageObject.data.data[i+1],this.imageObject.data.data[i+2],this.imageObject.data.data[i+3],]}return null},getValue:function(i){if(this._config.isPixelMap&&i&&this._config.fomularJS){if(!(i instanceof Array)){i=this.getImagePixel(i.point)}var e=this._config.fomularJS({r:i[0],g:i[1],b:i[2],a:i[3]});if(e>=this._config.clamp[0]&&e<=this._config.clamp[1]){return e}}return null},setImageObject:function(T){var e=document.createElement("canvas");e.width=T.width;e.height=T.height;var i=e.getContext("2d");i.drawImage(T,0,0,T.width,T.height);this.imageObject={width:T.width,height:T.height,data:i.getImageData(0,0,T.width,T.height)};this.updatePixelMc();i=null;e=null},updatePixelMc:function(){if(this.imageObject){var e=Math.abs(this.points[2].lng-this.points[0].lng);var i=Math.abs(this.points[2].lat-this.points[0].lat);this.lngMC=e/this.imageObject.width;this.latMC=i/this.imageObject.height}},setMaskImageObject:function(T){var e=document.createElement("canvas");e.width=T.width;e.height=T.height;var i=e.getContext("2d");i.drawImage(T,0,0,T.width,T.height);this.imageMaskObject={width:T.width,height:T.height,data:i.getImageData(0,0,T.width,T.height)};i=null;e=null},getImageMaskPixel:function(e){if(!this.imageMaskObject){return true}var jj=this._toOverlayPixelsGL([e]);var jo=this.maskOverlayPixels;var jl=jo[1][0]-jo[0][0];var jk=jo[1][1]-jo[0][1];var T=Math.floor((jj[0][0]-jo[0][0])/jl*this.imageMaskObject.width);var i=Math.floor((-jj[0][1]+jo[1][1])/jk*this.imageMaskObject.height);var jn=Math.floor((i*this.imageMaskObject.width+T)*4);if(T>this.imageMaskObject.width||T<0){return null}if(i>this.imageMaskObject.height||i<0){return null}var jm=this.imageMaskObject.data.data;if(jn+3>jm.length){return false}if(jm[jn+3]>0){if(this._config.maskData>-1&&this._config.maskData!==jm[jn]){return false}return true}return false},doOnceDraw:function(){var e=new ff("onlineupdate");e.overlay=this;this.dispatchEvent(e)}});function fv(jk,T){if(!jk){return}T=T||{};var jm=[new cg(jk.sw.lng,jk.ne.lat),new cg(jk.ne.lng,jk.ne.lat),new cg(jk.ne.lng,jk.sw.lat),new cg(jk.sw.lng,jk.sw.lat)];var e=hQ.getGraphPoints(jm).slice(0);var jl=[];for(var jj=0;jj<e.length;jj++){jl[jj]=il.convertLL2MC(e[jj])}bM.call(this,jl,T)}fv.inherits(bM,"GroundOverlayOut");ey.extend(fv.prototype,{toString:function(){return"GroundOverlay"}});var ao={};function hn(T,i){ey.BaseClass.call(this);this.content=T;this.map=null;this._config={width:0,height:0,maxWidth:600,offset:new id(0,0),title:"",maxContent:"",enableMaximize:false,enableAutoPan:true,enableCloseOnClick:true,margin:[10,10,40,10],collisions:[[10,10],[10,10],[10,10],[10,10]],ifMaxScene:false,onClosing:function(){return true}};this.setConfig(i);if(this._config.width<50){this._config.width=50}if(this._config.width>730){this._config.width=730}if(this._config.height!=0){if(this._config.height<50){this._config.height=50}if(this._config.height>650){this._config.height=650}}if(this._config.maxWidth!==0){if(this._config.maxWidth<50){this._config.maxWidth=50}if(this._config.maxWidth>730){this._config.maxWidth=730}}this.isWinMax=false;this.IMG_PATH=w.imgPath;this.overlay=null;var e=this;gs.load("simpleInfowindow",function(){e._draw()})}hn.inherits(ey.BaseClass,"SimpleInfoWindow");ey.extend(hn.prototype,{setWidth:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<50){e=50}if(e>730){e=730}}this._config.width=e},setHeight:function(e){e=e*1;e-=10;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<50){e=50}if(e>650){e=650}}this._config.height=e},setMaxWidth:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<50){e=50}if(e>730){e=730}}this._config.maxWidth=e},setTitle:function(e){this._config.title=e||""},setContent:function(e){this.content=e||""},setMaxContent:function(e){this._config.maxContent=e||""},redraw:function(){},enableAutoPan:function(){this._config.enableAutoPan=true},disableAutoPan:function(){this._config.enableAutoPan=false},enableCloseOnClick:function(){this._config.enableCloseOnClick=true},disableCloseOnClick:function(){this._config.enableCloseOnClick=false},enableMaximize:function(){this._config.enableMaximize=true},disableMaximize:function(){this._config.enableMaximize=false},show:function(){this._visible=true},hide:function(){this._visible=false},close:function(){this.hide()},dispose:function(){ey.BaseClass.prototype.decontrol.call(this)},maximize:function(){this.isWinMax=true},restore:function(){this.isWinMax=false},setConfig:function(i){if(!i){return}for(var e in i){if(typeof(this._config[e])==typeof(i[e])){this._config[e]=i[e]}}},isVisible:function(){return this.isOpen()},isOpen:function(){return false},getPoint:function(){if(this.overlay&&this.overlay.getPoint){return this.overlay.getPoint()}},getOffset:function(){return this._config.offset},dispose:function(){ey.BaseClass.prototype.decontrol.call(this)},toString:function(){return"SimpleInfoWindow"}});g5.prototype.openSimpleInfoWindow=function(jj,e){if(!jj||jj.toString()!="SimpleInfoWindow"||!e||e.toString()!="Point"){return}var i=this.temp;if(!i.marker){var T=new iD(w.imgPath+"blank.gif",{width:1,height:1});i.marker=new iZ(e,{icon:T,width:1,height:1,offset:new id(0,0),infoWindowOffset:new id(0,0),clickable:false});i.marker._fromMap=1}else{i.marker.setPoint(e)}this.addOverlay(i.marker);i.marker.show();i.marker.openSimpleInfoWindow(jj)};g5.prototype.closeSimpleInfoWindow=function(){var e=this.temp.infoWin||this.temp._infoWin;if(e&&e.overlay){e.overlay.closeSimpleInfoWindow()}};ec.prototype.openSimpleInfoWindow=function(e){if(this.map){this.map.closeSimpleInfoWindow();e._visible=true;this.map.temp._infoWin=e;e.overlay=this;ey.BaseClass.call(e,e.hashCode)}};ec.prototype.closeSimpleInfoWindow=function(){if(this.map&&this.map.temp._infoWin){this.map.temp._infoWin._visible=false;this.map.temp._infoWin.decontrol();this.map.temp._infoWin=null}};function b4(T,e){hQ.call(this,e);e=e||{};this._config.showRegion=e.showRegion||"inside";this._config.isBuildingMask=e.isBuildingMask&&true;this._config.isPoiMask=e.isPoiMask&&true;this._config.isMapMask=e.isMapMask&&true;this._config.path=T;this._parseFillCacheWebGL=[];this.setPoints(T,e);var i=this;gs.load("poly",function(){i._draw()})}b4.inherits(hQ,"MapMask");ey.extend(b4.prototype,{setPoints:function(i){var e=hQ.getGraphPoints(i).slice(0);this.hasMultipleParts=false;hQ.prototype.setPoints.call(this,e)},setPathIn:function(e){this.setPoints(e)},_processSinglePointArray:function(e){var i=hQ.getGraphPoints(e).slice(0);innerPoints=i.slice(0);if(innerPoints.length>1&&!innerPoints[0].equals(innerPoints[innerPoints.length-1])){innerPoints.push(new cg(innerPoints[0].lng,innerPoints[0].lat))}return{userPoints:i,innerPoints:innerPoints}},getPoints:function(){var e=this._userPoints;if(e.length===0){e=this.points}return e},getPathIn:function(){return this.getPoints()}});function i7(jl,T){if(!jl||jl.length===0){return}var jk=[];if(jl[0] instanceof cg){var e=this._processSinglePointArray(jl);for(var jj=0;jj<e.innerPoints.length;jj++){jk[jj]=il.convertLL2MC(e.innerPoints[jj])}}b4.call(this,jk,T)}i7.inherits(b4,"MapMaskOut");ey.extend(i7.prototype,{toString:function(){return"MapMask"}});function eS(e,i){e=isNaN(e)?0:e;i=isNaN(i)?0:i;this.x=e;this.y=i}eS.prototype.equals=function(e){if(!e){return false}return e.x===this.x&&e.y===this.y};eS.prototype.clone=function(){return new eS(this.x,this.y)};eS.prototype.toString=function(){return"Pixel"};function id(i,e){if(typeof i!=="number"){this.width=parseFloat(i)}else{this.width=i}if(typeof e!=="number"){this.height=parseFloat(e)}else{this.height=e}}id.prototype.equals=function(e){return !!(e&&this.width===e.width&&this.height===e.height)};id.prototype.toString=function(){return"Size"};var jc={B_NORMAL_MAP:{tileUrls:dc(w.tileDomain,w.rasterTilePath),vectorTileUrls:dc(w.tileDomain,w.vectorTilePath),tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,webgl:{minZoom:3,maxZoom:25},zoomLevelBase:18,errorUrl:w.imgPath+"bg.png",bounds:new hk(new cg(-21364736,-11708041.66),new cg(23855104,12474104.17)),imgExtend:"png"},B_SATELLITE_MAP:{tileUrls:["//maponline0.bdimg.com/starpic/?qt=satepc&","//maponline1.bdimg.com/starpic/?qt=satepc&","//maponline2.bdimg.com/starpic/?qt=satepc&","//maponline3.bdimg.com/starpic/?qt=satepc&"],tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:w.imgPath+"bg.png",bounds:new hk(new cg(-21364736,-10616832),new cg(23855104,15859712)),imgExtend:"png"},B_STREET_MAP:{tileUrls:dc(w.tileDomain,w.rasterTilePath),tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:w.imgPath+"bg.png",bounds:new hk(new cg(-21364736,-10616832),new cg(23855104,15859712)),imgExtend:"png"},BMAP_CUSTOM_LAYER:{tileUrls:[""],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:w.imgPath+"blank.gif",bounds:new hk(new cg(-21364736,-10616832),new cg(23855104,15859712)),imgExtend:"png"},B_EARTH_MAP:{tileUrls:[""],tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,webgl:{minZoom:3,maxZoom:21},zoomLevelBase:18,errorUrl:w.imgPath+"blank.gif",bounds:new hk(new cg(-21364736,-10616832),new cg(23855104,15859712)),imgExtend:"png"},B_NONE_MAP:{tileUrls:"",tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:w.imgPath+"bg.png",bounds:new hk(new cg(-21364736,-11708041.66),new cg(23855104,12474104.17)),imgExtend:"png"}};var dU=jc;function cs(jm,jn,T,e,jl){if(jl&&dU[jl]){this.mapTypeName=jl}else{this.mapTypeName=BMAP_NORMAL_MAP}if(jm&&jm instanceof Array){var jk=true;for(var jj=0;jj<jm.length;jj++){if(jm[jj] instanceof hk){continue}else{jk=false;break}}jk&&(this.bounds=jm)}if(typeof jn==="number"&&jn>=dU[this.mapTypeName].webgl.minZoom){if(dU[this.mapTypeName].webgl){if(jn>=dU[this.mapTypeName].webgl.minZoom){this.minZoom=jn}else{this.minZoom=dU[this.mapTypeName].webgl.minZoom}}else{if(jn>=dU[this.mapTypeName].minZoom){this.minZoom=jn}else{this.minZoom=dU[this.mapTypeName].minZoom}}}if(typeof T==="number"){if(dU[this.mapTypeName].webgl){if(T<=dU[this.mapTypeName].webgl.maxZoom){this.maxZoom=T}else{this.maxZoom=dU[this.mapTypeName].webgl.maxZoom}}else{if(T<=dU[this.mapTypeName].maxZoom){this.maxZoom=T}else{this.maxZoom=dU[this.mapTypeName].maxZoom}}}if(this.maxZoom<this.minZoom){this.maxZoom=null}if(e&&typeof e==="function"){this.tileUrlFunction=e}}ey.extend(cs.prototype,{addBoundary:function(e){if(e instanceof hk){if(this.bounds){this.bounds.push(e)}else{this.bounds=[e]}}},setTileUrlFunction:function(e){if(e&&typeof e==="function"){this.tileUrlFunction=e}},crossPoint:function(e,jj,jk){if(jk<this.minZoom||jk>this.maxZoom){return false}var jl=this.containsPoint(e,jk);if(jl){return jl}for(var T=0;T<this.bounds.length;T++){if(this.bounds[T].intersects(jj)){jl=true;break}}return jl},containsPoint:function(e,jj){if(!e||!(e instanceof cg)||!this.isValid()){return false}var jk=false;if(jj<this.minZoom||jj>this.maxZoom){return jk}for(var T=0;T<this.bounds.length;T++){if(this.bounds[T].containsPoint(e)){jk=true;break}}return jk},isValid:function(){return this.bounds&&this.minZoom&&this.maxZoom&&this.tileUrlFunction},toString:function(){return"PrivateRegionDataModel"}});function g4(jo,i,jk,T,jj){this.mgr=jo;this.position=jk;this._cbks=[];this.name=jo.getTileName(T,jj,jo.map.config.style);this.info=T;this._transparentPng=jj.isTransparentPng();var jp=bL("img");hm(jp);jp.galleryImg=false;var jn=jp.style;jn.position="absolute";jn.width=jo.tileSize+"px";jn.height=jo.tileSize+"px";jn.left=jk[0]+"px";jn.top=jk[1]+"px";this.img=jp;this.src=i;if(ed&&jk._offsetX===0){jn.opacity=0;jn.willChange="opacity"}var jm=this;this.img.onload=function(jx){if(!jm.mgr){return}var js=jm.mgr;var jq=js.bufferTiles;if(js.bufferNumber>0){jq[jm.name]=jm;jq.push(jm.name)}var ju=jq.length-js.bufferNumber;for(var jv=0;ju>0&&jv<jq.length;jv++){var jw=jq[jv];if(!js.mapTiles[jw]){if(jq[jw]){jq[jw].mgr=null;var jt=jq[jw].img;if(jt.parentNode){hE(jt);jt.parentNode.removeChild(jt)}jt=null;jq[jw].img=null;jq[jw]=null;delete jq[jw]}jq.splice(jv,1);jv--;ju--}}jm.loaded=true;js.imgNumber++;if(!aJ(jm.img)){if(jj.tilesDiv){jj.tilesDiv.appendChild(jm.img)}}var jx=new ff("onimagechange");jx.action="show";jx.tile=jm.name;js.map.dispatchEvent(jx);if(ed&&jk._offsetX===0){var jr=new e8({fps:10,duration:300,render:function(e){if(jm.img&&jm.img.style){jm.img.style.opacity=e*1}},finish:function(){if(jm.img&&jm.img.style){delete jm.img.style.opacity;jm.img.style.willChange="auto"}}})}jm._callCbks()};this.img.onerror=function(js){jm.error=true;jm._callCbks();if(!jm.mgr){return}var jq=jm.mgr;var jr=dU[jj.mapType];if(jr.errorUrl){jm.img.src=jr.errorUrl}if(!aJ(jm.img)){if(jj.tilesDiv){jj.tilesDiv.appendChild(jm.img)}}};jp=null;var jl=new ff("onimagebefore");jl.tile=jm.name;jo.map.dispatchEvent(jl)}g4.prototype._addLoadCbk=function(e){this._cbks.push(e)};g4.prototype._load=function(){if(FeBrowser.ie<=6&&FeBrowser.ie>0&&this._transparentPng){this.img.src=w.imgPath+"blank.gif"}else{this.img.src=this.src}};g4.prototype._callCbks=function(){var T=this;for(var e=0;e<T._cbks.length;e++){T._cbks[e]()}T._cbks.length=0};var ed=(!ey.Browser.ie||ey.Browser.ie>8);function iv(e){this.tileLayers=[];this.map=e;this.bufferNumber=300;this.mapTiles=[];this.bufferTiles=[];this.config=dU[this.map.mapType];this.errorUrl=this.config.errorUrl;this.tileSize=this.config.tileSize;this.baseUnits=this.config.baseUnits;this.baseZoomLevel=this.config.zoomLevelBase;this.tileURLs=this.config.tileUrls;this.imgNumber=0;this.numLoading=0;this.temp={}}bp.register(function(i){if(i._renderType==="webgl"){return}var e=i.tileMgr=new iv(i);i.addEventListener("mousewheel",function(T){e.mouseWheel(T)});i.addEventListener("dblclick",function(T){e.dblClick(T)});i.addEventListener("rightdblclick",function(T){e.dblClick(T)});i.addEventListener("minuspress",function(T){e.keypress(T)});i.addEventListener("pluspress",function(T){e.keypress(T)});i.addEventListener("load",function(T){if(this.mapType===BMAP_EARTH_MAP){return}e.loadTiles()});i.addEventListener("zoomstartcode",function(T){if(this.mapType===BMAP_EARTH_MAP){return}e._zoom(T)});i.addEventListener("moving",function(T){if(this.mapType===BMAP_EARTH_MAP){return}e.moveGridTiles()});i.addEventListener("resize",function(T){if(this.mapType===BMAP_EARTH_MAP){return}e.resizeMap(T)});i.addEventListener("addtilelayer",function(T){e.addTileLayer(T)});i.addEventListener("removetilelayer",function(T){e.removeTileLayer(T)})});ey.extend(iv.prototype,{addTileLayer:function(jj){var T=this;var i=jj.target;T.tileLayers.push(i);if(T.map.loaded){T.moveGridTiles()}},removeTileLayer:function(jq){var jr=this;var jo=jq.target;var jm=jo.mapType;var jl=jr.mapTiles;var jt=jr.bufferTiles;for(var T in jt){var jj=T.split("-")[1];if(jj==jm){delete jt[T]}}for(var T in jl){var jj=T.split("-")[1];if(jj==jm){delete jl[T]}}if(jr.zoomsDiv&&jr.zoomsDiv.parentNode){jr.zoomsDiv.parentNode.removeChild(jr.zoomsDiv);jr.zoomsDiv.innerHTML=""}var jk=jr.map;if(jk.deepZoom){var js=jk.deepZoom.preDeepZoomDiv;if(js&&js.parentNode){js.parentNode.removeChild(js)}}for(var jp=0,jn=jr.tileLayers.length;jp<jn;jp++){if(jo==jr.tileLayers[jp]){jr.tileLayers.splice(jp,1)}}jr.moveGridTiles()},hideDeepZoomDiv:function(){var i=this,T=i.map;if(T.deepZoom){var e=T.deepZoom.preDeepZoomDiv;if(e&&e.style.display!="none"){e.style.display="none"}}},getTileLayer:function(jk){var jj=this;for(var T=0,e=jj.tileLayers.length;T<e;T++){tilelayer=jj.tileLayers[T];if(tilelayer.mapType==jk){return tilelayer}}return null},_zoom:function(T){var i=this;if(i.zoomsDiv&&i.zoomsDiv.style.display!="none"){i.zoomsDiv.style.display="none"}i.hideDeepZoomDiv();i.moveGridTiles()},resizeMap:function(i){this.loaded=false;this.moveGridTiles()},_checkTilesLoaded:function(){this.numLoading--;var e=this;if(this.numLoading==0){if(this._checkLoadedTimer){clearTimeout(this._checkLoadedTimer);this._checkLoadedTimer=null}this._checkLoadedTimer=setTimeout(function(){if(e.numLoading==0){e.map.dispatchEvent(new ff("ontilesloaded"))}e._checkLoadedTimer=null},80)}},getTileName:function(e,T,i){var jk=T.mapType;var jj="TILE-"+jk+"-"+i+"-"+e[0]+"-"+e[1]+"-"+e[2];return jj},hideTile:function(jj,T){var i=jj.img;if(aJ(i)){if(jj.loaded){this.imgNumber--}if(i.parentNode){hE(i);i.parentNode.removeChild(i)}}var jk=new ff("onimagechange");jk.tile=this.getTileName(jj.info,T,this.map.config.style);jk.action="hide";delete this.mapTiles[jj.name];if(!jj.loaded){hE(i);jj._callCbks();i=null;jj.img=null;jj.mgr=null}this.map.dispatchEvent(jk)},loadTiles:function(){var i=this;if(ey.Browser.ie){try{document.execCommand("BackgroundImageCache",false,true)}catch(T){}}if(this.zoomsDiv&&this.zoomsDiv.style.display!="none"){this.zoomsDiv.style.display="none"}i.hideDeepZoomDiv();i.moveGridTiles()},getCell:function(jk,jj){var e=this.baseUnits*Math.pow(2,(this.baseZoomLevel-jj));var T=parseInt(jk.lng/e);var i=parseInt(jk.lat/e);return[T,i,e*(T+0.5),e*(i+0.5)]},moveGridTiles:function(){var jx=this.map,jG=jx.getMapType(),jE=this.tileLayers.length;var jC=jx.centerPoint;if(jG!==BMAP_SATELLITE_MAP){jC=eB.calcLoopCenterPoint(jC)}var jo=jx.width;var jS=jx.getZoomUnits();var jD=jS*jo;var jI=jC.lng-jD/2;var jt=jC.lng+jD/2;var jw=eB.isAddWidth(jI,jt);for(var jK=0;jK<jE;jK++){var jk=this.tileLayers[jK];if(jk.baseLayer||jE==1){this.tilesDiv=jk.tilesDiv}var jy=dU[jk.mapType];var jj=jx.zoomLevel;var jN=jx.getZoomUnits(jx.zoomLevel);var js=jy.baseUnits*Math.pow(2,(jy.zoomLevelBase-jj));var jq=Math.floor(jC.lng/js);var jJ=Math.floor(jC.lat/js);var jv=jy.tileSize;var jz=[jq,jJ,(jC.lng-jq*js)/js*jv,(jC.lat-jJ*js)/js*jv];var jr=jw?jx.width/2*1.5:jx.width/2;var ju=jz[0]-Math.ceil((jr-jz[2])/jv);var jR=jz[1]-Math.ceil((jx.height/2-jz[3])/jv);var jL=jz[0]+Math.ceil((jr+jz[2])/jv);var jA=jz[1]+Math.ceil((jx.height/2+jz[3])/jv);var jp=[];for(var jP=ju;jP<jL;jP++){for(var jO=jR;jO<jA;jO++){jp.push([jP,jO]);var jF="id_"+jP+"_"+jO+"_"+jj;jp[jF]=true}}if(jk.mapType!==BMAP_SATELLITE_MAP){jp=eB.calcLoopTiles(jp,jj)}jp.sort((function(i){return function(jU,jV){return((0.4*Math.abs(jU[0]-i[0])+0.6*Math.abs(jU[1]-i[1]))-(0.4*Math.abs(jV[0]-i[0])+0.6*Math.abs(jV[1]-i[1])))}})([jz[0],jz[1]]));var T=this.mapTiles;var e=-jC.lng/jN;var jT=jC.lat/jN;var jH=[e,jT];for(var jB in T){var jm=T[jB];var jQ=jm.info;if(!jQ){continue}var jF="id_"+jQ[0]+"_"+jQ[1]+"_"+jQ[2];if(!jp[jF]){this.hideTile(jm,jk)}}var jl=-jx.offsetX+jx.width/2;var jn=-jx.offsetY+jx.height/2;jk.tilesDiv.style.left=Math.round(e+jl)-jH[0]+"px";jk.tilesDiv.style.top=Math.round(jT+jn)-jH[1]+"px";this.numLoading+=jp.length;for(var jP=0,jM=jp.length;jP<jM;jP++){this.showTile([jp[jP][0],jp[jP][1],jx.zoomLevel],jH,jk,jP,jx.config.style)}}},showTile:function(jm,jl,jp,ju){this.centerPos=jl;var jn=dU[jp.mapType];var jq=this.map.config.style;var jj=this.getTileName(jm,jp,jq);var jk=(jm[0]*jn.tileSize)+jl[0];var T=(-1-jm[1])*jn.tileSize+jl[1];var jt=[jk,T];var jo=null;if(jp.mapType!==BMAP_SATELLITE_MAP){jo=eB.calcLoopParam(jm[0],jm[2]);var js=jo.offsetX;jt[0]+=js;jt._offsetX=js}var jx=this;var jw=this.mapTiles[jj];if(jw){jw.img.style.left=jt[0]+"px";jw.img.style.top=jt[1]+"px";if(jw.loaded){this._checkTilesLoaded()}else{jw._addLoadCbk(function(){jx._checkTilesLoaded()})}return}jw=this.bufferTiles[jj];if(jw){this.imgNumber++;jp.tilesDiv.insertBefore(jw.img,jp.tilesDiv.lastChild);this.mapTiles[jj]=jw;jw.img.style.left=jt[0]+"px";jw.img.style.top=jt[1]+"px";if(jw.loaded){this._checkTilesLoaded()}else{jw._addLoadCbk(function(){jx._checkTilesLoaded()})}var jv=new ff("onimagechange");jv.action="cache";jv.tile=this.getTileName(jm,jp,jq);this.map.dispatchEvent(jv)}else{var jr=new eS(jm[0],jm[1]);if(jo){jr.x=jo.col}var i=jp.getTilesUrl(jr,jm[2]);jw=new g4(this,i,jt,jm,jp);jw._addLoadCbk(function(){jx._checkTilesLoaded()});jw._load();this.mapTiles[jj]=jw;gF(this.map)}},mouseWheel:function(jn){var jm=this.map;if(!jm.config.enableWheelZoom){return}var jo=jm.zoomLevel+(jn.trend===true?1:-1);var jk=jm._getProperZoom(jo);if(jk.exceeded){var T=new ff("onzoomexceeded");T.targetZoom=jo;jm.dispatchEvent(T);return}jm.dispatchEvent(new ff("onzoomstart"));jm.lastLevel=jm.zoomLevel;jm.zoomLevel=jk.zoom;var i=jn.pixel;var jj=jm.pixelToPointIn(i,{zoom:jm.lastLevel});var jl=jm.getZoomUnits(jm.zoomLevel);jm.centerPoint=new cg(jj.lng+jl*(jm.width/2-i.x),jj.lat-jl*(jm.height/2-i.y));this.zoom(i)},dblClick:function(T){var i=this.map;if(!i.config.enableDblclickZoom){return}if(i.mapType==="B_EARTH_MAP"){return}if(i.currentOperation===dO.dragging){return}if(T.type=="onrightdblclick"){i.zoomOut(T.point)}else{i.zoomIn(T.point)}},keypress:function(T){var i=this.map;if(i.getMapType()===BMAP_EARTH_MAP){return}T.type=="onpluspress"?i.zoomIn():i.zoomOut()}});function gS(jj){this.opts=jj||{};this.copyright=this.opts.copyright||{};this.transparentPng=this.opts.transparentPng||false;this.png8=this.opts.png8||false;this.baseLayer=this.opts.baseLayer||false;this.dataType=this.opts.dataType||1;this.transform=this.opts.transform||0;this.spanLevel=this.opts.spanLevel||0;this.isFlat=!this.opts.isFlat?false:true;this.showLabel=this.opts.showLabel===false?false:true;var e=this.opts.tileTypeName||"web";this.tileType=hl.getInstance(e);this.clipTile=this.opts.clipTile||false;this._type="tilelayer";var i=bK()?128:256;this.cacheSize=this.opts.cacheSize||i;var T=this;this.tileCache=new at(this.cacheSize,{clearCallback:function(jk){if(jk.label){if(jk.label.textImageBitmap){jk.label.textImageBitmap.close()}if(jk.label.indoorTextImageBitmap){jk.label.indoorTextImageBitmap.close()}}T._removeIndoorData(jk)}});this.scaler=fI()>=1.5?2:1;this.normalUdt=iY("ditu","normal").udt;this.numLoading=0;this.useThumbData=false;this.useThumbData=this.opts.useThumbData||false;if(this.baseLayer){this.useThumbData=true}if(typeof this.opts.customLayer==="boolean"){this.customLayer=this.opts.customLayer}else{this.customLayer=true}}gS.inherits(cN,"TileLayer");ey.extend(gS.prototype,{isTransparentPng:function(){return this.transparentPng},getTilesUrl:function(jq,e){var T=dU[this.mapType];if(typeof T!=="object"){return null}var jj=jq.x;var jr=jq.y;if(this.mapType!==BMAP_SATELLITE_MAP){var jr=eB.calcLoopParam(jr,e).col}var i="";if(this.opts.tileUrlTemplate){i=this.opts.tileUrlTemplate;i=i.replace(/\{X\}/,jr);i=i.replace(/\{Y\}/,jj);i=i.replace(/\{Z\}/,e)}else{if(this.mapType===BMAPGL_NORMAL_MAP){var jp=this.isCanvasMap?0:1;var jl=T.tileUrls[Math.abs(jr+jj)%T.tileUrls.length];if(window.offLineIPAddress){jl=window.offLineIPAddress+"tile5/"}var jk=this.map.config.style;i=jl+"?qt=vtile&x="+jj+"&y="+jr+"&z="+e+(jk==="default"?"":("&styleId=1"))+"&styles=pl&udt="+this.normalUdt+"&scaler="+this.scaler+"&showtext="+jp;i=i.replace(/-(\d+)/gi,"M$1")}if(this.mapType===BMAP_SATELLITE_MAP){var jm=iY("ditu","satellite");var jo=jm.ver;var jn=jm.udt;i=T.tileUrls[Math.abs(jr+jj)%T.tileUrls.length]+"u=x="+jj+";y="+jr+";z="+e+";v="+jo+";type=sate&fm=46&udt="+jn;i=i.replace(/-(\d+)/gi,"M$1")}}return i},initialize:function(jl){this.map=jl;if(jl._renderType==="webgl"){var jk=null;if(this.customLayer!==false){jk=this.getTilesUrl}ey.extend(this,eN);this.labelProcessor=new io(this);this.callbackDataQueue=[];if(jk){this.getTilesUrl=jk}var i=this;jl.on("indoor_data_refresh",function(jm){if(!i.baseLayer){return}i._refreshIndoorData(jm.uid,jm.floor)});jl.on("custom_labels_ready",function(jm){if(!i.baseLayer){return}i._doWorkAfterLabelImageLoad(jm.virtualTile,jm.labelCanvas,null,jm.imgKey)});jl.on("glmoduleloaded",function(){if(!i.baseLayer){return}i.updateAllIconsTextureCoords()});jl.on("layer_update",function(jn){if(jn.name===i.tileType.getName()&&jl.customLoaded){i.tileCache.clear();jl._featureMgr.clearData(i.drawIndex);jl._featureMgr.setLabelData([]);jl._featureMgr.clearLabelOverlayData();i.labelProcessor.iconCache.clear();var jm=new ff("onlayer_clear");jl.fire(jm)}});if(this.ontology&&this.ontology._initEvent){this.ontology._initEvent(jl)}}if(!jl.temp.layerZIndex){jl.temp.layerZIndex=0}this.zIndex=this.zIndex||0;if(this.baseLayer){this.zIndex=0}this.adjustZIndex();if(!jl.temp.layid){jl.temp.layid=0}if(!this.opts.mapType){this.mapType="BMAP_CUSTOM_LAYER_"+jl.temp.layid;jl.temp.layid++}else{this.mapType=this.opts.mapType}var T=dU[this.mapType];if(!T){dU[this.mapType]={tileUrls:[],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:19,minZoom:3,maxZoom:19,minDataZoom:3,maxDataZoom:19,zoomLevelBase:18,errorUrl:w.imgPath+"/blank.gif",bounds:new hk(new cg(-21364736,-10616832),new cg(23855104,15859712)),imgExtend:"png"}}if(jl._renderType!=="webgl"){var jj=bB(jl.platform,'<div style="position:absolute;z-index:'+this.zIndex+'"></div>');jj.style.display="";jj.style.left=Math.ceil(-jl.offsetX+jl.width/2)+"px";jj.style.top=Math.ceil(-jl.offsetY+jl.height/2)+"px";this.tilesDiv=jj}this.isCanvasMap=jl.isCanvasMap();this.lastZoom=jl.getZoom();var e=this;this.addEventListener("initDrawData",function(jm){if(e.opts.boundary){e.addBoundary(e.opts.boundary)}})},remove:function(){if(this.tilesDiv&&this.tilesDiv.parentNode){this.tilesDiv.innerHTML="";this.tilesDiv.parentNode.removeChild(this.tilesDiv)}delete this.tilesDiv},getCopyright:function(){return this.copyright},getMapType:function(){return this.mapType},adjustZIndex:function(){if(this.map&&this.map._featureMgr){var e=this.map._featureMgr.result.bkData;while(e[this.zIndex]){this.zIndex+=1}}},setZIndex:function(e){this.setTargetZIndex(e)},setTargetZIndex:function(e){this.zIndex=e;this.drawIndex=e;if(this.tilesDiv){this.tilesDiv.style.zIndex=e}},calcLoopParam:function(e,i){return eB.calcLoopParam(e,i)},addBoundary:function(jl){if(!jl||!this.map){return}if(typeof jl==="string"){jl=[jl]}for(var jj=0;jj<jl.length;jj++){var T=new BMapGL.Polygon(jl[jj]);if(T&&bH(T._i)){var jk=new ff("onbeforeaddoverlay",T);jk.overlay=T;jk.isLayerMask=true;this.map.dispatchEvent(jk);T._i(this.map);if(this.boundary){this.boundary.push(T)}else{this.boundary=[T]}}}this.updateBoundary()},clearBoundary:function(){this.boundary=false;this.updateBoundary()},updateBoundary:function(){if(this.boundary===undefined||!this.map){return}var i=this.map._featureMgr.result.bkData;if(i[this.zIndex]){i[this.zIndex].boundary=this.boundary;this.map.dispatchEvent(new ff("onrefresh"));if(this.boundary===false){var T=new ff("onremoveLayerMask");T.hasLayerBoundary=this.map._featureMgr.hasLayerBoundary();this.map.dispatchEvent(T)}}}});function h(i,e,T){this.bounds=i;this.content=e;this.mapType=T}h.inherits(cN,"Copyright");var dZ={get:function(e){if(!dZ.singleton){dZ.singleton=new fz(e)}return dZ.singleton}};function fz(i){this._map=i;this._tileMgr=i.tileMgr;this._animationDiv=null;this._preAnimationDiv=null;this._animation=null;this._baseLayerDiv=null;this._transformStyleName=cL.ifSupportCSS3("transform",true);this._transformOriginStyleName=cL.ifSupportCSS3("transformOrigin",true);this._preZoomTimes=1;this._preRenderTick=1;this._enableCanvas2dMap=!!(i.getRenderType()==="canvas");this._isIE9=!!(ey.Browser.ie===9);var e=this;i.addEventListener("maptypechange",function(){e.hide()});i.addEventListener("load",function(){e.hide()})}ey.extend(fz.prototype,{prepareLayer:function(){var jj=this._map;var e=this._tileMgr;this._canvas2dMapMgr=jj.canvas2dMapMgr;var T=this._baseLayerDiv=e.tilesDiv;if(!this._animationDiv){var i=this._preAnimationDiv;if(i){i.parentNode&&i.parentNode.removeChild(i);this._preAnimationDiv=null}this._preAnimationDiv=this._animationDiv=T.cloneNode(true);jj.platform.insertBefore(this._animationDiv,jj.platform.firstChild)}this.show()},prepareAniParam:function(){var jj=this._animationDiv;if(!jj){return}var e=jj.children.length;var T;this._zoomAniInfo=[];for(var jk=e-1;jk>-1;jk--){var jl={};T=jj.children[jk].style;jl.top=parseInt(T.top,10);jl.left=parseInt(T.left,10);this._zoomAniInfo[jk]=jl}},prepareLabelLayer:function(){var jk=this._map;if(this._enableCanvas2dMap&&jk.canvas2dMapMgr){if(this.touchZoomLabelCanvas){this.touchZoomLabelCanvas.parentNode.removeChild(this.touchZoomLabelCanvas)}var i=jk.canvas2dMapMgr._labelCanvas;this.touchZoomLabelCanvas=i.cloneNode(false);var e=this.touchZoomLabelCanvas.getContext("2d");e.drawImage(i,0,0);jk.platform.insertBefore(this.touchZoomLabelCanvas,jk.platform.firstChild);var jj=parseInt(i.style.left,10);var T=parseInt(i.style.top,10);this.touchZoomLabelCanvas.style.zIndex=9;this.touchZoomLabelCanvas.style[this._transformOriginStyleName]=(this._fixPosition.x-(jk.offsetX+jj))+"px "+(this._fixPosition.y-(jk.offsetY+T))+"px";i.style.visibility="hidden"}},show:function(){if(this._animationDiv){this._animationDiv.style.visibility=""}},showLabel:function(){var i=this._map;if(this._enableCanvas2dMap&&i.canvas2dMapMgr){var e=i.canvas2dMapMgr._labelCanvas;if(e){e.style.visibility=""}if(this.touchZoomLabelCanvas){this.touchZoomLabelCanvas.style.zIndex=-2;this.touchZoomLabelCanvas.style.visibility="hidden"}}},hide:function(){if(this._animationDiv){this._animationDiv.style.visibility="hidden"}if(this._preAnimationDiv){this._preAnimationDiv.style.visibility="hidden"}},hideNonAnimationLayers:function(){var jj=this._map;if(jj.getRenderType()==="dom"){if(jj.overlayDiv){jj.overlayDiv.style.visibility="hidden"}if(jj.overlayDivEx){jj.overlayDivEx.style.visibility="hidden"}}var jl=jj.tileMgr.tileLayers;var jk;for(var T=0,e=jl.length;T<e;T++){jk=jl[T];jk.tilesDiv.style.visibility="hidden"}},showNonAnimationLayers:function(){var jj=this._map;if(jj.getRenderType()==="dom"){if(jj.overlayDiv){jj.overlayDiv.style.visibility=""}if(jj.overlayDivEx){jj.overlayDivEx.style.visibility=""}}var jl=jj.tileMgr.tileLayers;var jk;for(var T=0,e=jl.length;T<e;T++){jk=jl[T];jk.tilesDiv.style.visibility=""}},setFixPosition:function(e){this._fixPosition=e},setZoom:function(e,jp){var jm=this._fixPosition;var jv=this._map;var jw=this._baseLayerDiv;var jn={x:jm.x-parseInt(jw.style.left,10)-jv.offsetX,y:jm.y-parseInt(jw.style.top,10)-jv.offsetY};var jj=this._animationDiv;if(!jj){return}var jt=jj.children.length;var jr;var ju=this._transformStyleName;var jl=this._transformOriginStyleName;var jx=this;var jz;var jo;for(var js=jt-1;js>-1;js--){var jq=this._zoomAniInfo[js];jr=jj.children[js].style;var jk=jq.left-jn.x;var T=jq.top-jn.y;jq.dx=jk*e-jk;jq.dy=T*e-T;jq.preDx=jk-jk;jq.preDy=T-T;jz=jq.preDx+(jq.dx-jq.preDx);jo=jq.preDy+(jq.dy-jq.preDy)+jp;jr.left=jq.left+jz+"px";jr.top=jq.top+jo+"px";jr.width=jr.height=256*e+"px"}if(this._enableCanvas2dMap){var jy=!jx._isIE9?"translate3d(0px, "+jp+"px, 0) scale("+e+")":"translate(0px, "+jp+"px) scale("+e+")";this.touchZoomLabelCanvas.style[ju]=jy}},setZoomFinish:function(){this._animationDiv=null},startAnimation:function(jm){this.prepareLayer();this.hideNonAnimationLayers();var jF=this._map;if(this.touchZoomLabelCanvas){this.touchZoomLabelCanvas.style.display="none"}jm=jm||{};var jD=jm.zoomCount||0;var jr=jm.fixPosition;var jB=jm.fixMCPosition;var jp=jm.pixOffset;this._zoomCount=jD;var jj=jF.getZoom();var jE=jj+jD;var e=jF.config.enableContinuousZoom;var jv=0.5;var jq=5;var T=Math.pow(2,jD);var jH=this._baseLayerDiv;var js={x:jr.x-parseInt(jH.style.left,10)-jF.offsetX,y:jr.y-parseInt(jH.style.top,10)-jF.offsetY};var jn=this._animationDiv;var jz=jn.children.length;var jJ=this._preZoomTimes;var jC=[];var jA=this._transformStyleName;var jo=this._transformOriginStyleName;for(var jy=jz-1;jy>-1;jy--){var jw={};var jx=jn.children[jy].style;jw.top=parseInt(jx.top,10);jw.left=parseInt(jx.left,10);var jl=jw.left-js.x;var jk=jw.top-js.y;jw.dx=jl*T-jl;jw.dy=jk*T-jk;jw.preDx=jl*jJ-jl;jw.preDy=jk*jJ-jk;jC[jy]=jw}var jG=this;var ju;var jI;var jt;this._zoomAni=new e8({fps:60,duration:e?500:1,transition:function(i){i=i*jq/(2*jv);return jq*i-jv*i*i},render:function(jS){jS=jS*(4*jv)/(jq*jq);ju=jJ+jS*(T-jJ);var jL=jj+m(ju);var jQ=null;var jP=0;var jT=0;if(jm.onAnimationBeforeLooping){var jU=jm.onAnimationBeforeLooping(jS,jL);jQ=jU.loopingCenter;jP=jU.yDiff;jT=jU.totalYDiff}for(var jM=jC.length-1;jM>-1;jM--){var jN=jC[jM];if(jn.children[jM]){var jR=jn.children[jM].style;jI=jN.preDx+(jN.dx-jN.preDx)*jS-jp.width*jS;jt=jN.preDy+(jN.dy-jN.preDy)*jS-jp.height*jS+jP;jR.left=jN.left+jI+"px";jR.top=jN.top+jt+"px";jR.height=jR.width=256*ju+"px"}}var jK=jp.width*jS;var jO=jp.height*jS;if(jF.isRestrict){jG._enableCanvas2dMap&&jG._canvas2dMapMgr.clearLabel()}else{jG._enableCanvas2dMap&&jG._canvas2dMapMgr.drawLabel(ju,jr,jj,jE,jD,jS,jK,jO,jT,jP)}jG._preZoomTimes=ju;jG._preRenderTick=jS;jm.onAnimationLooping&&jm.onAnimationLooping(jS,jL,jQ)},finish:function(){jG._preZoomTimes=1;jG._zoomAni=null;jG._animationDiv=null;jm.onAnimationFinish&&jm.onAnimationFinish();jG.showNonAnimationLayers()}});return this._zoomAni},stopAnimation:function(){if(this._zoomAni){this._zoomAni.stop();this._zoomAni=null}}});function jg(e){this._initVars(e);this._initColorCanvas();this._bindEvent(e)}ey.extend(jg.prototype,{_initVars:function(e){this._map=e._map;this._canvas2dMapMgr=e;this._labelCtx=e._labelCtx;this.ratio=this._map.config.ratio;this.sizeRatio=this.ratio>1?2:1;this.RANK1=1000000;this.RANK2=2000000;this.RANK3=3000000;this.RANK4=4000000;this.RANK5=5000000},_initColorCanvas:function(){var i=256,T=bL("canvas"),e=T.style;e.width=i+"px";e.height=i+"px";T.width=i;T.height=i;this._colorCvsSize=i;this._colorCvs=T;this._colorCtx=T.getContext("2d")},getLabelImageData:function(jw){var jv=jw.textImg;var T=jw.textPos;var jt=this.ratio;var jr=this.sizeRatio/jt;var jk=this._colorCtx;var jo=this._colorCvsSize;jk.clearRect(0,0,jo,jo);var jq=0;var e=0;var jn=0;for(var jp=0;jp<T.length;jp++){if(T[jp].width>jq){jq=T[jp].width;e=jp;jn=T[jp].drawX}}jq/=jr;var js=0;for(var jp=0,jm=T.length;jp<jm;jp++){var ju=T[jp];var jx;if(jp===e){jx=0}else{jx=ju.drawX-jn}jk.drawImage(jv,ju.srcX,ju.srcY,ju.width,ju.height,jx,js,ju.width/jr,ju.height/jr);if(ju.width/jr>jq){jq=ju.width/jr}js+=ju.height/jr+2*jt}var jj=jk.getImageData(0,0,jq,js);var jl=jk.getImageData(0,0,jq,js);return[jj,jl]},_bindEvent:function(i){var e=this,T=i._map;T.addEventListener("onspotmouseover",function(jm){if(!this.isCanvasMap()||!this.temp.isPermitSpotOver){return}if(jm.spots.length>0){var jl=jm.spots[0].userdata.uid;var jk=jm.spots[0].userdata.name;var jj=e.findLabelByUid(jl,jk);jj&&e._toHighLightColor(jj)}});T.addEventListener("onspotmouseout",function(jm){if(!this.isCanvasMap()||!this.temp.isPermitSpotOver){return}if(jm.spots.length>0){var jl=jm.spots[0].userdata.uid;var jk=jm.spots[0].userdata.name;var jj=e.findLabelByUid(jl,jk);jj&&e._toDefaultColor(jj)}});T.addEventListener("onspotclick",function(jm){if(!this.isCanvasMap()||!this.temp.isPermitSpotOver){return}if(jm.spots&&jm.spots.length>0){var jl=jm.spots[0].userdata.uid;var jk=jm.spots[0].userdata.name;var jj=e.findLabelByUid(jl,jk);jj&&e._changeBaseMapState(jj)}else{e._recoverNormalState()}});T.on("spot_status_reset",function(){e._recoverNormalState()});T.on("spot_highlight",function(jk){var jj=e.findLabelByUid(jk.uid);jj&&e._changeBaseMapState(jj)})},_getTextBound:function(ju){if(!ju.textPos){return null}var js=this.ratio;var jq=this.sizeRatio/js;var T=ju.textPos;var jt=ju.baseDrawX;var jr=ju.baseDrawY;var jo=jt*js+(T[0].drawX-jt)/jq;var jm=jr*js+(T[0].drawY-jr)/jq;var jk=jo+T[0].width/jq;var e=jm+T[0].height/jq;for(var jp=0,jn=T.length;jp<jn;jp++){var jv=T[jp];var jl=jt*js+(jv.drawX-jt)/jq;if(jl<jo){jo=jl}var jj=jr*js+(jv.drawY-jr)/jq;if(jj<jm){jm=jj}if(jl+jv.width>jk){jk=jl+jv.width}if(jj+jv.height>e){e=jj+jv.height}}return[jo,jm,jk,e]},_toHighLightColor:function(T){if(T._tempRank&&T._tempRank==this.RANK5){return}var jn=this._getTextBound(T);if(!jn){return}var jj=Math.round(jn[0]);var i=Math.round(jn[1]);var e=this.getLabelImageData(T);var jl=e[0];var jk=e[1];var jm=this._canvas2dMapMgr.getFilterImageData(jl,this.RANK5);T._oldImgData=jk;this._labelCtx.putImageData(jm,jj,i)},_toDefaultColor:function(e){if(e._tempRank&&e._tempRank==this.RANK5){return}if(e._oldImgData){var i=this.sizeRatio;var T=this._getTextBound(e);if(!T){return}this._labelCtx.putImageData(e._oldImgData,Math.round(T[0]),Math.round(T[1]));e._oldImgData=null}},_changeBaseMapState:function(jj){var T=this._canvas2dMapMgr;var i=jj.guid;var e=jj.guidExt;var jk={guid:i,name:jj.name,guidExt:e};T._labelStrategy.setStrategyInfo(jk);T._loadData()},_recoverNormalState:function(){var e=this._canvas2dMapMgr;e._labelStrategy.setStrategyInfo(null);e._loadData()},findLabelByUid:function(jl,jj){var jn=this._canvas2dMapMgr,e=jn._computedLabel;for(var jk=0,T=e.length;jk<T;jk++){var jm=e[jk];if(!jn.isClickableLabel(jm)){continue}if(jl&&jm.guid===jl){return jm}if(jj&&jm.name===jj){return jm}}return null}});function z(e){this._initVars(e)}ey.extend(z.prototype,{_initVars:function(e){this._map=e._map;this._canvas2dMapMgr=e;this.ratio=this._map.config.ratio;this._strategyInfo=null;this.RANK1=1000000;this.RANK2=2000000;this.RANK3=3000000;this.RANK4=4000000;this.RANK5=5000000},setStrategyInfo:function(e){this._strategyInfo=e},preComputeLabel:function(jp,kg,jZ,jB,ka,ku){var jT=[],jx=jp._centerX,jv=jp._centerY,kv=jB*ka;var j5=this.ratio;var jo=this._map.getZoom();var jO=0;if(jo===5){jO=4}if(jo===8){jO=-6}jp.sort(function(kw,i){if(kw.x*kw.y<i.x*i.y){return -1}else{return 1}});for(var jQ=0,jM=jp.length;jQ<jM;jQ++){var kl=jp[jQ],jH=kl.x,jE=kl.y,jC=kl.z;var jJ=eB.calcLoopParam(jH,jC).offsetX;var j3=jH*kv,j2=(jE+1)*kv,jj=(j3-jx)/jB+kg/2+jJ,T=(jv-j2)/jB+jZ/2;for(var jN=0,kp=kl.length;jN<kp;jN++){var jr=kl[jN],jy=undefined,jw=undefined,kn=undefined,km=undefined;var kc=jr.baseDrawX=jj+jr.baseX;var kb=jr.baseDrawY=T+jr.baseY;if(jr.type=="fixed"){var jX=jr.iconPos,jA=jr.textPos,kr=jr.textImg;if(jX){jX.drawX=jj+jX.destX;jX.drawY=T+jX.destY;jy=jX.drawX;jw=jX.drawY;kn=jX.drawX+jX.width;km=jX.drawY+jX.height}if(jA&&kr){for(var kd=0;kd<jA.length;kd++){var kq=jA[kd];kq.drawX=jj+kq.destX;kq.drawY=T+kq.destY;if(!jy){jy=kq.drawX;jw=kq.drawY;kn=kq.drawX+kq.width;km=kq.drawY+kq.height}else{if(kq.drawX<jy){jy=kq.drawX}if(kq.drawY<jw){jw=kq.drawY}if(kq.drawX+kq.width>kn){kn=kq.drawX+kq.width}if(kq.drawY+kq.height>km){km=kq.drawY+kq.height}}}}}else{jr.tileX=jj;jr.tileY=T;jy=jj+jr.minXOriginal;jw=T+jr.minYOriginal;kn=jj+jr.maxXOriginal;km=T+jr.maxYOriginal}if(jy!=undefined){var kf=kc+(jy-kc)/j5;var ke=kb+(jw-kb)/j5;var jR=kc+(kn-kc)/j5;var jP=kb+(km-kb)/j5;jr.minX=kf;jr.minY=ke;jr.maxX=jR;jr.maxY=jP;var kj=(kf+jR)/2,ki=(ke+jP)/2,j0=jx+(kj-kg/2)*jB,jY=jv+(jZ/2-ki)*jB;jr.geoX=j0;jr.geoY=jY;jT.push(jr)}}}if(ku){for(var jQ=0,jM=ku.length;jQ<jM;jQ++){var jL=ku[jQ];var j8=jL[0];var js=jL[1];var jX=j8.iconPos;var jm=jX.geoX;var jk=jX.geoY;var kc=(jm-jx)/jB+kg/2;var kb=(jv-jk)/jB+jZ/2;var jy=kc+jX.destX;var jw=kb+jX.destY;var kn=jy+jX.width;var km=jw+jX.height;j8.textPos=j8.textPos||j8._textPos;var jA=j8.textPos;var kh=jA[0];var jG=kc+kh.destX;var ju=kb+kh.destY;if(ju<jw){jw=ju}if(jG+kh.width>kn){kn=jG+kh.width}if(ju+kh.height>km){km=ju+kh.height}if(jA.length===2){var jF=jA[1];var jD=kc+jF.destX;var jt=kb+jF.destY;if(jt<jw){jw=jt}if(jD+jF.width>kn){kn=jD+jF.width}if(jt+jF.height>km){km=jt+jF.height}}j8._tempBounds=[jy,jw,kn,km];var jX=js.iconPos;var jm=jX.geoX;var jk=jX.geoY;var kc=(jm-jx)/jB+kg/2;var kb=(jv-jk)/jB+jZ/2;var jy=kc+jX.destX;var jw=kb+jX.destY;var kn=jy+jX.width;var km=jw+jX.height;js.textPos=js.textPos||js._textPos;var jA=js.textPos;var kh=jA[0];var jG=kc+kh.destX;var ju=kb+kh.destY;if(jG<jy){jy=jG}if(ju<jw){jw=ju}if(ju+kh.height>km){km=ju+kh.height}if(jA.length===2){var jF=jA[1];var jD=kc+jF.destX;var jt=kb+jF.destY;if(jD<jy){jy=jD}if(jt<jw){jw=jt}if(jt+jF.height>km){km=jt+jF.height}}js._tempBounds=[jy,jw,kn,km]}for(var jQ=0,jM=ku.length;jQ<jM;jQ++){var jL=ku[jQ];var j8=jL[0];var js=jL[1];if(jQ===0&&js.textPos){js._textPos=js.textPos;delete js.textPos}var kk=j8;if(!j8.textPos&&js.textPos){kk=js}var ko=kk._tempBounds;for(jN=jQ+1;jN<jM;jN++){var jK=ku[jN];var jU=jK[0];var kt=jK[1];var jz=0;var ks=jU._tempBounds;if(!(ko[2]<ks[0]||ko[0]>ks[2]||ko[3]<ks[1]||ko[1]>ks[3])){jz++;if(jU.textPos){jU._textPos=jU.textPos;delete jU.textPos}}var ks=kt._tempBounds;if(!(ko[2]<ks[0]||ko[0]>ks[2]||ko[3]<ks[1]||ko[1]>ks[3])){jz++;if(kt.textPos){kt._textPos=kt.textPos;delete kt.textPos}}if(jz>=2){if(kk.textPos){kk._textPos=kk.textPos;delete kk.textPos}}}}for(var jQ=0,jM=ku.length;jQ<jM;jQ++){var jL=ku[jQ];var j8=jL[0];var js=jL[1];var jV=j8;if(!j8.textPos&&js.textPos){jV=js}var jX=jV.iconPos;var jm=jX.geoX;var jk=jX.geoY;var kc=jV.baseDrawX=(jm-jx)/jB+kg/2;var kb=jV.baseDrawY=(jv-jk)/jB+jZ/2;jX.drawX=kc+jX.destX;jX.drawY=kb+jX.destY;var jy=jX.drawX;var jw=jX.drawY;var kn=jX.drawX+jX.width;var km=jX.drawY+jX.height;var jA=jV.textPos;if(jA){var kh=jA[0];kh.drawX=kc+kh.destX;kh.drawY=kb+kh.destY;if(kh.drawX<jy){jy=kh.drawX}if(kh.drawY<jw){jw=kh.drawY}if(kh.drawX+kh.width>kn){kn=kh.drawX+kh.width}if(kh.drawY+kh.height>km){km=kh.drawY+kh.height}if(jA.length===2){var jF=jA[1];jF.drawX=kc+jF.destX;jF.drawY=kb+jF.destY;if(jF.drawX<jy){jy=jF.drawX}if(jF.drawY<jw){jw=jF.drawY}if(jF.drawX+jF.width>kn){kn=jF.drawX+jF.width}if(jF.drawY+jF.height>km){km=jF.drawY+jF.height}}}var kf=kc+(jy-kc)/j5;var ke=kb+(jw-kb)/j5;var jR=kc+(kn-kc)/j5;var jP=kb+(km-kb)/j5;jV.minX=kf;jV.minY=ke;jV.maxX=jR;jV.maxY=jP;var j7=(kf+jR)/2;var j6=(ke+jP)/2;var jn=jx+(j7-kg/2)*jB;var jl=jv+(jZ/2-j6)*jB;jV.geoX=jn;jV.geoY=jl;jT.push(jV)}}var j9=this._strategyInfo;if(j9){var jS=j9.guid;var j1=j9.name;var jI=j9.guidExt;for(var jQ=0,jM=jT.length;jQ<jM;jQ++){var jq=jT[jQ];delete jq._tempRank;if(!this._canvas2dMapMgr.isClickableLabel(jq)||(jI===1&&!jq.guidExt)){continue}if((jS&&jS===jq.guid)||(j1&&j1===jq.name)){jq._tempRank=this.RANK5}}}else{for(var jQ=0,jM=jT.length;jQ<jM;jQ++){var jq=jT[jQ];if(jq.type=="line"||!jq.iconPos){continue}delete jq._tempRank}}jT.sort(function(kx,kw){var ky=kx._tempRank?kx._tempRank:kx.rank,i=kw._tempRank?kw._tempRank:kw.rank;if(ky===i){return kx.baseX-kw.baseX}return i-ky});for(var jQ=0,jM=jT.length;jQ<jM;jQ++){var kk=jT[jQ];kk.isDel=false;kk.isFadeout=false;kk._schedule=0;kk._isIgnore=false;kk.arrIntersectIndex=[];for(jN=jQ+1;jN<jM;jN++){var jW=jT[jN];if(!(kk.maxX-jO<jW.minX||kk.minX>jW.maxX-jO||kk.maxY-jO<jW.minY||kk.minY>jW.maxY-jO)){kk.arrIntersectIndex.push(jN)}}}for(var jQ=0,jM=jT.length;jQ<jM;jQ++){var jq=jT[jQ];if(jq.isDel==false){var e=jq.arrIntersectIndex;for(var jN=0,kp=e.length;jN<kp;jN++){var j4=jT[e[jN]];j4.isDel=true;if(j4.guidExt===1){j4.isDel=false}}}}return jT}});function S(e){this._map=e;this._initCanvas();this._initVars();this._bindEvent();this._tileType=hl.getInstance("na")}bp.register(function(i){if(i.getRenderType()==="canvas"){var e=i.config.style;if(bp["FeatureStyle"+e]){i.canvas2dMapMgr=new S(i)}else{i.loadMapStyleFiles(function(){i.canvas2dMapMgr=new S(i);i.canvas2dMapMgr._loadData()})}}});ey.extend(S.prototype,{_initCanvas:function(){var jm=this._map,jk=jm.getSize(),jj=jk.width,i=jk.height,e=jm.platform,jn=bL("canvas"),jl=jn.style;var T=this.ratio=jm.config.ratio;this._width=jj;this._height=i;jl.cssText="position: absolute;left:0;top:0;width:"+jj+"px;height:"+i+"px;z-index:100;";jn.width=jj*T;jn.height=i*T;this._labelCanvas=jn;this._labelCtx=jn.getContext("2d");e.appendChild(jn)},_initVars:function(){var e=iY("ditu","normal");this._udt=e.udt;this._version=e.ver;this._labelDataUrls=dU.B_NORMAL_MAP.vectorTileUrls;this._style=bp["FeatureStyle"+this._map.config.style];this._labelCount=0;this._vectorDrawLib=new gr(this);this._cache={maxNum:500,delNum:50,arrCache:[]};this._computedLabel=null;this._spotData=null;this._labelStrategy=new z(this);this._labelClick=new jg(this);this._biz=new d1(this);this._map.temp.isPermitSpotOver=true;this.labelStyleParam="pl";if(this._map.getMapType()===BMAP_SATELLITE_MAP){this.labelStyleParam="sl"}this.statRequestCount=0;this.statResponseCount=0},_resizeHandler:function(jl){var jn=this,i=jn._map,jk=i.getSize(),T=jk.width,jp=jk.height;var jm=this.ratio;var jq=this._labelCanvas,jj=jq.style;jj.width=T+"px";jj.height=jp+"px";jq.width=T*jm;jq.height=jp*jm;jn._width=T;jn._height=jp;var jo=true;jn._loadData(jo)},_bindEvent:function(){var e=this,i=e._map;i.addEventListener("load",function(T){e.clearLabel();e._loadData()});i.addEventListener("zoomend",function(T){if(!T.notClearLabel){e.clearLabel()}e._loadData()});i.addEventListener("moveend",function(T){e._loadData()});i.addEventListener("resize",function(T){e._resizeHandler(T)});i.addEventListener("maptypechange",function(T){if(T.mapType===BMAP_EARTH_MAP){e.hideLabelCanvas()}else{e.showLabelCanvas();if(T.mapType===BMAPGL_NORMAL_MAP){e.labelStyleParam="pl"}else{if(T.mapType===BMAP_SATELLITE_MAP){e.labelStyleParam="sl"}}e._loadData()}});i.addEventListener("streetlayer_show",function(T){if(this.isCanvasMap()){e.showLabelCanvas()}});i.addEventListener("streetlayer_hide",function(T){if(this.isCanvasMap()){e.hideLabelCanvas()}});i.addEventListener("loadbizdata",function(jj){var T=jj.data;e._biz.proecessBizData(T,function(){e.updateLabel()})});i.addEventListener("unloadbizdata",function(T){e._biz.clearBizData();e.updateLabel()});e.isDrawText=false;setTimeout(function(){if(!e.isDrawText){i.dispatchEvent(new ff("onmapwhitescreen"))}},10000)},getStyle:function(){return this._style},_getZoomUnits:function(e){return Math.pow(2,18-e)},_createCacheForm:function(T,jn,jm,i){var jl=this;var e=jl._cache;var jj=e.arrCache;var jo=this._getLabelId(T,jn,jm,i);var jk={id:jo,updateLabelCounter:0};jj.push(jk);jj[jo]=jk;return jk},_getLabelId:function(i,jj,T,e){return"_"+i+"_"+jj+"_"+T+"_"+e+"_"+this.labelStyleParam},_getCache:function(i,jj,T,e){return this._cache.arrCache[this._getLabelId(i,jj,T,e)]},_setCacheValue:function(jk,jx,jv,jj,jq){var js=this;var e=js._cache;var jm=e.arrCache;var jo=e.maxNum;var jl=e.delNum;var jw=this._getLabelId(jk,jx,jv,jj);var jr=jm[jw];if(jq){jr.lb=jq}if(jm.length>jo){var T=jm.splice(0,jl);for(var jp=0,jn=T.length;jp<jn;jp++){var jt=T[jp],ju=jt.id;if(jm[ju].lb){jm[ju].lb=null}jm[ju]=null;delete jm[ju]}T=null}},_loadData:function(jv){var jO=this._map;if(!jO.isCanvasMap()){return}var jo=jO.getCenterIn();var jN=eB.calcLoopCenterPoint(jo);var jn=this._tileType;var jq=this._width/2;var jC=this._height;var jD=jO.getZoom();var jz=jn.getDataZoom(jD);var js=jO.getZoomUnits(jD);var jy=js*jq;var jM=jN.lng-jy;var jL=jN.lng+jy;var jw=eB.isAddWidth(jM,jL);jq=jw?jq*1.5:jq;var jx=jn.getTileSize(jD);var jk=jn.getMercatorSize(jD,jz);var jr=Math.floor(jN.lng/jk);var jt=Math.floor(jN.lat/jk);var jl=[jr,jt,(jN.lng-jr*jk)/jk*jx,(jN.lat-jt*jk)/jk*jx];var jF=jl[0]-Math.ceil((jq-jl[2])/jx);var jJ=jl[1]-Math.ceil((jC/2-jl[3])/jx);var jB=jl[0]+Math.ceil((jq+jl[2])/jx);var jG=jl[1]+Math.ceil((jC/2+jl[3])/jx);jO.temp.isPermitSpotOver=false;var e=[];for(var jI=jF;jI<jB;jI++){for(var jH=jJ;jH<jG;jH++){e.push([jI,jH,jz]);var jA="id_"+jI+"_"+jH+"_"+jD;e[jA]=true}}e._zoom=jz;e=eB.calcLoopTiles(e,jD);e.sort((function(i){return function(jQ,jR){return((0.4*Math.abs(jQ[0]-i[0])+0.6*Math.abs(jQ[1]-i[1]))-(0.4*Math.abs(jR[0]-i[0])+0.6*Math.abs(jR[1]-i[1])))}})([jl[0],jl[1]]));var ju=this._cache.arrCache;this._curViewLabels=[];var jj="viewKey_"+Math.floor(jo.lng)+"_"+Math.floor(jo.lat)+"_"+jD;this.statRequestCount=0;this.statResponseCount=0;this._labelCount+=e.length;var jp=jD;for(var jI=0,jE=e.length;jI<jE;jI++){var jr=e[jI][0];var jt=e[jI][1];var T=e[jI][2];var jm=this._getLabelId(jr,jt,T,jp);var jK=ju[jm];if(!jK){jK=this._createCacheForm(jr,jt,T,jp)}if(typeof jK.lb==="undefined"){jK.lb=null;this._loadLabelData(jr,jt,T,jp,jx,jj);this.statRequestCount++}else{if(jK.lb){this._curViewLabels.push(jK.lb);this._labelCount--}else{if(jv){this._loadLabelData(jr,jt,T,jp,jx,jj)}jK.updateLabelCounter++}}}if(this._labelCount===0){this.updateLabel()}var jP=this;if(jP.errorTimer){clearTimeout(jP.errorTimer)}jP.errorTimer=setTimeout(function(){if(jP._labelCount!==0){jP._labelCount=0;jP.updateLabel()}var jR=new ff("onloaddatatimeout");var jS=0;var jQ=0;var jT=0;var i=0;if(jP.statRequestCount===jP.statResponseCount){jS=1}else{jQ=1}if(jQ===1){i=jP.statRequestCount-jP.statResponseCount;jT=jP.statResponseCount}jR.noTimeoutCount=jS;jR.timeoutCount=jQ;jR.timeoutNoLoaded=i;jR.timeoutLoaded=jT;jP._map.dispatchEvent(jR)},500)},clearLabel:function(){var e=this._width;var T=this._height;var i=this.ratio;this._labelCtx.clearRect(0,0,e*i,T*i)},updateLabel:function(){var i=this._map;var e=i.getCenterIn();var jj=this._width;var jm=this._height;var jp=i.getZoom();var jo=this._tileType.getTileSize(jp);var jn=this._getZoomUnits(jp);var T=this._labelCtx;this._labelCanvas.style.left=-i.offsetX+"px";this._labelCanvas.style.top=-i.offsetY+"px";var jl=this._curViewLabels;jl._centerX=e.lng;jl._centerY=e.lat;var jk=this._biz.bizLabels;this._computedLabel=this._labelStrategy.preComputeLabel(jl,jj,jm,jn,jo,jk);this._computedLabel._zoom=jp;this.clearLabel();this._vectorDrawLib.drawIconAndText(T,this._computedLabel,jp);this._addSpotData();i.temp.isPermitSpotOver=true;if(jl.length>0){this.isDrawText=true}},_loadLabelData:function(js,jr,jq,T,jt,e){var jl=js.toString();var jj=jr.toString();var jn="cbk_"+jl.replace("-","_")+"_"+jj.replace("-","__")+"_"+Math.floor(jq);var jx=e2+"."+jn;var jw=this._labelDataUrls;var jp=Math.abs(js+jr)%jw.length;var jC=jw[jp];if(window.offLineIPAddress){jC=window.offLineIPAddress+"pvd/"}var i=this.labelStyleParam;var jv="?qt=vtile";var jy="";if(this._map.config.style!=="default"){jy="&styleId=1"}var ju="x={x}&y={y}&z={z}&udt={udt}&v={v}&styles={styles}"+jy+"&textonly=1&textimg=1&scaler={scaler}&fn="+encodeURIComponent(jx);var jz=eB.calcLoopParam(js,jq).col;var jo=this.ratio>1?2:1;var jm=ju.replace(/{x}/,jz).replace(/{y}/,jr).replace(/{z}/,Math.floor(jq)).replace(/{styles}/,i).replace(/{udt}/,this._udt).replace(/{v}/,this._version).replace(/{scaler}/,jo);var jk=jC+jv+"&param="+window.encodeURIComponent(eu(jm));var jB=this;var jA=jB._map;bp[jn]=function(jD){jB._vectorDrawLib.parseLabelData(jD,js,jr,jq,T,jt,function(jI){var jF=jA.getCenterIn();var jJ=jA.getZoom();var jL="viewKey_"+Math.floor(jF.lng)+"_"+Math.floor(jF.lat)+"_"+jJ;jB._labelCount--;var jM=jB._getCache(js,jr,jq,T).updateLabelCounter;jB._labelCount-=jM;var jG=jB._curViewLabels;if(jL===e||(jB._labelCount<0&&jJ===jq)){jG.push(jI)}if(jL===e){jB.statResponseCount++}if(jB._labelCount<=0){var jE=(new Date()).getTime();jB.updateLabel();var jH=(new Date()).getTime();var jK=new ff("oncanvasmaploaded");jK.drawTime=jH-jE;if(jB.statResponseCount===jB.statRequestCount){jK.isAllLoadedDrawing=true}jA.dispatchEvent(jK)}jB._setCacheValue(js,jr,jq,T,jI);delete bp[jn]})};gf.load(jk)},drawLabel:function(T,jj,jq,i,jo,jk,e,jl,jp,jm){var jn=this;if(!jn._computedLabel){return}if(jn._computedLabel._zoom!==jq){jn.clearLabel();return}jn._map.temp.isPermitSpotOver=false;jn.clearLabel();jn._vectorDrawLib.zoomingIconAndText(this._labelCtx,jn._computedLabel,T,jj,i,jo,jk,e,jl,jp,jm)},_addSpotData:function(){this._spotData=[];var jq=this._map.getZoom();for(var jl=0,jk=this._computedLabel.length;jl<jk;jl++){var jn=this._computedLabel[jl];if(!this.isClickableLabel(jn)||(jn.guidExt===1&&jn.startScale>jq)){continue}var jm=[];jm[0]=(jn.minX-jn.maxX)/2;jm[1]=(jn.minY-jn.maxY)/2;jm[2]=(jn.maxX-jn.minX)/2;jm[3]=(jn.maxY-jn.minY)/2;var jj=null;if(jn.iconPos){jj=new cg(jn.iconPos.geoX,jn.iconPos.geoY)}var T=jn.name?jn.name.replace("\\\\","<br>"):"";if(jn.iconPos&&jn.iconPos.iconType.indexOf("ditie")>-1&&this._map.getZoom()>14){T=""}var jp={n:T,pt:new cg(jn.geoX,jn.geoY),userdata:{iconPoint:jj,uid:jn.guid,name:T,type:jn.iconPos?jn.iconPos.iconType:"",iconImg:jn.iconImg,mapPoi:true,adver_log:jn.adver_log||""},bd:jm,tag:"MAP_SPOT_INFO"};this._spotData.push(jp)}var jo=new ff("onspotsdataready");jo.spots=this._spotData;this._map._spotDataOnCanvas=this._spotData;this._map.dispatchEvent(jo)},isClickableLabel:function(e){if(e.isDel||(!e.guid&&!e.name)){return false}return true},getFilterImageData:function(T,jm){var jn=T.data,jl=this._labelStrategy,jm=parseInt(jm);for(var jo=0,jk=jn.length;jo<jk;jo+=4){var e=jn[jo],jp=jn[jo+1],jq=jn[jo+2],jr=jn[jo+3];if(jr===0){continue}var jj=Math.round((e+jp+jq)/3);var js=jj-90;js=js<0?0:js;if(jm===jl.RANK5){jn[jo]=51+js*1.3;jn[jo+1]=133+js*0.8;jn[jo+2]=255}}return T},showLabelCanvas:function(){this._labelCanvas.style.visibility=""},hideLabelCanvas:function(){this._labelCanvas.style.visibility="hidden"}});var aK=5;var ii=4;var f1=3;var H=2;var d0=1;var gR=0;var jh=3;var hF=5;var eR={3:{start:3,base:3},4:{start:4,base:5},5:{start:4,base:5},6:{start:6,base:7},7:{start:6,base:7},8:{start:8,base:9},9:{start:8,base:9},10:{start:10,base:10},11:{start:11,base:12},12:{start:11,base:12},13:{start:11,base:12},14:{start:14,base:15},15:{start:14,base:15},16:{start:16,base:17},17:{start:16,base:17},18:{start:18,base:19},19:{start:18,base:19},20:{start:18,base:19},21:{start:18,base:19}};function gr(jj){this._canvas2dMapMgr=jj;var i=this.ratio=jj._map.config.ratio;this._featureStyle=null;this._map=jj._map;var T=bq();var e="udt="+T.udt+"&v="+T.ver;this.sizeRatio=this.ratio>1?2:1;this._binaryCache={};this._iconCache={};this._initColorCanvas()}ey.extend(gr.prototype,{_initColorCanvas:function(){var i=256,T=bL("canvas"),e=T.style;e.width=i+"px";e.height=i+"px";T.width=i;T.height=i;this._colorCvs=T;this._colorCtx=T.getContext("2d")},parseLabelData:function(i,jl,jk,jj,e,jo,jn){if(!this._featureStyle){this._featureStyle=this._canvas2dMapMgr.getStyle()}if(!i||!i[0]){jn([]);return}var jm=this._map.getZoomUnits();var T=this;this.loadTextPng(i,jo,jl,jk,jj,e,jm,jn)},loadTextPng:function(jA,jr,jp,jo,jm,i,jk,jj){var jz=this;var e=jA[5];var jy=this._map;var jv=jy.getZoom();var T=jy.getSize();var jw=T.width;var ju=T.height;var jx=jy.getCenterIn();var jn=jx.lng;var jl=jx.lat;var jt=jp*jr*jk;var js=(jo+1)*jr*jk;if(e){var jq=new Image();jq.onload=function(){jz.calcIconAndTextInfo(jA,jq,jr,jp,jo,jm,i,jk,jt,js,jj);delete this.onload};jq.src=e}else{setTimeout(function(){jz.calcIconAndTextInfo(jA,null,jr,jp,jo,jm,i,jk,jt,js,jj)},1)}},calcIconAndTextInfo:function(jC,jt,ju,js,jp,jn,jj,jl,jw,jv,jk){var jB=this;var jA=jB._featureStyle;var jq=[];jq.x=js;jq.y=jp;jq.z=jn;var jr=jB._canvas2dMapMgr,T=js*jl*ju,jz=(jp+1)*jl*ju,jm={tileLeft:T,tileTop:jz,zoomUnits:jl};var e=[];if(jC[0]){for(var jx=0;jx<jC[0].length;jx++){if(jC[0][jx][0]===jh){e.push(jC[0][jx])}}}var jo=jC[2]||[];for(var jx=0;jx<e.length;jx++){this._getFixedLabelInfo(e[jx],jt,jj,jl,ju,jw,jv,jq)}var jy=Math.pow(2,jj-jn);for(jx=0;jx<jo.length;jx++){this._getLineLabelInfo(jo[jx],jt,jn,jj,jl,ju,jw,jv,jy,jq)}jk(jq)},_getFixedLabelInfo:function(jt,jx,jk,jo,jy,jB,jA,jD){var js=jt[1];if(!js){return}var jF=this._map.getZoom();var jN=this._map.config.style;var jO=this._featureStyle;var jp=jk;if(jp===9){jp=8}for(var jK=0;jK<js.length;jK++){var jP=js[jK];var e=jP[0];var jj=aP.getStyleFromCache(jN,e,"point",jp,jO);var jJ=aP.getStyleFromCache(jN,e,"pointText",jp,jO);if((!jJ||jJ.length===0)&&(!jj||jj.length===0)){if(jp===5){var jn=jP[1];if(!jn){continue}for(var jG=0;jG<jn.length;jG++){var jE=jn[jG][4];if(jE&&jE[7]==="北京"){jj=aP.getStyleFromCache(jN,e,"point",6,jO);jJ=aP.getStyleFromCache(jN,e,"pointText",6,jO);break}else{continue}}}else{continue}}var jn=jP[1];if(!jn){continue}var jL=null;var jq=1;var T=0;var jw=0;if(jj&&jj[0]){jj=jj[0];jL=jj.icon;jq=jj.zoom?jj.zoom/100:1}else{jj=null}for(var jG=0;jG<jn.length;jG++){var jE=jn[jG][4];if(!jE){continue}var jI=jE[2];if(!this._isVisible(jI,jF)){continue}var jr=jE[12];if(jJ&&jJ.length>0&&!jr){continue}var jv=Math.round(jE[0]/100);var ju=Math.round(jE[1]/100);var jH={lng:jB+jv,lat:jA-(jy*jo-ju)};var jm=jv/jo;var jl=jy-ju/jo;var jz=jE[7]||"";var jM=jE[5];var jC={type:"fixed",name:jz,textImg:jx,rank:jE[4],baseX:jm,baseY:jl,iconPos:null,textPos:null,guid:jE[3]||"",tracer:jI,direction:jM,startScale:3};if((jM!==ii&&jr||!jr)&&jL!==null){jC.iconPos=this._getIconPosition(jL,jq,jm,jl,jH);if(jC.iconPos){T=jC.iconPos.width;jw=jC.iconPos.height}}if(T===0){jC.direction=ii}if(jr){jC.textPos=this._getTextDrawData(jE,jm,jl,T,jw)}if(jC.textPos||jC.iconPos){jD.push(jC)}}}},_isVisible:function(e,i){var jj;if(!this._binaryCache[e]){jj=e.toString(2);if(jj.length<8){jj=new Array(8-jj.length+1).join("0")+jj}this._binaryCache[e]=jj}jj=this._binaryCache[e];var T=eR[i].start;return jj[i-T]==="1"},_getIconPosition:function(jn,jl,T,i,e){var jj=this._map.config.style;var jo=bp["iconSetInfo"+jj][jn];if(!jo){if(jn.charCodeAt(0)>=48&&jn.charCodeAt(0)<=57){jo=bp["iconSetInfo"+jj]["_"+jn]}}if(!jo){return null}var jk=jo[0];var jm=jo[1];jk=jk*jl;jm=jm*jl;return{srcX:0,srcY:0,destX:T-jk/2,destY:i-jm/2,width:jk,height:jm,geoX:e.lng,geoY:e.lat,mcPt:e,iconType:jn}},_getTextDrawData:function(ju,jt,js,jj,jq){var jz=ju[5];if(typeof jz!=="number"){jz=0}var jo=this.ratio;var jn=jo/2;jj*=jn;jq*=jn;var jp=ju[12];var jk=jp.length;var jC=0;var jB=0;var jy=[];var jx=0;var jA=0;for(var jw=0;jw<jk;jw++){jA+=Math.round(jp[jw][3])}for(var jw=0;jw<jk;jw++){var jm=jp[jw];var jl=jm[0];var i=jm[1];var T=jm[2];var e=jm[3];var jD=2*jo;var jv=0;if(jj!==0){jv=2*jo}if(jj===0){jz=ii}switch(jz){case f1:var jr=js-jA/2-jD*(jk-1)/2;jC=jt-T-jj/2-jv;jB=jr+jx+jD*jw;break;case d0:var jr=js-jA/2-jD*(jk-1)/2;jC=jt+jj/2+jv;jB=jr+jx+jD*jw;break;case H:var jr=js-jq/2-jA-jD*(jk-1)-jD;jC=jt-T/2;jB=jr+jx+jD*jw;break;case gR:var jr=js+jq/2+jD/2;jC=jt-T/2;jB=jr+jx+jD*jw;break;case ii:var jr=js-e/2-jD*(jk-1)/2;jC=jt-T/2;jB=jr+jx+jD*jw;break}jx+=e;if(T>0&&e>0){jy.push({srcX:jl,srcY:i,destX:jC,destY:jB,width:T,height:e})}}if(jy.length>0){return jy}return null},_getLineLabelInfo:function(jr,jj,jk,jG,jT,jy,jE,jD,jF,jx){if(jr.length!==10){return}var jI=this.ratio;var T=this.ratio;var jP=jr[7].length;var jz=jr[1];var jR=jr[3];var jX=jr[8];var jn=jr[4];var e=2;var jl=jn.slice(0,e);for(var jU=e;jU<jn.length;jU+=e){jl[jU]=jl[jU-e]+jn[jU];jl[jU+1]=jl[jU-(e-1)]+jn[jU+1]}for(var jU=e;jU<jn.length;jU+=e){if(jU%(jR*e)===0||jU%(jR*e)===1){continue}jl[jU]=jl[jU-e]+jn[jU]/jF;jl[jU+1]=jl[jU-(e-1)]+jn[jU+1]/jF}for(var jW=0;jW<jP;jW++){var jS=jr[7][jW];if(!this._isVisible(jS,jG)){continue}var jK=jr[6][jW];var jw=jW*jR*e;jn=jl.slice(jw,jw+jR*e);var jA=[];var jJ=undefined;var jH=undefined;var jv=undefined;var ju=undefined;var jX=jr[9].slice(0);if(jK){jX.reverse()}var jN;var jL;for(var jV=0;jV<jR;jV++){var jt=jr[5][jR*jW+jV];var jO=jn[jV*e]/100;var jM=jn[jV*e+1]/100;var js=jX[jV];var jo=js[0];var jq=js[1];var jm=js[2];var jp=js[3];var jC;var jB;var jZ;var jY;if(jV===0){jN=jZ=jO/jT;jL=jy-jM/jT;jY=jM/jT}else{jZ=jO/jT;jY=jM/jT}var j1=jN+(jZ-jN)*T-jm/2;var j0=jL+(jy-jY-jL)*T-jp/2;if(jJ===undefined){jJ=jN-jm/2;jH=jL-jp/2;jv=jJ+jm;ju=jH+jp}else{if(j1<jJ){jJ=j1}if(j0<jH){jH=j0}if(j1+jm>jv){jv=j1+jm}if(j0+jp>ju){ju=j0+jp}}jA.push({angle:jt,srcX:jo,srcY:jq,destX:j1,destY:j0,width:jm,height:jp})}var jQ={type:"line",textImg:jj,rank:jz,baseX:jN,baseY:jL,arrWordPos:jA,minXOriginal:jJ,minYOriginal:jH,maxXOriginal:jv,maxYOriginal:ju,text:""};jx.push(jQ)}},alterColor:function(jm,e,jl){var T=this._colorCtx,i=this._canvas2dMapMgr;T.clearRect(0,0,jm.width,jm.height);T.drawImage(e,jm.srcX,jm.srcY,jm.width,jm.height,0,0,jm.width,jm.height);var jk=T.getImageData(0,0,jm.width,jm.height),jj=i.getFilterImageData(jk,jl);T.putImageData(jj,0,0)},drawIconAndText:function(jy,jx,e){var jp=this.ratio;var jn=this.sizeRatio/jp;var jr=2/jp;var jJ=this;for(var jB=0,jz=jx.length;jB<jz;jB++){var jq=jx[jB];if(jq.isDel==false){var jk=jq.baseDrawX;var jj=jq.baseDrawY;if(jq.type=="fixed"){var jm=jq.iconPos,jC=jq.textPos,jv=jq.textImg,jF=jq.startScale;if(jm&&jF<=e){var T=this._iconCache[jm.iconType];if(T){if(T.img){jy.drawImage(T.img,0,0,T.img.width,T.img.height,Math.round(jk*jp+(jm.drawX-jk)/jr),Math.round(jj*jp+(jm.drawY-jj)/jr),jm.width/jr,jm.height/jr)}else{T.drawLabels.push(jq)}}else{if(!T){this._iconCache[jm.iconType]={img:null,drawLabels:[jq]};var jL=new Image();jL._iconName=jm.iconType;jL.onload=function(){var jR=jJ._iconCache[this._iconName];jR.img=this;this.onload=null;for(var jN=0;jN<jR.drawLabels.length;jN++){var jP=jR.drawLabels[jN];var jO=jP.baseDrawX;var jM=jP.baseDrawY;var jQ=jP.iconPos;jy.drawImage(this,0,0,this.width,this.height,Math.round(jO*jp+(jQ.drawX-jO)/jr),Math.round(jM*jp+(jQ.drawY-jM)/jr),jQ.width/jr,jQ.height/jr)}jR.drawPos=[]};jL.src=w.getIconSetPath(jJ._map.config.style)+jm.iconType+".png"}}}if(jC&&jv&&jF<=e){for(var jo=0;jo<jC.length;jo++){var jw=jC[jo];if(!jq._tempRank){jy.drawImage(jv,jw.srcX,jw.srcY,jw.width,jw.height,Math.round(jk*jp+(jw.drawX-jk)/jn),Math.round(jj*jp+(jw.drawY-jj)/jn),jw.width/jn,jw.height/jn)}else{this.alterColor(jw,jv,jq._tempRank);jy.drawImage(this._colorCvs,0,0,jw.width,jw.height,Math.round(jk*jp+(jw.drawX-jk)/jn),Math.round(jj*jp+(jw.drawY-jj)/jn),jw.width/jn,jw.height/jn)}}}}else{var jl=jq.arrWordPos,jv=jq.textImg,ju=jq.tileX,js=jq.tileY;for(var jA=0,jt=jl.length;jA<jt;jA++){var jD=jl[jA];var jK=Math.round(ju+jD.destX);var jI=Math.round(js+jD.destY);var jE=jD.angle;jK=jk*jp+jK-jk;jI=jj*jp+jI-jj;if(jE>10&&jE<350){jy.save();var jH=Math.round(jK+jD.width/2);var jG=Math.round(jI+jD.height/2);jy.translate(jH,jG);jy.rotate(-jE/180*Math.PI);jy.drawImage(jv,jD.srcX,jD.srcY,jD.width,jD.height,-Math.round(jD.width/2),-Math.round(jD.height/2),jD.width/jn,jD.height/jn);jy.restore()}else{jy.drawImage(jv,jD.srcX,jD.srcY,jD.width,jD.height,jK,jI,jD.width/jn,jD.height/jn)}}}}}},isCollide:function(jl,ju,jt,e,jn,T,jp){for(var jk=0,jj=T.length;jk<jj;jk++){var jo=T[jk],jm=1/Math.pow(2,jp+1),js=jm*jo[3]/2,jr=jm*jo[4]/2,jq=jo[0];if(jq!=jl){if(!(ju+e<jo[1]-js||ju>jo[1]+jo[3]+js||jt+jn<jo[2]-jr||jt>jo[2]+jo[4]+jr)){return true}}}return false},zoomingIconAndText:function(jJ,jD,jj,jH,jI,ka,jQ,jr,jW,jP,jA){var kb=this.ratio;var js=this.sizeRatio/kb;var kc=2/kb;var km=kb/2;var j6=jH.x;var j5=jH.y;var jK=2*kb;if(jA!==0){j5+=jP}var jv=undefined,jo=undefined,jl=undefined,jq=undefined,jz=undefined;var jV=ka>0?true:false;if(!jV){jv=[];var jZ=1-jQ}for(var ki=0,kg=jD.length;ki<kg;ki++){var kd=jD[ki];if(kd.isDel==false){var kn=kd.baseDrawX;var kk=kd.baseDrawY;jJ.save();jJ.translate(-jr*kb,-jW*kb);if(kd.isFadeout){if(!jV&&kd._schedule<=jQ&&!kd._isIgnore){jJ.globalAlpha=jZ;kd._schedule=jQ}else{kd._isIgnore=true;continue}}if(kd.type=="fixed"){var jL=kd.iconPos,jS=kd.textPos,jm=kd.textImg,jM=kd.startScale;var T;var j3=0;if(jL){j3=jK}if(jL&&!kd.iconImg&&this._iconCache[jL.iconType]){T=this._iconCache[jL.iconType].img}if(jL&&jM<=jI&&T){jq=jL.width;jz=jL.height;jo=(j6+(kn-j6)*jj)*kb-jq/2/kc;jl=(j5+(kk-j5)*jj)*kb-jz/2/kc+jA;if(!jV&&this.isCollide(ki,jo,jl,jq,jz,jv,ka)){kd.isFadeout=true}jJ.drawImage(T,jL.srcX,jL.srcY,T.width,T.height,Math.round(jo),Math.round(jl),jq/kc,jz/kc);!jV&&jv.push([ki,jo,jl,jq,jz])}if(jS&&jm&&jM<=jI){var jR;var jT;var jC=0;var jO=0;if(jL){jC=jL.width;jO=jL.height}var j4=jS.length;var ju=0;var jU=0;for(var jE=0;jE<j4;jE++){var kf=jS[jE];jU+=kf.height;if(ju<kf.width){ju=kf.width}}jU+=(jE-1)*jK;if(!jV&&this.isCollide(ki,jo,jl,ju,jU,jv,ka)){kd.isFadeout=true}var ke=0;for(var jE=0;jE<j4;jE++){var kf=jS[jE];switch(kd.direction){case f1:jR=-(jC/2/kc+kf.width+j3);jT=-jU/2+ke+jK*jE;break;case d0:jR=jC/2/kc+j3;jT=-jU/2+ke+jK*jE;break;case H:jR=-kf.width/2;jT=-jO/2/kc-jU+ke-jK*(jE+1);break;case gR:jR=-kf.width/2;jT=jO/2/kc+ke+jK*(jE+1);break;case ii:jR=-kf.width/2;jT=-jU/2+ke+jK*jE;break}ke+=kf.height;jo=(j6+(kn-j6)*jj)*kb+jR/js;jl=(j5+(kk-j5)*jj)*kb+jT/js;+jA;jq=kf.width;jz=kf.height;if(!kd._tempRank){jJ.drawImage(jm,kf.srcX,kf.srcY,jq,jz,Math.round(jo),Math.round(jl),jq/js,jz/js)}else{this.alterColor(kf,jm,kd._tempRank);jJ.drawImage(this._colorCvs,0,0,jq,jz,Math.round(jo),Math.round(jl),jq/js,jz/js)}!jV&&jv.push([ki,jo,jl,jq,jz])}}}else{var jB=kd.arrWordPos,jm=kd.textImg,kl=kd.tileX,kj=kd.tileY;var jt=jB[0];var jp=Math.round(kl+jt.destX);var jn=Math.round(kj+jt.destY);for(var kh=0,j2=jB.length;kh<j2;kh++){var j9=jB[kh];var kp=Math.round(kl+j9.destX);var ko=Math.round(kj+j9.destY);var jG=j9.angle;var j1=Math.round((j6+(kn-j6)*jj)*kb-jt.width/2+kp-jp);var j0=Math.round((j5+(kk-j5)*jj)*kb-jt.height/2+ko-jn);jo=j1;jl=j0;jq=j9.width;jz=j9.height;if(!jV&&this.isCollide(ki,jo,jl,jq,jz,jv,ka)){kd.isFadeout=true}if(jG>10&&jG<350){var j8=j1+j9.width/2;var j7=j0+j9.height/2;var jk=jG/180*Math.PI;var jN=Math.cos(jk);var jw=Math.sin(jk);var jY=jN;var jx=jN;var jX=jw;var jy=-jw;var jF=j8-j8*jN-j7*jw;var e=j7+j8*jw-j7*jN;jJ.save();jJ.transform(jY,jy,jX,jx,jF,e);jJ.drawImage(jm,j9.srcX,j9.srcY,jq,jz,jo,jl,jq/js,jz/js);jJ.restore()}else{jJ.drawImage(jm,j9.srcX,j9.srcY,jq,jz,jo,jl,jq/js,jz/js)}!jV&&jv.push([ki,jo,jl,jq,jz])}}jJ.restore()}}}});function d1(e){this.initVars(e)}ey.extend(d1.prototype,{initVars:function(e){this._map=e._map;this._canvas2dMapMgr=e;this.base64Prefix="data:image/png;base64,";this.bizData=null;this.objTextsPng=null;this.arrIconsPng=null;this.bizLabels=null},proecessBizData:function(jl,jp){var jn=this;this.bizData=jl;this.objTextsPng=null;this.arrIconsPng=null;var T=jl.textsPng;var jr=jl.iconsPng;if(!T||!jr){return}var jo=new Image();jo.onload=function(){jn.objTextsPng=this;jn.calcIconAndTextInfo(jp);this.onload=null};jo.src=this.base64Prefix+T;var jq=jr.length;var e=[];for(var jk=0;jk<jq;jk++){var jm=jr[jk];var jj=new Image();(function(i){jj.onload=function(){jq--;e[i]=this;if(jq===0){jn.arrIconsPng=e;jn.calcIconAndTextInfo(jp)}this.onload=null}})(jk);jj.src=this.base64Prefix+jm}},calcIconAndTextInfo:function(js){if(this.objTextsPng&&this.arrIconsPng){var jo=this.bizData;var jm=jo.pois;var e=[];for(var jp=0,jl=jm.length;jp<jl;jp++){var jj=jm[jp];var jn=this.arrIconsPng[jj.iconPng];var jk=jn.height/2;var jr={type:"fixed",name:"",textImg:this.objTextsPng,iconImg:jn,rank:jj.rank,iconPos:{srcX:0,srcY:0,destX:-jn.width/2,destY:-jk/2,width:jn.width,height:jk,geoX:jj.x,geoY:jj.y,iconType:"vectorCustom"},textPos:this.calcTextPos(jj.pos,jn),startScale:jj.from<12?12:jj.from,guid:jj.guid,guidExt:1,adver_log:jj.adver_log||""};var T={type:"fixed",textDirLeft:"left",name:"",textImg:this.objTextsPng,iconImg:jn,rank:jj.rank,iconPos:{srcX:0,srcY:0,destX:-jn.width/2,destY:-jk/2,width:jn.width,height:jk,geoX:jj.x,geoY:jj.y,iconType:"vectorCustom"},textPos:this.calcTextPosLeft(jj.pos,jn),startScale:jj.from<12?12:jj.from,guid:jj.guid,guidExt:1,adver_log:jj.adver_log||""};var jq=[jr,T];e.push(jq)}this.bizLabels=e;js&&js()}},calcTextPos:function(jm,T){var i=[];var jl=jm.length/4;var jk=T.width/2;if(jl===1){var jj={srcX:jm[0],srcY:jm[1],destX:jk,destY:-jm[3]/2,width:jm[2],height:jm[3]};i.push(jj)}else{var jj={srcX:jm[0],srcY:jm[1],destX:jk,destY:-jm[3],width:jm[2],height:jm[3]};var e={srcX:jm[4],srcY:jm[5],destX:jk,destY:0,width:jm[6],height:jm[7]};i.push(jj);i.push(e)}return i},calcTextPosLeft:function(jm,T){var i=[];var jl=jm.length/4;var jk=T.width/2;if(jl===1){var jj={srcX:jm[0],srcY:jm[1],destX:-jk-jm[2],destY:-jm[3]/2,width:jm[2],height:jm[3]};i.push(jj)}else{var jj={srcX:jm[0],srcY:jm[1],destX:-jk-jm[2],destY:-jm[3],width:jm[2],height:jm[3]};var e={srcX:jm[4],srcY:jm[5],destX:-jk-jm[2],destY:0,width:jm[6],height:jm[7]};i.push(jj);i.push(e)}return i},clearBizData:function(){this.bizData=null;this.bizLabels=null}});function x(){}ey.extend(x.prototype,{centerAndZoomIn:function(T,jp,jq){jq=jq||{};if(!this.loaded){this.firstTileLoad=false}jp=this._getProperZoom(jp).zoom;if(jq.noAnimation!==true&&this.loaded){var jl=this._ifUseAnimation(T,jp);if(jl){this.flyToIn(T,jp,jq);return}}var jn=this;if(!T&&!jp){return}this._stopAllAnimations();if(T&&!T.equals(this.centerPoint)){this.fire(new ff("oncenter_changed"))}if(jp&&jp!==this.zoomLevel){this.fire(new ff("onzoom_changed"))}T=T||this.centerPoint;jp=jp||this.zoomLevel;jp=this._getProperZoom(jp).zoom;if(this.mapType===BMAP_EARTH_MAP){if(!this._earth){this.mapType=BMAPGL_NORMAL_MAP;this.temp.originMapType=BMAP_EARTH_MAP;function jo(){jn._earth=new bp.Earth(jn,{showRealSunlight:jn.config.showRealSunlight,showMilkyway:jn.config.showMilkyway,earthBackground:jn.config.earthBackground});jn._proxyEarthEvents();jn._changeEarthMapType(BMAP_EARTH_MAP);ey.extend(jn,bp.EarthView.prototype);delete jn.temp.originMapType}gs.load("earth",function(){if(bp["FeatureStyle"+jn.config.style]){jo()}else{jn.loadMapStyleFiles(function(){jo()})}})}}this.lastLevel=this.zoomLevel||jp;this.zoomLevel=jp;var jm=new ff("onload");jm.point=T;jm.zoom=jp;this.centerPoint=new cg(T.lng,T.lat);this.defaultZoomLevel=this.defaultZoomLevel||this.zoomLevel;this.defaultCenter=this.defaultCenter||this.centerPoint;if(this.mapType!==BMAP_EARTH_MAP){this.centerPoint=this.restrictCenter(this.centerPoint)}if(!this.loaded&&!(this.temp.originMapType===BMAP_EARTH_MAP)){var i=this.config.defaultMaxBounds;var jk=new h(i,"baidu",this.mapType);if(this.mapType!==BMAP_NONE_MAP){var jj=new gS({mapType:this.mapType,copyright:jk,dataType:this.mapType===BMAP_SATELLITE_MAP?f8:g3,customLayer:this.mapType===BMAP_SATELLITE_MAP,baseLayer:true,transparentPng:true,tileTypeName:this.mapType===BMAP_SATELLITE_MAP?"web":"na"});jj._isInnerLayer=true;this.addTileLayer(jj);this.baseLayerAdded=true}if(this.mapType===BMAP_SATELLITE_MAP&&this._isHybridShow===true){this._addHybirdMap()}this.on("zoom_changed",function(){if(this._heading===0){return}if(this.getZoom()<7&&this.config.restrictCenter===true){jn.resetHeading()}})}this.loaded=true;this.dispatchEvent(jm);jq.callback&&jq.callback()},_ifUseAnimation:function(jj,jo){var jn=this.getSize();var T={zoom:this.zoomLevel};var jq={zoom:jo};var jp=this.pointToPixelIn(this.centerPoint);var jk=this.pointToPixelIn(jj,T);var jm=this.pointToPixelIn(this.centerPoint,jq);var js=this.pointToPixelIn(jj,jq);var jl=Math.abs(jp.x-jk.x);var i=Math.abs(jp.y-jk.y);var e=Math.abs(jm.x-js.x);var jr=Math.abs(jm.y-js.y);if((jl>jn.width||i>jn.height)&&(e>jn.width||jr>jn.height)){return false}return true},_setPlatformPosition:function(jq,jp,js){js=js||{};if(jq===0&&jp===0&&!js.point){return}if(isNaN(js.initMapOffsetX)){js.initMapOffsetX=this.offsetX}if(isNaN(js.initMapOffsetY)){js.initMapOffsetY=this.offsetY}var jm=hR(this._heading);if(this._tilt>0){jp=jp/Math.cos(hR(this._tilt))}var jr=jq*Math.cos(jm)+jp*Math.sin(jm);var jo=-jq*Math.sin(jm)+jp*Math.cos(jm);jr=jr+js.initMapOffsetX;jo=jo+js.initMapOffsetY;if(js.point){var i=this.restrictCenter(js.point);if(!i.equals(this.centerPoint)){this.centerPoint=i.clone();this.fire(new ff("oncenter_changed"))}}else{var jj=this.offsetX-jr;var e=this.offsetY-jo;var jn=this.centerPoint.lng;var jl=this.centerPoint.lat;var jk=new cg(jn,jl);var T=this.getZoomUnits();this.centerPoint=this.restrictCenter(new cg(jk.lng+jj*T,jk.lat-e*T),T);this.fire(new ff("oncenter_changed"))}this.offsetX=jr;this.offsetY=jo;this.dispatchEvent(new ff("onmoving"))},restrictCenter:function(jr,e){if(this.config.restrictCenter===false){return jr}e=e||this.getZoomUnits();var jp=this.pixelToPointIn(new eS(this.width,0),{center:jr});var jm=this.pixelToPointIn(new eS(0,this.height),{center:jr});var js=jr.lng;var jx=jr.lat;if(this.config.restrictBounds!==null&&!this.config.restrictBounds.isEmpty()){var jw=this.config.restrictBounds;var T=jw.getSouthWest();var ju=jw.getNorthEast();var jq=il.convertLL2MC(T);var jk=il.convertLL2MC(ju);var jn=this.calcNewZoomByRestriction(js,jx,jm,jp,jq.lng,jk.lng,jq.lat,jk.lat);if(jn>this.zoomLevel){this.zoomLevel=jn;return jr}jr.lng=this.calcNewLngByBounds(js,jm,jp,jq.lng,jk.lng,e);jr.lat=this.calcNewLatByBounds(jx,jm,jp,jq.lat,jk.lat,e);return jr}var jo=this.pixelToPointIn(new eS(0,0),{center:jr});var jj=this.pixelToPointIn(new eS(0,this.height),{center:jr});if(this.zoomLevel<5){if(jo.lat>g5.MAX_LAT&&jj.lat<g5.MIN_LAT){var i=g5.MAX_LAT-jr.lat;var jl=jr.lat-g5.MIN_LAT;var jv;if(i<jl){jv=i/(this.height/2)}else{jv=jl/(this.height/2)}var jt=18-m(jv);this.zoomLevel=jt;return jr}}if(jo.lat>g5.MAX_LAT){jr.lat=g5.MAX_LAT-this.height/2*e}else{if(jj.lat<g5.MIN_LAT){jr.lat=g5.MIN_LAT+this.height/2*e}}return jr},calcNewZoomByRestriction:function(jq,jp,e,jo,jk,jm,jj,jl){var jt=0;var ju=0;if(typeof jj==="number"&&typeof jl==="number"&&jo.lat>jl&&e.lat<jj){var T=jl-jp;var i=jp-jj;var jn;if(T<i){jn=T/(this.height/2)}else{jn=i/(this.height/2)}jt=18-m(jn)}if(typeof jk==="number"&&typeof jm==="number"&&jo.lng>jm&&e.lng<jk){var js=jm-jq;var jr=jq-jk;var jn;if(js<jr){jn=js/(this.width/2)}else{jn=jr/(this.width/2)}ju=18-m(jn)}return Math.max(jt,ju)||this.zoomLevel},calcNewLatByBounds:function(i,jj,T,jm,jl,e){var jk=i;if(T.lat>jl){jk=jl-this.height/2*e}else{if(jj.lat<jm){jk=jm+this.height/2*e}}return jk},calcNewLngByBounds:function(jm,jl,jj,jk,T,e){var i=jm;if(jj.lng>T){i=T-this.width/2*e}else{if(jl.lng<jk){i=jk+this.width/2*e}}return i},zoomTo:function(e,ju,jv){var jq=dU[this.mapType];if(!jq){return}var jp=this._getProperZoom(e);e=jp.zoom;if(this.zoomLevel===e){jv&&jv.callback&&jv.callback();return}var jl=e;this.lastLevel=this.zoomLevel;jv=jv||{};if(this.zoomEventStatus==="idle"){this.fire(new ff("onzoomstart"));this.zoomEventStatus="zooming"}if(!ju&&(this.getInfoWindow()&&this.temp.infoWin&&this.temp.infoWin.isOpen())){ju=il.convertLL2MC(this.getInfoWindow().getPoint())}var T=null;if(jv.fixPixel){T=jv.fixPixel}else{if(ju){T=this.pointToPixelIn(ju,{useRound:false})}}var jm=this.pixelToPointIn(T);var jn=this.centerPoint.clone();this.fixPoint=ju;this.fixPixel=T;this.fixCenter=jn;this.mousePosMCPoint=jm;if(jv.noAnimation){e=jp.zoom;this.zoomLevel=e;this.fire(new ff("onzoom_changed"));var jk=this.getCurrentMaxTilt();if(this._tilt>jk){this._tilt=jk}if(ju){if(this._heading%360!==0||this._tilt>0){var i=this._webglMapCamera.fromScreenPixelToMC(T.x,T.y,{center:jn,zoom:this.zoomLevel});if(i){var jr=i.sub(jm);var jj=jn.sub(jr);this.centerPoint=this.restrictCenter(jj)}}else{var jo=this.getZoomUnits();var jj=new cg(ju.lng-jo*(T.x-this.width/2),ju.lat+jo*(T.y-this.height/2));this.centerPoint=this.restrictCenter(jj,jo)}this.fire(new ff("oncenter_changed"))}this._checkFireZoomend();jv.callback&&jv.callback();return}this._animationInfo.zoom={current:this.zoomLevel,diff:e-this.zoomLevel,target:e};var js=this;js._checkFireZoomend();var jt=this._tilt;if(this.fixPoint||jt>g5.MAX_DRAG_TILT_L2){jv.renderCallback=function(){var jz=js.getCurrentMaxTilt();if(js._tilt>jz){js._tilt=jz}var jA=js.fixPixel;if(!js.fixPixel||!js.fixPoint){return}var jw=js.fixPixel;var jG=js.fixPoint;var jD=js.fixCenter;var jB=js.mousePosMCPoint;if(js._heading%360!==0||js._tilt>0){var jx=js._webglMapCamera.fromScreenPixelToMC(jw.x,jw.y,{center:jD,zoom:js.zoomLevel,tilt:js._tilt});if(jx){var jF=jx.sub(jB);var jy=jD.sub(jF);js.centerPoint=js.restrictCenter(jy)}}else{var jC=jw;var jE=js.getZoomUnits();var jy=new cg(jG.lng-jE*(jC.x-js.width/2),jG.lat+jE*(jC.y-js.height/2));js.centerPoint=js.restrictCenter(jy,jE)}js.fire(new ff("oncenter_changed"))}}if(jv.fromMouseWheel===true){this._startInfiniteZoomAnimation(jv);jv.callback&&jv.callback();return}this._startAnimation(jv)},_checkFireZoomend:function(){var e=this;if(e.fireZoomendTimer){clearTimeout(e.fireZoomendTimer)}e.fireZoomendTimer=setTimeout(function(){if(e.zoomEventStatus==="zooming"){e.fire(new ff("onzoomend"));e.zoomEventStatus="idle"}e.fireZoomendTimer=null},150)},deepZoomMedia:function(e){var i=this;if(!i.temp.isStdCtrlBusy){i.temp.isStdCtrlBusy=true;i.deepZoomTo(i.zoomLevel+e);setTimeout(function(){i.temp.isStdCtrlBusy=false},400)}},deepZoomTo:function(e){this.zoomTo(e)},flyToIn:function(T,jN,jy){jy=jy||{};var jk=this._getProperZoom(jN);jN=jk.zoom;if(this.centerPoint.equals(T)&&this.zoomLevel===jN&&typeof jy.heading!=="number"&&typeof jy.tilt!=="number"){return}var e=this.getHeading()%360;var jq=this.getTilt();var jw=0;var jA=0;var jt=this.getBounds().containsPoint(T);if(typeof jy.heading==="number"){jw=jy.heading}else{if(jt){jw=e}}if(typeof jy.tilt==="number"){jA=jy.tilt}else{if(jt){jA=jq}}this._heading=e;var jK=jw-e;var jG=jA-jq;var ju=this;var jm=this.zoomLevel;var jn=1.42;var jC=this.zoomScale(jN-jm);var jP=this.getZoomUnits();var js=this.centerPoint.div(jP);var jQ=T.div(jP);var jJ=this.worldSize();var jF=jn;var jE=Math.max(this.width,this.height);var jD=jE/jC;var jr=jQ.sub(js).mag();var i=jF*jF;function jM(jS){var jR=(jD*jD-jE*jE+(jS?-1:1)*i*i*jr*jr)/(2*(jS?jD:jE)*i*jr);return Math.log(Math.sqrt(jR*jR+1)-jR)}function jj(jR){return(Math.exp(jR)-Math.exp(-jR))/2}function jo(jR){return(Math.exp(jR)+Math.exp(-jR))/2}function jx(jR){return jj(jR)/jo(jR)}var jp=jM(0);var jH=function(jR){return(jo(jp)/jo(jp+jF*jR))};var jI=function(jR){return jE*((jo(jp)*jx(jp+jF*jR)-jj(jp))/i)/jr};var jl=(jM(1)-jp)/jF;if(Math.abs(jr)<0.000001||jl===Infinity||isNaN(jl)){if(Math.abs(jE-jD)<0.000001){this._animationInfo.zoom={current:this.zoomLevel,diff:jN-this.zoomLevel};this._animationInfo.center={current:this.centerPoint,diff:T.sub(this.centerPoint)};this._animationInfo.heading={current:e,diff:jw-e};this._animationInfo.tilt={current:jq,diff:jA-jq};this.setLock(true);this._startAnimation({callback:function(jR){ju.setLock(false);if(jy.callback){jy.callback(jR)}},duration:jy.duration});return}var jO=jD<jE?-1:1;jl=Math.abs(Math.log(jD/jE))/jF;jI=function(){return 0};jH=function(jR){return Math.exp(jO*jF*jR)}}var jL=1.7;if(jl<0.3){jL=0.8}else{if(jl>5){jL=(jl-5)/2+jL}}var jz=jy.duration||1000*jl/jL;if(isNaN(jz)){var jB={};for(var jv in jy){jB[jv]=jy[jv];jB.noAnimation=true}this.centerAndZoomIn(T,jN,jB);return}this.fire(new ff("onmovestart"));this.fire(new ff("onzoomstart"));this.setLock(true);this._startAnimation({duration:jz,renderCallback:function(jR,jS){var jT=jR*jl;var jW=jI(jT);var jV=jm+ju.scaleZoom(1/jH(jT));if(jV<ju.getMinZoom()){jV=ju.getMinZoom()}if(jV>ju.getMaxZoom()){jV=ju.getMaxZoom()}if(jV!==ju.zoomLevel){ju.zoomLevel=jV;ju.fire(new ff("onzoom_changed"))}ju.centerPoint=js.add(jQ.sub(js).mult(jW)).mult(jP);ju.fire(new ff("oncenter_changed"));if(typeof jw==="number"){var jU=jR/0.7;if(jU>1){jU=1}ju.setHeading(e+jK*jR,{noAnimation:true})}if(typeof jA==="number"){ju.setTilt(jq+jG*jR,{noAnimation:true})}},callback:function(jR,jS){ju.setLock(false);if(jS&&jS.stop===true){ju.fire(new ff("onmoveend"));ju.fire(new ff("onzoomend"));jy.callback&&jy.callback(jR);return}if(jN!==ju.zoomLevel){ju.zoomLevel=jN;ju.fire(new ff("onzoom_changed"))}ju.fire(new ff("onmoveend"));ju.fire(new ff("onzoomend"));jy.callback&&jy.callback(jR)}})},zoomScale:function(e){return Math.pow(2,e)},scaleZoom:function(e){return Math.log(e)/Math.LN2},panToIn:function(i,T){T=T||{};if(!i||i.equals(this.centerPoint)){T.callback&&T.callback();return}var jj=this.pointToPixelIn(i);var e=Math.round(this.width/2);var jl=Math.round(this.height/2);var jk=this._ifUseAnimation(i,this.zoomLevel);if(T.noAnimation===true||jk===false){this._stopAllAnimations();this._panToIn(e-jj.x,jl-jj.y,i);T.callback&&T.callback();return}this.flyToIn(i,this.zoomLevel,T)},_panToIn:function(i,e,jj){var T=this.temp;if(T.operating===true){return}if(T.dragAni){T.dragAni.stop(false,{readyToMove:true});T.dragAni=null}this.dispatchEvent(new ff("onmovestart"));this._setPlatformPosition(i,e,{point:jj});this.dispatchEvent(new ff("onmoveend"))},_stopAllAnimations:function(e){e=e||{};if(this._ani){this._ani.stop(!!e.goToEnd,{stopCurrentAnimation:e.stopCurrentAnimation});this._ani=null}if(this._infiniteAni){this._infiniteAni.stop();this._infiniteAni=null}},panBy:function(i,e,T){i=Math.round(i)||0;e=Math.round(e)||0;T=T||{};if(Math.abs(i)<=this.width&&Math.abs(e)<=this.height&&T.noAnimation!==true){this._panBy(i,e,T)}else{this._panToIn(i,e,T.point);T.callback&&T.callback()}},_panBy:function(i,e,jk){if(this.temp.operating===true){return}jk=jk||{};this.dispatchEvent(new ff("onmovestart"));var jj=this;var T=jj.temp;T.pl=jj.offsetX;T.pt=jj.offsetY;if(T.tlPan){T.tlPan.cancel()}if(T.dragAni){T.dragAni.stop(false,{readyToMove:true});T.dragAni=null}T.tlPan=new e8({fps:jk.fps||jj.config.fps,duration:jk.duration||jj.config.actionDuration,transition:jk.transition||f3.easeInOutQuad,render:function(jl){this.terminative=jj.temp.operating;if(jj.temp.operating){return}jj._setPlatformPosition(i*jl,e*jl,{initMapOffsetX:T.pl,initMapOffsetY:T.pt})},finish:function(jl){jj.dispatchEvent(new ff("onmoveend"));jj.temp.tlPan=false;if(jj.temp.stopArrow===true){jj.temp.stopArrow=false;if(jj.temp.arrow!==0){jj._arrow()}}}})},_startAnimation:function(i){var jk=this._animationInfo;var T=this;i=i||{};if(T._ani){T._ani.stop(!!i.goToEnd,{stopCurrentAnimation:i.stopCurrentAnimation})}if(T._infiniteAni){T._infiniteAni.stop();T._infiniteAni=null}var jl=i.duration||500;var jm=i.transition||f3.ease;var e=new ff("onanimation_start");this.fire(e);if(i.unstopable){jk=this._animationInfoUnstopable}var jj=new e8({duration:jl,transition:jm,render:function(jp,jo){for(var jn in jk){if(!jk.hasOwnProperty(jn)){continue}var jr=jk[jn].current;var jq=jk[jn].diff;T._setValueTick(jn,jr,jq,jp)}if(i.renderCallback){i.renderCallback(jp,jo)}},finish:function(jn){T.fire(new ff("onanimation_end"));if(i.unstopable){T._animationInfoUnstopable={};T._unstopableAni=null}else{T._ani=null;T._animationInfo={}}if(i.mapNeedCbk){i.mapNeedCbk()}if(i.callback){i.callback(jn)}},onStop:function(jn){jn=jn||{};T.fire(new ff("onanimation_end"));if(jn.stopCurrentAnimation){T._animationInfo={}}T._ani=null;if(i.mapNeedCbk){i.mapNeedCbk()}if(i.callback){i.callback(null,{stop:true})}}});if(i.unstopable){T._unstopableAni=jj}else{T._ani=jj}},_startInfiniteZoomAnimation:function(e){var i=this;if(i._ani){i._ani.stop(!!e.goToEnd,{stopCurrentAnimation:e.stopCurrentAnimation})}if(i._infiniteAni){return}this.fire(new ff("onanimation_start"));i._infiniteAni=new e8({duration:10000,transition:f3.linear,render:function(){var T=i._animationInfo.zoom;if(Math.abs(T.current-T.target)<0.001){i._setValue("zoom",T.target);i._infiniteAni.stop();return}T.current+=(T.target-T.current)*0.35;i._setValue("zoom",T.current);if(e.renderCallback){e.renderCallback()}},finish:function(){i._infiniteAni=null;i._animationInfo={};i.fire(new ff("onanimation_end"));if(e.callback){e.callback()}},onStop:function(){i._infiniteAni=null;i._animationInfo={};i.fire(new ff("onanimation_end"));if(e.callback){e.callback()}}})},_setValue:function(e,T){if(e==="zoom"){this._preZoomLevel=this.zoomLevel;var i=this._getProperZoom(T);T=i.zoom;if(T!==this.zoomLevel){this.zoomLevel=T;if(T<5){this.restrictCenter(this.centerPoint)}this.fire(new ff("on"+e+"_changed"))}return}else{if(e==="center"){this.centerPoint=T}}this["_"+e]=T;this.fire(new ff("on"+e+"_changed"))},_setValueTick:function(e,jk,jj,i){if(e==="center"){var T=new cg(jk.lng+jj.lng*i,jk.lat+jj.lat*i);this._setValue(e,T);return}if(e==="zoom"){this._setValue(e,Math.pow(jk,1-i)*Math.pow(jk+jj,i));return}this._setValue(e,jk+jj*i)},setHeading:function(jj,i){i=i||{};if(jj===this._heading){i.callback&&i.callback();return}var T=dP(this._heading,360);var e=dP(jj,360);if(e===T){this._heading=jj;i.callback&&i.callback();return}if(i.noAnimation){this._setValue("heading",jj);i.callback&&i.callback();return}if(i.unstopable){this._animationInfoUnstopable.heading={current:this._heading,diff:jj-this._heading}}else{this._animationInfo.heading={current:this._heading,diff:jj-this._heading}}this._startAnimation(i)},resetHeading:function(e){var i=this._heading;while(i<0){i+=360}i=i%360;if(i>180){i-=360}this._heading=i;e=e||{};e.unstopable=true;this.setHeading(0,e)},getHeading:function(){return this._heading},setTilt:function(e,i){i=i||{};if(e===this._tilt){i.callback&&i.callback();return}if(e>g5.MAX_TILT){e=g5.MAX_TILT}if(e<g5.MIN_TILT){e=g5.MIN_TILT}if(i&&i.noAnimation){this._setValue("tilt",e);i.callback&&i.callback();return}this._animationInfo.tilt={current:this._tilt,diff:e-this._tilt};this._startAnimation(i)},getTilt:function(){return this._tilt},getCenterIn:function(){return this.centerPoint},getZoom:function(){return this.zoomLevel},getCameraPosition:function(T){T=T||{};var e=T.center||this.centerPoint;var jj=T.zoom||this.zoomLevel;var jm=typeof T.heading==="number"?T.heading:this._heading;var i=typeof T.tilt==="number"?T.tilt:this._tilt;var jl=this._webglMapCamera.generateMVMatrix(e,jj,jm,i);var jk=mat4.create(Float32Array);mat4.invert(jk,jl);return this._webglMapCamera.getPosition(jk)}});function bb(i){this._jobQueue=[];this._idleOnlyJobQueue=[];var e=this;this.isIdle=true;i.on("updateframe",function(jj){var T=12-jj.frameTime;T=T<1?1:T;e.isIdle=false;if(e.idleWorkTimer){clearInterval(e.idleWorkTimer);e.idleWorkTimer=null}e.runJobs(T)});this._idleWorkerTicker=(function(T){return function(){if(T.isIdle){T.runJobs();T.runIdleOnlyJobs()}}})(this);i.on("mapglidle",function(){e.isIdle=true;e.runJobs();e.runIdleOnlyJobs();e.idleWorkTimer=setInterval(e._idleWorkerTicker,bb.MAX_IDLE_TIME)})}bb.MAX_IDLE_TIME=50;bb.MAX_FRAME_TIME=6;bb.prototype.runJobs=function(i){if(this._jobQueue.length===0){return}var jj=hv();var e=0;i=i||bb.MAX_FRAME_TIME;while(this._jobQueue.length&&e<i){var T=this._jobQueue.shift();if(T.state!=="invalid"){T.call()}e=hv()-jj}};bb.prototype.runIdleOnlyJobs=function(){if(this._idleOnlyJobQueue.length===0){return}var T=hv();var e=0;while(this._idleOnlyJobQueue.length&&e<bb.MAX_IDLE_TIME){var i=this._idleOnlyJobQueue.shift();if(i.state!=="invalid"){i.call()}e=hv()-T}};bb.prototype.checkIdleRunning=function(){if(this.isIdle&&!this.idleWorkTimer){this.runJobs();this.runIdleOnlyJobs();this.idleWorkTimer=setInterval(this._idleWorkerTicker,50)}};bb.prototype.addJob=function(e){this._jobQueue.push(e);this.checkIdleRunning()};bb.prototype.clearJobs=function(){this._jobQueue.length=0;this._idleOnlyJobQueue.length=0};bb.prototype.addIdleOnlyJob=function(e){this._idleOnlyJobQueue.push(e);this.checkIdleRunning()};var dw={};(function(jm){if(!jq){var jq=0.000001}if(!i){var i=(typeof Float32Array!=="undefined")?Float32Array:Array}if(!jk){var jk=Math.random}var T={};var jl=Math.PI/180;T.toRadian=function(jr){return jr*jl};var jp={};jp.create=function(js){js=js||i;var jr=new js(2);jr[0]=0;jr[1]=0;return jr};jp.clone=function(jr,jt){jt=jt||i;var js=new jt(2);js[0]=jr[0];js[1]=jr[1];return js};jp.fromValues=function(jr,ju,jt){jt=jt||i;var js=new jt(2);js[0]=jr;js[1]=ju;return js};jp.copy=function(js,jr){js[0]=jr[0];js[1]=jr[1];return js};jp.set=function(js,jr,jt){js[0]=jr;js[1]=jt;return js};jp.add=function(jt,js,jr){jt[0]=js[0]+jr[0];jt[1]=js[1]+jr[1];return jt};jp.subtract=function(jt,js,jr){jt[0]=js[0]-jr[0];jt[1]=js[1]-jr[1];return jt};jp.sub=jp.subtract;jp.multiply=function(jt,js,jr){jt[0]=js[0]*jr[0];jt[1]=js[1]*jr[1];return jt};jp.mul=jp.multiply;jp.divide=function(jt,js,jr){jt[0]=js[0]/jr[0];jt[1]=js[1]/jr[1];return jt};jp.div=jp.divide;jp.min=function(jt,js,jr){jt[0]=Math.min(js[0],jr[0]);jt[1]=Math.min(js[1],jr[1]);return jt};jp.max=function(jt,js,jr){jt[0]=Math.max(js[0],jr[0]);jt[1]=Math.max(js[1],jr[1]);return jt};jp.scale=function(jt,js,jr){jt[0]=js[0]*jr;jt[1]=js[1]*jr;return jt};jp.scaleAndAdd=function(jt,js,jr,ju){jt[0]=js[0]+(jr[0]*ju);jt[1]=js[1]+(jr[1]*ju);return jt};jp.distance=function(jt,js){var jr=js[0]-jt[0],ju=js[1]-jt[1];return Math.sqrt(jr*jr+ju*ju)};jp.dist=jp.distance;jp.squaredDistance=function(jt,js){var jr=js[0]-jt[0],ju=js[1]-jt[1];return jr*jr+ju*ju};jp.sqrDist=jp.squaredDistance;jp.length=function(js){var jr=js[0],jt=js[1];return Math.sqrt(jr*jr+jt*jt)};jp.len=jp.length;jp.squaredLength=function(js){var jr=js[0],jt=js[1];return jr*jr+jt*jt};jp.sqrLen=jp.squaredLength;jp.negate=function(js,jr){js[0]=-jr[0];js[1]=-jr[1];return js};jp.normalize=function(ju,jt){var js=jt[0],jv=jt[1];var jr=js*js+jv*jv;if(jr>0){jr=1/Math.sqrt(jr);ju[0]=jt[0]*jr;ju[1]=jt[1]*jr}return ju};jp.dot=function(js,jr){return js[0]*jr[0]+js[1]*jr[1]};jp.cross=function(jt,js,jr){var ju=js[0]*jr[1]-js[1]*jr[0];jt[0]=jt[1]=0;jt[2]=ju;return jt};jp.lerp=function(jt,js,jr,ju){var jw=js[0],jv=js[1];jt[0]=jw+ju*(jr[0]-jw);jt[1]=jv+ju*(jr[1]-jv);return jt};jp.random=function(jr,jt){jt=jt||1;var js=jk()*2*Math.PI;jr[0]=Math.cos(js)*jt;jr[1]=Math.sin(js)*jt;return jr};jp.transformMat2=function(ju,jt,js){var jr=jt[0],jv=jt[1];ju[0]=js[0]*jr+js[2]*jv;ju[1]=js[1]*jr+js[3]*jv;return ju};jp.transformMat2d=function(ju,jt,js){var jr=jt[0],jv=jt[1];ju[0]=js[0]*jr+js[2]*jv+js[4];ju[1]=js[1]*jr+js[3]*jv+js[5];return ju};jp.transformMat3=function(ju,jt,js){var jr=jt[0],jv=jt[1];ju[0]=js[0]*jr+js[3]*jv+js[6];ju[1]=js[1]*jr+js[4]*jv+js[7];return ju};jp.transformMat4=function(ju,jt,js){var jr=jt[0],jv=jt[1];ju[0]=js[0]*jr+js[4]*jv+js[12];ju[1]=js[1]*jr+js[5]*jv+js[13];return ju};jp.rotate=function(ju,js,jr,jy){var jx=js[0]-jr[0];var jw=js[1]-jr[1];var jt=Math.sin(jy);var jv=Math.cos(jy);ju[0]=jx*jv-jw*jt+jr[0];ju[1]=jx*jt+jw*jv+jr[1];return ju};jp.forEach=(function(){var jr=jp.create();return function(ju,jy,jz,jx,jw,js){var jv,jt;if(!jy){jy=2}if(!jz){jz=0}if(jx){jt=Math.min((jx*jy)+jz,ju.length)}else{jt=ju.length}for(jv=jz;jv<jt;jv+=jy){jr[0]=ju[jv];jr[1]=ju[jv+1];jw(jr,jr,js);ju[jv]=jr[0];ju[jv+1]=jr[1]}return ju}})();jp.str=function(jr){return"vec2("+jr[0]+", "+jr[1]+")"};jm.vec2=jp;var jo={};jo.create=function(js){js=js||i;var jr=new js(3);jr[0]=0;jr[1]=0;jr[2]=0;return jr};jo.clone=function(jr,jt){jt=jt||i;var js=new jt(3);js[0]=jr[0];js[1]=jr[1];js[2]=jr[2];return js};jo.fromValues=function(jr,jv,jt,ju){ju=ju||i;var js=new ju(3);js[0]=jr;js[1]=jv;js[2]=jt;return js};jo.copy=function(js,jr){js[0]=jr[0];js[1]=jr[1];js[2]=jr[2];return js};jo.set=function(js,jr,ju,jt){js[0]=jr;js[1]=ju;js[2]=jt;return js};jo.add=function(jt,js,jr){jt[0]=js[0]+jr[0];jt[1]=js[1]+jr[1];jt[2]=js[2]+jr[2];return jt};jo.subtract=function(jt,js,jr){jt[0]=js[0]-jr[0];jt[1]=js[1]-jr[1];jt[2]=js[2]-jr[2];return jt};jo.sub=jo.subtract;jo.multiply=function(jt,js,jr){jt[0]=js[0]*jr[0];jt[1]=js[1]*jr[1];jt[2]=js[2]*jr[2];return jt};jo.mul=jo.multiply;jo.divide=function(jt,js,jr){jt[0]=js[0]/jr[0];jt[1]=js[1]/jr[1];jt[2]=js[2]/jr[2];return jt};jo.div=jo.divide;jo.min=function(jt,js,jr){jt[0]=Math.min(js[0],jr[0]);jt[1]=Math.min(js[1],jr[1]);jt[2]=Math.min(js[2],jr[2]);return jt};jo.max=function(jt,js,jr){jt[0]=Math.max(js[0],jr[0]);jt[1]=Math.max(js[1],jr[1]);jt[2]=Math.max(js[2],jr[2]);return jt};jo.scale=function(jt,js,jr){jt[0]=js[0]*jr;jt[1]=js[1]*jr;jt[2]=js[2]*jr;return jt};jo.scaleAndAdd=function(jt,js,jr,ju){jt[0]=js[0]+(jr[0]*ju);jt[1]=js[1]+(jr[1]*ju);jt[2]=js[2]+(jr[2]*ju);return jt};jo.distance=function(jt,js){var jr=js[0]-jt[0],jv=js[1]-jt[1],ju=js[2]-jt[2];return Math.sqrt(jr*jr+jv*jv+ju*ju)};jo.dist=jo.distance;jo.squaredDistance=function(jt,js){var jr=js[0]-jt[0],jv=js[1]-jt[1],ju=js[2]-jt[2];return jr*jr+jv*jv+ju*ju};jo.sqrDist=jo.squaredDistance;jo.length=function(js){var jr=js[0],ju=js[1],jt=js[2];return Math.sqrt(jr*jr+ju*ju+jt*jt)};jo.len=jo.length;jo.squaredLength=function(js){var jr=js[0],ju=js[1],jt=js[2];return jr*jr+ju*ju+jt*jt};jo.sqrLen=jo.squaredLength;jo.negate=function(js,jr){js[0]=-jr[0];js[1]=-jr[1];js[2]=-jr[2];return js};jo.normalize=function(ju,jt){var js=jt[0],jw=jt[1],jv=jt[2];var jr=js*js+jw*jw+jv*jv;if(jr>0){jr=1/Math.sqrt(jr);ju[0]=jt[0]*jr;ju[1]=jt[1]*jr;ju[2]=jt[2]*jr}return ju};jo.dot=function(js,jr){return js[0]*jr[0]+js[1]*jr[1]+js[2]*jr[2]};jo.cross=function(js,jx,jw){var jr=jx[0],jz=jx[1],jy=jx[2],jv=jw[0],ju=jw[1],jt=jw[2];js[0]=jz*jt-jy*ju;js[1]=jy*jv-jr*jt;js[2]=jr*ju-jz*jv;return js};jo.lerp=function(jt,js,jr,ju){var jx=js[0],jw=js[1],jv=js[2];jt[0]=jx+ju*(jr[0]-jx);jt[1]=jw+ju*(jr[1]-jw);jt[2]=jv+ju*(jr[2]-jv);return jt};jo.random=function(jr,jv){jv=jv||1;var jt=jk()*2*Math.PI;var ju=(jk()*2)-1;var js=Math.sqrt(1-ju*ju)*jv;jr[0]=Math.cos(jt)*js;jr[1]=Math.sin(jt)*js;jr[2]=ju*jv;return jr};jo.transformMat4=function(ju,jt,js){var jr=jt[0],jw=jt[1],jv=jt[2];ju[0]=js[0]*jr+js[4]*jw+js[8]*jv+js[12];ju[1]=js[1]*jr+js[5]*jw+js[9]*jv+js[13];ju[2]=js[2]*jr+js[6]*jw+js[10]*jv+js[14];return ju};jo.transformMat3=function(ju,jt,js){var jr=jt[0],jw=jt[1],jv=jt[2];ju[0]=jr*js[0]+jw*js[3]+jv*js[6];ju[1]=jr*js[1]+jw*js[4]+jv*js[7];ju[2]=jr*js[2]+jw*js[5]+jv*js[8];return ju};jo.transformQuat=function(jx,jD,jr){var jE=jD[0],jC=jD[1],jB=jD[2],jz=jr[0],jy=jr[1],jw=jr[2],jA=jr[3],ju=jA*jE+jy*jB-jw*jC,jt=jA*jC+jw*jE-jz*jB,js=jA*jB+jz*jC-jy*jE,jv=-jz*jE-jy*jC-jw*jB;jx[0]=ju*jA+jv*-jz+jt*-jw-js*-jy;jx[1]=jt*jA+jv*-jy+js*-jz-ju*-jw;jx[2]=js*jA+jv*-jw+ju*-jy-jt*-jz;return jx};jo.rotateX=function(jt,js,jr,jw){var jv=[],ju=[];jv[0]=js[0]-jr[0];jv[1]=js[1]-jr[1];jv[2]=js[2]-jr[2];ju[0]=jv[0];ju[1]=jv[1]*Math.cos(jw)-jv[2]*Math.sin(jw);ju[2]=jv[1]*Math.sin(jw)+jv[2]*Math.cos(jw);jt[0]=ju[0]+jr[0];jt[1]=ju[1]+jr[1];jt[2]=ju[2]+jr[2];return jt};jo.rotateY=function(jt,js,jr,jw){var jv=[],ju=[];jv[0]=js[0]-jr[0];jv[1]=js[1]-jr[1];jv[2]=js[2]-jr[2];ju[0]=jv[2]*Math.sin(jw)+jv[0]*Math.cos(jw);ju[1]=jv[1];ju[2]=jv[2]*Math.cos(jw)-jv[0]*Math.sin(jw);jt[0]=ju[0]+jr[0];jt[1]=ju[1]+jr[1];jt[2]=ju[2]+jr[2];return jt};jo.rotateZ=function(jt,js,jr,jw){var jv=[],ju=[];jv[0]=js[0]-jr[0];jv[1]=js[1]-jr[1];jv[2]=js[2]-jr[2];ju[0]=jv[0]*Math.cos(jw)-jv[1]*Math.sin(jw);ju[1]=jv[0]*Math.sin(jw)+jv[1]*Math.cos(jw);ju[2]=jv[2];jt[0]=ju[0]+jr[0];jt[1]=ju[1]+jr[1];jt[2]=ju[2]+jr[2];return jt};jo.forEach=(function(){var jr=jo.create();return function(ju,jy,jz,jx,jw,js){var jv,jt;if(!jy){jy=3}if(!jz){jz=0}if(jx){jt=Math.min((jx*jy)+jz,ju.length)}else{jt=ju.length}for(jv=jz;jv<jt;jv+=jy){jr[0]=ju[jv];jr[1]=ju[jv+1];jr[2]=ju[jv+2];jw(jr,jr,js);ju[jv]=jr[0];ju[jv+1]=jr[1];ju[jv+2]=jr[2]}return ju}})();jo.str=function(jr){return"vec3("+jr[0]+", "+jr[1]+", "+jr[2]+")"};jm.vec3=jo;var jn={};jn.create=function(js){js=js||i;var jr=new js(4);jr[0]=0;jr[1]=0;jr[2]=0;jr[3]=0;return jr};jn.clone=function(jr,jt){jt=jt||i;var js=new jt(4);js[0]=jr[0];js[1]=jr[1];js[2]=jr[2];js[3]=jr[3];return js};jn.fromValues=function(jr,jw,ju,js,jv){jv=jv||i;var jt=new jv(4);jt[0]=jr;jt[1]=jw;jt[2]=ju;jt[3]=js;return jt};jn.copy=function(js,jr){js[0]=jr[0];js[1]=jr[1];js[2]=jr[2];js[3]=jr[3];return js};jn.set=function(jt,jr,jv,ju,js){jt[0]=jr;jt[1]=jv;jt[2]=ju;jt[3]=js;return jt};jn.add=function(jt,js,jr){jt[0]=js[0]+jr[0];jt[1]=js[1]+jr[1];jt[2]=js[2]+jr[2];jt[3]=js[3]+jr[3];return jt};jn.subtract=function(jt,js,jr){jt[0]=js[0]-jr[0];jt[1]=js[1]-jr[1];jt[2]=js[2]-jr[2];jt[3]=js[3]-jr[3];return jt};jn.sub=jn.subtract;jn.multiply=function(jt,js,jr){jt[0]=js[0]*jr[0];jt[1]=js[1]*jr[1];jt[2]=js[2]*jr[2];jt[3]=js[3]*jr[3];return jt};jn.mul=jn.multiply;jn.divide=function(jt,js,jr){jt[0]=js[0]/jr[0];jt[1]=js[1]/jr[1];jt[2]=js[2]/jr[2];jt[3]=js[3]/jr[3];return jt};jn.div=jn.divide;jn.min=function(jt,js,jr){jt[0]=Math.min(js[0],jr[0]);jt[1]=Math.min(js[1],jr[1]);jt[2]=Math.min(js[2],jr[2]);jt[3]=Math.min(js[3],jr[3]);return jt};jn.max=function(jt,js,jr){jt[0]=Math.max(js[0],jr[0]);jt[1]=Math.max(js[1],jr[1]);jt[2]=Math.max(js[2],jr[2]);jt[3]=Math.max(js[3],jr[3]);return jt};jn.scale=function(jt,js,jr){jt[0]=js[0]*jr;jt[1]=js[1]*jr;jt[2]=js[2]*jr;jt[3]=js[3]*jr;return jt};jn.scaleAndAdd=function(jt,js,jr,ju){jt[0]=js[0]+(jr[0]*ju);jt[1]=js[1]+(jr[1]*ju);jt[2]=js[2]+(jr[2]*ju);jt[3]=js[3]+(jr[3]*ju);return jt};jn.distance=function(ju,js){var jr=js[0]-ju[0],jw=js[1]-ju[1],jv=js[2]-ju[2],jt=js[3]-ju[3];return Math.sqrt(jr*jr+jw*jw+jv*jv+jt*jt)};jn.dist=jn.distance;jn.squaredDistance=function(ju,js){var jr=js[0]-ju[0],jw=js[1]-ju[1],jv=js[2]-ju[2],jt=js[3]-ju[3];return jr*jr+jw*jw+jv*jv+jt*jt};jn.sqrDist=jn.squaredDistance;jn.length=function(jt){var jr=jt[0],jv=jt[1],ju=jt[2],js=jt[3];return Math.sqrt(jr*jr+jv*jv+ju*ju+js*js)};jn.len=jn.length;jn.squaredLength=function(jt){var jr=jt[0],jv=jt[1],ju=jt[2],js=jt[3];return jr*jr+jv*jv+ju*ju+js*js};jn.sqrLen=jn.squaredLength;jn.negate=function(js,jr){js[0]=-jr[0];js[1]=-jr[1];js[2]=-jr[2];js[3]=-jr[3];return js};jn.normalize=function(jv,ju){var js=ju[0],jx=ju[1],jw=ju[2],jt=ju[3];var jr=js*js+jx*jx+jw*jw+jt*jt;if(jr>0){jr=1/Math.sqrt(jr);jv[0]=ju[0]*jr;jv[1]=ju[1]*jr;jv[2]=ju[2]*jr;jv[3]=ju[3]*jr}return jv};jn.dot=function(js,jr){return js[0]*jr[0]+js[1]*jr[1]+js[2]*jr[2]+js[3]*jr[3]};jn.lerp=function(jt,js,jr,ju){var jx=js[0],jw=js[1],jv=js[2],jy=js[3];jt[0]=jx+ju*(jr[0]-jx);jt[1]=jw+ju*(jr[1]-jw);jt[2]=jv+ju*(jr[2]-jv);jt[3]=jy+ju*(jr[3]-jy);return jt};jn.random=function(jr,js){js=js||1;jr[0]=jk();jr[1]=jk();jr[2]=jk();jr[3]=jk();jn.normalize(jr,jr);jn.scale(jr,jr,js);return jr};jn.transformMat4=function(jv,ju,js){var jr=ju[0],jx=ju[1],jw=ju[2],jt=ju[3];jv[0]=js[0]*jr+js[4]*jx+js[8]*jw+js[12]*jt;jv[1]=js[1]*jr+js[5]*jx+js[9]*jw+js[13]*jt;jv[2]=js[2]*jr+js[6]*jx+js[10]*jw+js[14]*jt;jv[3]=js[3]*jr+js[7]*jx+js[11]*jw+js[15]*jt;return jv};jn.transformQuat=function(jx,jD,jr){var jE=jD[0],jC=jD[1],jB=jD[2],jz=jr[0],jy=jr[1],jw=jr[2],jA=jr[3],ju=jA*jE+jy*jB-jw*jC,jt=jA*jC+jw*jE-jz*jB,js=jA*jB+jz*jC-jy*jE,jv=-jz*jE-jy*jC-jw*jB;jx[0]=ju*jA+jv*-jz+jt*-jw-js*-jy;jx[1]=jt*jA+jv*-jy+js*-jz-ju*-jw;jx[2]=js*jA+jv*-jw+ju*-jy-jt*-jz;return jx};jn.forEach=(function(){var jr=jn.create();return function(ju,jy,jz,jx,jw,js){var jv,jt;if(!jy){jy=4}if(!jz){jz=0}if(jx){jt=Math.min((jx*jy)+jz,ju.length)}else{jt=ju.length}for(jv=jz;jv<jt;jv+=jy){jr[0]=ju[jv];jr[1]=ju[jv+1];jr[2]=ju[jv+2];jr[3]=ju[jv+3];jw(jr,jr,js);ju[jv]=jr[0];ju[jv+1]=jr[1];ju[jv+2]=jr[2];ju[jv+3]=jr[3]}return ju}})();jn.str=function(jr){return"vec4("+jr[0]+", "+jr[1]+", "+jr[2]+", "+jr[3]+")"};jm.vec4=jn;var jj={};jj.create=function(js){js=js||i;var jr=new js(4);jr[0]=1;jr[1]=0;jr[2]=0;jr[3]=1;return jr};jj.clone=function(jr,jt){jt=jt||i;var js=new jt(4);js[0]=jr[0];js[1]=jr[1];js[2]=jr[2];js[3]=jr[3];return js};jj.copy=function(js,jr){js[0]=jr[0];js[1]=jr[1];js[2]=jr[2];js[3]=jr[3];return js};jj.identity=function(jr){jr[0]=1;jr[1]=0;jr[2]=0;jr[3]=1;return jr};jj.transpose=function(jt,js){if(jt===js){var jr=js[1];jt[1]=js[2];jt[2]=jr}else{jt[0]=js[0];jt[1]=js[2];jt[2]=js[1];jt[3]=js[3]}return jt};jj.invert=function(jv,jt){var ju=jt[0],js=jt[1],jr=jt[2],jx=jt[3],jw=ju*jx-jr*js;if(!jw){return null}jw=1/jw;jv[0]=jx*jw;jv[1]=-js*jw;jv[2]=-jr*jw;jv[3]=ju*jw;return jv};jj.adjoint=function(jt,jr){var js=jr[0];jt[0]=jr[3];jt[1]=-jr[1];jt[2]=-jr[2];jt[3]=js;return jt};jj.determinant=function(jr){return jr[0]*jr[3]-jr[2]*jr[1]};jj.multiply=function(jv,jA,jy){var ju=jA[0],jt=jA[1],js=jA[2],jr=jA[3];var jB=jy[0],jz=jy[1],jx=jy[2],jw=jy[3];jv[0]=ju*jB+js*jz;jv[1]=jt*jB+jr*jz;jv[2]=ju*jx+js*jw;jv[3]=jt*jx+jr*jw;return jv};jj.mul=jj.multiply;jj.rotate=function(jv,jy,jx){var ju=jy[0],jt=jy[1],js=jy[2],jr=jy[3],jz=Math.sin(jx),jw=Math.cos(jx);jv[0]=ju*jw+js*jz;jv[1]=jt*jw+jr*jz;jv[2]=ju*-jz+js*jw;jv[3]=jt*-jz+jr*jw;return jv};jj.scale=function(jv,jw,jy){var ju=jw[0],jt=jw[1],js=jw[2],jr=jw[3],jz=jy[0],jx=jy[1];jv[0]=ju*jz;jv[1]=jt*jz;jv[2]=js*jx;jv[3]=jr*jx;return jv};jj.str=function(jr){return"mat2("+jr[0]+", "+jr[1]+", "+jr[2]+", "+jr[3]+")"};jj.frob=function(jr){return(Math.sqrt(Math.pow(jr[0],2)+Math.pow(jr[1],2)+Math.pow(jr[2],2)+Math.pow(jr[3],2)))};jj.LDU=function(jr,ju,jt,js){jr[2]=js[2]/js[0];jt[0]=js[0];jt[1]=js[1];jt[3]=js[3]-jr[2]*jt[1];return[jr,ju,jt]};jm.mat2=jj;var e={};e.create=function(js){js=js||i;var jr=new js(16);jr[0]=1;jr[1]=0;jr[2]=0;jr[3]=0;jr[4]=0;jr[5]=1;jr[6]=0;jr[7]=0;jr[8]=0;jr[9]=0;jr[10]=1;jr[11]=0;jr[12]=0;jr[13]=0;jr[14]=0;jr[15]=1;return jr};e.clone=function(jr){var js=new i(16);js[0]=jr[0];js[1]=jr[1];js[2]=jr[2];js[3]=jr[3];js[4]=jr[4];js[5]=jr[5];js[6]=jr[6];js[7]=jr[7];js[8]=jr[8];js[9]=jr[9];js[10]=jr[10];js[11]=jr[11];js[12]=jr[12];js[13]=jr[13];js[14]=jr[14];js[15]=jr[15];return js};e.copy=function(js,jr){js[0]=jr[0];js[1]=jr[1];js[2]=jr[2];js[3]=jr[3];js[4]=jr[4];js[5]=jr[5];js[6]=jr[6];js[7]=jr[7];js[8]=jr[8];js[9]=jr[9];js[10]=jr[10];js[11]=jr[11];js[12]=jr[12];js[13]=jr[13];js[14]=jr[14];js[15]=jr[15];return js};e.identity=function(jr){jr[0]=1;jr[1]=0;jr[2]=0;jr[3]=0;jr[4]=0;jr[5]=1;jr[6]=0;jr[7]=0;jr[8]=0;jr[9]=0;jr[10]=1;jr[11]=0;jr[12]=0;jr[13]=0;jr[14]=0;jr[15]=1;return jr};e.transpose=function(ju,jt){if(ju===jt){var jy=jt[1],jw=jt[2],jv=jt[3],jr=jt[6],jx=jt[7],js=jt[11];ju[1]=jt[4];ju[2]=jt[8];ju[3]=jt[12];ju[4]=jy;ju[6]=jt[9];ju[7]=jt[13];ju[8]=jw;ju[9]=jr;ju[11]=jt[14];ju[12]=jv;ju[13]=jx;ju[14]=js}else{ju[0]=jt[0];ju[1]=jt[4];ju[2]=jt[8];ju[3]=jt[12];ju[4]=jt[1];ju[5]=jt[5];ju[6]=jt[9];ju[7]=jt[13];ju[8]=jt[2];ju[9]=jt[6];ju[10]=jt[10];ju[11]=jt[14];ju[12]=jt[3];ju[13]=jt[7];ju[14]=jt[11];ju[15]=jt[15]}return ju};e.invert=function(jK,jP){var jT=jP[0],jR=jP[1],jQ=jP[2],jN=jP[3],jv=jP[4],ju=jP[5],jt=jP[6],js=jP[7],jJ=jP[8],jI=jP[9],jH=jP[10],jG=jP[11],jV=jP[12],jU=jP[13],jS=jP[14],jO=jP[15],jF=jT*ju-jR*jv,jE=jT*jt-jQ*jv,jD=jT*js-jN*jv,jC=jR*jt-jQ*ju,jB=jR*js-jN*ju,jA=jQ*js-jN*jt,jz=jJ*jU-jI*jV,jy=jJ*jS-jH*jV,jx=jJ*jO-jG*jV,jw=jI*jS-jH*jU,jM=jI*jO-jG*jU,jL=jH*jO-jG*jS,jr=jF*jL-jE*jM+jD*jw+jC*jx-jB*jy+jA*jz;if(!jr){return null}jr=1/jr;jK[0]=(ju*jL-jt*jM+js*jw)*jr;jK[1]=(jQ*jM-jR*jL-jN*jw)*jr;jK[2]=(jU*jA-jS*jB+jO*jC)*jr;jK[3]=(jH*jB-jI*jA-jG*jC)*jr;jK[4]=(jt*jx-jv*jL-js*jy)*jr;jK[5]=(jT*jL-jQ*jx+jN*jy)*jr;jK[6]=(jS*jD-jV*jA-jO*jE)*jr;jK[7]=(jJ*jA-jH*jD+jG*jE)*jr;jK[8]=(jv*jM-ju*jx+js*jz)*jr;jK[9]=(jR*jx-jT*jM-jN*jz)*jr;jK[10]=(jV*jB-jU*jD+jO*jF)*jr;jK[11]=(jI*jD-jJ*jB-jG*jF)*jr;jK[12]=(ju*jy-jv*jw-jt*jz)*jr;jK[13]=(jT*jw-jR*jy+jQ*jz)*jr;jK[14]=(jU*jE-jV*jC-jS*jF)*jr;jK[15]=(jJ*jC-jI*jE+jH*jF)*jr;return jK};e.adjoint=function(jz,jC){var jG=jC[0],jE=jC[1],jD=jC[2],jA=jC[3],ju=jC[4],jt=jC[5],js=jC[6],jr=jC[7],jy=jC[8],jx=jC[9],jw=jC[10],jv=jC[11],jI=jC[12],jH=jC[13],jF=jC[14],jB=jC[15];jz[0]=(jt*(jw*jB-jv*jF)-jx*(js*jB-jr*jF)+jH*(js*jv-jr*jw));jz[1]=-(jE*(jw*jB-jv*jF)-jx*(jD*jB-jA*jF)+jH*(jD*jv-jA*jw));jz[2]=(jE*(js*jB-jr*jF)-jt*(jD*jB-jA*jF)+jH*(jD*jr-jA*js));jz[3]=-(jE*(js*jv-jr*jw)-jt*(jD*jv-jA*jw)+jx*(jD*jr-jA*js));jz[4]=-(ju*(jw*jB-jv*jF)-jy*(js*jB-jr*jF)+jI*(js*jv-jr*jw));jz[5]=(jG*(jw*jB-jv*jF)-jy*(jD*jB-jA*jF)+jI*(jD*jv-jA*jw));jz[6]=-(jG*(js*jB-jr*jF)-ju*(jD*jB-jA*jF)+jI*(jD*jr-jA*js));jz[7]=(jG*(js*jv-jr*jw)-ju*(jD*jv-jA*jw)+jy*(jD*jr-jA*js));jz[8]=(ju*(jx*jB-jv*jH)-jy*(jt*jB-jr*jH)+jI*(jt*jv-jr*jx));jz[9]=-(jG*(jx*jB-jv*jH)-jy*(jE*jB-jA*jH)+jI*(jE*jv-jA*jx));jz[10]=(jG*(jt*jB-jr*jH)-ju*(jE*jB-jA*jH)+jI*(jE*jr-jA*jt));jz[11]=-(jG*(jt*jv-jr*jx)-ju*(jE*jv-jA*jx)+jy*(jE*jr-jA*jt));jz[12]=-(ju*(jx*jF-jw*jH)-jy*(jt*jF-js*jH)+jI*(jt*jw-js*jx));jz[13]=(jG*(jx*jF-jw*jH)-jy*(jE*jF-jD*jH)+jI*(jE*jw-jD*jx));jz[14]=-(jG*(jt*jF-js*jH)-ju*(jE*jF-jD*jH)+jI*(jE*js-jD*jt));jz[15]=(jG*(jt*jw-js*jx)-ju*(jE*jw-jD*jx)+jy*(jE*js-jD*jt));return jz};e.determinant=function(jM){var jR=jM[0],jP=jM[1],jN=jM[2],jL=jM[3],ju=jM[4],jt=jM[5],js=jM[6],jr=jM[7],jI=jM[8],jH=jM[9],jG=jM[10],jF=jM[11],jT=jM[12],jS=jM[13],jQ=jM[14],jO=jM[15],jE=jR*jt-jP*ju,jD=jR*js-jN*ju,jC=jR*jr-jL*ju,jB=jP*js-jN*jt,jA=jP*jr-jL*jt,jz=jN*jr-jL*js,jy=jI*jS-jH*jT,jx=jI*jQ-jG*jT,jw=jI*jO-jF*jT,jv=jH*jQ-jG*jS,jK=jH*jO-jF*jS,jJ=jG*jO-jF*jQ;return jE*jJ-jD*jK+jC*jv+jB*jw-jA*jx+jz*jy};e.multiply=function(jD,jH,jE){var jL=jH[0],jK=jH[1],jI=jH[2],jF=jH[3],jx=jH[4],jv=jH[5],jt=jH[6],jr=jH[7],jC=jH[8],jB=jH[9],jA=jH[10],jz=jH[11],jN=jH[12],jM=jH[13],jJ=jH[14],jG=jH[15];var jy=jE[0],jw=jE[1],ju=jE[2],js=jE[3];jD[0]=jy*jL+jw*jx+ju*jC+js*jN;jD[1]=jy*jK+jw*jv+ju*jB+js*jM;jD[2]=jy*jI+jw*jt+ju*jA+js*jJ;jD[3]=jy*jF+jw*jr+ju*jz+js*jG;jy=jE[4];jw=jE[5];ju=jE[6];js=jE[7];jD[4]=jy*jL+jw*jx+ju*jC+js*jN;jD[5]=jy*jK+jw*jv+ju*jB+js*jM;jD[6]=jy*jI+jw*jt+ju*jA+js*jJ;jD[7]=jy*jF+jw*jr+ju*jz+js*jG;jy=jE[8];jw=jE[9];ju=jE[10];js=jE[11];jD[8]=jy*jL+jw*jx+ju*jC+js*jN;jD[9]=jy*jK+jw*jv+ju*jB+js*jM;jD[10]=jy*jI+jw*jt+ju*jA+js*jJ;jD[11]=jy*jF+jw*jr+ju*jz+js*jG;jy=jE[12];jw=jE[13];ju=jE[14];js=jE[15];jD[12]=jy*jL+jw*jx+ju*jC+js*jN;jD[13]=jy*jK+jw*jv+ju*jB+js*jM;jD[14]=jy*jI+jw*jt+ju*jA+js*jJ;jD[15]=jy*jF+jw*jr+ju*jz+js*jG;return jD};e.mul=e.multiply;e.translate=function(jD,jF,jy){var jx=jy[0],jw=jy[1],jv=jy[2],jI,jH,jG,jE,ju,jt,js,jr,jC,jB,jA,jz;if(jF===jD){jD[12]=jF[0]*jx+jF[4]*jw+jF[8]*jv+jF[12];jD[13]=jF[1]*jx+jF[5]*jw+jF[9]*jv+jF[13];jD[14]=jF[2]*jx+jF[6]*jw+jF[10]*jv+jF[14];jD[15]=jF[3]*jx+jF[7]*jw+jF[11]*jv+jF[15]}else{jI=jF[0];jH=jF[1];jG=jF[2];jE=jF[3];ju=jF[4];jt=jF[5];js=jF[6];jr=jF[7];jC=jF[8];jB=jF[9];jA=jF[10];jz=jF[11];jD[0]=jI;jD[1]=jH;jD[2]=jG;jD[3]=jE;jD[4]=ju;jD[5]=jt;jD[6]=js;jD[7]=jr;jD[8]=jC;jD[9]=jB;jD[10]=jA;jD[11]=jz;jD[12]=jI*jx+ju*jw+jC*jv+jF[12];jD[13]=jH*jx+jt*jw+jB*jv+jF[13];jD[14]=jG*jx+js*jw+jA*jv+jF[14];jD[15]=jE*jx+jr*jw+jz*jv+jF[15]}return jD};e.scale=function(ju,js,jt){var jr=jt[0],jw=jt[1],jv=jt[2];ju[0]=js[0]*jr;ju[1]=js[1]*jr;ju[2]=js[2]*jr;ju[3]=js[3]*jr;ju[4]=js[4]*jw;ju[5]=js[5]*jw;ju[6]=js[6]*jw;ju[7]=js[7]*jw;ju[8]=js[8]*jv;ju[9]=js[9]*jv;ju[10]=js[10]*jv;ju[11]=js[11]*jv;ju[12]=js[12];ju[13]=js[13];ju[14]=js[14];ju[15]=js[15];return ju};e.rotate=function(jL,jS,jU,jr){var jB=jr[0],jA=jr[1],jz=jr[2],jM=Math.sqrt(jB*jB+jA*jA+jz*jz),jG,jQ,jF,jW,jV,jT,jR,jy,jx,jw,jv,jK,jJ,jI,jH,jE,jD,jC,jP,jO,jN,ju,jt,js;if(Math.abs(jM)<jq){return null}jM=1/jM;jB*=jM;jA*=jM;jz*=jM;jG=Math.sin(jU);jQ=Math.cos(jU);jF=1-jQ;jW=jS[0];jV=jS[1];jT=jS[2];jR=jS[3];jy=jS[4];jx=jS[5];jw=jS[6];jv=jS[7];jK=jS[8];jJ=jS[9];jI=jS[10];jH=jS[11];jE=jB*jB*jF+jQ;jD=jA*jB*jF+jz*jG;jC=jz*jB*jF-jA*jG;jP=jB*jA*jF-jz*jG;jO=jA*jA*jF+jQ;jN=jz*jA*jF+jB*jG;ju=jB*jz*jF+jA*jG;jt=jA*jz*jF-jB*jG;js=jz*jz*jF+jQ;jL[0]=jW*jE+jy*jD+jK*jC;jL[1]=jV*jE+jx*jD+jJ*jC;jL[2]=jT*jE+jw*jD+jI*jC;jL[3]=jR*jE+jv*jD+jH*jC;jL[4]=jW*jP+jy*jO+jK*jN;jL[5]=jV*jP+jx*jO+jJ*jN;jL[6]=jT*jP+jw*jO+jI*jN;jL[7]=jR*jP+jv*jO+jH*jN;jL[8]=jW*ju+jy*jt+jK*js;jL[9]=jV*ju+jx*jt+jJ*js;jL[10]=jT*ju+jw*jt+jI*js;jL[11]=jR*ju+jv*jt+jH*js;if(jS!==jL){jL[12]=jS[12];jL[13]=jS[13];jL[14]=jS[14];jL[15]=jS[15]}return jL};e.rotateX=function(jr,jy,jx){var jD=Math.sin(jx),jw=Math.cos(jx),jC=jy[4],jB=jy[5],jA=jy[6],jz=jy[7],jv=jy[8],ju=jy[9],jt=jy[10],js=jy[11];if(jy!==jr){jr[0]=jy[0];jr[1]=jy[1];jr[2]=jy[2];jr[3]=jy[3];jr[12]=jy[12];jr[13]=jy[13];jr[14]=jy[14];jr[15]=jy[15]}jr[4]=jC*jw+jv*jD;jr[5]=jB*jw+ju*jD;jr[6]=jA*jw+jt*jD;jr[7]=jz*jw+js*jD;jr[8]=jv*jw-jC*jD;jr[9]=ju*jw-jB*jD;jr[10]=jt*jw-jA*jD;jr[11]=js*jw-jz*jD;return jr};e.rotateY=function(jv,jC,jB){var jD=Math.sin(jB),jA=Math.cos(jB),ju=jC[0],jt=jC[1],js=jC[2],jr=jC[3],jz=jC[8],jy=jC[9],jx=jC[10],jw=jC[11];if(jC!==jv){jv[4]=jC[4];jv[5]=jC[5];jv[6]=jC[6];jv[7]=jC[7];jv[12]=jC[12];jv[13]=jC[13];jv[14]=jC[14];jv[15]=jC[15]}jv[0]=ju*jA-jz*jD;jv[1]=jt*jA-jy*jD;jv[2]=js*jA-jx*jD;jv[3]=jr*jA-jw*jD;jv[8]=ju*jD+jz*jA;jv[9]=jt*jD+jy*jA;jv[10]=js*jD+jx*jA;jv[11]=jr*jD+jw*jA;return jv};e.rotateZ=function(jv,jy,jx){var jD=Math.sin(jx),jw=Math.cos(jx),ju=jy[0],jt=jy[1],js=jy[2],jr=jy[3],jC=jy[4],jB=jy[5],jA=jy[6],jz=jy[7];if(jy!==jv){jv[8]=jy[8];jv[9]=jy[9];jv[10]=jy[10];jv[11]=jy[11];jv[12]=jy[12];jv[13]=jy[13];jv[14]=jy[14];jv[15]=jy[15]}jv[0]=ju*jw+jC*jD;jv[1]=jt*jw+jB*jD;jv[2]=js*jw+jA*jD;jv[3]=jr*jw+jz*jD;jv[4]=jC*jw-ju*jD;jv[5]=jB*jw-jt*jD;jv[6]=jA*jw-js*jD;jv[7]=jz*jw-jr*jD;return jv};e.fromRotationTranslation=function(jE,jC,jA){var jx=jC[0],jw=jC[1],jv=jC[2],jy=jC[3],jF=jx+jx,jr=jw+jw,jz=jv+jv,ju=jx*jF,jt=jx*jr,js=jx*jz,jD=jw*jr,jB=jw*jz,jI=jv*jz,jJ=jy*jF,jH=jy*jr,jG=jy*jz;jE[0]=1-(jD+jI);jE[1]=jt+jG;jE[2]=js-jH;jE[3]=0;jE[4]=jt-jG;jE[5]=1-(ju+jI);jE[6]=jB+jJ;jE[7]=0;jE[8]=js+jH;jE[9]=jB-jJ;jE[10]=1-(ju+jD);jE[11]=0;jE[12]=jA[0];jE[13]=jA[1];jE[14]=jA[2];jE[15]=1;return jE};e.fromQuat=function(jB,jy){var jv=jy[0],ju=jy[1],jt=jy[2],jw=jy[3],jC=jv+jv,jr=ju+ju,jx=jt+jt,js=jv*jC,jA=ju*jC,jz=ju*jr,jI=jt*jC,jH=jt*jr,jF=jt*jx,jG=jw*jC,jE=jw*jr,jD=jw*jx;jB[0]=1-jz-jF;jB[1]=jA+jD;jB[2]=jI-jE;jB[3]=0;jB[4]=jA-jD;jB[5]=1-js-jF;jB[6]=jH+jG;jB[7]=0;jB[8]=jI+jE;jB[9]=jH-jG;jB[10]=1-js-jz;jB[11]=0;jB[12]=0;jB[13]=0;jB[14]=0;jB[15]=1;return jB};e.frustum=function(jv,js,jA,jr,jz,jx,jw){var jy=1/(jA-js),ju=1/(jz-jr),jt=1/(jx-jw);jv[0]=(jx*2)*jy;jv[1]=0;jv[2]=0;jv[3]=0;jv[4]=0;jv[5]=(jx*2)*ju;jv[6]=0;jv[7]=0;jv[8]=(jA+js)*jy;jv[9]=(jz+jr)*ju;jv[10]=(jw+jx)*jt;jv[11]=-1;jv[12]=0;jv[13]=0;jv[14]=(jw*jx*2)*jt;jv[15]=0;return jv};e.perspective=function(ju,jt,js,jv,jr){var jx=1/Math.tan(jt/2),jw=1/(jv-jr);ju[0]=jx/js;ju[1]=0;ju[2]=0;ju[3]=0;ju[4]=0;ju[5]=jx;ju[6]=0;ju[7]=0;ju[8]=0;ju[9]=0;ju[10]=(jr+jv)*jw;ju[11]=-1;ju[12]=0;ju[13]=0;ju[14]=(2*jr*jv)*jw;ju[15]=0;return ju};e.ortho=function(ju,js,jA,jr,jy,jx,jw){var jv=1/(js-jA),jz=1/(jr-jy),jt=1/(jx-jw);ju[0]=-2*jv;ju[1]=0;ju[2]=0;ju[3]=0;ju[4]=0;ju[5]=-2*jz;ju[6]=0;ju[7]=0;ju[8]=0;ju[9]=0;ju[10]=2*jt;ju[11]=0;ju[12]=(js+jA)*jv;ju[13]=(jy+jr)*jz;ju[14]=(jw+jx)*jt;ju[15]=1;return ju};e.lookAt=function(jF,jM,jN,jx){var jL,jK,jI,jt,js,jr,jA,jz,jy,jG,jJ=jM[0],jH=jM[1],jE=jM[2],jw=jx[0],jv=jx[1],ju=jx[2],jD=jN[0],jC=jN[1],jB=jN[2];if(Math.abs(jJ-jD)<jq&&Math.abs(jH-jC)<jq&&Math.abs(jE-jB)<jq){return e.identity(jF)}jA=jJ-jD;jz=jH-jC;jy=jE-jB;jG=1/Math.sqrt(jA*jA+jz*jz+jy*jy);jA*=jG;jz*=jG;jy*=jG;jL=jv*jy-ju*jz;jK=ju*jA-jw*jy;jI=jw*jz-jv*jA;jG=Math.sqrt(jL*jL+jK*jK+jI*jI);if(!jG){jL=0;jK=0;jI=0}else{jG=1/jG;jL*=jG;jK*=jG;jI*=jG}jt=jz*jI-jy*jK;js=jy*jL-jA*jI;jr=jA*jK-jz*jL;jG=Math.sqrt(jt*jt+js*js+jr*jr);if(!jG){jt=0;js=0;jr=0}else{jG=1/jG;jt*=jG;js*=jG;jr*=jG}jF[0]=jL;jF[1]=jt;jF[2]=jA;jF[3]=0;jF[4]=jK;jF[5]=js;jF[6]=jz;jF[7]=0;jF[8]=jI;jF[9]=jr;jF[10]=jy;jF[11]=0;jF[12]=-(jL*jJ+jK*jH+jI*jE);jF[13]=-(jt*jJ+js*jH+jr*jE);jF[14]=-(jA*jJ+jz*jH+jy*jE);jF[15]=1;return jF};e.str=function(jr){return"mat4("+jr[0]+", "+jr[1]+", "+jr[2]+", "+jr[3]+", "+jr[4]+", "+jr[5]+", "+jr[6]+", "+jr[7]+", "+jr[8]+", "+jr[9]+", "+jr[10]+", "+jr[11]+", "+jr[12]+", "+jr[13]+", "+jr[14]+", "+jr[15]+")"};e.frob=function(jr){return(Math.sqrt(Math.pow(jr[0],2)+Math.pow(jr[1],2)+Math.pow(jr[2],2)+Math.pow(jr[3],2)+Math.pow(jr[4],2)+Math.pow(jr[5],2)+Math.pow(jr[6],2)+Math.pow(jr[6],2)+Math.pow(jr[7],2)+Math.pow(jr[8],2)+Math.pow(jr[9],2)+Math.pow(jr[10],2)+Math.pow(jr[11],2)+Math.pow(jr[12],2)+Math.pow(jr[13],2)+Math.pow(jr[14],2)+Math.pow(jr[15],2)))};jm.mat4=e})(window);function bZ(){this.result={bkData:[],eleData:[[],[],[],[],[],[],[],[],[],[]],tileLabels:[]}}ey.extend(bZ.prototype,{createLayer:function(T,i){var e=this.result.bkData;i=i||{};if(!e[T]){e[T]=[[],[],[]]}e[T].tileTypeName=i.tileTypeName||"na";e[T].dataType=i.dataType||2;e[T].png8=i.png8||false;e[T].clipTile=i.clipTile||false;e[T].boundary=i.boundary||false;if(i.ontology){e[T].ontology=i.ontology}},removeLayer:function(i){var e=this.result.bkData;e[i]=null},hasLayerBoundary:function(){var e=this.result.bkData;var T=false;for(var jj=0;jj<e.length;jj++){if(e[jj]&&e[jj].boundary){T=true;break}}return T},getResult:function(){return this.result},setData:function(jl,jk,jm){var e=this.result.bkData;var T=e[jk]?e[jk][jm]:null;if(!T){return}for(var jj=0;jj<T.length;jj++){if(T[jj].key&&T[jj].key===jl.key){T[jj]=jl;return}}T.push(jl)},setLabelData:function(e){this.result.tileLabels=e},getLabelData:function(){return this.result.tileLabels},setOverlayData:function(i,e){if(!this.result.eleData[e]){return}if(e===0||e===5||e===6){i.sort(function(jj,T){return jj.overlay.zIndex-T.overlay.zIndex})}this.result.eleData[e]=i},clearLabelOverlayData:function(){this.result.eleData[2]=[];this.result.eleData[3]=[];this.result.eleData[4]=[]},clearData:function(jj){var e=this.result.bkData;if(typeof jj==="number"){if(e[jj]){e[jj][0]=[];e[jj][1]=[];e[jj][2]=[]}return}for(var T=0;T<e.length;T++){if(!e[T]){continue}e[T][0]=[];e[T][1]=[];e[T][2]=[]}},sortThumbData:function(i){var e=this.result.bkData;var T=e[i];if(!T){return}if(T[0]&&T[0].length>0){T[0].sort(function(jk,jj){return jk.tileInfo.useZoom-jj.tileInfo.useZoom})}}});var fQ=(function(){var jt=new Int8Array(4);var T=new Int32Array(jt.buffer,0,1);var jo=new Float32Array(jt.buffer,0,1);function jv(jC){T[0]=jC;return jo[0]}function i(jC){jo[0]=jC;return T[0]}function jp(jC){var jE=(jC[3]<<24|jC[2]<<16|jC[1]<<8|jC[0]);var jD=jv(jE&4278190079);return jD}var jk=0;var jn=1;var jr=2;var jz=0;var jw=1;var ju=2;var jl=9;function js(jC,jD){var jE;if(jD%2===0){jE=[-jC[1],jC[0]]}else{jE=[jC[1],-jC[0]]}return jE}function e(jC,jD,jE){var jF=js(jC,jD);var jG;if(jE===jn){return jF}else{if(jD===4||jD===5){jG=[jF[0]-jC[0],jF[1]-jC[1]]}else{jG=[jF[0]+jC[0],jF[1]+jC[1]]}if(jE===jk){vec2.normalize(jG,jG)}return jG}}function jy(jD,jC){return Math.sqrt(Math.pow(jD[0]-jC[0],2)+Math.pow(jD[1]-jC[1],2))}function jj(jG,jF,jE,jC){var jD=vec2.dot(jG,jF);if(jE===ju||jE===jw){if((jC===0||jC===1)&&jD>0){return true}else{if((jC===2||jC===3)&&jD<0){return true}}}if((jC===0||jC===1)&&jD<0){return true}else{if((jC===2||jC===3)&&jD>0){return true}}return false}function jq(jD,jI,jK){var jJ=js(jD,jI);var jF;var jH=jD;var jG=jK;var jM=[];vec2.normalize(jM,[jH[0]+jG[0],jH[1]+jG[1]]);var jL=vec2.dot(jJ,[-jM[1],jM[0]]);if(Math.abs(jL)<0.1){jL=1}var jE=1/jL;jF=[-jM[1]*jE,jM[0]*jE];var jC=vec2.dot(jD,jF);if(jC<0){vec2.negate(jF,jF)}return{cos2:jC,offset:jF}}function jB(jD,jI,jK,jC){var jJ=js(jD,jI);var jH;var jG;var jF;if(jI===0||jI===1){jH=jK;jG=jD}else{jH=jD;jG=jK}if(!jH||!jG){return jJ}var jM=[jH[0]+jG[0],jH[1]+jG[1]];if(jM[0]===0&&jM[1]===0){vec2.normalize(jM,jG)}else{vec2.normalize(jM,jM)}var jN=jj(jM,jJ,jC,jI);if(jN){return jJ}var jL=vec2.dot(jJ,[-jM[1],jM[0]]);if(Math.abs(jL)<0.1){jL=1}var jE=1/jL;jF=[-jM[1]*jE,jM[0]*jE];return jF}function jA(jN,jO,jH,jG,jP,jM,jF,jI,jE,jL){var jK;var jD=0;var jC=false;jK=jM.length/jl-1;jm(jO[0],jN[0],jH[0],jP,jG,4,jI,jE,undefined,jM,jL);jK++;jD++;jm(jO[0],jN[0],jH[0],jP,jG,5,jI,jE,undefined,jM,jL);jK++;jD++;for(var jJ=0;jJ<jN.length;jJ++){jm(jO[jJ],jN[jJ],jH[jJ],jP,jG,0,jI,jE,jN[jJ-1],jM,jL);jx(jF,++jK,++jD,jC);jm(jO[jJ],jN[jJ],jH[jJ],jP,jG,1,jI,jE,jN[jJ-1],jM,jL);jx(jF,++jK,++jD,jC);jm(jO[jJ+1],jN[jJ],jH[jJ+1],jP,jG,2,jI,jE,jN[jJ+1],jM,jL);jx(jF,++jK,++jD,jC);jm(jO[jJ+1],jN[jJ],jH[jJ+1],jP,jG,3,jI,jE,jN[jJ+1],jM,jL);jx(jF,++jK,++jD,jC);if(jG===jw&&jJ!==jN.length-1){jm(jO[jJ+1],jN[jJ],jH[jJ+1],jP,jG,8,jI,jE,jN[jJ+1],jM,jL);jx(jF,++jK,++jD,jC);jC=jC?false:true}}jm(jO[jO.length-1],jN[jN.length-1],jH[jO.length-1],jP,jG,6,jI,jE,undefined,jM,jL);jx(jF,++jK,++jD,jC);jm(jO[jO.length-1],jN[jN.length-1],jH[jO.length-1],jP,jG,7,jI,jE,undefined,jM,jL);jx(jF,++jK,++jD,jC)}function jm(jP,jF,jJ,jQ,jE,jK,jH,jD,jN,jM,jL){var jO=jK%2===0?1:-1;var jI;if(jK===4||jK===5||jK===6||jK===7){jI=e(jF,jK,jQ)}else{if(jK===0||jK===1||jK===2||jK===3){jI=jB(jF,jK,jN,jE)}else{if(jK===8){var jG=jq(jF,jK,jN);jI=jG.offset;vec2.normalize(jI,jI);var jC=jG.cos2;if(jC<0){jO=-jO}}}}jM[jM.length]=jP[0]*10;jM[jM.length]=jP[1]*10;jM[jM.length]=jI[0]*jD*10;jM[jM.length]=jI[1]*jD*10;jM[jM.length]=jH;jM[jM.length]=jO;jM[jM.length]=0;jM[jM.length]=jL||0;jM[jM.length]=jJ}function jx(jG,jE,jC,jF){var jD;if(jC%2===0){if(jF){jG[jG.length]=jE-2;jG[jG.length]=jE-1;jG[jG.length]=jE}else{jG[jG.length]=jE-1;jG[jG.length]=jE-2;jG[jG.length]=jE}}else{if(jF){jG[jG.length]=jE-1;jG[jG.length]=jE-2;jG[jG.length]=jE}else{jG[jG.length]=jE-2;jG[jG.length]=jE-1;jG[jG.length]=jE}}}return{getVertexCount:function(jD,jC){if(jC===jw){return jD*5-2}else{return jD*4}},buildData:function(jN,jE,jO,jK,jC,jH,jD,jL){var jM=[];var jJ=0;var jG=[0];for(var jI=0;jI<jN.length;jI++){if(jI>0){jJ+=jy(jN[jI],jN[jI-1]);jG.push(jJ*10)}if(jI!==jN.length-1){var jF=[jN[jI+1][0]-jN[jI][0],jN[jI+1][1]-jN[jI][1]];var jP=[];if(jF[0]===0&&jF[1]===0){jP=[0,0]}else{vec2.normalize(jP,jF)}jM[jM.length]=[jP[0],jP[1]]}}return jA(jM,jN,jG,jE,jO,jK,jC,jp(jH),jD,jL)},toTileSolidLineVertices:function(jG,jD){var jE=new Float32Array(jG.length/jl*5);var jC=new Int16Array(jE.buffer);var jI=0;var jF=0;for(var jH=0;jH<jG.length;jH+=jl){jC[jI]=~~jG[jH];jC[jI+1]=~~jG[jH+1];jC[jI+2]=~~jG[jH+2];jC[jI+3]=~~jG[jH+3];jE[jF+2]=jG[jH+4];jC[jI+6]=jG[jH+5];jC[jI+7]=jD?jD:0;jC[jI+8]=jG[jH+7];jC[jI+9]=0;jI+=10;jF+=5}return jE}}})();var f8=1;var g3=2;var eN={drawIndex:0,devicePixelRatio:fI(),zoomState:1,curViewTilesInfo:null,iconSetImg:null,LAST_CALC_ZOOM:-1,LAST_LOAD_VECTOR_ZOOM_CHANGE:false,lastCollisionTestTime:0,remove:function(){this.tileCache.clear()},initDrawData:function(){this.drawIndex=this.zIndex;var e={tileTypeName:this.tileType.getName(),dataType:this.dataType,png8:this.png8,clipTile:this.clipTile,boundary:this.boundary};if(this.ontology){e.ontology=this.ontology}this.map._featureMgr.createLayer(this.drawIndex,e);this.dispatchEvent(new ff("oninitDrawData"))},destroyDrawData:function(){this.map._featureMgr.removeLayer(this.drawIndex);var i=new ff("onremoveLayerMask");i.hasLayerBoundary=this.map._featureMgr.hasLayerBoundary();this.map.dispatchEvent(i)},setZIndex:function(jn){jn=Math.abs(Math.floor(jn))||1;if(!jn||jn===this.zIndex){return}var i=this.map._featureMgr.result.bkData;var jj=this.map.tileMgr.tileLayers;function T(jq){var jp=null;for(var jo=0;jo<jj.length;jo++){if(jj[jo].zIndex===jq){jp=jj[jo];break}}return jp}var e=[];var jm=[];var jl=this.zIndex;if(i[jn]){e.push(T(jn));jm.push(i[jn]);this.setTargetZIndex(jn);i[jn]=i[jl];i[jl]=null}else{this.setTargetZIndex(jn);i[jn]=i[jl];i[jl]=null;this.map.dispatchEvent(new ff("onrefresh"));return}var jk=jn+1;while(jk){if(i[jk]){e.push(T(jk));jm.push(i[jk]);e.shift().setTargetZIndex(jk);i[jk]=jm.shift();jk+=1}else{e.shift().setTargetZIndex(jk);i[jk]=jm.shift();jk=0}}this.map.dispatchEvent(new ff("onrefresh"))},setZIndexTop:function(){var e=this.map._featureMgr.result.bkData;e[e.length]=e[this.zIndex];e[this.zIndex]=null;this.setTargetZIndex(e.length-1);this.map.dispatchEvent(new ff("onrefresh"))},getTileKey:function(e,jj){jj=jj||{};var i=typeof jj.useZoom==="number"?jj.useZoom:e.useZoom;var T=e.style||this.mapStyleId||"default";return this.mapType+"_"+T+"_"+e.col+"_"+e.row+"_"+e.zoom+"_"+i},getTileRenderDataKey:function(i){var T=i.col;var jj=i.zoom;var e=i.baseTileSize;T=eB.calcLoopParam(T,jj,e).col;return this.mapType+"_"+T+"_"+i.row+"_"+jj+"_"+i.useZoom},getTileUnits:function(e){var jj=this.map;var T=dU[jj.getMapType()];var i=T.baseUnits*Math.pow(2,T.zoomLevelBase-e);return i},getTilesUrl:function(jk,jt,ju){var i=jk.x;var jv=jk.y;var jq=iY("ditu","normal");var jm=jq.ver;var jn=jq.udt;i=eB.calcLoopParam(i,jt,ju).col;var js=dU.B_NORMAL_MAP.vectorTileUrls;var jl=Math.abs(i+jv)%js.length;var jr=js[jl];if(window.offLineIPAddress){js=[window.offLineIPAddress+"pvd/"];jr=js[0]}var T="x="+i+"&y="+jv+"&z="+Math.floor(jt);var jp=this.devicePixelRatio>1?"&scaler=2":"";var jo="&textimg=1";if(this.map.config.textRenderType==="canvas"){jo="&textimg=0"}var jj=this.map.config.style;if(typeof jj==="string"&&jj!=="default"){T+="&styleId="+w.mapStyleNameIdPair[jj]}T+="&styles=pl"+jo+jp+"&v="+jm+"&udt="+jn+"&json=0";var e=jr+"?qt=vtile&param="+window.encodeURIComponent(eu(T));return e},getRasterTilesUrl:function(T,jl,jj){var jk=dU[this.map.mapType];var i=this.map.config.style;var e=jk.tileUrls[Math.abs(jl+T)%jk.tileUrls.length]+"?qt=tile&x="+T+"&y="+jl+"&z="+jj+((i==="default"||typeof i!=="string")?"":("&styleId="+w.mapStyleNameIdPair[i]))+"&styles=pl&udt="+this.normalUdt+"&scaler="+this.scaler+"&p=1";e=e.replace(/-(\d+)/gi,"M$1");return e},getZoomState:function(){var T=this.map;var i=T.getZoom();var e=i-this.lastZoom;if(e>0){this.zoomState=1}else{if(e<0){this.zoomState=-1}}this.lastZoom=i;return this.zoomState},releaseOutViewTileData:function(e){var jk=this.map._workerMgr.releasePendingData(e);for(var jj=0,T=jk.length;jj<T;jj++){var jl=this.getTileKey(jk[jj]);this.tileCache.removeData(jl)}},loadLayerData:function(e,jj,i){this.hasZoomChange=i;this.curViewTilesInfo=e;this.mapStyleId=this.map.getMapStyleId();this.releaseOutViewTileData(e);var T=this.getZoomState();if(this.dataType===g3){if(jj){this.getVectorLayerDataFromCache(e,T)}else{this.loadVectorLayerData(e)}}else{this.loadRasterLayerData(e,jj)}},getVectorLayerDataFromCache:function(jo,jy){this.map.temp.isPermitSpotOver=false;this.tileLabels=[];if(this.baseLayer===true){var js=this.map._customLabelMgr.virtualTile;if(js&&js.label){this.tileLabels.push(js.label)}}this.thumbCache={};var jz=-1;for(var jv=0,jt=jo.length;jv<jt;jv++){var jw=jo[jv];var jk=jw.col;var jl=jw.row;var T=jw.zoom;var ju=this._getTileTexImgKey(jw);var jj=jw.useZoom;jz=T;var jm=this.getTileKey(jw);var jB=this.tileCache.getData(jm);if(jB&&jB.status==="ready"){var jC=jB;this.map._featureMgr.setData(jB,this.drawIndex,2);if(jB.label){if(jB.label.status==="ready"){jB.label.tileInfo=jB.tileInfo;this.tileLabels.push(jB.label);if(jB.label.textureSources&&jB.label.textureSources[jj]&&this.map._webglMapScene){var jA=this.map._webglMapScene._painter;if(!jA._labelTextureAtlasOffset[ju]){jA._addToAsyncJob(jB.label.textureSources[jj])}}}else{if(jB.label.status!=="processing"){this.processLabelData(jB)}}}}else{var jx={tileInfo:jw,dataType:g3,key:jm};this.map._featureMgr.setData(jx,this.drawIndex,2);if(this.useThumbData){this.setThumbData(jk,jl,T,jj,jy)}}}this.tileLabels.labelZoom=jz;this.updateLabels(jy);var jp=this.map.getZoom();var jn=Math.floor(jp);var jr=jp-jn;var jq=Math.floor(this.LAST_CALC_ZOOM);var e=this.LAST_CALC_ZOOM-jq;var jD=false;if(this.hasZoomChange){if(Math.abs(jp-this.LAST_CALC_ZOOM)>=0.5){jD=true}else{if(jr<0.5&&e>=0.5){jD=true}else{if(jr>=0.5&&e<0.5){jD=true}}}if(jD){this.cacheDataCollideLabels(0)}this.LAST_CALC_ZOOM=jp}else{if(this.tileLabels.length>0){this.cacheDataCollideLabels(ey.Browser.ie?50:30)}}},loadVectorLayerData:function(jp){this.map.temp.isPermitSpotOver=false;var jo=this;function jn(i,jq){var js=jo.tileCache.getData(jq);if(!js){return}if(!i||i.error){i.event&&bp.fetchDebug&&bp.fetchDebug.sendError({title:i.event.title,msg:i.event.msg,category:bp.fetchDebug.category.AJAX,level:bp.fetchDebug.levels.ERROR,url:i.event.title});var jr=new ff("ontileloaderror");i=i||{};jr.error=i.error||"";jr.message=i.message||"";jo.map.fire(jr);js.status="init";js.reloadTimer=setTimeout(function(){if(js.retry<3){js.retry++;js.status="loading";jo.loadVectorTileData(i.tileInfo,jn)}else{jo.tileCache.removeData(jq)}},4000);jo.map._featureMgr.clearData(jo.drawIndex);jo._checkTilesLoaded();jo.getVectorLayerDataFromCache(jo.curViewTilesInfo,jo.getZoomState());return}if(js.reloadTimer){clearTimeout(js.reloadTimer);js.reloadTimer=null}jo.callbackDataQueue.push([i,jq]);if(jo.processDataTimer){return}jo.processDataTimer=setTimeout(function(){while(jo.callbackDataQueue.length>0){var ju=jo.callbackDataQueue.shift();jo.vectorTileDataCbk(ju[0],ju[1]);jo._checkTilesLoaded()}jo.map._featureMgr.clearData(jo.drawIndex);jo.getVectorLayerDataFromCache(jo.curViewTilesInfo,jo.getZoomState());var jt=new ff("onrefresh");jt.source="webgllayer";jo.map.dispatchEvent(jt);jo.processDataTimer=null},200)}for(var jm=0,jk=jp.length;jm<jk;jm++){var T=jp[jm];var jl=this.getTileKey(T);var e=this.tileCache.getData(jl);if(!e){e={status:"init",tileInfo:T,dataType:g3,key:jl,retry:0}}if(e.status!=="ready"&&e.status!=="loading"){this.numLoading++;e.status="loading";this.tileCache.setData(jl,e);var jj=this.getProcessedLabelZoom(T);if(jj){T.processedLabelZooms=jj}this.loadVectorTileData(T,jn)}}},setThumbData:function(i,jk,jj,e,T){if(T===1){if(this._findParentZoomTile(i,jk,jj,e,8)===false){this._findChildZoomTile(i,jk,jj,e,3)}}else{if(T===-1){if(this._findChildZoomTile(i,jk,jj,e,3)===false){this._findParentZoomTile(i,jk,jj,e,8)}}}this.map._featureMgr.sortThumbData(this.drawIndex)},_findParentZoomTile:function(jm,jv,ju,jk,jp){var jl=dU[this.getMapType()];var T=jl.minDataZoom;var e=jm;var js=jv;var jq=ju;var jr=jk;for(var jo=1;jo<=jp;jo++){var jj=this.tileType.getParentTile(e,js,jq,jr,T);if(jj===null){continue}var jt=this.getTileKey(jj);var jn=this.tileCache.getData(jt);if(jn&&jn.status==="ready"){if(this.thumbCache[jt]){continue}this.map._featureMgr.setData(jn,this.drawIndex,0);this.thumbCache[jt]=true;return true}e=jj.col;js=jj.row;jq=jj.zoom;jr=jj.useZoom}return false},_findChildZoomTile:function(jn,jp,e,jk,jy){var jw=dU[this.getMapType()];var js=jw.maxDataZoom;var jm=jn;var jo=jp;var jq=e;var jj=jk;var jl=true;for(var jv=1;jv<=jy;jv++){var jt=false;var T=this.tileType.getChildTiles(jm,jo,jq,jj,js,jv);if(!T){continue}for(var ju=0;ju<T.length;ju++){var jr=this.getTileKey(T[ju]);var jx=this.tileCache.getData(jr);if(jx&&jx.status==="ready"){if(!this.thumbCache[jr]){this.map._featureMgr.setData(jx,this.drawIndex,1);this.thumbCache[jr]=true}jt=true}else{jl=false}}if(jt){break}}return jl},loadVectorTileData:function(jw,jx){var jk=jw.col;var jl=jw.row;var e=jw.zoom;var ju=jw.baseTileSize;var jj=this.getTilesUrl(new eS(jk,jl),e,ju);var jm=this.map.getPrivateRegions();if(!this.processData&&this.map.getPrivateStatus()&&jm){var js=jw.useZoom;var jr=this.tileType.getMercatorSize(js);var jq=jk*jr;var jp=jl*jr;var jt=new cg(jq+jr/2,jp+jr/2);var jo=new hk(new cg(jq,jp),new cg(jq+jr,jp+jr));var jn=fI()>=1.5?2:1;for(var jv=0;jv<jm.length;jv++){if(jm[jv] instanceof cs){if(jm[jv].crossPoint(jt,jo,js)){var jy={x:jk,y:jl,z:e,mapZoom:js,scalerRadio:jn,textimg:this.map.config.textRenderType==="canvas"?0:1};var T=jm[jv].tileUrlFunction(jj,jy);if(T&&T.url){jj=T.url;T.header&&(jw.header=T.header)}break}}}}if(!jj){return}var jA=this.getTileKey(jw);gF(this.map);if(!this.processData){this.map._workerMgr.loadTileData(jj,jw,jA,jx);return}var jx="cbk"+jA.replace(/-/g,"_");var jz=this;bp[jx]=function(i){var jB=(function(jC){return function(){jC.tileInfo=jw;var jI=jz.processData(jC);if(!jI.road){return}var jF={tileInfo:jw,renderData:{base:[]},status:"ready",key:jA,mapType:jz.mapType};var jL=[];var jO=[];for(var jH=0;jH<jI.road.length;jH++){var jK=jI.road[jH];var jJ=-1;for(var jG=0;jG<jK.length;jG++){var jM=jK[jG];var jN=[];if(jL.length/7+jM[0].length/2>65536){jF.renderData.base.push({type:"line",data:[fQ.toTileSolidLineVertices(jL,4000),new Uint16Array(jO)]});jL=[];jO=[]}for(var jE=0;jE<jM[0].length;jE+=2){jN[jN.length]=[jM[0][jE],jM[0][jE+1]]}var jD=jM[3];fQ.buildData(jN,jM[1],jM[2],jL,jO,jD,jM[4],jH+20,false)}jF.renderData.base.push({type:"line",data:[fQ.toTileSolidLineVertices(jL,4000),new Uint16Array(jO)]})}jz.tileCache.setData(jA,jF);jz.map._featureMgr.clearData(jz.drawIndex);jz.getVectorLayerDataFromCache(jz.curViewTilesInfo,jz.getZoomState());jz.map.dispatchEvent(new ff("onrefresh"))}})(i);jz.map.jobScheduler.addJob(jB);delete bp[jx]};jj+="&fn="+encodeURIComponent(e2+"."+jx);gf.load(jj)},vectorTileDataCbk:function(jj,jk){var jo=new ff("ontileloaded");jo.perfStat=jj.perfStat||[];var e=this.map;e.fire(jo);var i=jj.tileInfo;var T=i.col;var js=i.row;var jr=i.zoom;var jq=i.baseTileSize;var jm=this.tileCache.getData(jk);if(!jm){return}if(!this.showLabel){jj.label=null}jm.renderData=jj;jm.tileInfo=i;var jl=eB.calcLoopParam(T,jr,jq);var jp=jl.geoOffsetX;jm.tileInfo.loopOffsetX=jp;jm.status="ready";jm.mapType=this.mapType;this.tileCache.setData(jk,jm);jm.label=jj.label;jj.label=null;if(jj.indoorData&&e._indoorMgr){e._indoorMgr.setData(jj.indoorData)}var jn="id_"+T+"_"+js+"_"+jr;if(!this.curViewTilesInfo[jn]){e.fire(new ff("ontilenotinview"));return}this.processLabelData(jm);if(jj.indoorData&&e._indoorMgr&&e._indoorMgr.currentUid){this._refreshIndoorData(e._indoorMgr.currentUid,e._indoorMgr.currentFloor)}},_refreshIndoorData:function(jr,jq){var jt=this.map._indoorMgr.getIndoorData(jr);var jw=jt.tileKeys;var ju=Math.floor(this.map.getZoom());for(var jo=0;jo<jw.length;jo++){var jl=jw[jo];var jn=this.tileCache.getData(jl);if(!jn){continue}var jv=jn.renderData;jv.indoorBase=[];jv.indoorBaseContour=[];jv.indoorBorder3D=[];jv.indoorArea3D=[];jn.label.indoorLabel=[];this.labelProcessor.clearCollisionCache(jn.label);for(var jp in jv.indoorData){if(jp==="tileInfo"){continue}var e=jv.indoorData[jp];var jk=e.defaultFloor;if(jp===jr){jk=jq;e.currentFloor=jq}if(e.floors[jk]){if(e.floors[jk].base){for(var jm=0;jm<e.floors[jk].base.length;jm++){jv.indoorBase.push(e.floors[jk].base[jm])}}if(e.floors[jk].contour){for(var jm=0;jm<e.floors[jk].contour.length;jm++){jv.indoorBaseContour.push(e.floors[jk].contour[jm])}}if(e.floors[jk].indoorBorder3D){jv.indoorBorder3D.push(e.floors[jk].indoorBorder3D)}if(e.floors[jk].area3D){jv.indoorArea3D.push(e.floors[jk].area3D)}if(e.floors[jk].pois){jn.label.indoorLabel=jn.label.indoorLabel.concat(e.floors[jk].pois)}}}this.updateAllIconsTextureCoords(jn);var js=this;this.labelProcessor.loadIconImages(jn,function(i){js.updateAllIconsTextureCoords(i)},"indoor");var jj=jl.split("_");var T=parseInt(jj[jj.length-1],10);if(T!==ju){continue}js.map._featureMgr.setData(jn,this.drawIndex,2)}this.dataBackCollideLabels();this.map.dispatchEvent(new ff("onrefresh"))},_removeIndoorData:function(i){if(!i.indoorData){return}for(var e in i.indoorData){if(e==="tileInfo"){continue}this.map._indoorMgr.removeData(e,i.key)}},getProcessedLabelZoom:function(jj){var jk=je.baseZoomInfo[jj.zoom];if(!jk){return false}var T=[];for(var jl=0;jl<jk.length;jl++){var jm=this.getTileKey(jj,{useZoom:jk[jl]});var e=this.tileCache.getData(jm);if(e&&e.status==="ready"&&e.label&&e.label.status==="ready"){T.push(jk[jl])}}if(T.length){return T}else{return false}},getSameZoomDataFromCache:function(T){var jj=je.baseZoomInfo[T.zoom];for(var jk=0;jk<jj.length;jk++){var jl=this.getTileKey(T,{useZoom:jj[jk]});if(T.useZoom===jj[jk]){continue}var e=this.tileCache.getData(jl);if(e&&e.status==="ready"&&e.label&&e.label.status==="ready"){return e}}return false},hasSameLabelData:function(jj,T){for(var e=0;e<T.length;e++){if(T[e].key===jj){return true}}return false},getDataByFloorName:function(T,jj){for(var e=0;e<T.length;e++){if(T[e].floorName===jj){return T[e]}}return null},mergeIndoorLabelData:function(jo,e){for(var jm in jo){if(jm==="tileInfo"){continue}if(e[jm]){var T=jo[jm].floors;var jp=e[jm].floors;for(var jk=0;jk<T.length;jk++){var jj=T[jk];var jn=jj.floorName;var jl=this.getDataByFloorName(jp,jn);if(jl){if(jl.pois){jl.pois=jl.pois.concat(jj.pois);jj.pois=jl.pois}else{jl.pois=jj.pois}}}}}},mergeSameZoomLabelData:function(jm){var jk=jm.label;if(!jk){return}var e=jm.tileInfo;var jl=this.getSameZoomDataFromCache(e);if(!jl){return}var jj=jl.label;if(!jj){return}for(var T=0;T<jk.fixedLabel.length;T++){if(!this.hasSameLabelData(jk.fixedLabel[T].key,jj.fixedLabel)){jj.hasNewData=true;jj.fixedLabel.push(jk.fixedLabel[T])}}for(var T=0;T<jk.lineLabel.length;T++){if(!this.hasSameLabelData(jk.lineLabel[T].key,jj.lineLabel)){jj.hasNewData=true;jj.lineLabel.push(jk.lineLabel[T])}}for(var T=0;T<jk.indoorLabel.length;T++){if(!this.hasSameLabelData(jk.indoorLabel[T].key,jj.indoorLabel)){jj.hasNewData=true;jj.indoorLabel.push(jk.indoorLabel[T])}}jm.label=jj;if(jl.renderData.indoorData&&jm.renderData.indoorData){this.mergeIndoorLabelData(jm.renderData.indoorData,jl.renderData.indoorData)}},processLabelData:function(jl){if(!jl.label){return}if(jl.label.status==="processing"){return}jl.label.status="processing";var jj=this;jj.updateAllIconsTextureCoords(jl);this.labelProcessor.loadIconImages(jl,function(jm){jj.updateAllIconsTextureCoords(jm)});if(this.map.config.textRenderType==="canvas"){var e=this.labelProcessor.drawLabelsOnCanvas(jl,function(jo,jq){var jn=jl.tileInfo;var jp=jj.map.config.mapStyleId;if(!bp["customStyleInfo_"+jp]){jj.mergeSameZoomLabelData(jl)}if(jo){if(!jl.label.textureHeights){jl.label.textureHeights=[]}jl.label.textureHeights[jn.useZoom]=jo.height}if(jq){if(!jl.label.indoorTextureHeights){jl.label.indoorTextureHeights=[]}jl.label.indoorTextureHeights[jn.useZoom]=jq.height}var jm=jj._getTileTexImgKey(jn);jj._doWorkAfterLabelImageLoad(jl,jo,jq,jm)});return}var T=jl.label.textImageBitmap||jl.label.textImgStr;var jk=jl.label.indoorTextImageBitmap||jl.label.indoorTextImgStr;this.labelProcessor.loadImgByStr(T,jk,function i(jr,jp){var jo=jl.label.textureHeight;var js=jl.label.indoorTextureHeight;jl.label.textureHeight=undefined;jl.label.indoorTextureHeight=undefined;var jn=jl.tileInfo;jj.mergeSameZoomLabelData(jl);var jq=jl.label;jq.textImgStr="";jq.indoorTextImgStr&&(jq.indoorTextImgStr="");if(!jq.textureHeights){jq.textureHeights=[]}jq.textureHeights[jn.useZoom]=jo;if(!jq.indoorTextureHeights){jq.indoorTextureHeights=[]}jq.indoorTextureHeights[jn.useZoom]=js;var jm=jj._getTileTexImgKey(jn);jj._doWorkAfterLabelImageLoad(jl,jr,jp,jm)})},_getTileTexImgKey:function(i){var T=i.style||this.mapStyleId||"default";var e=T+"_"+i.col+"_"+i.row+"_"+i.zoom;if(this.map.config.textRenderType==="canvas"){e+="_"+i.useZoom}return e},_doWorkAfterLabelImageLoad:function(jn,jl,jj,i){var jm=this;var jk=jn.label;jk.tileInfo=jn.tileInfo;jk.status="ready";if(jl||jj){var e=jk.tileInfo;if(jl){jl.id=i;if(!jk.textureSources){jk.textureSources=[]}jk.textureSources[e.useZoom]=jl}if(jj){jj.id=i+"_indoor";if(!jk.indoorTextureSources){jk.indoorTextureSources=[]}jk.indoorTextureSources[e.useZoom]=jj}if(jm.map._webglMapScene){var T=jm.map._webglMapScene._painter;if(jl){T._addToAsyncJob(jk.textureSources[e.useZoom])}}}if(jn.custom!==true){jm.tileLabels.push(jk)}if(jm.collisionTimer){return}jm.collisionTimer=setTimeout(function(){jm.dataBackCollideLabels();jm.collisionTimer=null},300)},_updateIconTextureCoords:function(jn,T){if(!jn){return}var jm=this.map;for(var jj=0;jj<jn.length;jj++){var jl=jn[jj];if(!jl.iconPos){continue}if(jm._webglMapScene){var e=jm._webglMapScene._painter;var jk=T+"_"+jl.iconPos.iconType;jl.iconPos.texcoord=e._iconTextureAtlasCoords[jk]||null}}},updateAllIconsTextureCoords:function(jk){if(this.map.viewAnimationTime){return}if(jk){if(jk.label){var i=jk.tileInfo.style;this._updateIconTextureCoords(jk.label.fixedLabel,i);this._updateIconTextureCoords(jk.label.indoorLabel,i)}}else{var jj=this.tileCache.getAllData();for(var T in jj){var e=jj[T].data;if(e.status==="ready"&&e.label){var i=e.tileInfo.style;this._updateIconTextureCoords(e.label.fixedLabel,i);this._updateIconTextureCoords(e.label.indoorLabel,i)}}}this.updateLabels();this.map.dispatchEvent(new ff("onrefresh"))},cacheDataCollideLabels:function(T){var jk=this;var i=this.map._featureMgr;function jj(){jk.cacheLabelTimer=null;var jl;var jm=jk.map.getTilt();var jo=jk.map.getHeading()%360;if(jk.tileLabels.length===0||(jk.tileLabels.length===1&&jk.tileLabels[0].tileInfo.zoom===0)){jl=i.getLabelData();if(jl.length>0){jl=jk.labelProcessor.collisionTest(jl,-1)}}else{if(jm||jo){if(this._collisionTimer){if(!jm){clearTimeout(this._collisionTimer)}else{if(Date.now()-jk.lastCollisionTestTime>500){jk.lastCollisionTestTime=Date.now()}else{clearTimeout(this._collisionTimer)}}}this._collisionTimer=setTimeout(function(){jl=jk.labelProcessor.collisionTest(jk.tileLabels);if(jl){if(jk.map.stencil&&jk.map.stencil.isPoiMask){var jp=jk.isPoiInPolygon(jl);i.setLabelData(jp)}else{i.setLabelData(jl)}}jk.updateLabels();jk.map.dispatchEvent(new ff("onrefresh"));jk._collisionTimer=null},60);return}else{jl=jk.labelProcessor.getCachedLabels(jk.tileLabels)}}if(jl){if(jk.map.stencil&&jk.map.stencil.isPoiMask){var jn=jk.isPoiInPolygon(jl);i.setLabelData(jn)}else{i.setLabelData(jl)}}jk.updateLabels();jk.map.dispatchEvent(new ff("onrefresh"))}if(!T){clearTimeout(jk.cacheLabelTimer);jj()}else{if(jk.cacheLabelTimer){return}jk.cacheLabelTimer=setTimeout(function e(){jj()},T)}},isPoiInPolygon:function(T){var jC=this;var js=jC.map.stencil;var jk=jC.map._featureMgr.result.eleData[9];var jj=[];for(var jx=0;jx<jk.length;jx++){var jt=jk[jx].overlay.points;jj=jj.concat(jt)}for(var jA=1;jA<T.length;jA++){var jm=[];var jl=[];for(var jy=0;jy<T[jA].fixedLabel.length;jy++){var jr=T[jA].fixedLabel[jy];var jv=jr.pt;if(jr.pt&&am(jv,jj)){jm.push(jr)}else{jl.push(jr)}}if(js.showRegion==="inside"){T[jA].fixedLabel=jm}else{if(js.showRegion==="outside"){T[jA].fixedLabel=jl}}var jw=[];var jo=[];for(var jx=0;jx<T[jA].lineLabel.length;jx++){var jz=T[jA].lineLabel[jx];var e=jz.pt;if(e&&am(e,jj)){jw.push(jz)}else{jo.push(jz)}}if(js.showRegion==="inside"){T[jA].lineLabel=jw}else{if(js.showRegion==="outside"){T[jA].lineLabel=jo}}var ju=[];var jq=[];for(var jp=0;jp<T[jA].indoorLabel.length;jp++){var jB=T[jA].indoorLabel[jp];var jn=jB.pt;if(jn&&am(jn,jj)){ju.push(jB)}else{jq.push(jB)}}if(js.showRegion==="inside"){T[jA].indoorLabel=ju}else{if(js.showRegion==="outside"){T[jA].indoorLabel=jq}}}return T},dataBackCollideLabels:function(){var T=this;if((T.tileLabels&&T.tileLabels.length===0)){return}var e;T.labelProcessor.calcLabelsCollision(T.tileLabels);e=T.labelProcessor.getCachedLabels(T.tileLabels);if(e){if(T.map.stencil&&T.map.stencil.isPoiMask){var i=T.isPoiInPolygon(e);T.map._featureMgr.setLabelData(i)}else{T.map._featureMgr.setLabelData(e)}}T.updateLabels();T.map.dispatchEvent(new ff("onrefresh"));if(bK()){this.labelProcessor._refreshSpotData()}},updateLabels:function(jk){var jl=this.map;var i=jl._featureMgr;var T=i.getLabelData();if(T.length>0){var jj=jl.getZoom();if(T.labelZoom-jj<3){this.labelProcessor.updateLabels(T);var e=this.labelProcessor.fixDataFormat(T);i.setOverlayData(e[0],2);i.setOverlayData(e[1],3);i.setOverlayData(e[2],4)}else{i.clearLabelOverlayData()}jl.temp.isPermitSpotOver=false;this.labelProcessor.curSpotAdded=false}},loadRasterLayerData:function(jo,jj){this.thumbCache={};var jp=this.getZoomState();if(jj){for(var jm=0,jk=jo.length;jm<jk;jm++){var T=jo[jm];var jl=this.getTileKey(T);var e=this.tileCache.getData(jl);if(e&&e.status==="ready"){if(T.tileTypeName==="xyz"){e.tileInfo=T}this.map._featureMgr.setData(e,this.drawIndex,2)}else{if(this.useThumbData){this.setThumbData(T.col,T.row,T.zoom,T.useZoom,jp)}}}return}for(var jm=0,jk=jo.length;jm<jk;jm++){var T=jo[jm];var jl=this.getTileKey(T);var e=this.tileCache.getData(jl);if(!e){this.tileCache.setData(jl,{});var jn=this;this.loadRasterTileData(T,function(i,jq){jn.rasterTileDataCbk(i,jq)})}}},loadRasterTileData:function(i,e){var T=new Image();var jk=i.col;var jn=i.row;var jl=i.zoom;var jj=this.getTilesUrl(new eS(jk,jn),jl,i);if(!jj){return}var jm=this.getTileKey(i);if(i.combine){T=jj;T.tileInfo=i;if(T){e&&e(T,jm)}else{e&&e(null,jm)}}else{T=this.loadTileImage(jj,jm,e)}T.tileInfo=i},loadTileImage:function(jj,T,e){var i=new Image();i.crossOrigin="anonymous";i.onload=function(){e&&e(this,T)};i.onerror=function(){bp.fetchDebug&&bp.fetchDebug.sendError({title:jj,msg:jj,category:bp.fetchDebug.category.RESOURCE,level:bp.fetchDebug.levels.ERROR,url:jj});e&&e(null,T)};i.src=jj;return i},rasterTileDataCbk:function(jl,jj){if(!jl||typeof jl==="string"){this.tileCache.removeData(jj);return}var i=jl.tileInfo;var T=i.col;var jr=i.row;var jq=i.zoom;var e=this.tileCache.getData(jj);if(!e){return}var jm="id_"+T+"_"+jr+"_"+jq;var jp=this;e.dataType=f8;e.tileInfo=i;if(i.tileTypeName==="xyz"){var jo=i.tileSize;e.textureSource=jl;e.renderData={vertexAll:[0,0,0,0,0,jo,0,0,1,0,jo,jo,0,1,1,0,0,0,0,0,jo,jo,0,1,1,0,jo,0,0,1]};jp.setRasterTileData(jj,e,jm)}else{e.textureSource=jl;var jk=eB.calcLoopParam(T,jq);var jn=jk.geoOffsetX;jl.tileInfo.loopOffsetX=jn;e.renderData={vertexAll:[0,0,0,0,0,256,0,0,1,0,256,256,0,1,1,0,0,0,0,0,256,256,0,1,1,0,256,0,0,1]};this.setRasterTileData(jj,e,jm)}},setRasterTileData:function(jk,e,jj){e.status="ready";this.tileCache.setData(jk,e);var T=false;if(this.curViewTilesInfo[jj]){e.dataType=f8;e.png8=this.png8||false;this.map._featureMgr.setData(e,this.drawIndex,2);T=true}if(T){var i=new ff("onrefresh");i.source="webgllayer";this.map.dispatchEvent(i)}},_checkTilesLoaded:function(){this.numLoading--;if(this.map.firstTileLoad===false){this.map.dispatchEvent(new ff("onfirsttilesloaded"));this.map.firstTileLoad=true}var e=this;if(this.numLoading===0){if(this._checkLoadedTimer){clearTimeout(this._checkLoadedTimer);this._checkLoadedTimer=null}this._checkLoadedTimer=setTimeout(function(){if(e.numLoading===0){e.map.dispatchEvent(new ff("ontilesloaded"))}e._checkLoadedTimer=null},60)}},isClickableLabel:function(e){if(e.isDel){return false}if(e.zoom>9&&!e.guid){return false}if(e.zoom<=9&&!e.name&&!e.guid){return false}return true}};var aK=5;var ii=4;var f1=3;var H=2;var d0=1;var gR=0;function ap(e){this._ratio=fI();this._iconCache={};this._map=e;this._drawingCanvasPool=[];this._drawingCanvasHeight=4096;this._bufferSpan=[5,5]}ey.extend(ap.prototype,{_loadIcons:function(i,jo,jk){var T=0;var jl=this;var jj=this._map.config.style;for(var jm in i){T++;var jn=new Image();jn.id=jm;jn.crossOrigin="anonymous";jn.onload=function(){jl._iconCache[this.id].loaded=true;T--;if(T===0){jo()}this.onload=null};jn.onerror=function(){jl._iconCache[this.id]=null;T--;if(T===0){jo()}this.onerror=null};if(!jk){var e=w.getIconSetPath(jj)+jm+".png"}else{var e=jm}jn.src=e;this._iconCache[jm]={loaded:false,image:jn}}},_getEmptyDrawingCanvas:function(){for(var T=0;T<this._drawingCanvasPool.length;T++){if(this._drawingCanvasPool[T]._free===true){this._drawingCanvasPool[T]._free=false;return this._drawingCanvasPool[T]}}var e=this._createNewDrawingCanvas();this._drawingCanvasPool.push(e);e._free=false;return e},_createNewDrawingCanvas:function(){var e=bL("canvas");e.width=512;e.height=this._drawingCanvasHeight;e._free=true;e._id=bp.getGUID();var i=e.getContext("2d");i.textBaseline="bottom";i.lineJoin="round";return e},drawLabelsOnCanvas:function(jB,jj){var jr=jB.label.fixedLabel.slice(0);var jx=jB.label.lineLabel.slice(0);var T=jB.label.indoorLabel.slice(0);if(jr.length===0&&jx.length===0&&T.length===0){jj();return}var jm=function(jG,i){return jG.styleId-i.styleId};jr.sort(jm);jx.sort(jm);T.sort(jm);var jA={};var e=this._getEmptyDrawingCanvas();var jw=e.getContext("2d");jw.clearRect(0,0,e.width,e.height);var jE=0;var js=null;var jl=0;if(jr.length>0){while(jl<jr.length&&!jr[jl].styleText[0]){jl++}if(jr[jl]&&jr[jl].styleText[0]){js=jr[jl].styleText[0].fontSize+jr[jl].styleText[0].haloSize*2}}if(js===null&&T.length>0){jl=0;while(jl<T.length&&!T[jl].styleText[0]){jl++}if(T[jl]&&T[jl].styleText[0]){js=T[jl].styleText[0].fontSize+T[jl].styleText[0].haloSize*2}}if(js===null&&jx.length>0){jl=0;while(jl<jx.length&&!jx[jl].styleText[0]){jl++}if(jx[jl]&&jx[jl].styleText[0]){js=jx[jl].styleText[0].fontSize+jx[jl].styleText[0].haloSize*2}}if(js===null||isNaN(js)){jj();return}var jo=0;var jn=js;jn+=this._bufferSpan[1];var ju={};var jF=0;var jv=[];for(var jz=0;jz<jr.length;jz++){var jq=jr[jz];var jt=jq.name;var jy=jq.styleText;if(!jt||jy.length===0){continue}var jk=jq.icon;if(jq.textOnIcon&&(!this._iconCache[jk]||this._iconCache[jk].loaded===false)){jv.push(jq);jF++;if(!ju[jk]){ju[jk]=true}continue}var jC=this._drawEachText(jw,jq,jE,jo,jn,js,jA);if(!jC){continue}jo=jC.curX;jn=jC.curY;js=jC.curLineHeight;jE=jC.styleId}var jC=this._drawEachTypeOfLabels(jw,T,jE,jo,jn,js,jA);jE=jC.curStyleId;jo=jC.curX;jn=jC.curY;js=jC.curLineHeight;var jC=this._drawEachTypeOfLabels(jw,jx,jE,jo,jn,js,jA);jE=jC.curStyleId;jo=jC.curX;jn=jC.curY;js=jC.curLineHeight;if(jF>0){var jD=this;this._loadIcons(ju,function(){jC=jD._drawEachTypeOfLabels(jw,jv,jE,jo,jn,js,jA);jE=jC.curStyleId;jo=jC.curX;jn=jC.curY;js=jC.curLineHeight;var i=jD._generateEachLabelCanvas(e,jn,jr,jx,T,jB);jj(i[0],i[1])});return}var jp=this._generateEachLabelCanvas(e,jn,jr,jx,T,jB);jj(jp[0],jp[1])},drawCustomLabelsOnCanvas:function(jm,jt){if(jm.length===0){jt();return}var T=0;var e=(jm[0].style.fontSize+(jm[0].style.haloSize||0)*2)||0;var jj=e;e+=this._bufferSpan[1];var jo=this._getEmptyDrawingCanvas();var jv=jo.getContext("2d");jv.clearRect(0,0,jo.width,jo.height);var jp={};var jr=-1;var jk={};var js=false;for(var jl=0;jl<jm.length;jl++){var jn=null;if(jm[jl].textOnIcon&&jm[jl].icon){jn=jm[jl].icon}if(jn&&!jk[jn]&&(!this._iconCache[jn]||this._iconCache[jn].loaded===false)){jk[jn]=true;js=true}}var ju=this;if(js){this._loadIcons(jk,function(){jq()},true)}else{jq()}function jq(){for(var jy=0;jy<jm.length;jy++){if(!jm[jy].name){continue}var jz=ju._drawEachText(jv,jm[jy],jr,T,e,jj,jp);if(!jz){continue}T=jz.curX;e=jz.curY;jj=jz.curLineHeight;jr=jz.styleId}var jx=e;var jw=ju._copyToNewCanvas(jo,jx);for(var jy=0;jy<jm.length;jy++){if(!jm[jy].name&&jm[jy].style.iconSize){ju._addFixedLabelBounds(jm[jy]);continue}if(!jm[jy].textSize){continue}ju._updateFixedLabelCoords(jm[jy],jx);ju._addFixedLabelBounds(jm[jy])}jt(jw)}},_drawEachTypeOfLabels:function(js,jm,jq,jj,T,jk,jo){for(var jl=0;jl<jm.length;jl++){var jn=jm[jl];var jr=jn.name;var e=jn.styleText;if(!jr||e.length===0){continue}var jp=this._drawEachText(js,jn,jq,jj,T,jk,jo);if(!jp){continue}jj=jp.curX;T=jp.curY;jk=jp.curLineHeight;jq=jp.styleId;if(jp.curY>this._drawingCanvasHeight){return{curX:jj,curY:T,curLineHeight:jk,curStyleId:jq}}}return{curX:jj,curY:T,curLineHeight:jk,curStyleId:jq}},_drawIndoorTextLabelOnCanvas:function(jk){var e=this._getEmptyDrawingCanvas();var jr=e.getContext("2d");jr.clearRect(0,0,e.width,e.height);var jz=0;var jq=null;var jp=0;var jn;var jw={};var jv=[];for(var jl in jk){if(jl==="tileInfo"){continue}var jj=jk[jl];var ju=jj.defaultFloor;var jo=jj.floors;for(var jt=0;jt<jo.length;jt++){if(jt===ju){continue}var jx=jo[jt];if(!jx.pois){continue}var jm=jx.pois;for(var js=0;js<jm.length;js++){if(jq===null&&jm[js].styleText[0]){jq=jm[js].styleText[0].fontSize+jm[js].styleText[0].haloSize*2;jn=jq}jv.push(jm[js])}}}if(jq===null){return null}jv.sort(function(jA,i){return i.rank-jA.rank||jA.styleId-i.styleId});var jy=this._drawEachTypeOfLabels(jr,jv,jz,jp,jn,jq,jw);jz=jy.curStyleId;jp=jy.curX;jn=jy.curY;jq=jy.curLineHeight;var T=this._copyToNewCanvas(e,jn);return T},_updateIndoorLabelsCoords:function(jq,jr){for(var jp in jq){if(jp==="tileInfo"){continue}var e=jq[jp];var jl=e.defaultFloor;var jm=e.floors;for(var jn=0;jn<jm.length;jn++){if(jn===jl){continue}var T=jm[jn];if(!T.pois){continue}var jk=T.pois;for(var jj=0;jj<jk.length;jj++){var jo=jk[jj];if(jo.name&&(!jo.textSize||jo.textSize.length===0)){jk.splice(jj,1);jj--;continue}this._updateFixedLabelCoords(jo,jr);this._addFixedLabelBounds(jo)}}}},_generateEachLabelCanvas:function(jm,jl,jn,e,jp,T){jl=Math.min(jl,this._drawingCanvasHeight);var jo=this._copyToNewCanvas(jm,jl);var jj=null;if(T.renderData.indoorData){jj=this._drawIndoorTextLabelOnCanvas(T.renderData.indoorData);if(jj){this._updateIndoorLabelsCoords(T.renderData.indoorData,jj.height)}}for(var jk=0;jk<jn.length;jk++){if(!jn[jk].textSize){continue}this._updateFixedLabelCoords(jn[jk],jl);this._addFixedLabelBounds(jn[jk])}for(var jk=0;jk<jp.length;jk++){if(!jp[jk].textSize){continue}this._updateFixedLabelCoords(jp[jk],jl);this._addFixedLabelBounds(jp[jk])}for(var jk=0;jk<e.length;jk++){this._updateLineLabelCoords(e[jk],jl)}return[jo,jj]},_copyToNewCanvas:function(T,i){if(i===0){return null}var jj=bL("canvas");jj.width=T.width;jj.height=i;var e=jj.getContext("2d");e.drawImage(T,0,0,512,i,0,0,512,i);jj._id=T._id;T._free=true;return jj},_drawEachText:function(jB,jn,T,jD,jC,jK,jk){jD+=this._bufferSpan[0];var jJ=jn.name;var js=jn.styleText?jn.styleText[0]:jn.style;if(!js){return null}var jv=js.fontSize;var jO=js.fontWeight;var j1=js.haloSize||0;if(!jw){}if(js.fontRgba){var j7=js.fontRgba[3]/255;var jr=[];jr[3]=j7;for(var j6=0;j6<3;j6++){jr[j6]=js.fontRgba[j6]}}if(js.haloRgba){var j7=js.haloRgba[3]/255;var jy=[];jy[3]=j7;for(var j6=0;j6<3;j6++){jy[j6]=js.haloRgba[j6]}}var jV=jr?"rgba("+jr.join(",")+")":js.color;var jm=jy?"rgba("+jy.join(",")+")":js.strokeColor;var j3=jn.styleId||0;if(j1>4){j1=4}var jL=[];var jA=[];var jH=0;if(jk&&!jk[j3]){jk[j3]={}}var ju=jv+j1*2;var jM=ju;if(jn.containDescendings){jM+=4}if(j1===0){jM+=2}if(jn.textOnIcon){jM=Math.max(jM,jn.iconSize[1])}if(j3!==T||jM>jK){T=j3;if(jO>=10&&jO%10===0){jB.font=jO*10+" "+jv+"px sans-serif"}else{jB.font=jv+"px sans-serif"}if(jM>jK){var jI=jM-jK;jK+=jI;jC+=jI}if(j1>0){jB.lineWidth=j1*2;jB.strokeStyle=jm}jB.fillStyle=jV}if(jn.type==="line"){var jp=jJ.split("");for(var j4=0;j4<jp.length;j4++){var jX=jp[j4];var jE;var jP;if(jk[j3][jX]){var jw=jk[j3][jX];jE=jw.displaySize;jP=jw.curWordPosition}else{var jj=Math.ceil(jB.measureText(jX).width);if(jD+jj>512){jD=0+this._bufferSpan[0];jC+=jM;jC+=this._bufferSpan[1];jK=jM}if(jC>this._drawingCanvasHeight){return{curX:jD,curY:jC,curLineHeight:jK,styleId:j3}}var jY=jD;if(j1>0){jj+=j1;jY-=Math.round(j1/2);jB.strokeText(jX,jD,jC)}jB.fillText(jX,jD,jC);var jU=[jj,jM];jE=[Math.round(jU[0]/2),Math.round(jU[1]/2)];jP=[jY,jC-jM];jk[j3][jX]={displaySize:jE,curWordPosition:jP,totalHeight:jH};jD+=jj+2}jL.push(jE);jA.push(jP)}jH=Math.round(jL[0][1])}else{if(jk[j3][jJ]){var jw=jk[j3][jJ];jL=jw.textSize;jA=jw.labelImagePosition;jH=jw.totalHeight}else{var jx=jJ.split("\\");if(jx.length>1&&jn.textOnIcon){var j5=0;var j2=0;var j8=[];var jF=8;for(var j4=0;j4<jx.length;j4++){var jJ=jx[j4];var jt=Math.ceil(jB.measureText(jJ).width);if(jt>j5){j5=jt}j8.push(Math.round(jt/2));j2+=jM}var jq=j5+2*jF;var j0=j2+2*jF;if(jD+jq>512){jD=0+this._bufferSpan[0];jC+=jK;jC+=this._bufferSpan[1]}jC+=j2-jM+2*jF;var jT=jD;var jG=jC-j0;var e=Math.round(jq/2);var jz=this._iconCache[jn.icon].image;this.drawStretchedIcon(jB,jz,[jT,jG],jF,j5,j2);for(var j4=0;j4<jx.length;j4++){var jJ=jx[j4];var jZ=jT+(e-j8[j4]);var jW=jG+4+(j4+1)*jM;jB.fillText(jJ,jZ,jW)}jL.push([Math.round(jq/2),Math.round(j0/2)]);jA.push([jT,jG]);jD+=jq;jK=j0;jH=Math.round(j0/2)}else{for(var j4=0;j4<jx.length;j4++){var jJ=jx[j4];var jt=Math.ceil(jB.measureText(jJ).width);var jq=jt;var jl=0;if(jn.textOnIcon){jl=10;jq+=jl*2;if(jn.styleId===519){jq=jn.iconSize[0];jl=Math.round((jq-jt)/2)}}if(jD+jq>512){jD=0+this._bufferSpan[0];jC+=jM;jC+=this._bufferSpan[1];jK=jM}if(jC>this._drawingCanvasHeight){return{curX:jD,curY:jC,curLineHeight:jK,styleId:j3}}var jT=jD;var jG=jC-jM;var jS=jD;var jR=jC;if(jn.containDescendings){jR-=4}if(jn.textOnIcon){var jN=false;var jz=this._iconCache[jn.icon].image;var jQ=jn.iconSize.concat([]);if(ju>=jQ[1]){jQ[1]=ju;jN=true;jM+=jl*2;var jI=jM-jK;if(jI>0){jC+=jI;jK=jM;jR+=jI/2}else{jR-=jl;jG-=jl*2}}if(jt>=jQ[0]){jQ[0]=jt}if(jn.styleId===519){jB.drawImage(jz,0,0,jQ[0],jQ[1],jT,jG,jQ[0],jQ[1])}else{if(jN){this.drawStretchedIcon(jB,jz,[jT,jG],jl,jt,jQ[1])}else{this.draw3StretchedIcon(jB,jz,[jT,jG],jl,jt,jQ[1])}}jS+=jl;if(jn.iconSize[1]>ju){jR-=(jn.iconSize[1]-ju)/2-1}jq+=1}if(j1>0){if(j3===71028){jM-=2}if(j3===32){jM-=2}jB.strokeText(jJ,jS,jR)}jB.fillText(jJ,jS,jR);var jo=[jq,jM];var jE=[Math.round(jo[0]/2),Math.round(jo[1]/2)];jL.push(jE);jA.push([jT,jG]);jH+=Math.round(jE[1]);jD+=jq}}jk[j3][jJ]={textSize:jL,labelImagePosition:jA,totalHeight:jH}}}jn.textSize=jL;jn.labelImagePosition=jA;jn.totalHeight=jH;return{curX:jD,curY:jC,curLineHeight:jK,styleId:j3}},drawStretchedIcon:function(e,T,jj,jm,jn,i){var jl=jj[0];var jk=jj[1];e.drawImage(T,0,0,jm,jm,jl,jk,jm,jm);e.drawImage(T,jm,0,1,jm,jl+jm,jk,jn,jm);e.drawImage(T,T.width-jm,0,jm,jm,jl+jn+jm,jk,jm,jm);e.drawImage(T,0,jm,jm,1,jl,jk+jm,jm,i);e.drawImage(T,jm,jm,1,1,jl+jm,jk+jm,jn,i);e.drawImage(T,T.width-jm,jm,jm,1,jl+jn+jm,jk+jm,jm,i);e.drawImage(T,0,T.height-jm,jm,jm,jl,jk+i+jm,jm,jm);e.drawImage(T,jm,T.height-jm,1,jm,jl+jm,jk+i+jm,jn,jm);e.drawImage(T,T.width-jm,T.height-jm,jm,jm,jl+jn+jm,jk+i+jm,jm,jm)},draw3StretchedIcon:function(e,i,T,jl,jn,jm){var jk=T[0];var jj=T[1];e.drawImage(i,0,0,jl,i.height,jk,jj,jl,i.height);e.drawImage(i,jl,0,1,i.height,jk+jl,jj,jn,i.height);e.drawImage(i,i.width-jl,0,jl,i.height,jk+jl+jn,jj,jl,i.height)},_updateFixedLabelCoords:function(jk,jz){if(jz===0){return}var ju=[];var jG=[];var jH=0;var jx=jk.totalHeight;var jP=jk.textSize.length;var jl=jk.direction;if(typeof jl!=="number"){jl=0}for(var jI=0;jI<jP;jI++){var jA=jk.labelImagePosition[jI];var jy=jk.textSize[jI];var jw=jA[0];var jj=jA[1];var jm=jy[0];var jr=jy[1];var jt=0;var jF=0;if(typeof jk.textMargin==="number"){jF=jk.textMargin}var js;var e;var jo=0;var jv=0;if(!jk.iconPos){if(!jk.custom){jl=ii}}else{jo=jk.iconPos.width;jv=jk.iconPos.height}switch(jl){case f1:var T=jx/2-jr+jt*(jP-1)/2;js=Math.round(-jo/2-jm-jF);e=Math.round(T-jH-jt*jI);break;case d0:var T=jx/2-jr+jt*(jP-1)/2;js=Math.round(jo/2+jF);e=Math.round(T-jH-jt*jI);break;case H:var T=jv/2+jx-jr+jt*jP;js=Math.round(-jm/2);e=Math.round(T-jH-jt*jI);break;case gR:var T=-jv/2-jt-jr;js=Math.round(-jm/2);e=Math.round(T-jH-jt*jI);break;case ii:var T=-jx/2-jt*(jP-1)/2;js=Math.round(-jm/2);e=Math.round(T-jH-jt*jI);break}jH+=jr;var jq=js+jm;var jQ=e;var jp=jq;var jO=jQ+jr;var jn=js;var jN=jO;ju.push(js,e,jq,jQ,jp,jO,js,e,jp,jO,jn,jN);var jM=jw/512;var jE=(jz-jj-jr*2)/jz;var jL=(jw+jm*2)/512;var jD=jE;var jK=jL;var jC=(jz-jj)/jz;var jJ=jM;var jB=jC;jG.push(jM,jE,jL,jD,jK,jC,jM,jE,jK,jC,jJ,jB)}if(!jk.textPos){jk.textPos={}}jk.textPos.vertex=ju;jk.textPos.texcoord=jG},_addFixedLabelBounds:function(jp){var jl=1000;var jj=1000;var T=-1000;var e=-1000;if(jp.iconPos){var jn=jp.iconPos["vertex"];for(var jo=0,jk=jn.length;jo<jk;jo+=2){var jt=jn[jo];var jr=jn[jo+1];if(jt<jl){jl=jt}if(jt>T){T=jt}if(jr<jj){jj=jr}if(jr>e){e=jr}}}if(jp.custom&&jp.style.iconSize&&!jp.name){var jq=jp.style.iconSize;var js=jp.direction;switch(js){case ii:jl=-Math.round(jq[0]/2);jj=-Math.round(jq[1]/2);T=Math.round(jq[0]/2);e=Math.round(jq[1]/2);break;case H:jl=-Math.round(jq[0]/2);jj=0;T=Math.round(jq[0]/2);e=jq[1];break}}if(jp.textPos){var jm=jp.textPos["vertex"];for(var jo=0,jk=jm.length;jo<jk;jo+=2){var jt=jm[jo];var jr=jm[jo+1];if(jt<jl){jl=jt}if(jt>T){T=jt}if(jr<jj){jj=jr}if(jr>e){e=jr}}}jp.bds=[jl,jj,T,e]},_updateLineLabelCoords:function(jA,jq){if(jq===0){return}var jj=jA.wordsInfo;var jx=jA.wordCount;if(!jA.labelImagePosition){return}var js=jA.labelImagePosition.slice(0);if(jA.reverse){js.reverse()}var jJ=1000;var jG=1000;var jH=-1000;var jF=-1000;for(var jB=0;jB<jx;jB++){var jK=js[jB];var jI=jK[0];var jy=jK[1];var jw=jA.textSize[jB];var jp=jw[0];var e=jw[1];var jo=jI/512;var jv=(jq-jy-e*2)/jq;var jm=(jI+jp*2)/512;var ju=jv;var jk=jm;var jt=(jq-jy)/jq;var T=jo;var jr=jt;jj[jB].size=[jp,e];jj[jB].texcoord=[jo,jv,jm,ju,jk,jt,jo,jv,jk,jt,T,jr];var jE=jj[jB].offset[0];var jD=jj[jB].offset[1];var jC=jE-jp/2;var jn=jD+e/2;var jl=jD-e/2;var jz=jE+jp/2;if(jC<jJ){jJ=jC}if(jz>jH){jH=jz}if(jl<jG){jG=jl}if(jn>jF){jF=jn}}jA.bds=[jJ,jG,jH,jF]}});var fx={0:"00000000",16:"00010000",32:"00100000",48:"00110000",64:"01000000",96:"01100000"};function dS(T,jj,jk){var e=T.bds;if(!e){return false}var i=T.tracer;var jn;if(i){if(!fx[i]){jn=i.toString(2);if(jn.length<8){jn=new Array(8-jn.length+1).join("0")+jn}fx[i]=jn}jn=fx[i];var jm=je.mapZoomStartZoomMapping[jj];return jn[jj-jm]==="1"}var jl=T.displayRange;if(jk>=jl[0]&&jk<=jl[1]){return true}return false}function io(i,e){this.map=i.map;this.layer=i;e=e||[];this.allLabels=[];this._spotData=[];this._strategyInfo=null;this.RANK1=1000000;this.RANK2=2000000;this.RANK3=3000000;this.RANK4=4000000;this.RANK5=5000000;this._ratio=fI();this._useRound=true;this._sharpenRender=false;if(this._ratio>g5.HIGH_RES_MIN_RATIO){this._useRound=false;this._sharpenRender=true}this._mapIsMoving=false;this._onMapIdleCallback=e.onMapIdleCallback;this.map.temp.isPermitSpotOver=true;this.currentSelectedLabel=null;this.map._labelProcessor=this;this.iconCache=new at((bK()||ey.Browser.ie)?64:128,{clearCallback:function(T){}});this.fixedLabelData=[];this.lineLabelData=[];this.highlightLabelData=[];this._iconLoadTimer=null;this._labelTextCanvas=null;if(this.map.config.textRenderType==="canvas"){this._labelTextCanvas=this.map.tileMgr.getLabelTextCanvas()}this.bind()}ey.extend(io.prototype,{bind:function(){var T=this.map;var i=this;T.addEventListener("mapstatusbusy_inner",function(jj){i._mapIsMoving=true;if(i._ratio>g5.HIGH_RES_MIN_RATIO){i._sharpenRender=false}else{i._useRound=false}});T.addEventListener("mapstatusidle_inner",function(jj){if(i._ratio>g5.HIGH_RES_MIN_RATIO){i._sharpenRender=true}else{i._useRound=true}i._mapIsMoving=false});T.addEventListener("onspotmouseover",function(jl){if(!this.temp.isPermitSpotOver){return}if(jl.spots.length>0){var jk=jl.spots[0].userdata.uid;var jm=jl.spots[0].userdata.tilePosStr;var jj=i.getLabelByUid(jk,jm);jj&&jj.formatedData&&i._toHighlightColor(jj.formatedData)}});T.addEventListener("onspotmouseout",function(jl){if(!this.temp.isPermitSpotOver){return}if(jl.spots.length>0){var jk=jl.spots[0].userdata.uid;var jm=jl.spots[0].userdata.tilePosStr;var jj=i.getLabelByUid(jk,jm);jj&&jj.formatedData&&i._toDefaultColor(jj.formatedData)}});T.addEventListener("spotclick",function(jl){if(jl.spots&&jl.spots.length>0){if(jl.spots[0].userdata.zoom<10){return}var jk=jl.spots[0].userdata.uid;var jm=jl.spots[0].userdata.tilePosStr;if(i.currentSelectedLabel&&(i.currentSelectedLabel.uid!==jk||i.currentSelectedLabel.tilePosStr!==jm)){i._recoverNormalState()}var jj=i.getLabelByUid(jk,jm);jj&&i._changeBaseMapState(jj)}else{i._recoverNormalState()}});T.on("spot_status_reset",function(){i._recoverNormalState()});T.on("spot_highlight",function(jk){var jj=i.getLabelByUid(jk.uid,jk.tilePosStr);jj&&jj.formatedData&&i._toHighlightColor(jj.formatedData)});T.addEventListener("mousemove",function(jj){if(i.curSpotAdded){return}if(this.currentOperation!==dO.idle||i._mapIsMoving===true){return}i._refreshSpotData();this.temp.isPermitSpotOver=true;i.curSpotAdded=true});if(bK()){function e(){i._refreshSpotData()}T.addEventListener("mapstatusidle_inner",e)}T.on("style_loaded",function(){if(i.map.config.textRenderType==="canvas"&&!i._labelTextCanvas){i._labelTextCanvas=i.map.tileMgr.getLabelTextCanvas()}})},getLabelByUid:function(jn,jo){var e=this.map._featureMgr.getResult().tileLabels;for(var jm=0;jm<e.length;jm++){var jj=e[jm].fixedLabel;for(var jl=0;jl<jj.length;jl++){if(e[jm].fixedLabel[jl].guid===jn&&e[jm].fixedLabel[jl].tilePosStr===jo){return e[jm].fixedLabel[jl]}}var jk=e[jm].indoorLabel;for(var T=0;T<jk.length;T++){if(e[jm].indoorLabel[T].guid===jn&&e[jm].indoorLabel[T].tilePosStr===jo){return e[jm].indoorLabel[T]}}}return null},getTileByLabelUid:function(jn){var e=this.map._featureMgr.getResult().tileLabels;for(var jm=0;jm<e.length;jm++){var jj=e[jm].fixedLabel;for(var jl=0;jl<jj.length;jl++){if(e[jm].fixedLabel[jl].guid===jn){return e[jm]}}var jk=e[jm].indoorLabel;for(var T=0;T<jk.length;T++){if(e[jm].indoorLabel[T].guid===jn){return e[jm]}}}return null},_toHighlightColor:function(T){if(T.tempRank&&T.tempRank===this.RANK5){return}var e=this.map._featureMgr.getResult().eleData[4]||[];var jk=false;for(var jj=0;jj<e.length;jj++){if(e[jj]===T||(e[jj].guid===T.guid&&e[jj].tilePosStr===T.tilePosStr&&e[jj].zoom===T.zoom)){jk=true;break}}if(jk){return}e.push(T);this.map._featureMgr.setOverlayData(e,4);this.map.dispatchEvent(new ff("onrefresh"))},_toDefaultColor:function(T){if(T.tempRank&&T.tempRank===this.RANK5){return}var e=this.map._featureMgr.getResult().eleData[4]||[];for(var jj=0;jj<e.length;jj++){if(T===e[jj]||(T.guid===e[jj].guid&&T.tilePosStr===e[jj].tilePosStr&&T.zoom===e[jj].zoom)){e.splice(jj,1);break}}this.map._featureMgr.setOverlayData(e,4);this.map.dispatchEvent(new ff("onrefresh"))},_changeBaseMapState:function(i){var jk=i.guid;var jo=i.formatedData.guidExt;var jp={guid:jk,tilePosStr:i.tilePosStr,guidExt:jo};this._strategyInfo=jp;this.currentSelectedLabel=i;var jj=this.map._featureMgr;var e=jj.getLabelData();e=this.collisionTest(e);this.updateLabels(e);var jq=this.fixDataFormat(e);jj.setOverlayData(jq[0],2);jj.setOverlayData(jq[1],3);jj.setOverlayData(jq[2],4);var T=this.getTileByLabelUid(jk);this.currentSelectedLabel.tileInfo=T.tileInfo;var jn=this.layer.tileCache.getAllData();for(var jm in jn){var jl=jn[jm].data;if(!jl.label){continue}this.clearCollisionCache(jl.label)}this.map.dispatchEvent(new ff("onrefresh"))},_recoverNormalState:function(){this._strategyInfo=null;var jn=false;var jl=this.map._featureMgr.getLabelData();if(this.currentSelectedLabel){var T=this.currentSelectedLabel.guid;this.clearCollisionCache(this.getTileByLabelUid(T));var jk=this.layer.tileCache.getAllData();for(var jj in jk){if(Object.prototype.hasOwnProperty.call(jk,jj)){var jm=jk[jj].data;if(!jm.label){continue}this.clearCollisionCache(jm.label)}}this.currentSelectedLabel.tempRank=null;this.currentSelectedLabel=null;jn=true}jl=this.collisionTest(jl);this.updateLabels(jl);var e=this.fixDataFormat(jl);var i=this.map._featureMgr;i.setOverlayData(e[0],2);i.setOverlayData(e[1],3);i.setOverlayData([],4);this.map.dispatchEvent(new ff("onrefresh"));if(jn){this.curSpotAdded=false;this._refreshSpotData()}},loadIconImages:function(jk,jw,jq){var jn=jk.label;var jl=jk.tileInfo.style;var T=jn.fixedLabel;if(jq==="indoor"){T=[]}var jt=jn.indoorLabel;var jx=T.length+jt.length;var jp=this;var jj=0;var jv=200;for(var jm=0;jm<jx;jm++){var jo;if(jm<T.length){jo=T[jm]}else{jo=jt[jm-T.length]}if(!jo.iconPos){continue}var js=jo.iconPos.iconType;var ju=jl+"_"+js;jj++;if(this.iconCache.getData(ju)){if(this.iconCache.getData(ju).loaded){jw(jk)}continue}if(!jq||jq==="indoor"){var e=w.getIconSetPath(this.map.config.style)+js+".png"}else{var e=js}var jr=new Image();jr.id=ju;jr.iconUrl=e;jr.crossOrigin="anonymous";jr.onload=function(){if(jp.iconCache.getData(this.id)){jp.iconCache.getData(this.id).loaded=true;jp._addToIconTexture(this)}if(jp._iconLoadTimer===null){jp._iconLoadTimer=setTimeout(function(){jw();jp._iconLoadTimer=null},jv)}this.onload=null};jr.onerror=function(){if(!jp._iconLoadTimer){jp._iconLoadTimer=setTimeout(function(){jw();jp._iconLoadTimer=null},jv)}jp.iconCache.removeData(this.id);this.onerror=null;bp.fetchDebug&&bp.fetchDebug.sendError({title:this.iconUrl,msg:this.iconUrl,category:bp.fetchDebug.category.RESOURCE,level:bp.fetchDebug.levels.ERROR,url:this.iconUrl})};jr.src=e;this.iconCache.setData(ju,{loaded:false,image:jr})}return jj},_addToIconTexture:function(jl){if(!this.map._webglMapScene){return}var jn=this.map._webglMapScene._painter;var e=jn._iconTextureAtlas.addTexture(jl);jn._iconTextureAtlasOffset[jl.id]=e;var jq=0*jl.width/1024+e.width;var jk=0*jl.height/1024+e.height;var jp=jl.width/1024+e.width;var jj=jk;var jo=jp;var T=jl.height/1024+e.height;var jm=jq;var i=T;jn._iconTextureAtlasCoords[jl.id]=[jq,jk,jp,jj,jo,T,jq,jk,jo,T,jm,i]},loadImgByStr:function(jj,jk,jl){if(!jj&&!jk){jl&&jl(null,null);return}if(typeof jj==="object"&&typeof jk==="object"){jl(jj,jk);return}var i=0;var T=null;var e=null;if(jj){i++;T=new Image();T.onload=function(){i--;if(i===0){jl&&jl(this,e)}this.onload=null};T.src=jj}if(jk){i++;e=new Image();e.onload=function(){i--;if(i===0){jl&&jl(T,this)}this.onload=null};e.src=jk}},collisionTest:function(jz,kp,jU){if(this.map.viewAnimationTime){return[]}if(!jz){return[]}var jK=this.map;var j5=jK.getHeading();j5=this.calcLoopHeading(j5);var kf=jK.height;var kb=this.allLabels;kb.length=0;jz.sort(function(j1,i){var ks=j1.tileInfo;var j2=i.tileInfo;if(ks.col*ks.row<j2.col*j2.row){return -1}else{return 1}});var jL=jK.getTilt();var jB=jK.getZoom();var ka;if(jU){ka=jU}else{ka=this.getZoomStep()}for(var kl=0,kg=jz.length;kl<kg;kl++){var jP=jz[kl];var jx=jP.tileInfo;var jr=jx.zoom;var j9=jx.loopOffsetX/Math.pow(2,18-jr);if(!j5&&!jL){if(jP.unnecessaryCollisionTest&&jP.unnecessaryCollisionTest[jU]){continue}}var jZ=jP.fixedLabel||[];for(var kj=0,jR=jZ.length;kj<jR;kj++){var ju=jZ[kj];ju.zoom=jr;if(kp===-1&&ju.isDel){continue}if(!dS(ju,jx.useZoom,jB)){ju.isDel=true;continue}this.calcCollisionBounds(ju,ka,j9,kf);kb.push(ju)}var jX=jP.indoorLabel||[];for(var kh=0,jm=jX.length;kh<jm;kh++){var jM=jX[kh];jM.zoom=jr;if(kp===-1&&jM.isDel){continue}if(!dS(jM,jx.useZoom)){jM.isDel=true;continue}this.calcCollisionBounds(jM,ka,j9,kf);kb.push(jM)}var jw=jP.lineLabel||[];for(var km=0,jF=jw.length;km<jF;km++){var jj=jw[km];if(kp===-1&&jj.isDel){continue}if(!dS(jj,jx.useZoom)){jj.isDel=true;continue}var kr=jj.pt;var jT=jK.pointToPixelIn(kr,{zoom:ka,useRound:this._useRound});var jQ=jT.x+j9;var jO=kf-jT.y;var jW=jj.bds;var ke=jW[0];var kc=jW[1];var jI=jW[2];var jH=jW[3];var j6=ke;var j4=kc;var jE=jI;var jD=jH;if((j5>=0&&j5<45)||(j5>=315&&j5<360)){j6=ke;j4=kc;jE=jI;jD=jH}else{if(j5>=45&&j5<135){j6=kc;j4=-jI;jE=jH;jD=-ke}else{if(j5>=135&&j5<225){j6=-jI;j4=-jH;jE=-ke;jD=-kc}else{if(j5>=225&&j5<315){j6=-jH;j4=ke;jE=-kc;jD=jI}}}}jj._tempBds=[jQ+j6,jO+j4,jQ+jE,jO+jD];var jy=jK.pixelToPointIn(new eS(jj._tempBds[0],jT.y+j4),{zoom:ka});var jl=jK.pixelToPointIn(new eS(jj._tempBds[2],jT.y+jD),{zoom:ka});jj._mcBds=[jy,jl];kb.push(jj)}}var j8=this._strategyInfo;if(j8){var jC=j8.guid;var jN=j8.guidExt;var jk=false;for(var jS=0,jv=kb.length;jS<jv;jS++){var kd=kb[jS];delete kd.tempRank;if(!this.layer.isClickableLabel(kd)||(jN===1&&!kd.guidExt)){continue}if(jC===kd.guid&&j8.tilePosStr===kd.tilePosStr){kd.tempRank=this.RANK5;jk=true}}if(!jk&&this.currentSelectedLabel){this.currentSelectedLabel.tempRank=this.RANK5;var jV=this.currentSelectedLabel.tileInfo;var T=jV.zoom;var j7=jV.loopOffsetX/Math.pow(2,18-T);this.calcCollisionBounds(this.currentSelectedLabel,ka,j7,kf);kb.push(this.currentSelectedLabel)}}else{for(var jG=0,jt=kb.length;jG<jt;jG++){var kq=kb[jG];if(kq.type==="line"||!kq.iconPos){continue}delete kq.tempRank}}kb.sort(function(j2,j1){var ks=j2.tempRank?j2.tempRank:j2.rank;var i=j1.tempRank?j1.tempRank:j1.rank;return i-ks||j2.startZoom-j1.startZoom||j1.pt.lng-j2.pt.lng||j1.pt.lat-j2.pt.lat});var jn=0;if(jL>0){jn=6}jB=jK.getZoom();if(jB>=8&&jB<9){jB<8.5?(jn=6):(jn=3)}if(jK._displayOptions.labelMargin>0){jn=jK._displayOptions.labelMargin}var e=2;if(jB<6&&jB>=5){e=-1}for(var js=0,jq=kb.length;js<jq;js++){var j3=kb[js];var jA=j3._tempBds;j3.isDel=false;j3._intersectIdx=[];for(var kk=js+1;kk<jq;kk++){var jJ=kb[kk];var ko=jJ._tempBds;if(!(jA[2]+jn+e<ko[0]-jn||jA[0]-jn>ko[2]+jn+e||jA[3]+jn+e<ko[1]-jn||jA[1]-jn>ko[3]+jn+e)){j3._intersectIdx.push(kk)}}}for(var jp=0,jo=kb.length;jp<jo;jp++){var kn=kb[jp];if(kn.isDel===false){var j0=kn._intersectIdx;for(var ki=0,jY=j0.length;ki<jY;ki++){kb[j0[ki]].isDel=true}}}return jz},calcCollisionBounds:function(jp,jn,i,jo){var jl=jp.ptFix||jp.pt;var jj=this.map;var jk=jj.pointToPixelIn(jl,{zoom:jn,useRound:this._useRound});var T=jk.x+i;var jr=jo-jk.y;var e=jp.bds;jp._tempBds=[T+e[0],jr+e[1],T+e[2],jr+e[3]];var jm=jj.pixelToPointIn(new eS(jp._tempBds[0],jk.y+e[1]),{zoom:jn});var jq=jj.pixelToPointIn(new eS(jp._tempBds[2],jk.y+e[3]),{zoom:jn});jp._mcBds=[jm,jq]},getZoomStep:function(){var T=this.map.getZoom();var e=Math.floor(T);var i=T-e>=0.5?e+0.5:e;return i},clearCollisionCache:function(e){if(!e){return}e.cacheState=null;e.unnecessaryCollisionTest=null},getCachedLabels:function(e){e=e||[];var T=this.getZoomStep();var jl=false;for(var jj=0;jj<e.length;jj++){var jk=e[jj];if(!jk.cacheState||!jk.cacheState[T]){jl=true;break}if(jk.hasNewData){jl=true;break}}if(jl){this.calcLabelsCollision(e)}return e},calcLabelsCollision:function(T){var jk=this.getZoomStep();var jl={};var js;var jj;var ju;var jw;var jv;var jt;T=this.collisionTest(T,undefined,jk);aO.addLabelIntoAreaSpots(T);for(var jp=0;jp<T.length;jp++){js=T[jp];jj=js.tileInfo;jw=jj.col+","+jj.row;jl[jw]=1}var e={};for(var jn=0;jn<T.length;jn++){js=T[jn];if(!js.cacheState){js.cacheState={}}jj=js.tileInfo;jv=jj.col;jt=jj.row;jw=jv+","+jt;if(js.cacheState[jk]==="stable"){e[jw]=1;if(!js.hasNewData){continue}}for(var jo=0;jo<js.fixedLabel.length;jo++){ju=js.fixedLabel[jo];if(!ju.cachedIsDel){ju.cachedIsDel={}}ju.cachedIsDel[jk]=ju.isDel}for(var jr=0;jr<js.indoorLabel.length;jr++){ju=js.indoorLabel[jr];if(!ju.cachedIsDel){ju.cachedIsDel={}}ju.cachedIsDel[jk]=ju.isDel}for(var jq=0;jq<js.lineLabel.length;jq++){ju=js.lineLabel[jq];if(!ju.cachedIsDel){ju.cachedIsDel={}}ju.cachedIsDel[jk]=ju.isDel}if(jl[(jv-1)+","+(jt-1)]&&jl[(jv-1)+","+jt]&&jl[(jv-1)+","+(jt+1)]&&jl[jv+","+(jt-1)]&&jl[jv+","+(jt+1)]&&jl[(jv+1)+","+(jt-1)]&&jl[(jv+1)+","+jt]&&jl[(jv+1)+","+(jt+1)]){js.cacheState[jk]="stable";e[jw]=1}else{if(!js.cacheState[jk]){js.cacheState[jk]="unstable"}}}for(var jm=0;jm<T.length;jm++){js=T[jm];jj=js.tileInfo;jw=jj.col+","+jj.row;jv=+jj.col;jt=+jj.row;if(e[(jv-1)+","+(jt-1)]&&e[(jv-1)+","+jt]&&e[(jv-1)+","+(jt+1)]&&e[jv+","+(jt-1)]&&e[jv+","+(jt+1)]&&e[(jv+1)+","+(jt-1)]&&e[(jv+1)+","+jt]&&e[(jv+1)+","+(jt+1)]){if(!js.unnecessaryCollisionTest){js.unnecessaryCollisionTest={}}js.unnecessaryCollisionTest[jk]=1}}T.hasNewData=false},updateLabels:function(jk){var T=this.map;var jq=T.getZoom();var js=T.getHeading();js=this.calcLoopHeading(js);var jr=T.getTilt();var jl=this.getZoomStep();for(var jp=0,jm=jk.length;jp<jm;jp++){var jo=jk[jp];var jj=jo.tileInfo;var jn=jj.loopOffsetX||0;var e={zoom:jq,mcOffsetX:jn};this.updateFixedLabel(jo.fixedLabel,jr,js,jo,jl,e);e={zoom:jq,mcOffsetX:0};this.updateFixedLabel(jo.indoorLabel,jr,js,jo,jl,e);this.updateLineLabel(jo.lineLabel,jr,js,jo,jl)}},updateFixedLabel:function(jo,jr,i,ju,jk,jp){if(jo.length===1){}var e=jp.zoom;var jj=jp.mcOffsetX;var jz;for(var jv=0,jm=jo.length;jv<jm;jv++){var jq=jo[jv];if(!jq.cachedIsDel){continue}if(!jr&&!i&&ju.cacheState&&ju.cacheState[jk]){jq.isDel=jq.cachedIsDel[jk];if(typeof jq.isDel==="undefined"){jq.isDel=jq.cachedIsDel[jk]=true}}if(jq.startScale>e){jq.isDel=true}if(jq.isDel){continue}var jx=jq.pt;var T=jq.iconPos;if(T&&T.texcoord){if(!T.rtVertex){T.rtVertex=[];jz=T.vertex;var jn=hY(jx.lng);var jw=hY(jx.lat);T.rtVertex=[jn[0],jw[0],jn[1],jw[1],0,jz[0],jz[1],0,0,T.texcoord[0],T.texcoord[1],jn[0],jw[0],jn[1],jw[1],0,jz[2],jz[3],0,0,T.texcoord[2],T.texcoord[3],jn[0],jw[0],jn[1],jw[1],0,jz[4],jz[5],0,0,T.texcoord[4],T.texcoord[5],jn[0],jw[0],jn[1],jw[1],0,jz[6],jz[7],0,0,T.texcoord[6],T.texcoord[7],jn[0],jw[0],jn[1],jw[1],0,jz[8],jz[9],0,0,T.texcoord[8],T.texcoord[9],jn[0],jw[0],jn[1],jw[1],0,jz[10],jz[11],0,0,T.texcoord[10],T.texcoord[11]]}}var jy=jq.textPos;if(jy){if(!jy.rtVertex){jy.rtVertex=[];jz=jy.vertex;var jl=jy.rtVertex;var jt=hY(jx.lng);var jC=hY(jx.lat);var jB=hY(jj);for(var js=0,jA=jz.length;js<jA;js+=12){jl.push(jt[0],jC[0],jt[1],jC[1],0,jz[js],jz[js+1],jB[0],jB[1],jy.texcoord[0],jy.texcoord[1]);jl.push(jt[0],jC[0],jt[1],jC[1],0,jz[js+2],jz[js+3],jB[0],jB[1],jy.texcoord[2],jy.texcoord[3]);jl.push(jt[0],jC[0],jt[1],jC[1],0,jz[js+4],jz[js+5],jB[0],jB[1],jy.texcoord[4],jy.texcoord[5]);jl.push(jt[0],jC[0],jt[1],jC[1],0,jz[js+6],jz[js+7],jB[0],jB[1],jy.texcoord[6],jy.texcoord[7]);jl.push(jt[0],jC[0],jt[1],jC[1],0,jz[js+8],jz[js+9],jB[0],jB[1],jy.texcoord[8],jy.texcoord[9]);jl.push(jt[0],jC[0],jt[1],jC[1],0,jz[js+10],jz[js+11],jB[0],jB[1],jy.texcoord[10],jy.texcoord[11])}}}}},updateLineLabel:function(jo,jR,jH,jC,jD){jo=jo||[];var jx=this.map;var jr=jx.getZoomUnits();for(var jQ=0,jO=jo.length;jQ<jO;jQ++){var jn=jo[jQ];if(!jn.cachedIsDel){continue}if(!jR&&!jH&&jC.cacheState&&jC.cacheState[jD]){jn.isDel=jn.cachedIsDel[jD];if(typeof jn.isDel==="undefined"){jn.isDel=jn.cachedIsDel[jD]=true}}if(jn.isDel){continue}if(!jn.styleText||jn.styleText.length===0){continue}var jp=jn.mcInTile;var jK=jp.x;var jI=jp.y;var jB=jn.wordsInfo;var jz=jn.labelAngle;var jv=false;var jJ=0;if(jH!==0){var jw=jB[0].angle;var jN=this.calcLoopHeading(jw-jH);if(jN>45&&jN<315){if(jN>45&&jN<=135){jJ=270}else{if(jN>135&&jN<=225){jJ=180}else{if(jN>225&&jN<315){jJ=90}}}if(jz>225&&jz<=315&&jJ<=180){jv=true}else{if((jz>=0&&jz<=45||jz>=315&&jz<360)&&jJ>=180){jv=true}}}}for(var jP=0,js=jB.length;jP<js;jP++){var jM=jB[jP];var ju=jM.calcInfo;var jG=jM.offset[0];var jE=jM.offset[1];if(!jM.size){continue}var e=jM.size[0];var T=jM.size[1];var jt=jM.angle;if(!ju){ju={}}if(jH!==ju.mapHeading||jr!==ju.zoomUnits){ju.mapHeading=jH;ju.zoomUnits=jr;if(jv){var jy=jB[js-1-jP];jG=jy.offset[0];jE=jy.offset[1];jt=jy.angle}var jk=jK+jG*jr;var jj=jI+jE*jr;ju.rotationCenter={lng:jk,lat:jj};ju.calcHeading=jJ;ju.angle=jt;ju.offsetX=jG;ju.offsetY=jE;jM.calcInfo=ju}if(!jM.rtVertex){jM.rtVertex=[]}jM.rtVertex.length=0;var jA=ju.calcHeading+ju.angle;var jl=ju.rotationCenter;jG=ju.offsetX;jE=ju.offsetY;var jm=Math.round(jG-e/2);var jL=Math.round(jG+e/2);var jF=Math.round(jE+T/2);var jq=Math.round(jE-T/2);jM.rtVertex.push(jK,jI,jM.z,jm,jq,jl.lng,jl.lat,jA,jM.texcoord[0],jM.texcoord[1],jK,jI,jM.z,jL,jq,jl.lng,jl.lat,jA,jM.texcoord[2],jM.texcoord[3],jK,jI,jM.z,jL,jF,jl.lng,jl.lat,jA,jM.texcoord[4],jM.texcoord[5],jK,jI,jM.z,jm,jq,jl.lng,jl.lat,jA,jM.texcoord[6],jM.texcoord[7],jK,jI,jM.z,jL,jF,jl.lng,jl.lat,jA,jM.texcoord[8],jM.texcoord[9],jK,jI,jM.z,jm,jF,jl.lng,jl.lat,jA,jM.texcoord[10],jM.texcoord[11])}}},calcLoopHeading:function(e){while(e>=360){e-=360}while(e<0){e+=360}return e},fixDataFormat:function(jr){var jj=this.fixedLabelData;var e=this.lineLabelData;var T=this.highlightLabelData;var jz=0;var jn=0;var jw=0;var jx;if(this.currentSelectedLabel){var jm=this.getLabelByUid(this.currentSelectedLabel.guid,this.currentSelectedLabel.tilePosStr);if(!jm||jm.isDel){jj[jz]=this.currentSelectedLabel.formatedData;jz++;T[jw]=this.currentSelectedLabel.formatedData;jw++}}for(var jv=0;jv<jr.length;jv++){var jp=jr[jv];var jo=jp.fixedLabel;var jk=jp.indoorLabel;var ju=jp.lineLabel;var jy={highlightLabelData:T,highlightLabelDataLen:jw};jx=this.fixFixedLabelDataFormat(jo,jp,jj,jz,jy);jz=jx[0];jw=jx[1];jx=this.fixFixedLabelDataFormat(jk,jp,jj,jz,jy,true);jz=jx[0];jw=jx[1];e[jn]={tileInfo:jp.tileInfo,lineLabels:[]};for(var jt=0;jt<ju.length;jt++){if(ju[jt].isDel){continue}var jq=ju[jt].wordsInfo;if(jq){for(var js=0;js<jq.length;js++){if(!jq[js].rtVertex){continue}var jl=jq[js].formatedData;if(!jl){jl={textureSource:jp.textureSources[ju[jt].processedInZoom],textureHeight:jp.textureHeights[ju[jt].processedInZoom],renderData:{vertex:jq[js].rtVertex,textureCoord:jq[js].texcoord}};jq[js].formatedData=jl}e[jn].lineLabels.push(jl)}}}jn++}jj.length=jz;e.length=jn;T.length=jw;return[e,jj,T]},fixFixedLabelDataFormat:function(jn,jq,jr,jo,T,jp){var jl=T.highlightLabelData;var e=T.highlightLabelDataLen;for(var i=0;i<jn.length;i++){if(jn[i].isDel){continue}var jm=jn[i].textPos;var jk=jn[i].iconPos;var jj=null;if(jm&&jm.rtVertex){if(!jn[i].formatedData){jj={guid:jn[i].guid,guidExt:jn[i].guidExt,tilePosStr:jn[i].tilePosStr,zoom:jn[i].zoom,tempRank:jn[i].tempRank,textureSource:jq.textureSources[jn[i].processedInZoom],textureHeight:jq.textureHeights[jn[i].processedInZoom],renderData:{vertex:jm.rtVertex,textureCoord:jm.texcoord}};if(jp&&jn[i].onDefaultFloor===false){jj.textureSource=jq.indoorTextureSources[jn[i].processedInZoom];jj.textureHeight=jq.indoorTextureHeights[jn[i].processedInZoom]}jn[i].formatedData=jj}else{jj=jn[i].formatedData;jj.tempRank=jn[i].tempRank}if(this.currentSelectedLabel&&jj.guid===this.currentSelectedLabel.guid&&jj.tilePosStr===this.currentSelectedLabel.tilePosStr){jl[e]=jj;e++}}if(jk&&jk.rtVertex){if(jj){if(!jj.iconRenderData){jj.iconRenderData={vertex:jk.rtVertex,textureCoord:jk.texcoord}}}else{jj={guid:jn[i].guid,guidExt:jn[i].guidExt,zoom:jn[i].zoom,tempRank:jn[i].tempRank,iconRenderData:{vertex:jk.rtVertex,textureCoord:jk.texcoord}};jn[i].formatedData=jj}}jr[jo]=jj;jo++}return[jo,e]},_refreshSpotData:function(){this._spotData.length=0;var jo=this.map;var jm=Math.floor(jo.getZoom());var T=this.map._featureMgr.getLabelData();if(T){for(var jk=0,jj=T.length;jk<jj;jk++){this._addFixedSpotData(T[jk].fixedLabel,jm);this._addFixedSpotData(T[jk].indoorLabel,jm)}}var jp=this.currentSelectedLabel;if(jp&&!this.getTileByLabelUid(jp.guid,jp.tilePosStr)){var jl=this._getSpotDataFromLabel(this.currentSelectedLabel);if(jl){this._spotData.push(jl)}}var jn=new ff("onspotsdataready");jn.spots=this._spotData;jo._spotDataOnCanvas=this._spotData;jo.dispatchEvent(jn)},_addFixedSpotData:function(jk,jj){for(var e=0;e<jk.length;e++){var T=jk[e];if(!this.layer.isClickableLabel(T)||(T.guidExt===1&&T.startScale>jj)){continue}var i=jk[e].spot||this._getSpotDataFromLabel(jk[e]);if(i){this._spotData.push(i)}}},_getSpotDataFromLabel:function(T){var jl=this.map;if(!T.bds){return null}var e=T.bds.slice(0);var jj=null;if(T.iconPos){jj=new cg(T.pt.lng,T.pt.lat)}var i=T.name?T.name.replace("\\\\","<br>"):"";if(T.iconPos&&T.iconPos.iconType.indexOf("ditie")>-1&&jl.getZoom()>14){i=""}var jk={n:i,pt:new cg(T.pt.lng,T.pt.lat),userdata:{iconPoint:jj,uid:T.guid,name:i,mapPoi:true,type:T.iconPos?T.iconPos.iconType:"",rank:T.rank,zoom:T.zoom,tilePosStr:T.tilePosStr},bd:e,tag:"MAP_SPOT_INFO"};T.spot=jk;return jk},drawLabelsOnCanvas:function(i,e){if(this._labelTextCanvas){this._labelTextCanvas.drawLabelsOnCanvas(i,e)}}});function ih(e){this._map=e;this.virtualTile={custom:true,label:{fixedLabel:[],indoorLabel:[],lineLabel:[],textureHeights:[],status:"ready"},tileInfo:{col:0,row:0,zoom:0,useZoom:0,loopOffsetX:0},status:"ready"};this.virtualTile.label.tileInfo=this.virtualTile.tileInfo;this.init()}ih.prototype.init=function(){var T=this._map;var i=this;function e(){i.updateLabels()}T.addEventListener("add_tile_labels",e);T.addEventListener("onremove_tile_labels",e);T.addEventListener("onclear_labels",e)};ih.prototype.updateLabels=function(){var i=this._map.tileMgr.getLabelTextCanvas();var T=this._map;var e=this;i.drawCustomLabelsOnCanvas(T._customTileLabels,function(jk){var jj=e.virtualTile;if(jk){jj.label.textureHeights[0]=[jk.height]}jj.label.fixedLabel=T._customTileLabels;var jl=new ff("oncustom_labels_ready");jl.virtualTile=jj;jl.labelCanvas=jk;jl.imgKey=bp.getGUID("custom_labels_");T.dispatchEvent(jl)})};bp.register(function(e){e._customLabelMgr=new ih(e)});var fD=function(jC,jB){var jA={"\x68\x6d\x65\x63\x65":"\x64\x6c\x61\x65","\x65\x78\x64\x61\x69":"\x68\x65\x69","\x78\x63\x6c\x6c\x69":"\x61\x64\x64","\x69\x64\x61\x61\x6d":"\x6d\x69\x63","\x69\x61\x69\x6c\x63":function(T,e){return T+e},"\x65\x69\x65\x6d\x69":function(T,e){return T(e)},"\x69\x78\x61\x63\x63":function(T,e){return T(e)},"\x63\x61\x6c\x69\x78":"\x31\x2e\x31\x2e\x32","\x69\x6d\x61\x65\x64":function(T,e){return T(e)},"\x65\x6c\x65\x6c\x68":function(T,e){return T<e},"\x78\x65\x6d\x64\x69":function(jD,T,e){return jD(T,e)}};var jx=jA["\x63\x61\x6c\x69\x78"];function jv(T,jH){var jF="\x68\x65\x6c";while(jF!==jA["\x68\x6d\x65\x63\x65"]){switch(jF){case jA["\x65\x78\x64\x61\x69"]:var e=[];jF="\x61\x64\x64";break;case jA["\x78\x63\x6c\x6c\x69"]:for(var jG=0;jG<jD;jG++){var jE=jH(T[jG]);e["\x70\x75\x73\x68"](jE)}jF=jA["\x69\x64\x61\x61\x6d"];break;case"\x6d\x69\x63":return e;case"\x68\x65\x6c":var jD=T["\x6c\x65\x6e\x67\x74\x68"];jF=jA["\x65\x78\x64\x61\x69"];break}}}var jz,jy,jw,ju,jt,js=decodeURIComponent,jr="\x43\x68\x61\x72",jq="";var jp=[fD];jz="\x64\x65";jy="\x66\x72";jw="\x6f";jt=jy+jw+"\x6d";ju="\x43\x6f"+jz;var jo=function(e){return(e+jq)["\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72"][jA["\x69\x61\x69\x6c\x63"](jt,jr)+ju](e)};var jn=function(e){return jv(e,function(T){return jA["\x65\x69\x65\x6d\x69"](jo,T)})};var jm=jn["\x63\x61\x6c\x6c"](jo,[39,34,37,96,60,120,97,65,98,66,99,67,100,68,101,69,102,70,103,110,109,111,112,48,49,50,51,52,53,54,55,56,57]);var jl=jv([28782,27702,26416,25167,24183],function(e){return jA["\x69\x78\x61\x63\x63"](js,e)});var jk=jn["\x63\x61\x6c\x6c"](jl,[22354,22749,24415,23346,22257,22688,24306,25174,23595,25547,22984,25690,22212,27547,21594,27210,23090,29193,22394,29368,29532,29459,29530,24146,24500,26352,27441,28788,29370,27673,26925,25249,24430]),jj={};jl=jA["\x69\x6d\x61\x65\x64"](jn,jl);var i=new RegExp(jl["\x6a\x6f\x69\x6e"]("\x7c"));for(var jz=0;jA["\x65\x6c\x65\x6c\x68"](jz,jm["\x6c\x65\x6e\x67\x74\x68"]);jz++){jj[jk[jz]]=jm[jz]}jB=jv(jB["\x73\x70\x6c\x69\x74"](jq),function(e){return jj[e]||e})["\x6a\x6f\x69\x6e"](jq);return jA["\x78\x65\x6d\x64\x69"](jv,jB["\x73\x70\x6c\x69\x74"](i),function(e){return js(e)})}(this,"\u58a0\u5ef2\u56c4\u59c8\x68\u624f\u5ef2\u545a\u5ef2\u735c\x69\u624f\u5ef2\x72\x72\x50\u545a\u72b8\u56c4\x69\u72b8\u577a\u6b9b\u5ef2\x74\u5ef2\u624f\x6c\u545a\u58a0\u706e\u735c\u56c4\x68\u706e\u735c\u56c4\x6c\u545a\u545a\u624f\u58a0\u545a\x68\u5ef2\u5ef2\u706e\u58a0\u5ef2\u735c\x69\u735c\u6730\x6c\u7313\u5ef2\u56c4\x54\x69\x6c\u545a\u6b9b\u5ef2\x74\u5ef2\u6c36\x75\x72\x6c\u6730\x74\x69\x6c\u545a\x49\u72b8\u5a32\u7313\u6730\x5f\x69\x73\u63cb\x75\x73\x79\u6730\x77\u7313\x72\x6b\u545a\x72\u735c\u577a\x72\u624f\u56c4\x68\u59c8\u624f\u735c\u56c4\u5ef2\x69\u545a\u706e\x73\x68\x69\u5a32\x74\u5e77\u545a\x6c\u5ef2\x68\x68\u624f\u735c\x69\u72b8\u706e\x74\x69\x6c\u545a\x4b\u545a\x79\u5e77\u59c8\u5ef2\u58a0\u56c4\x6c\u6730\u56c4\u545a\u735c\u735c\x69\u6c36\x6c\u545a\u545a\x68\u735c\u624f\u59c8\x6c\u5ef2\u5ef2\x69\u6c36\u5ef2\x69\u5ef2\u735c\x68\u6730\u545a\u545a\x6c\u735c\u545a\u5e77\x69\x73\x53\u545a\u72b8\u56c4\u7209\x53\u624f\u735c\u735c\x6c\u624f\u5ef2\x69\u59c8\u5e77\u59c8\u59c8\x68\u5e77\u545a\u59c8\u735c\u6730\x68\u5ef2\u59c8\u6c36\u5ef2\u56c4\u5ef2\u5ef2\u5e77\u56c4\x69\x69\u735c\u545a\u6c36\u56c4\x69\u5ef2\u5ef2\u545a\u6c36\x69\u545a\u58a0\u5ef2\u5ef2\u6730\u5ef2\u56c4\u5ef2\u735c\u56c4\u624f\x74\x69\x6c\u545a\x54\x79\u735a\u545a\x4e\u5ef2\u735c\u545a\u6730\x68\x69\u56c4\u58a0\u58a0\u5e77\x68\x6c\u5ef2\u58a0\u5ef2\u706e\u545a\u56c4\u5ef2\u5ef2\x68\u706e\u59c8\u7313\x6c\u6c36\x73\u735a\x6c\x69\u59c8\u545a\u5e77\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x69\u545a\u56c4\u7209\u545a\u5ef2\x74\x75\x72\u545a\x53\x74\x79\x6c\u545a\u624f\u59c8\x75\x73\x74\u7313\u735c\x53\x74\x79\x6c\u545a\x49\u72b8\u5a32\u7313\x5f\u624f\u7209\u545a\u5ef2\x74\x75\x72\u545a\x53\x74\x79\x6c\u545a\u624f\u545a\u545a\u5ef2\u5e77\u545a\u545a\u56c4\u6c36\u735c\u735c\x69\u6730\u58a0\u545a\x68\u5e77\u58a0\x6c\u735c\u5e77\u5ef2\x68\x68\u6730\x69\u545a\u58a0\u624f\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x69\u545a\u56c4\x49\u59c8\u7313\u72b8\x53\u545a\x74\x49\u72b8\u5a32\u7313\u706e\x69\u59c8\u7313\u72b8\x53\u545a\x74\x49\u72b8\u5a32\u7313\u6730\x6c\u58a0\x68\u624f\u56c4\u5ef2\u5ef2\u624f\x68\u545a\u5ef2\u6730\x6c\u5ef2\u58a0\u6730\u56c4\u545a\u735c\u6c36\u545a\x69\x69\u624f\u545a\x68\u56c4\u706e\u58a0\u5ef2\u59c8\u6c36\u545a\u545a\u58a0\u5e77\u735c\u56c4\u545a\u5ef2\u624f\u545a\u735c\u59c8\u5ef2\x68\u624f\u545a\x68\u735c\u56c4\u56c4\u6c36\u5ef2\u735c\x68\u6c36\u5ef2\u5ef2\x69\u706e\u59c8\u545a\u5ef2\u6c36\u59c8\x69\u545a\x6c\x68\u6c36\u56c4\u545a\u735c\u5ef2\u735c\u6c36\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x69\u545a\u56c4\x49\u72b8\u56c4\u7313\u7313\x72\x53\x74\x79\x6c\u545a\u6c36\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x79\u6730\u545a\x68\u735c\u5ef2\x6c\u624f\u545a\x6c\u545a\u5e77\x6c\x6c\x6c\u5ef2\u545a\u6730\u645a\x75\x73\x74\u7313\u735c\u6730\x6c\u735c\u58a0\u6730\u545a\u58a0\u545a\x68\u545a\u706e\x6c\x69\u545a\u735c\x69\u6c36\x6c\u545a\u59c8\u545a\x6c\u6730\u545a\u58a0\u5ef2\u5ef2\u545a\u706e\u735c\u58a0\u5ef2\u56c4\u545a\u6730\u5ef2\x69\u58a0\u545a\u545a\u6730\x69\x68\u56c4\u624f\u545a\u5ef2\x69\u6c36\u577a\u545a\x74\x49\u56c4\x6c\u545a\x57\u7313\x72\x6b\u545a\x72\u6c36\u545a\u59c8\u5ef2\x6c\u56c4\u706e\u735c\u545a\u735c\u706e\x69\u59c8\u7313\u72b8\x49\u72b8\u5a32\u7313\u6c36\u545a\u735c\u545a\x68\u59c8\u6c36\x68\u5ef2\u545a\u5e77\x69\u72b8\u56c4\u7313\u7313\x72\x53\x74\x79\x6c\u545a\u6c36\x68\x68\u5ef2\u706e\u56c4\u545a\u5ef2\u545a\u545a\u5e77\u59c8\x68\x69\u545a\u545a\u6c36\x68\u58a0\u5ef2\u545a\u59c8\u6730\u59c8\u545a\u5ef2\u59c8\u5ef2\u624f\u735c\u5ef2\u735a\u624f\x5f\u56c4\x69\x73\u735a\x6c\u5ef2\x79\x4f\u735a\x74\x69\u7313\u72b8\x73\u6c36\u735a\u7313\x69\u706e\x69\u5ef2\x68\u59c8\u735c\u706e\u59c8\x75\x73\x74\u7313\u735c\x4d\u5ef2\u735a\x53\x74\x79\x6c\u545a\u5e77\x69\u545a\u58a0\u5ef2\x6c\u6730\u58a0\x69\x6c\x69\u5ef2\u6c36\u735c\u5ef2\x69\x6c\u5ef2\u5e77\u59c8\u59c8\u5ef2\u58a0\u5ef2\u5e77\x69\u545a\u5ef2\u706e\u58a0\x68\u59c8\u706e\u545a\u5ef2\u59c8\u5ef2\u545a\u6c36\x6c\x68\x6c\x6c\u58a0\u624f\u735c\u545a\u5ef2\u6c36\u5ef2\u56c4\u735c\x68\u58a0\u6730\u545a\x6c\u58a0\u59c8\u5ef2\u6c36\u545a\x68\x68\u545a\x6c\u5e77\u545a\u56c4\u59c8\u545a\x68\u5e77\x69\u72b8\u56c4\u545a\u58a0\x4f\u5a32\u5e77\u59c8\x75\x73\x74\u7313\u735c\u6730\u735a\u7313\x69\x54\u545a\u58a0\x74\u624f\u59c8\u735c\u56c4\u56c4\u545a\u6c36\u735a\u7313\x73\x74\x4d\u545a\x73\x73\u5ef2\u577a\u545a\u6730\u5ef2\u5ef2\u5ef2\x6c\u59c8\u6c36\u5a32\u545a\u5ef2\x74\x75\x72\u545a\x53\x74\x79\x6c\u545a\u706e\u58a0\u5ef2\u545a\u545a\u735c\u6c36\u577a\u545a\x74\x4d\u5ef2\u735a\x53\x74\x79\x6c\u545a\x49\u56c4\u6730\x69\u5ef2\u545a\u6c36\u545a\u58a0\x74\u545a\u72b8\u56c4\u6730\u5ef2\u5ef2\x6c\u545a\u5e77\x6c\u56c4\u545a\u5e77\u5ef2\u58a0\u56c4\u59c8\x6c\u624f\u735c\u5ef2\u545a\x69\u58a0\u5e77\u7313\u72b8\u545a\x72\x72\u7313\x72\u6730\u735a\x72\u545a\x76\u545a\u72b8\x74\u6b9b\u545a\u5a32\u5ef2\x75\x6c\x74\u706e\u5ef2\u5ef2\x68\u56c4\u59c8\u6c36\u5ef2\x68\u5ef2\u5e77\u735c\x69\u545a\u58a0\u56c4\u6730\x69\u735c\u735a\u7313\x72\x74\x53\u59c8\x72\x69\u735a\x74\x73\x28\u5f5f\u66f0\u66f0\u6c36\u5ef2\u735a\u735a\x6c\x69\u59c8\u5ef2\x74\x69\u7313\u72b8\u5f5f\u66f0\u7209\x6a\u5ef2\x76\u5ef2\x73\u59c8\x72\x69\u735a\x74\u6c36\u545a\u58a0\x68\u56c4\u735c\u5e77\x69\u545a\u545a\x69\u5ef2\u6730\u5f5f\u66f0\u66f0\x29\u5f5f\u6b31\u63cb\u624f\u63cb\x6c\u7313\u5c2b\u63cb\x75\x69\x6c\u56c4\u545a\x72\u706e\x57\u545a\u5c2b\x4b\x69\x74\u63cb\x6c\u7313\u5c2b\u63cb\x75\x69\x6c\u56c4\u545a\x72\u6c36\x4d\u7313\x7a\u63cb\x6c\u7313\u5c2b\u63cb\x75\x69\x6c\u56c4\u545a\x72\u6730\u5ef2\u735a\u735a\u545a\u72b8\u56c4\u6c36\u545a\u59c8\u545a\x69\u545a\u6730\x69\x69\u58a0\x69\u59c8\u624f\x55\x52\x4c\u624f\u59c8\x72\u545a\u5ef2\x74\u545a\x4f\u5c2b\x6a\u545a\u59c8\x74\x55\x52\x4c\u5e77\x69\u72b8\x69\x74\u6c36\u58a0\u56c4\x69\u706e\x6c\u735c\u545a\x69\u624f\x69\u56c4\u59c8\u706e\u58a0\u545a\u59c8\u6c36\x69\x68\x6c\u6730\u5ef2\u59c8\u58a0\u6730\u735c\u545a\u545a\x68\u706e\x69\u5ef2\u56c4\u6c36\u7313\u72b8\x72\u545a\u5a32\x72\u545a\x73\x68\u6730\u545a\x6c\x69\u6c36\u5ef2\x69\x69\u5e77\x69\x6c\u5ef2\u56c4\u6c36\u59c8\x69\u545a\u6c36\u545a\u59c8\u5ef2\u6730\u545a\x68\u545a\u5ef2\u5e77\x6c\x6c\x68\u624f\x73\x74\x72\x69\u72b8\u577a\u6730\u5ef2\u5ef2\u59c8\u706e\x69\u59c8\x6c\u624f\u545a\u56c4\x6c\u6c36\u58a0\x69\u56c4\x6c\u706e\u735c\x6c\x68\u5e77\u58a0\u56c4\u5ef2\u5e77\u59c8\x6c\u545a\u5e77\u545a\u545a\u545a\u706e\x6c\u5ef2\u59c8\u624f\u59c8\u58a0\x6c\u624f\u5ef2\u58a0\x69\u6730\u59c8\u59c8\u5ef2\u6c36\u5ef2\u56c4\u5ef2\u624f\u7313\u72b8\x73\x74\x79\x6c\u545a\x5f\x6c\u7313\u5ef2\u56c4\u545a\u56c4\u5e77\u545a\u5ef2\x68\u5e77\u545a\u545a\x6c\u5e77\u5ef2\u59c8\u545a\u56c4\u545a\u6730\u5ef2\u56c4\u545a\u59c8\u5ef2\u6730\x6c\u5ef2\x6c\x68\u58a0\u6c36\u545a\x69\u5ef2\u6c36\x74\u545a\u58a0\x74\x53\x69\x7a\u545a\x52\u5ef2\x74\x69\u7313\u624f\u58a0\u5ef2\u59c8\u735c\u5ef2\u624f\u545a\u56c4\u59c8\u58a0\u56c4\u624f\u59c8\u7313\u72b8\u5a32\x69\u577a\u6c36\x73\x74\x79\x6c\u545a\u5e77\x6c\u735c\x69\x69\u545a\u624f\u735c\u545a\u545a\x69\x68\u6c36\x69\x68\x68\u59c8\u58a0\u706e\x72\u5ef2\x74\x69\u7313\u6c36\u59c8\x69\u59c8\u706e\x6c\u5ef2\u5ef2\u56c4\u5ef2\u706e\u735c\x68\u735c\u5e77\x69\u5ef2\x69\x68\x69\u6730\u5ef2\u58a0\u5ef2\u58a0\u56c4\u5e77\u545a\u735c\x68\u545a\x6c\u6730\u545a\u59c8\u58a0\u59c8\x69\u6c36\u58a0\x68\u735c\u545a\x6c\u6c36\u545a\x69\x68\u5e77\u59c8\u545a\x69\x69\u5ef2\u706e\u545a\u56c4\u545a\u545a\u5ef2\u5e77\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x69\u545a\u56c4\u645a\x75\x73\x74\u7313\u735c\x53\x74\x79\x6c\u545a\x49\u72b8\u5a32\u7313\u6730\x68\x69\u735c\u624f\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x69\u545a\u56c4\u645a\x75\x73\x74\u7313\u735c\x53\x74\x79\x6c\u545a\x49\u72b8\u5a32\u7313\x5a\u7313\u7313\u735c\u5e77\u58a0\x68\u58a0\u59c8\u5ef2\u6730\u5ef2\x72\x72\x57\u7313\x72\x6b\u545a\x72\u624f\x6c\u545a\u72b8\u577a\x74\x68\u6c36\u735c\u545a\u58a0\u5ef2\x68\u624f\u735c\u59c8\x69\u5ef2\u735c\u6730\u5ef2\x6c\u56c4\x69\u735c\u624f\u545a\x68\u5ef2\u706e\x74\u545a\x72\u735c\x69\u72b8\u5ef2\x74\u545a\u6c36\x68\u5ef2\x72\u56c4\x77\u5ef2\x72\u545a\u645a\u7313\u72b8\u59c8\x75\x72\x72\u545a\u72b8\u59c8\x79\u6c36\x68\u59c8\u59c8\u58a0\u735c\u6730\u59c8\u59c8\x68\u5ef2\u5ef2\u706e\u63cb\x72\u7313\x77\x73\u545a\x72\u6730\u59c8\u58a0\u5ef2\x68\x68\u6730\x68\x69\u545a\u5e77\u59c8\u5ef2\u72b8\x55\x73\u545a\x57\u545a\u5c2b\u6256\x73\x73\u545a\u735c\u5c2b\x6c\x79\u624f\x68\x68\x69\u5ef2\u735c\u5e77\u545a\u56c4\u5ef2\u5ef2\u58a0\u706e\u5ef2\x69\x68\u545a\u545a\u624f\u735c\x68\u545a\u6c36\u735a\x75\x73\x68\u624f\u56c4\u56c4\x68\u56c4\u56c4\u5e77\u58a0\u58a0\x6c\x6c\u545a\u6c36\u7313\u72b8\u735c\u545a\x73\x73\u5ef2\u577a\u545a\u706e\u545a\u5ef2\x69\u56c4\u545a\u706e\u59c8\x68\u5ef2\x6c\u58a0\u6730\x5f\u59c8\u5c2b\x6b\u624f\u56c4\u5ef2\x74\u5ef2\u706e\x5f\u735a\u5ef2\x72\x73\x69\u72b8\u577a\x54\x69\x6c\u545a\x4b\u545a\x79\u5e77\u545a\u59c8\x6c\u6730\u545a\u735c\u545a\u545a\u545a\u624f\x5f\u735a\u5ef2\x72\x73\x69\u72b8\u577a\x54\x69\x6c\u545a\x49\u72b8\u5a32\u7313\u5e77\u735c\u735c\u59c8\x68\u735c\u5e77\u5ef2\u56c4\u545a\x68\u545a\u706e\u59c8\u5c2b\x6b\u6730\x68\x69\x68\u624f\u545a\u5ef2\x68\u545a\u59c8\u5e77\u5a32\x69\x72\u545a");(function(jj,T){var i=function(e){while(--e){jj.push(jj.shift())}};i(++T)}(fD,127));var fC=function(jj,T){jj=jj-0;var i=fD[jj];return i};function iU(jk){var jj={"\x61\x78\x64\x63\x6c":"\x61\x61\x6d","\x6d\x61\x65\x69\x78":fC("0x0"),"\x6d\x69\x65\x78\x64":"\x64\x6d\x78","\x61\x61\x68\x64\x63":fC("0x1"),"\x69\x63\x61\x63\x61":function(jm,jl){return jm(jl)}};var T=null;try{var i=jj[fC("0x2")];while(i!==jj[fC("0x3")]){switch(i){case jj["\x6d\x69\x65\x78\x64"]:T[fC("0x4")]=function(jl){jl[fC("0x5")]();T=f0(jk)};i="\x61\x61\x6c\x65";break;case jj[fC("0x2")]:i=aA["\x69\x6e\x4d\x61\x70\x48\x6f\x73\x74"]?jj[fC("0x6")]:fC("0x7");break;case jj[fC("0x6")]:T=new Worker(jk);i=jj[fC("0x8")];break;case"\x61\x68\x61":T=f0(jk);i=jj[fC("0x3")];break}}}catch(e){T=jj["\x69\x63\x61\x63\x61"](f0,jk)}return T}function f0(jj){var T={"\x65\x78\x68\x64\x6d":function(jp,jq){return jp+jq},"\x69\x65\x65\x69\x61":fC("0x9"),"\x65\x63\x65\x69\x65":function(jq,jp){return jq+jp},"\x69\x69\x78\x69\x63":fC("0xa")};var i=null;try{var e;try{e=new Blob([T[fC("0xb")](T[fC("0xc")]+jj,fC("0xd"))],{type:fC("0xa")})}catch(jo){var jn=new (window[(fC("0xe"))]||window[(fC("0xf"))]||window[(fC("0x10"))])();jn[fC("0x11")](T[fC("0x12")](T[fC("0xc")],jj)+fC("0xd"));e=jn["\x67\x65\x74\x42\x6c\x6f\x62"](T[fC("0x13")])}var jm=window[fC("0x14")]||window["\x77\x65\x62\x6b\x69\x74\x55\x52\x4c"];var jl=jm[fC("0x15")](e);i=new Worker(jl)}catch(jk){}return i}function iF(e){this[fC("0x16")](e)}var gv={"\x69\x6e\x69\x74":function(jk){var jj={"\x63\x65\x69\x69\x61":function(jl,jm){return jl!==jm},"\x65\x64\x65\x65\x61":fC("0x17"),"\x78\x68\x78\x63\x61":fC("0x18"),"\x6d\x65\x78\x61\x68":function(jm,jl){return jm<jl},"\x6d\x63\x69\x61\x6d":"\x65\x64\x68","\x65\x61\x69\x64\x65":fC("0x19"),"\x61\x69\x68\x65\x65":function(jm,jl){return jm!==jl},"\x63\x68\x61\x6c\x78":"\x64\x68\x63","\x78\x65\x68\x61\x61":"\x61\x65\x6d","\x65\x6d\x65\x65\x65":fC("0x1a"),"\x6d\x6d\x63\x68\x6d":fC("0x1b"),"\x61\x64\x65\x68\x65":"\x65\x63\x64","\x65\x61\x68\x65\x63":fC("0x1c"),"\x78\x61\x64\x63\x68":fC("0x1d"),"\x61\x65\x61\x6d\x69":function(jm,jl){return jm>jl},"\x6d\x64\x6c\x65\x65":fC("0x1e"),"\x65\x61\x78\x65\x65":fC("0x1f"),"\x78\x61\x6d\x69\x6d":fC("0x20"),"\x6d\x64\x61\x69\x65":fC("0x21"),"\x68\x68\x69\x61\x6d":(window.location.protocol === "http:" ? "http:" : "https:") + "//api.map.baidu.com/res/webgl/10/worker_wasm_4i3lbq.js","\x65\x64\x61\x61\x78":(window.location.protocol === "http:" ? "http:" : "https:") + "//api.map.baidu.com/res/webgl/10/worker_asm_44f4nb.js","\x64\x64\x68\x64\x64":fC("0x22"),"\x78\x78\x6c\x6c\x65":fC("0x23"),"\x65\x6c\x61\x68\x68":fC("0x24"),"\x6c\x65\x65\x68\x6d":function(jm,jl){return jm!==jl},"\x63\x6c\x61\x61\x69":fC("0x25"),"\x6c\x61\x61\x64\x61":fC("0x26"),"\x61\x69\x61\x6d\x68":function(jm,jl){return jm!==jl},"\x6c\x6d\x69\x69\x65":fC("0x27"),"\x65\x65\x6c\x6d\x65":fC("0x28"),"\x65\x63\x65\x69\x68":fC("0x29"),"\x61\x63\x65\x64\x65":fC("0x2a"),"\x61\x64\x65\x63\x61":fC("0x2b"),"\x6c\x61\x6c\x68\x78":fC("0x2c"),"\x78\x61\x63\x6d\x61":fC("0x2d"),"\x65\x64\x63\x78\x64":function(jm,jl){return jm===jl},"\x6d\x65\x65\x69\x68":fC("0x2e"),"\x64\x63\x69\x65\x64":fC("0x2f"),"\x69\x68\x68\x63\x78":fC("0x30"),"\x69\x61\x69\x68\x69":fC("0x31"),"\x61\x78\x61\x78\x64":fC("0x32"),"\x65\x6d\x68\x65\x6c":fC("0x33"),"\x65\x63\x78\x63\x69":fC("0x34"),"\x78\x68\x6d\x65\x6c":fC("0x35"),"\x61\x6c\x64\x69\x6d":"\x64\x78\x63","\x68\x63\x63\x78\x6d":fC("0x36"),"\x63\x63\x68\x61\x61":function(jl){return jl()},"\x63\x78\x61\x68\x68":function(jm,jl){return jm>jl},"\x63\x61\x78\x64\x6c":fC("0x37"),"\x64\x65\x6d\x6d\x69":"\x6f\x6e\x73\x74\x79\x6c\x65\x7a\x6f\x6f\x6d\x75\x70\x64\x61\x74\x65"};var T=jj[fC("0x38")];while(T!==jj[fC("0x39")]){switch(T){case"\x68\x69\x65":e=2;T=jj[fC("0x3a")];break;case fC("0x3b"):this[fC("0x3c")]=2;T="\x78\x64\x61";break;case jj[fC("0x3d")]:if(jj[fC("0x3e")](typeof this["\x6d\x61\x70"][fC("0x3f")][fC("0x40")],jj[fC("0x41")])){T=jj[fC("0x42")];break}T=jj["\x64\x63\x69\x65\x64"];break;case jj[fC("0x43")]:this[fC("0x44")]=fI();T="\x6d\x68\x6d";break;case fC("0x45"):this["\x6d\x61\x70"]=jk;T=jj[fC("0x46")];break;case fC("0x47"):this["\x77\x6f\x72\x64\x53\x70\x61\x63\x65\x52\x61\x74\x69\x6f"]=this["\x72\x61\x74\x69\x6f"];T=jj[fC("0x48")];break;case jj[fC("0x49")]:this[fC("0x3c")]=1;T=jj["\x78\x61\x63\x6d\x61"];break;case jj[fC("0x46")]:this["\x61\x72\x72\x50\x65\x6e\x64\x69\x6e\x67\x44\x61\x74\x61"]=[];T=jj[fC("0x4a")];break;case jj[fC("0x4b")]:jk["\x6f\x6e"](jj[fC("0x4c")],function(){var jn=fC("0x4d");while(jj[fC("0x4e")](jn,fC("0x18"))){switch(jn){case jj[fC("0x4f")]:i[fC("0x50")]=null;jn=fC("0x51");break;case fC("0x51"):i[fC("0x52")]=[];jn=jj[fC("0x53")];break;case fC("0x4d"):for(var jm=0,jl=i[fC("0x54")][fC("0x55")];jj[fC("0x56")](jm,jl);jm++){i[fC("0x54")][jm]["\x69\x73\x53\x65\x6e\x64\x46\x53"]=![]}jn=jj[fC("0x57")];break;case jj["\x6d\x63\x69\x61\x6d"]:if(jj[fC("0x4e")](typeof this["\x63\x6f\x6e\x66\x69\x67"][fC("0x40")],fC("0x27"))){jn=fC("0x17");break}jn=fC("0x18");break}}});T="\x65\x65\x6c";break;case jj[fC("0x58")]:this[fC("0x52")]=[];T=fC("0x2f");break;case fC("0x59"):jk["\x6f\x6e"]("\x64\x65\x73\x74\x72\x6f\x79",function(){for(var jl=0;jj[fC("0x56")](jl,i[fC("0x54")][fC("0x55")]);jl++){if(i["\x61\x72\x72\x57\x6f\x72\x6b\x65\x72"][jl]){i[fC("0x54")][jl][fC("0x5a")]()}}i[fC("0x54")][fC("0x55")]=0});T=jj["\x61\x64\x65\x63\x61"];break;case fC("0x31"):T=this[fC("0x44")]>1?fC("0x3b"):jj[fC("0x49")];break;case fC("0x33"):var e=navigator[fC("0x5b")]||4;T=jj[fC("0x5c")];break;case jj[fC("0x42")]:this[fC("0x50")]=null;T=jj[fC("0x58")];break;case fC("0x36"):if((jj[fC("0x5d")](bK)||ey[fC("0x5e")]["\x69\x65"])&&jj[fC("0x5f")](e,2)){T=fC("0x60");break}T=fC("0x2c");break;case fC("0x2f"):e3[fC("0x61")](function(js){var jr;if(js){jr=jj[fC("0x62")]}else{jr=jj[fC("0x63")]}for(var jq=0;jq<e;jq++){var jl=fC("0x24");while(jj[fC("0x64")](jl,fC("0x22"))){switch(jl){case fC("0x65"):i[fC("0x54")][fC("0x66")](jp);jl=jj[fC("0x67")];break;case jj[fC("0x68")]:jp[fC("0x69")]=function jm(ju){var jt=jj[fC("0x6a")];while(jj[fC("0x64")](jt,fC("0x1d"))){switch(jt){case jj[fC("0x6b")]:this[fC("0x6c")]&&this[fC("0x6c")](ju[fC("0x6d")],this[fC("0x6e")]);jt=jj["\x78\x65\x68\x61\x61"];break;case fC("0x6f"):this[fC("0x6c")]=null;jt=fC("0x1a");break;case jj[fC("0x70")]:this[fC("0x71")]=null;jt=jj[fC("0x72")];break;case jj[fC("0x73")]:var jx=jv[fC("0x74")];jt=fC("0x75");break;case jj[fC("0x76")]:jk[fC("0x77")](jw);jt=jj[fC("0x78")];break;case fC("0x21"):if(jj[fC("0x79")](i[fC("0x7a")][fC("0x55")],0)){jt=fC("0x7b");break}jt=fC("0x7c");break;case jj[fC("0x7d")]:this[fC("0x6c")]&&this[fC("0x6c")](null,this[fC("0x6e")]);jt=jj[fC("0x7e")];break;case fC("0x7c"):var jw=new ff(jj["\x65\x61\x78\x65\x65"]);jt=jj[fC("0x7f")];break;case"\x68\x69\x68":i[fC("0x80")](jv[fC("0x81")],jv[fC("0x82")],jv["\x74\x69\x6c\x65\x4b\x65\x79"],jx);jt="\x6d\x64\x68";break;case jj[fC("0x7e")]:this[fC("0x83")]=![];jt=fC("0x6f");break;case jj[fC("0x7f")]:jw["\x73\x6f\x75\x72\x63\x65"]=fC("0x84");jt=jj[fC("0x76")];break;case jj[fC("0x6a")]:jt=ju[fC("0x6d")]?fC("0x85"):jj[fC("0x7d")];break;case fC("0x1b"):this[fC("0x6e")]=null;jt=jj[fC("0x86")];break;case"\x6c\x65\x78":var jv=i[fC("0x7a")][fC("0x87")]();jt=jj[fC("0x73")];break}}};jl=fC("0x65");break;case jj[fC("0x88")]:var jp=iU(jr);jl=fC("0x23");break}}}if(i[fC("0x7a")][fC("0x55")]>0){for(var jo=0;jj["\x6d\x65\x78\x61\x68"](jo,Math[fC("0x89")](i[fC("0x7a")][fC("0x55")],e));jo++){var jn=i[fC("0x7a")][fC("0x87")]();i["\x6c\x6f\x61\x64\x54\x69\x6c\x65\x44\x61\x74\x61"](jn[fC("0x81")],jn[fC("0x82")],jn[fC("0x8a")],jn[fC("0x74")])}}});T=jj[fC("0x4b")];break;case fC("0x2c"):this[fC("0x54")]=[];T=jj[fC("0x43")];break;case fC("0x2a"):var i=this;T=fC("0x45");break;case jj[fC("0x8b")]:jk["\x6f\x6e"](jj[fC("0x8c")],function(){var jn=fC("0x29");while(jj[fC("0x8d")](jn,jj[fC("0x8e")])){switch(jn){case jj["\x6c\x61\x61\x64\x61"]:if(jj[fC("0x8f")](typeof this[fC("0x3f")][fC("0x40")],jj["\x6c\x6d\x69\x69\x65"])){jn=jj[fC("0x90")];break}jn=jj[fC("0x8e")];break;case fC("0x28"):i["\x73\x74\x72\x69\x6e\x67\x69\x66\x69\x65\x64\x43\x75\x73\x74\x6f\x6d\x53\x74\x79\x6c\x65\x49\x6e\x66\x6f"]=null;jn="\x6d\x6d\x6c";break;case jj["\x65\x63\x65\x69\x68"]:for(var jm=0,jl=i[fC("0x54")][fC("0x55")];jj[fC("0x56")](jm,jl);jm++){i[fC("0x54")][jm][fC("0x91")]=![]}jn=fC("0x26");break;case fC("0x92"):i[fC("0x52")]=[];jn="\x65\x68\x65\x61";break}}});T=fC("0x59");break}}},"\x67\x65\x74\x49\x64\x6c\x65\x57\x6f\x72\x6b\x65\x72":function(){var jk={"\x64\x69\x69\x6d\x65":fC("0x93"),"\x63\x65\x69\x6c\x65":fC("0x94"),"\x64\x69\x61\x61\x65":fC("0x95"),"\x64\x63\x61\x61\x6d":fC("0x96"),"\x69\x65\x78\x61\x61":fC("0x97")};for(var jj=0,T=this[fC("0x54")]["\x6c\x65\x6e\x67\x74\x68"];jj<T;jj++){var i=jk[fC("0x98")];while(i!==fC("0x97")){switch(i){case jk["\x63\x65\x69\x6c\x65"]:return e;case fC("0x96"):e[fC("0x83")]=!![];i="\x63\x63\x68";break;case jk[fC("0x98")]:var e=this["\x61\x72\x72\x57\x6f\x72\x6b\x65\x72"][jj];i=fC("0x95");break;case jk[fC("0x99")]:if(!e[fC("0x83")]){i=jk["\x64\x63\x61\x61\x6d"];break}i=jk[fC("0x9a")];break}}}return null},"\x72\x65\x6c\x65\x61\x73\x65\x50\x65\x6e\x64\x69\x6e\x67\x44\x61\x74\x61":function(e){var jn={"\x61\x64\x61\x6d\x64":function(jp,jo){return jp-jo},"\x68\x6d\x63\x61\x69":function(jp,jo){return jp>=jo},"\x78\x65\x65\x64\x61":function(jp,jo){return jp!==jo},"\x68\x69\x64\x78\x78":function(jp,jo){return jp+jo},"\x68\x6c\x61\x78\x61":function(jp,jo){return jp+jo},"\x65\x64\x61\x61\x68":"\x69\x64\x5f"};var jm=[];var jl=this[fC("0x7a")];for(var jk=jn[fC("0x9b")](jl["\x6c\x65\x6e\x67\x74\x68"],1);jn["\x68\x6d\x63\x61\x69"](jk,0);jk--){var jj=jl[jk];var T=jj[fC("0x82")];if(jn["\x78\x65\x65\x64\x61"](e[fC("0x9c")],T[fC("0x9c")])){continue}var i=jn[fC("0x9d")](jn[fC("0x9e")](jn[fC("0x9f")],T[fC("0xa0")])+"\x5f"+T["\x72\x6f\x77"]+"\x5f",T["\x7a\x6f\x6f\x6d"]);if(!e[i]){jl[fC("0xa1")](jk,1);jm[fC("0x66")](T)}}return jm},"\x6c\x6f\x61\x64\x54\x69\x6c\x65\x44\x61\x74\x61":function(jl,jj,T,i){var e={"\x65\x65\x65\x65\x6d":"\x68\x69\x63","\x65\x6d\x63\x61\x68":function(jv,ju){return jv+ju},"\x65\x68\x6d\x64\x64":fC("0xa2"),"\x63\x69\x65\x6c\x68":"\x64\x61\x6d","\x63\x68\x6c\x61\x6d":fC("0xa3"),"\x64\x65\x6d\x61\x6d":"\x78\x68\x63","\x65\x68\x6d\x61\x6c":fC("0xa4"),"\x6c\x6c\x6c\x61\x65":fC("0xa5"),"\x68\x61\x6d\x65\x69":"\x65\x6c\x65","\x65\x78\x65\x68\x65":function(ju,jv){return ju+jv},"\x6c\x69\x65\x6d\x69":fC("0xa6"),"\x6c\x65\x63\x65\x6c":fC("0xa7"),"\x65\x78\x61\x61\x65":"\x65\x78\x68","\x6d\x78\x61\x64\x65":fC("0xa8"),"\x61\x69\x78\x65\x65":"\x6d\x65\x6d","\x65\x63\x61\x6c\x64":fC("0xa9"),"\x65\x6d\x65\x68\x63":fC("0xaa"),"\x6c\x65\x61\x6c\x6c":"\x69\x61\x65","\x64\x65\x61\x65\x65":"\x63\x6c\x61","\x63\x68\x69\x65\x65":fC("0xab"),"\x68\x78\x61\x65\x63":fC("0xac"),"\x69\x6c\x6d\x64\x6d":function(jv,ju){return jv+ju},"\x63\x65\x61\x63\x61":fC("0xad"),"\x69\x61\x68\x63\x6d":fC("0xae"),"\x69\x65\x78\x61\x6c":fC("0xaf"),"\x78\x69\x6c\x69\x61":fC("0xb0"),"\x6d\x78\x63\x68\x65":fC("0x80"),"\x6d\x61\x69\x6c\x61":"\x78\x65\x69","\x63\x63\x61\x78\x61":"\x68\x61\x65","\x65\x61\x63\x61\x65":fC("0xb1"),"\x6c\x68\x6c\x6c\x78":fC("0xb2"),"\x61\x64\x6d\x68\x78":fC("0xb3"),"\x65\x6c\x78\x63\x61":fC("0xb4"),"\x65\x68\x68\x65\x6c":fC("0xb5"),"\x65\x64\x63\x65\x68":function(jv,ju){return jv===ju},"\x63\x6d\x64\x64\x65":fC("0xb6"),"\x61\x61\x61\x6c\x63":fC("0xb7"),"\x78\x61\x65\x65\x6d":function(jv,ju){return jv+ju}};var jt=e["\x65\x65\x65\x65\x6d"];while(jt!==fC("0xb7")){switch(jt){case fC("0xb2"):if(this[e[fC("0xb8")](e[fC("0xb9")],jk)]){jt=fC("0xba");break}jt="\x69\x65\x61";break;case fC("0xbb"):js["\x5f\x63\x62\x6b"]=i;jt=fC("0xbc");break;case e[fC("0xbd")]:this[fC("0x50")]=JSON["\x73\x74\x72\x69\x6e\x67\x69\x66\x79"](bp[e["\x63\x68\x6c\x61\x6d"]+jk]);jt=fC("0xb2");break;case e[fC("0xbe")]:jp["\x69\x6e\x64\x6f\x6f\x72\x53\x74\x79\x6c\x65"]=this[fC("0xbf")];jt="\x65\x78\x68";break;case fC("0xa6"):this[e[fC("0xb9")]+jk]=JSON[fC("0xc0")](bp[e[fC("0xc1")]+jk]);jt=fC("0xa7");break;case fC("0xb3"):if(jn){jt=fC("0xc2");break}jt=e[fC("0xc3")];break;case e["\x68\x61\x6d\x65\x69"]:jo=fC("0xc4");jt="\x65\x65\x61";break;case fC("0xc5"):if(!this[e[fC("0xc6")](fC("0xa2"),jk)]&&bp[e[fC("0xc1")]+jk]){jt=e[fC("0xc7")];break}jt=e[fC("0xc8")];break;case e[fC("0xc9")]:if(jn&&this[fC("0x50")]){jt=e[fC("0xca")];break}jt=e[fC("0xcb")];break;case fC("0xa5"):if(!js[fC("0x91")]){jt=fC("0xc5");break}jt=fC("0xcc");break;case fC("0xb6"):jt=js?fC("0xbb"):fC("0xcd");break;case fC("0xaf"):this["\x61\x72\x72\x50\x65\x6e\x64\x69\x6e\x67\x44\x61\x74\x61"][fC("0x66")](jq);jt="\x6d\x64\x65\x61";break;case e["\x65\x65\x65\x65\x6d"]:var js=this[fC("0xce")]();jt=e[fC("0xcf")];break;case fC("0xb4"):js[fC("0x91")]=!![];jt=fC("0xcc");break;case fC("0xd0"):jp[fC("0xd1")]={"\x77\x6f\x72\x64\x53\x70\x61\x63\x65\x52\x61\x74\x69\x6f":this["\x77\x6f\x72\x64\x53\x70\x61\x63\x65\x52\x61\x74\x69\x6f"],"\x74\x65\x78\x74\x53\x69\x7a\x65\x52\x61\x74\x69\x6f":this[fC("0x3c")]};jt=e[fC("0xd2")];break;case fC("0xd3"):this[fC("0xbf")]=JSON[fC("0xc0")](bp[fC("0xd4")]);jt=e["\x6c\x65\x61\x6c\x6c"];break;case fC("0xa7"):if(!this[fC("0xac")+jo]){jt=fC("0xab");break}jt=fC("0xd5");break;case e[fC("0xd6")]:js["\x5f\x70\x61\x72\x73\x69\x6e\x67\x54\x69\x6c\x65\x4b\x65\x79"]=T;jt=fC("0xb0");break;case e[fC("0xd7")]:this[e[fC("0xd8")]+jo]=JSON["\x73\x74\x72\x69\x6e\x67\x69\x66\x79"](bp[e["\x69\x6c\x6d\x64\x6d"](e[fC("0xd9")],jo)]);jt=fC("0xd5");break;case"\x78\x6c\x6d":var jr=this[fC("0xda")][fC("0xdb")][fC("0xdc")];jt=e[fC("0xdd")];break;case"\x78\x65\x68":jp[fC("0xde")]=this[fC("0x50")];jt="\x6d\x65\x6d";break;case fC("0xcd"):var jq={"\x75\x72\x6c":jl,"\x74\x69\x6c\x65\x49\x6e\x66\x6f":jj,"\x74\x69\x6c\x65\x4b\x65\x79":T,"\x63\x62\x6b":i};jt=e[fC("0xdf")];break;case e[fC("0xe0")]:var jp={"\x61\x63\x74\x69\x6f\x6e":e["\x6d\x78\x63\x68\x65"],"\x75\x72\x6c":jl,"\x74\x69\x6c\x65\x49\x6e\x66\x6f":jj,"\x74\x69\x6c\x65\x4b\x65\x79":T,"\x69\x73\x54\x65\x78\x74":jm,"\x69\x73\x50\x6f\x69":jr};jt=e[fC("0xe1")];break;case fC("0xd5"):if(!this[fC("0xbf")]){jt=e[fC("0xe2")];break}jt="\x69\x61\x65";break;case fC("0xe3"):jp[fC("0xad")]=this[e["\x68\x78\x61\x65\x63"]+jo];jt=fC("0xe4");break;case e[fC("0xe5")]:if(!this[fC("0x50")]){jt=e["\x63\x69\x65\x6c\x68"];break}jt=e[fC("0xe6")];break;case fC("0xe7"):var jo=jk;jt=e[fC("0xe8")];break;case fC("0xaa"):jp["\x6d\x61\x70\x53\x74\x79\x6c\x65\x49\x64"]=jk;jt=e[fC("0xe9")];break;case fC("0xbc"):js[fC("0x71")]=jj;jt=e[fC("0xd6")];break;case e[fC("0xea")]:var jn=!!e[fC("0xeb")](jk[fC("0xec")](fC("0xed")),0);jt=fC("0xe7");break;case"\x6c\x78\x68":var jm=jr?this["\x6d\x61\x70"][fC("0xdb")][fC("0xee")]:![];jt=e[fC("0xef")];break;case fC("0xcc"):js[fC("0xf0")](jp);jt=e[fC("0xf1")];break;case"\x61\x6d\x68":jp[fC("0xf2")]=this[e[fC("0xf3")](e[fC("0xb9")],jk)];jt=fC("0xe3");break;case e[fC("0xe1")]:var jk=this[fC("0xda")][fC("0xf4")]();jt=e[fC("0xea")];break;case fC("0xf5"):if(jn&&bp["\x63\x75\x73\x74\x6f\x6d\x53\x74\x79\x6c\x65\x49\x6e\x66\x6f\x5f"+jk]){jt=fC("0xb1");break}jt=e[fC("0xe6")];break}}}};ey[fC("0xf6")](iF["\x70\x72\x6f\x74\x6f\x74\x79\x70\x65"],gv);function h4(i){this.tileLayers=[];this.map=i;var e=this.config=dU[this.map.mapType];this.errorUrl=e.errorUrl;this.tileSize=e.tileSize;this.baseUnits=e.baseUnits;this.baseZoomLevel=e.zoomLevelBase;this.tileURLs=e.tileUrls;this.tilesInfoCache={};this.loadDelay=10;this._labelTextCanvas=null}bp.register(function(i){if(i._renderType!=="webgl"){return}var e=i.tileMgr=new h4(i);i.addEventListener("addtilelayer",function(jj){e.addWebGLLayer(jj.target)});i.addEventListener("removetilelayer",function(jj){e.removeWebGLLayer(jj.target)});i.on("update",function T(jk){if(i.getFeatureStyleTags().length===0||!i.customLoaded){return}var jj=false;if(jk.changedStatus&&jk.changedStatus.onzoom_changed){jj=true}e.loadLayersData({zoomChanged:jj})});i.on("style_changed",function(){e.loadLayersData()})});ey.extend(h4.prototype,{addWebGLLayer:function(T){this.tileLayers.push(T);T.initDrawData();if(this.tileLayers.length>1){for(var e=1;e<this.tileLayers.length;e++){if(this.tileLayers[e].isFlat){this.map.setDisplayOptions({isFlat:true});break}}}if(this.map.getFeatureStyleTags().length>0&&this.map.customLoaded){this.loadLayersData()}else{var jj=this;this.map.loadMapStyleFiles(function(){jj.loadLayersData()})}},removeWebGLLayer:function(jl){var jm=false;for(var jk=0,jj=this.tileLayers.length;jk<jj;jk++){if(jl===this.tileLayers[jk]){jm=true;this.tileLayers.splice(jk,1);break}}if(jm===false){return}jl.destroyDrawData();if(this.map.getFeatureStyleTags().length>0){this.loadLayersData()}if(this.tileLayers.length===1){this.map.setDisplayOptions({isFlat:false})}else{var e=false;for(var jk=1;jk<this.tileLayers.length;jk++){if(this.tileLayers[jk].isFlat){e=true;break}}this.map.setDisplayOptions({isFlat:e})}var T=new ff("onrefresh");T.source="removewebgllayer";this.map.fire(T)},getLabelTextCanvas:function(){if(!this._labelTextCanvas){this._labelTextCanvas=new ap(this.map)}return this._labelTextCanvas},loadLayersData:function(i){if(this.map.suspendLoad){return}var jj=this;i=i||{};var T=!!i.zoomChanged;var e=(T===true||this.map.getTilt()>50);if(!e){if(!this.syncLoadTimer){this.syncLoadTimer=setTimeout(function(){jj._loadLayersFromCache(T);jj.syncLoadTimer=null},40)}}else{this._loadLayersFromCache(T)}if(!jj.map.viewAnimationTime){this.timer&&window.clearTimeout(this.timer)}this.timer=window.setTimeout(function(){if(jj.map.viewAnimationTime){if(new Date().getTime()-jj.map.viewAnimationTime<1000){return}jj.map.viewAnimationTime=new Date().getTime()}var jl=jj.tileLayers.length;jj.tilesInfoCache={};for(var jm=0;jm<jl;jm++){var jo=jj.tileLayers[jm];var jn=jo.tileType;var jk=null;if(jj.tilesInfoCache[jn.getName()]){jk=jj.tilesInfoCache[jn.getName()]}else{jk=jj.calcTilesInfo(jn,jo);jj.tilesInfoCache[jn.getName()]=jk}jo.loadLayerData(jk,false,T)}jj.timer=null},this.loadDelay);if((bK()||ey.Browser.ie)&&T){this.loadDelay=200}else{this.loadDelay=80}},_loadLayersFromCache:function(jk){this.map._featureMgr.clearData();var jn=this.tileLayers;jn.sort(function(jo,i){return jo.zIndex-i.zIndex>0});var T=jn.length;this.tilesInfoCache={};for(var jj=0;jj<T;jj++){var jm=jn[jj];var jl=jm.tileType;var e=null;if(this.tilesInfoCache[jl.getName()]){e=this.tilesInfoCache[jl.getName()]}else{e=this.calcTilesInfo(jl,jm);this.tilesInfoCache[jl.getName()]=e}jm.loadLayerData(e,true,jk)}},calcTilesInfo:function(jw,jX){var jJ=this.map;var jP=jJ.getMapType();var jK=dU[jP];var jD=jJ.getZoom();var e=Math.floor(jD);var jm=jw.getDataZoom(jD);var j2=jw.getName();jm=bX(jm,jK.minDataZoom,jK.maxDataZoom);var jS=e;if(jw._name==="web"||jw._name==="xyz"){jS=jm}else{if(jS<3){jS=3}}var jH=jw.getTileSize(jD);var jl=jw.getBaseTileSize(jD);var jF=jJ.getBoundsIn();var jA=jw.getMercatorSize(jD,jm);var jz;var jQ;var jG;var jU;var jL=jJ.getCenterIn();if(jP!==BMAP_SATELLITE_MAP){jL=eB.calcLoopCenterPoint(jL)}if(j2==="xyz"){return this.calcXYZTilesInfo(jL,jF,jm,j2,jX,jJ)}var jE=Math.floor(jL.lng/jA);var jo=Math.floor(jL.lat/jA);var jN=0;var jj=0;if(j2!=="web"){jF=eB.calcLoopMapBounds(jF,jJ.getCenter())}if(jF.ne.lng>eB._mc180X){var ju=eB.getSpaceDistanceInPixel(jm);jN=Math.ceil(ju/jl)}if(jF.sw.lng<eB._mcM180X){var ju=eB.getSpaceDistanceInPixel(jm);jj=Math.ceil(ju/jl)}if(jF.ne.lat>19505879.362428114||jF.sw.lat<-15949096.637571886){jF.ne.lat=19505879.362428114;jF.sw.lat=-15949096.637571886}var jq=[Math.floor(jF.sw.lng/jA)-jj,Math.floor(jF.sw.lat/jA)];var j0=[Math.floor(jF.ne.lng/jA)+jN,Math.floor(jF.ne.lat/jA)];jz=jq[0];jQ=j0[0]+1;jG=jq[1];jU=j0[1]+1;var jv=[];for(var js=jz;js<jQ;js++){if(eB.isTileBlank(js,jm,jl)===true){continue}for(var jx=jG;jx<jU;jx++){var jW=false;var jr=256;if(j2==="web"){var jR=eB.calcLoopParam(js,jm);var jZ={col:jR.col,row:jx,baseTileSize:256,zoom:jm};var jI=il.prototype.tileToBound(jZ,jJ.getCenter());if(jI.LL.sw.lng*jI.LL.ne.lng<0&&Math.floor(jI.LL.ne.lng)<0){jW=true;jr=eB.pixelWidth(jI.MC.sw.lng,jJ.getZoom())}}var jt={col:js,row:jx,zoom:jm,useZoom:jS,tileTypeName:j2,loopOffsetX:0,tileSize:jH,baseTileSize:jl,mercatorSize:jA,combine:jW,dataIndex:jr};jv.push(jt);var jO="id_"+js+"_"+jx+"_"+jm;jv[jO]=true}}if(jP!==BMAP_SATELLITE_MAP){jv=eB.calcLoopTiles(jv,jm,jl,jA)}if(jm===3){for(var jY=0,jV=jv.length;jY<jV;jY++){var js=jv[jY].col;var jx=jv[jY].row;var jR=eB.calcLoopParam(js,jm);var jn=jR.T;var jB=js>=0?js-jn:js+jn;var jC="id_"+jB+"_"+jx+"_"+jm;if(!jv[jC]){var jt={col:jB,row:jx,zoom:jm,useZoom:jS,loopOffsetX:0,tileSize:jH,baseTileSize:jl,mercatorSize:jA,combine:false};jv.push(jt);jv[jC]=true}}}if(this.map._tilt>0){for(var jY=0;jY<jv.length;jY++){var jp=jv[jY];var jT=jp.col;var j1=jp.row;var jM=[];jM.minX=jT*jA;jM.maxX=(jT+1)*jA;jM.minY=j1*jA;jM.maxY=(j1+1)*jA;var jk=new cg(0,0);jk.lng=(jM.minX+jM.maxX)/2;jk.lat=(jM.minY+jM.maxY)/2;var jy=jJ.pointToPixelIn(jk);if(jy.x>0&&jy.x<this.map.width&&jy.y>0&&jy.y<this.map.height){continue}if(jM.minX<jL.lng&&jM.maxX>jL.lng&&jM.minY<jL.lat&&jM.maxY>jL.lat){continue}if(!this.ifTileInMapBounds(jM,jF,jT,j1)){jv.splice(jY,1);jY--}}}jv.sort((function(i){return function(T,j3){return((0.4*Math.abs(T.col-i[0])+0.6*Math.abs(T.row-i[1]))-(0.4*Math.abs(j3.col-i[0])+0.6*Math.abs(j3.row-i[1])))}})([jE,jo]));jv.zoom=jm;jv.tileTypeName=j2;return jv},calcXYZTilesInfo:function(ju,jn,jt,jy,jm,jB){var jp=jB.width;var jz=jB.height;var jo=Math.floor(jt);var jq=null;if(jm.transform.target==="EPSG3857"){var jj=de.transformBDmcPoint(ju,jm.transform);var jk=de.getRangeExtent(jj,jp,jz,jo,jm.transform);jq=[jk.minX,jk.minY,jk.maxX,jk.maxY]}else{if(jm.transform.source==="BD09MC"){var jj=[ju.lng,ju.lat];jq=[jn.sw.lng,jn.sw.lat,jn.ne.lng,jn.ne.lat]}else{var jj=de.transformBDmcPoint(ju,jm.transform);var jl=de.transformBDmcPoint(jn.ne,jm.transform);var js=de.transformBDmcPoint(jn.sw,jm.transform);jq=de.getLoopBox(jj,[js[0],js[1],jl[0],jl[1]])}}if(!jj||!jq){return[]}jo=jo+jm.spanLevel;var T=de.getTileRangeForExtentFactory(jq,jo,jm.transform);var e=[];var jC=de.getResolutionScale(jo,jm.transform);for(var jx=T.minX;jx<=T.maxX;jx++){for(var jv=T.minY;jv<=T.maxY;jv++){var jw={col:jx,row:jv,zoom:jo,useZoom:jo,tileTypeName:jy,loopOffsetX:0,tileSize:256*jC,transform:jm.transform,combine:false,dataIndex:0};e.push(jw);var jr="id_"+jx+"_"+jv+"_"+jo;e[jr]=true}}var jA=de.getTileCoordForCoordAndZ(jj,jo);e.sort((function(i){return function(jD,jE){return((0.4*Math.abs(jD.col-i[0])+0.6*Math.abs(jD.row-i[1]))-(0.4*Math.abs(jE.col-i[0])+0.6*Math.abs(jE.row-i[1])))}})([jA[1],jA[2]]));e.zoom=jo;e.tileTypeName=jy;return e},getCurrentViewTilesInfo:function(i){var e=this.tilesInfoCache[i.getName()];if(!e){return this.calcTilesInfo(i)}return e},ifTileInMapBounds:function(e,jl,T,jk){var i=jl.normalizedBottomLeft;var jw=jl.normalizedTopRight;var jo=jl.normalizedTopLeft;var jm=jl.normalizedBottomRight;var jj=false;var jv=new cg(e.minX,e.minY);var js=new cg(e.maxX,e.maxY);var jn=new cg(js.lng,jv.lat);var jt=new cg(jv.lng,js.lat);var jq=[jt,js,jn,jv];for(var ju=0,jp=jq.length;ju<jp;ju++){var jr=ju+1;if(jr===jp){jr=0}var jx=ju;var jy=ik(jq[jr],jq[jx],jo,i);if(jy){jj=true;break}jy=ik(jq[jr],jq[jx],jm,jw);if(jy){jj=true;break}jy=ik(jq[jr],jq[jx],jw,jo);if(jy){jj=true;break}jy=ik(jq[jr],jq[jx],i,jm);if(jy){jj=true;break}}return jj},getTileLayer:function(jk){for(var jj=0,e=this.tileLayers.length;jj<e;jj++){var T=this.tileLayers[jj];if(T.mapType===jk){return T}}return null},getZoomState:function(i){var e=i-this.lastZoom;if(e>0){this.zoomState=1}else{if(e<0){this.zoomState=-1}}this.lastZoom=i;return this.zoomState}});function gP(e){this._map=e;this._spotsId=null;this._init()}gP.prototype._init=function(){var e=this._map;e.addEventListener("onspotsdataready",function(T){var i=T.spots;if(this._spotsId){e.removeSpots(this._spotsId)}this._spotsId=e.addSpots(i)})};bp.register(function(e){if(!e.config.enableIconClick){return}e._mapIcon=new gP(e)});function cM(e){this._indoorData={};this._map=e;this.currentUid=null;this.currentFloor=null;this._indoorControl=null;this.enterMethod=null;this.showMask=false;this._isMobile=bK();this._autoEnterZoom=19;if(this._isMobile){this._autoEnterZoom=17}this._init(e);window._indoorMgr=this}cM.prototype._init=function(i){var e=this;i.on("indoor_status_changed",function(jm){var T=jm.uid;var jk=jm.floor;if(T===null){T=e.currentUid;if(e._indoorData[T]){jk=e._indoorData[T].defaultFloor}if(e._indoorControl){e._indoorControl.hide()}e.currentUid=null;e.currentFloor=null;e.enterMethod=null}else{if(e._indoorData[T]){var jl=e._indoorData[T];jk=(typeof jk==="number")?jk:jl.defaultFloor;if(!e._indoorControl){if(i.config.showControls&&i._displayOptions.indoor){e._indoorControl=new an(i,jl)}}else{e._indoorControl.setInfo(jl);e._indoorControl.show()}e.currentUid=T;e.currentFloor=jk}}if(!e._indoorData||!e._indoorData[T]||e._indoorData[T].currentFloor===jk){this.fire(new ff("onrefresh"));return}var jj=new ff("onindoor_data_refresh");jj.uid=T;jj.floor=jk;jj.tileKey=e._indoorData[T].tileKey;e._indoorData[T].currentFloor=jk;e.currentFloor=jk;this.fire(jj)});i.on("spotclick",function(jj){var T=null;if(jj.curAreaSpot&&this.areaSpots[jj.curAreaSpot]){T=this.areaSpots[jj.curAreaSpot].userData.uid}if(T===e.currentUid){if(jj.curAreaSpot){e.enterMethod="byClick"}return}if(T===null){if(e.currentUid&&e.enterMethod==="byClick"){i.showIndoor(null);e.enterMethod=null}}else{e.enterMethod="byClick";if(e.currentUid){i.showIndoor(e.currentUid,e._indoorData[e.currentUid].defaultFloor)}i.showIndoor(T,e._indoorData[T].defaultFloor)}});i.on("moveend",function(){if(this.getZoom()>=e._autoEnterZoom){e._checkIndoorByMove()}});i.on("zoomend",function(){if(this.getZoom()>=e._autoEnterZoom){e._checkIndoorByMove()}else{if(e.enterMethod!=="byClick"&&e.currentUid!==null){this.showIndoor(null)}}})};cM.prototype._checkIndoorByMove=function(){var T=this._map;var jp=T.getSize();var ju={x:jp.width/2,y:jp.height/2};var jt=Math.max(jp.width,jp.height);var jv=[];for(var jq in this._indoorData){var e=this._indoorData[jq].center;var jj=T.pointToPixelIn(new bp.Point(e[0],e[1]));var jm=b3(ju,jj);jv.push({uid:jq,distance:jm})}if(jv.length===0){return}jv.sort(function(jw,i){return jw.distance-i.distance});var jl=jv[0];var jr=T.getCenterIn();var jk=false;for(var jo=0;jo<this._indoorData[jl.uid].contour.length;jo++){if(bC([jr.lng,jr.lat],this._indoorData[jl.uid].contour[jo])){jk=true;break}}if(jk===false&&jl.uid==="e96b44200baa3b4082288acc"){var jn=this._indoorData[jl.uid].boundsMin;var js=this._indoorData[jl.uid].boundsMax;if(jr.lng>jn[0]&&jr.lat>jn[1]&&jr.lng<js[0]&&jr.lat<js[1]){jk=true}}if(jk){if(this.enterMethod!=="byClick"){if(this.currentUid!==null&&this.currentUid!==jl.uid){this._map.showIndoor(this.currentUid,this._indoorData[this.currentUid].defaultFloor)}if(this.currentUid!==jl.uid){this._map.showIndoor(jl.uid,this._indoorData[jl.uid].defaultFloor)}this.enterMethod="byMove"}}else{if(this.enterMethod!=="byClick"){this._map.showIndoor(null)}}};cM.prototype.setData=function(jj){if(jj===null){return}for(var T in jj){if(T==="tileInfo"){continue}var jk=jj[T].tileKey;if(this._indoorData[T]){if(!this._indoorData[T][jk]){this._indoorData[T].tileKeys.push(jk);this._indoorData[T][jk]=true}}else{this._indoorData[T]=jj[T];this._indoorData[T].tileKeys=[jj[T].tileKey];this._indoorData[T][jk]=true;for(var e=0;e<this._indoorData[T].contour.length;e++){this._map.addAreaSpot(this._indoorData[T].contour[e],{id:T+e,userData:{uid:T}})}}}if(this._map.getZoom()>=this._autoEnterZoom){this._checkIndoorByMove()}};cM.prototype.removeData=function(T,jk){if(!this._indoorData[T]){return}var jj=this._indoorData[T];for(var e=0;e<jj.tileKeys.length;e++){if(jj.tileKeys[e]===jk){jj.tileKeys.splice(e,1);break}}delete jj[jk];if(jj.tileKeys.length===0){delete this._indoorData[T]}};cM.prototype.getIndoorData=function(e){return this._indoorData[e]||null};cM.prototype.getData=function(){return this._indoorData};bp.register(function(e){e._indoorMgr=new cM(e)});var aP=(function(){var jj={};var js={};var jo={};function jq(ju){if(Object.prototype.toString.call(ju)==="[object Object]"){for(var jt in ju){return false}return true}else{return false}}function jp(jA,jB,jE,jx,jD){var jt=jt||null;jx=jx||jt;var jv;if(jx){jv=jr(jA,jB,jE,jx)}else{jv=T(jA,jB,jE,jD)}var jz=jv.drawId;var ju=jv.style;var jC=jv.styleUpdate;var jF=[];if(!jz){return jF}for(var jw=0;jw<jz.length;jw++){var jy=jC[jz[jw]]||ju[jz[jw]];if(jy){switch(jB){case"polygon":jy=jk(jy,jA);break;case"line":jy=jn(jy,jA);break;case"pointText":jy=jl(jy,jA);break;case"point":jy=e(jy,jA);break;case"polygon3d":jy=jm(jy,jA);break}if(jy){jy.did=jz[jw];jF[jF.length]=jy}}}return jF}function jr(ju,jw,jx,jt){var jv=jt[2];switch(jw){case"point":jv=jv[0];break;case"pointText":jv=jv[1];break;case"line":jv=jv[3];break;case"polygon":jv=jv[4];break;case"polygon3d":jv=jv[5];break}var jz=jx-1;if(jw==="line"&&jx===12){jz=jx}var jA=jt[1][jz][0];var jy=jA[ju];if(!jy){if(jw==="point"||jw==="pointText"){jA=jt[1][jx][0];jy=jA[ju]}}return{drawId:jy,style:jv,styleUpdate:[]}}function T(jx,jy,jB,jA){if(!jA){return{drawId:null,style:[],styleUpdate:[]}}var jz;var jv=jA.baseFs;if(jq(jA.zoomRegion)){jz=jA.StyleBody||[]}else{jz=jA.zoomStyleBody[jB]||[]}var ju=jv[2];switch(jy){case"point":ju=ju[0];jz=jz[0]||{};break;case"pointText":ju=ju[1];jz=jz[1]||{};break;case"line":ju=ju[3];jz=jz[3]||{};break;case"polygon":ju=ju[4];jz=jz[4]||{};break;case"polygon3d":ju=ju[5];jz=jz[5]||{};break}var jt=jv[1][jB-1][0];var jw=jt[jx];return{drawId:jw,style:ju,styleUpdate:jz}}function jl(ju,jt){if(!ju||ju.length===0){return null}return{sid:jt,fontRgba:i(ju[0]),haloRgba:i(ju[1]),backRgba:i(ju[2]),fontSize:ju[3],haloSize:ju[4],fontWeight:ju[5],fontStyle:ju[6],density:ju[7]}}function e(ju,jt){return{sid:jt,rank:ju[0],ucflag:ju[1],icon:ju[2],iconType:ju[3],nineGG:ju[4],density:ju[5],zoom:ju[6]}}function jn(ju,jt){return{sid:jt,borderRgba:i(ju[0]),fillRgba:i(ju[1]),borderWidth:ju[2],fillWidth:ju[3],borderCap:ju[4],fillCap:ju[5],haveBorderLine:ju[6],haveBorderTexture:ju[7],haveFillTexture:ju[8],isUseBorderRgba:ju[9],isUseFillRgba:ju[10],borderTexture:ju[11],fillTexture:ju[12],borderTextureType:ju[13],fillTextureType:ju[14],isRealWidth:ju[15],haveArrow:ju[16],needRound:ju[17],realBorderWidth:ju[18]}}function jk(ju,jt){return{sid:jt,fillRgba:i(ju[0]),borderRgba:i(ju[1]),borderWidth:ju[2],borderTexture:ju[3],borderTextureType:ju[4],waterStyle:ju[5],haloStyle:ju[6],textureStyle:ju[7],thickRgba:i(ju[8])}}function jm(ju,jt){return{sid:jt,filter:ju[0],ratio:ju[1],haveBorder:ju[2],borderWidth:ju[3],borderRgba:i(ju[4]),fillTop:i(ju[5]),fillSide:i(ju[6]),polyTexture:ju[7]}}function i(jy){var jx=jy;if(jo[jx]){return jo[jx]}jy=jy>>>0;var jw=(jy)&255;var jv=(jy>>8)&255;var jt=(jy>>16)&255;var ju=(jy>>24)&255;jo[jx]=[jw,jv,jt,ju];return jo[jx]}return{getStyleFromCache:function(jA,jv,jy,jz,ju,jx,jt){jA=jA||"default";var jw=jA+"-"+jv+"-"+jy+"-"+jz;if(jx){jw+="-indoor"}if(ju){if(!js[jw]){js[jw]=jp(jv,jy,jz,ju)}return js[jw]}if(!jj[jw]){jj[jw]=jp(jv,jy,jz,ju,jt)}return jj[jw]}}})();bp.register(function(i){var e=new hu(i)});function hu(e){e.container.appendChild(this.render());this.bind(e)}hu.prototype.render=function(){var i=document.createElement("div");i.className="click-ripple-container";var e=document.createElement("div");e.className="click-ripple";i.appendChild(e);this._div=i;this._ripple=e;return i};hu.prototype.bind=function(i){var e=this;i.addEventListener("spotclick",function(T){if(!T.spots||T.spots.length===0){return}e._div.style.left=T.pixel.x+"px";e._div.style.top=T.pixel.y+"px";ey.ac(e._ripple,"ripple-playing")});ey.on(e._ripple,"transitionend",function(){ey.rc(e._ripple,"ripple-playing")})};function bJ(e){cN.call(this);if(!e){return}this._opts={};this._map=e;this._maxLat=84.6;this._minLat=-80.6;this._maxLatMC=il.convertLL2MC(new ca(this._maxLat,0)).lat;this._minLatMC=il.convertLL2MC(new ca(this._minLat,0)).lat}bJ.inherits(cN,"ToolbarItem");ey.extend(bJ.prototype,{open:function(){if(this._isOpen==true){return true}if(this._map._toolInUse){return false}this._map._toolInUse=true;this._isOpen=true;return true},close:function(){if(!this._isOpen){return}this._map._toolInUse=false;this._isOpen=false},_checkStr:function(e){if(!e){return""}return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}});function b1(T,i){bJ.call(this,T);i=i||{};this._opts=ey.extend(ey.extend(this._opts||{},{autoClear:false,tips:"测距",followText:"单击确定起点，双击结束绘制",unit:"metric",showResult:true,lineColor:"blue",lineStroke:2,opacity:1,lineStyle:"solid",cursor:w.distCursor,styleCodes:{lnCode:0,spCode:0,slCode:0,tlCode:0},enableMassClear:true}),i);if(this._opts.showResult===false){if(typeof i.tips==="undefined"){this._opts.tips="绘制折线"}if(!i.cursor){this._opts.cursor="crosshair"}}if(this._opts.lineStroke<=0){this._opts.lineStroke=2}if(this._opts.opacity>1){this._opts.opacity=1}else{if(this._opts.opacity<0){this._opts.opacity=0}}if(this._opts.lineStyle!=="solid"&&this._opts.lineStyle!=="dashed"){this._opts.lineStyle="solid"}this._checked=false;this._drawing=null;this.followTitle=null;this._totalDis={};this._points=[];this._paths=[];this._dots=[];this._segDistance=[];this._overlays=[];this._units={metric:{name:"metric",conv:1,incon:1000,u1:"米",u2:"公里"},us:{name:"us",conv:3.2808,incon:5279.856,u1:"英尺",u2:"英里"}};if(!this._units[this._opts.unit]){this._opts.unit="metric"}this._dLineColor="#ff6319";this._dLineStroke=3;this._dOpacity=0.8;this._dLineStyle="solid";this._dCursor=w.distCursor;if(this._opts.showResult){this._opts.followText="单击确定起点"}this._followTextM="单击确定地点，双击结束";this._sectionMarkerTip="单击可删除此点，拖拽可调整位置";this._movingTimerId=null;if(this._opts.showResult){this.text="测距"}else{this.text="绘线"}this._isOpen=false;var e=this;gs.load("tools",function(){e._draw()})}b1.inherits(bJ,"PolylineTItem");ey.extend(b1.prototype,{setLineColor:function(e){this._opts.lineColor=e},setLineStroke:function(e){if(Math.round(e)>0){this._opts.lineStroke=Math.round(e)}},setOpacity:function(e){if(e>=0&&e<=1){this._opts.opacity=e}},setLineStyle:function(e){if(e==="solid"||e==="dashed"){this._opts.lineStyle=e}},clear:function(){for(var T=0,e=this._overlays.length;T<e;T++){if(this._overlays[T]){this._map.removeOverlay(this._overlays[T])}}this._overlays.length=0;for(var T=0,e=this._dots.length;T<e;T++){if(this._dots[T]&&this._dots[T].parentNode){this._dots[T].parentNode.removeChild(this._dots[T])}}this._dots.length=0},setCursor:function(e){if(this._opts.showResult===true){return}this._opts.cursor=e},getCursor:function(){if(this._opts.showResult===true){return this._dCursor}var e=this._opts.cursor.match(/^url\((.+)\)(,.*)?/);if(e!==null){return e[1]}else{return this._opts.cursor}},showResult:function(e){this._opts.showResult=!!e}});function bu(){var jk=3;var jr=256;var jj=Math.pow(2,18-jk)*jr;var js=2;var jq=(js+1)*jj;var T=il.convertLL2MC(new cg(180,0));var jo=T.lng;var jm=jq-jo;var jp=-3;var e=jp*jj;var jl=il.convertLL2MC(new cg(-180,0));var jn=jl.lng;var i=jn-e;this._validPixels=jo/Math.pow(2,18-jk);this._mc180X=jo;this._mcM180X=jn;this._loopOffset=jm+i;this._mcTSpan=jo-jn;this._spaceDistance=jm;this._mSpaceDistance=i}bu.prototype={calcLoopParam:function(jj,i,jq){jq=jq||256;var jn=0;var jk=3;var jm=6;var jl=jm*Math.pow(2,(i-jk))*256/jq;var jp=jl/2-1;var jo=-jl/2;while(jj>jp){jj-=jl;jn-=this._loopOffset}while(jj<jo){jj+=jl;jn+=this._loopOffset}var e=jn;jn=Math.round(jn/Math.pow(2,18-i));return{offsetX:jn,geoOffsetX:e,col:jj,T:jl,maxCol:jp,minCol:jo}},calcLoopCenterPoint:function(i){var e=i.lng;while(e>this._mc180X){e-=this._mcTSpan}while(e<this._mcM180X){e+=this._mcTSpan}i.lng=e;return i},calcLoopMapBounds:function(T,jj){var i=jj||T.getCenter();var e=T.sw.lng;var jk=T.ne.lng;while(i.lng>this._mc180X){i.lng-=this._mcTSpan;e-=this._mcTSpan;jk-=this._mcTSpan}while(i.lng<this._mcM180X){i.lng+=this._mcTSpan;e+=this._mcTSpan;jk+=this._mcTSpan}T.sw.lng=e;T.ne.lng=jk;if(T.pointBottomLeft){T.pointBottomLeft=this.calcLoopCenterPoint(T.pointBottomLeft);T.pointTopLeft=this.calcLoopCenterPoint(T.pointTopLeft);T.pointTopRight=this.calcLoopCenterPoint(T.pointTopRight);T.pointBottomRight=this.calcLoopCenterPoint(T.pointBottomRight)}return T},calcLoopTiles:function(jr,e,jv,jo){jv=jv||256;var jk=jo||Math.pow(2,18-e)*jv;var jq=Math.floor(this._mc180X/jk);var jm=Math.floor(this._mcM180X/jk);var js=Math.floor(this._loopOffset/jk);var jt=[];for(var jn=0;jn<jr.length;jn++){var ju=jr[jn];var jj=ju[0];var jw=ju[1];if(jj>=jq){var jp=jj+js;if(this.isTileBlank(jp,e,jv)===true){continue}var T="id_"+jp+"_"+jw+"_"+e;if(!jr[T]){jr[T]=true;jt.push([jp,jw,e,0])}}else{if(jj<=jm){var jp=jj-js;if(this.isTileBlank(jp,e,jv)===true){continue}var T="id_"+jp+"_"+jw+"_"+e;if(!jr[T]){jr[T]=true;jt.push([jp,jw,e,0])}}}}for(var jn=0,jl=jt.length;jn<jl;jn++){jr.push(jt[jn])}for(var jn=jr.length-1;jn>=0;jn--){var jj=jr[jn][0];if(this.isTileBlank(jj,e,jv)){jr.splice(jn,1)}}return jr},isTileBlank:function(T,jk,e){var jl=Math.pow(2,jk-3);var i=Math.round(this._validPixels*jl);var jj=6*jl*256/e;while(T>jj/2-1){T-=jj}while(T<-(jj/2)){T+=jj}if(T>0&&T*e>i){return true}if(T<0&&Math.abs((T+1)*e)>i){return true}return false},isAddWidth:function(e,i){return e<this._mcM180X||i>this._mc180X},pixelWidth:function(e,i){if(e<0){e=-e}return Math.abs(e-this._mc180X)/(Math.pow(2,18-i))},getSpaceDistanceInPixel:function(i){var e=Math.round((this._spaceDistance+this._mSpaceDistance)/Math.pow(2,18-i));return e}};var eB=new bu();var fZ=(function(){function jp(ju){var jt=ju?ju:{};if(jt.reference){this.reference=jt.reference}else{this.reference=null}return this}jp.prototype.readFeatureFromObject=function(ju,jx){var jt=null;if(ju.type==="Feature"){jt=ju}else{jt={type:"Feature",geometry:ju,properties:null,}}jx=jx||{};jx.reference=(jx.reference===undefined?this.reference:jx.reference);if(jx.isPoints){jx.onlyGeometry=true}var jy=i(jt.geometry,jx,jt.properties);var jw=e(jk(jt),jx);if(!jy){return null}if(jx&&jx.onlyGeometry&&!jx.isPoints){return{geometry:jy,type:jt.geometry.type,bBox:jw}}if(jy instanceof Array){for(var jv=0;jv<jy.length;jv++){if(jx.isPoints){jy[jv]={points:jy[jv],properties:jt.properties}}else{jy[jv].properties=jt.properties}}}else{if(jx.isPoints){jy={points:jy,properties:jt.properties}}else{jy.properties=jt.properties}}return jy};jp.prototype.readFeaturesFromObject=function(jv,jD,jt){var jA=jv;var ju=null;if(jA.type==="FeatureCollection"){var jx=jv;ju=[];var jz=jx.features;for(var jy=0,jB=jz.length;jy<jB;++jy){var jC=this.readFeatureFromObject(jz[jy],jD);if(jC instanceof Array){for(var jw=0;jw<jC.length;jw++){jt&&jt(jC[jw]);ju.push(jC[jw])}}else{jt&&jt(jC);ju.push(jC)}}}else{var jC=this.readFeatureFromObject(jv,jD);if(jC instanceof Array){ju=[];for(var jy=0;jy<jC.length;jy++){jt&&jt(jC[jy]);ju.push(jC[jy])}}else{jt&&jt(jC);ju=[jC]}}return ju};function i(jt,jv,ju){if(!jt){return null}var jw;switch(jt.type){case fl.POINT:jw=jm(jt,jv,ju);break;case fl.LINE_STRING:jw=T(jt,jv,ju);break;case fl.POLYGON:jw=jn(jt,jv,ju);break;case fl.MULTI_POINT:jw=jo(jt,jv,ju);break;case fl.MULTI_LINE_STRING:jw=jq(jt,jv,ju);break;case fl.MULTI_POLYGON:jw=jr(jt,jv,ju);break;default:throw new Error("geojson类型错误: "+jt.type)}return jw}function jm(ju,jx,jv){var jy=ju.coordinates;if(jx.reference&&jx.reference!=="BD09LL"){jy=gcoord.transform(jy,gcoord[jx.reference||"EPSG4326"],gcoord.BD09LL)}if(jx&&jx.onlyGeometry){return new cg(jy[0],jy[1])}var jw=jx;if(jx.markerStyle){jw=jx.markerStyle;if(jx.markerStyle instanceof Function){jw=jx.markerStyle(jv)||{}}}var jt=new r(new cg(jy[0],jy[1]),jw);return jt}function js(jx,ju){var jw=[];for(var jt=0;jt<jx.length;jt++){var jv=jx[jt];if(ju.reference&&ju.reference!=="BD09LL"){jv=gcoord.transform(jv,gcoord[ju.reference||"EPSG4326"],gcoord.BD09LL)}jw.push(new cg(jv[0],jv[1]))}return jw}function T(ju,jx,jv){var jy=ju.coordinates;if(jx&&jx.onlyGeometry){return js(jy,jx)}var jw=jx;if(jx.polylineStyle){jw=jx.polylineStyle;if(jx.polylineStyle instanceof Function){jw=jx.polylineStyle(jv)||{}}}var jt=new bd(js(jy,jx),jw);return jt}function jn(jt,jx,jv){var jy=jt.coordinates;if(jx&&jx.onlyGeometry){return js(jy[0],jx)}var jw=jx;if(jx.polygonStyle){jw=jx.polygonStyle;if(jx.polygonStyle instanceof Function){jw=jx.polygonStyle(jv)||{}}}var ju=new hW(js(jy[0],jx),jw);return ju}function jo(jv,jB,jy){var jz=jv.coordinates;var jt=[];for(var jx=0;jx<jz.length;jx++){var jA=jz[jx];if(jB.reference&&jB.reference!=="BD09LL"){jA=gcoord.transform(jA,gcoord[jB.reference||"EPSG4326"],gcoord.BD09LL)}if(jB&&jB.onlyGeometry){jt.push(new cg(jA[0],jA[1]))}else{var ju=jB;if(jB.markerStyle){ju=jB.markerStyle;if(jB.markerStyle instanceof Function){ju=jB.markerStyle(jy)||{}}}var jw=new r(new cg(jA[0],jA[1]),ju);jt.push(jw)}}return jt}function jq(ju,jy,jw){var jA=ju.coordinates;var jz=[];for(var jv=0;jv<jA.length;jv++){if(jy&&jy.onlyGeometry){jz.push(js(jA[jv],jy))}else{var jx=jy;if(jy.polylineStyle){jx=jy.polylineStyle;if(jy.polylineStyle instanceof Function){jx=jy.polylineStyle(jw)||{}}}var jt=new bd(js(jA[jv],jy),jx);jz.push(jt)}}return jz}function jr(jw,jD,jA){var jC=jw.coordinates;var jt=[];for(var jz=0;jz<jC.length;jz++){var jE=[];for(var jx=0,jv=jC[jz];jx<jv.length;jx++){var jy=js(jv[jx],jD);if(jD&&jD.onlyGeometry){if(jv.length===1){jt.push(jy)}else{jE.push(jy)}}else{if(jv.length===1){var ju=jD;if(jD.polygonStyle){ju=jD.polygonStyle;if(jD.polygonStyle instanceof Function){ju=jD.polygonStyle(jA)||{}}}var jB=new hW(jy,ju);jt.push(jB)}else{jE.push(jy)}}}if(jv.length!==1){if(jD&&jD.onlyGeometry){jt.push(jE)}else{var ju=jD;if(jD.polygonStyle){ju=jD.polygonStyle;if(jD.polygonStyle instanceof Function){ju=jD.polygonStyle(jA)||{}}}var jB=new hW(jE,ju);jt.push(jB)}}}return jt}function jj(jt){}function e(jx,ju){var jw=[];for(var jt=0;jt<jx.length;jt+=2){var jv=[jx[jt],jx[jt+1]];if(ju.reference){jv=gcoord.transform(jv,gcoord[ju.reference||"EPSG4326"],gcoord.BD09LL)}jw.push(jv[0]);jw.push(jv[1])}return jw}function jk(ju){var jx=[Infinity,Infinity,-Infinity,-Infinity];jl(ju,function(jy){if(jx[0]>jy[0]){jx[0]=jy[0]}if(jx[1]>jy[1]){jx[1]=jy[1]}if(jx[2]<jy[0]){jx[2]=jy[0]}if(jx[3]<jy[1]){jx[3]=jy[1]}});if(this.reference){var jw=[];for(var jv=0;jv<jx.length;jv+=2){var jt=gcoord.transform([jx[jv],jx[jv+1]],gcoord[this.reference||"EPSG4326"],gcoord.BD09LL);jw.push(jt[0]);jw.push(jt[1])}jx=jw}return jx}function jl(jC,jH){var jy,jv,ju,jB,jt,jE,jG,jF,jx,jA,jw=jC.type==="FeatureCollection",jz=jC.type==="Feature",jD=jw?jC.features.length:1;for(jy=0;jy<jD;jy++){jx=(jw?jC.features[jy].geometry:(jz?jC.geometry:jC));jA=jx.type==="GeometryCollection";jG=jA?jx.geometries.length:1;for(jB=0;jB<jG;jB++){jE=jA?jx.geometries[jB]:jx;jF=jE.coordinates;if(jE.type==="Point"){jH(jF)}else{if(jE.type==="LineString"||jE.type==="MultiPoint"){for(jv=0;jv<jF.length;jv++){jH(jF[jv])}}else{if(jE.type==="Polygon"||jE.type==="MultiLineString"){for(jv=0;jv<jF.length;jv++){for(ju=0;ju<jF[jv].length;ju++){jH(jF[jv][ju])}}}else{if(jE.type==="MultiPolygon"){for(jv=0;jv<jF.length;jv++){for(ju=0;ju<jF[jv].length;ju++){for(jt=0;jt<jF[jv][ju].length;jt++){jH(jF[jv][ju][jt])}}}}else{throw new Error("类型错误")}}}}}}}return jp})();const cF={point:{icon:{format:"string",defaultValue:""},iconSize:{format:"array",defaultValue:[32,32]},uid:{format:"string",defaultValue:"custom-vector-0"},name:{format:"string",defaultValue:""},fontSize:{format:"number",defaultValue:22},color:{format:"string",defaultValue:"#0d20c9"},haloSize:{format:"number",defaultValue:2},strokeColor:{format:"string",defaultValue:"#fff"},textOnIcon:{format:"string",defaultValue:false},textOnIconSize:{format:"array",defaultValue:[32,32]},textOnIconUrl:{format:"string",defaultValue:""},textMargin:{format:"number",defaultValue:0},direction:{format:"number",defaultValue:0},rank:{format:"number",defaultValue:50000},visibility:{format:"boolean",defaultValue:true}},polyline:{strokeLineJoin:{format:"string",defaultValue:"miter"},strokeLineCap:{format:"string",defaultValue:"round"},strokeColor:{format:"string",defaultValue:"#142655"},strokeWeight:{format:"number",defaultValue:2},strokeOpacity:{format:"number",defaultValue:1},strokeStyle:{format:"string",defaultValue:"solid"},dashArray:{format:"object",defaultValue:[8,4]},visibility:{format:"boolean",defaultValue:true}},polygon:{fillColor:{format:"string",defaultValue:"#142655"},fillOpacity:{format:"number",defaultValue:1},strokeWeight:{format:"number",defaultValue:0},strokeLineJoin:{format:"string",defaultValue:"miter"},strokeLineCap:{format:"string",defaultValue:"round"},strokeColor:{format:"string",defaultValue:"#dec41b"},strokeOpacity:{format:"number",defaultValue:1},strokeStyle:{format:"string",defaultValue:"solid"},dashArray:{format:"object",defaultValue:[8,4]},visibility:{format:"boolean",defaultValue:true}}};const cb=(function(i){var e={};for(var jj in i){e[jj]={};for(var T in i[jj]){e[jj][T]=i[jj][T].defaultValue}}return e})(cF);const fl={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",CIRCLE:"Circle",};var iM=(function(){var i=true;var jk=256;var e=true;var jm=iY("ditu","normalTraffic");var jj=jm.udt;var jn="//its.map.baidu.com/traffic/";var jl=[[2,"79,210,125,1",3,2,0,[],0,0],[2,"79,210,125,1",3,2,0,[],0,0],[2,"79,210,125,1",4,2,0,[],0,0],[2,"79,210,125,1",5,2,0,[],0,0],[2,"79,210,125,1",6,2,0,[],0,0],[2,"255,208,69,1",3,2,0,[],0,0],[2,"255,208,69,1",3,2,0,[],0,0],[2,"255,208,69,1",4,2,0,[],0,0],[2,"255,208,69,1",5,2,0,[],0,0],[2,"255,208,69,1",6,2,0,[],0,0],[2,"232,14,14,1",3,2,0,[],0,0],[2,"232,14,14,1",3,2,0,[],0,0],[2,"232,14,14,1",4,2,0,[],0,0],[2,"232,14,14,1",5,2,0,[],0,0],[2,"232,14,14,1",6,2,0,[],0,0],[2,"181,0,0,1",3,2,0,[],0,0],[2,"181,0,0,1",3,2,0,[],0,0],[2,"181,0,0,1",4,2,0,[],0,0],[2,"181,0,0,1",5,2,0,[],0,0],[2,"181,0,0,1",6,2,0,[],0,0],[2,"255,255,255,1",4,0,0,[],0,0],[2,"255,255,255,1",5.5,0,0,[],0,0],[2,"255,255,255,1",7,0,0,[],0,0],[2,"255,255,255,1",8.5,0,0,[],0,0],[2,"255,255,255,1",10,0,0,[],0,0]];var T=new gS({transparentPng:true,dataType:2,cacheSize:256,clipTile:true,isFlat:true});T.zIndex=2;T.getTilesUrl=function(jq,jr){if(!jq||jr<7){return null}var jp=jq.x;var js=jq.y;var jo=jn+"TrafficTileService?level="+jr+"&x="+jp+"&y="+js+"&time="+(+new Date());if(this.map.getRenderType()==="webgl"){jo=jn+"?qt=vtraffic&z="+jr+"&x="+jp+"&y="+js+"&udt="+jj}return jo};T.setColors=function(jo){for(var jr=0;jr<jl.length;jr++){var jq=Math.floor(jr/5);var jp=jo[jq];if(jp){if(Object.prototype.toString.call(jp)==="[object String]"){jp=gW.parseCSSColor(jp)}jl[jr][1]=[jp[0],jp[1],jp[2],jp[3]/255].join(",")}}};T.setEdge=function(jo){e=!!jo};T.processData=function(jr){var jv=jr.content;var jt=10;if(typeof jr.precision==="number"){jt=jr.precision*10}var jC={road:[[],[]]};if(!jv){return jC}var jA=jv.tf;if(!jA){return jC}for(var js=0;js<jA.length;js++){var jB=jA[js][1];var jz=[];var jx=0;var jw=0;var jy=jl[jA[js][3]];for(var jq=0,jo=jB.length;jq<jo/2;jq++){jx+=jB[jq*2]/jt;jw+=jB[jq*2+1]/jt;jz.push(jx,256-jw)}var jp=jy[1].split(",");jp[3]=jp[3]*255;var ju=jy[2]/2;if(e){jC.road[0].push([jz,1,2,[255,255,255,255],ju+2])}jC.road[1].push([jz,1,2,jp,ju])}return jC};return T})();function iu(){}iu.prototype=iM;function dC(e){ec.call(this);e=e||{};this._opts={};this._opts.districts=e.name||"";this._opts.kind=e.kind||0;this._config={};this._config.strokeColor=e.strokeColor||"#00f";this._config.strokeOpacity=typeof e.strokeOpacity==="number"?e.strokeOpacity:1;bX(this._config.strokeOpacity,0,1);this._config.fillColor=e.fillColor||"#ff0";this._config.fillOpacity=typeof e.fillOpacity==="number"?e.fillOpacity:0.6;bX(this._config.fillOpacity,0,1);this._config.strokeWeight=e.strokeWeight||1;this._config.viewport=e.viewport||false;this.disOverlays=[];this.eventAndCallback={};var i=this;gs.load("layer",function(){i._asyncSearch()})}dC.inherits(cN,"DistrictLayer");ey.extend(dC.prototype,{initialize:function(e){this._map=e;this.addDistrict()},removeDistrict:function(i,e){this._map=i;this.deleteDistrict(e)},toString:function(){return"DistrictLayer"}});function aE(e,i){i=i||{};this.layerName=e||"unknown";this.reference=i.reference;this.level=i.level||-99;this.visible=(i.visible===undefined?true:!!i.visible);this.minZoom=i.minZoom||3;this.maxZoom=i.maxZoom||21;this.markerStyle=i.markerStyle||{};this.polylineStyle=i.polylineStyle||{};this.polygonStyle=i.polygonStyle||{};this.overlayData=[];this._onMap=false;this.clickDistrict=5;this.setData(i.dataSource)}aE.inherits(ey.BaseClass,"GeoJSONLayer");aE.prototype.init=function(jm){if(this.map){return}this.map=jm;var jk=this;this._onZoomEvent=function(){if(jk.map.getZoom()>=jk.minZoom&&jk.map.getZoom()<=jk.maxZoom){if(!jk._onMap){jk.addDataToMap();jk._onMap=true}}else{if(jk._onMap){jk.removeDataFromMap();jk._onMap=false}}};this.map.on("zoomend",this._onZoomEvent);var jk=this;var e=false;var jj={x:0,y:0};this._layerMouseEvent=function(jp){if(!jk.map||!jk._listeners||!jk.visible||!jk._onMap){return}if(!jk._listeners.onmousemove||Object.keys(jk._listeners.onmousemove).length===0){return}var jo=jk.pickOverlays(jp);var i;if(jo&&jo.length>0){i=new ff("onmousemove");i.features=jo;jk.map.platform.style.cursor=jk.map.config.overlayMoveCursor;e=true}else{if(!e||!jk._listeners.onmouseout||Object.keys(jk._listeners.onmouseout).length===0){return}jk.map.platform.style.cursor=jk.map.config.defaultCursor;i=new ff("onmouseout");i.features=null;e=false}if(i){i.point=jp.point;i.pixel=jp.pixel;i.latLng=jp.latlng;jk.dispatchEvent(i)}};this._layerClickEvent=function(jq){if(!jk.map||!jk._listeners||!jk.visible){return}if((!jk._listeners.onclick&&!jk._listeners.dblclick)||(Object.keys(jk._listeners.onclick).length===0&&Object.keys(jk._listeners.dblclick).length===0)){return}var jo={x:jq.clientX,y:jq.clientY};if(Math.abs(jo.x-jj.x)>jk.clickDistrict||Math.abs(jo.y-jj.y)>jk.clickDistrict){return}var jp=jk.pickOverlays(jq);var i=new ff(jq.type);i.point=jq.point;i.pixel=jq.pixel;i.latLng=jq.latlng;i.features=jp;jk.dispatchEvent(i)};this._layerMouseDownEvent=function(i){jj={x:i.clientX,y:i.clientY}};jm.addEventListener("onmousemove",this._layerMouseEvent);jm.addEventListener("onmouseout",this._layerMouseEvent);jm.addEventListener("onmousedown",this._layerMouseDownEvent);var jl=["onclick"];for(var T=0;T<jl.length;T++){var jn=jl[T];jm.addEventListener(jn,this._layerClickEvent)}this._onZoomEvent()};aE.prototype.remove=function(){if(this.map){this.removeDataFromMap();this.map.removeEventListener("onmousemove",this._layerMouseEvent);this.map.removeEventListener("onmouseout",this._layerMouseEvent);this.map.removeEventListener("onclick",this._layerClickEvent);this.map.removeEventListener("onmousedown",this._layerMouseDownEvent);this.map.removeEventListener("onzoomend",this._onZoomEvent)}this.map=null};aE.prototype.destroy=function(){if(this.map){this.clearData();this.map.removeEventListener("onmousemove",this._layerMouseEvent);this.map.removeEventListener("onmouseout",this._layerMouseEvent);this.map.removeEventListener("onclick",this._layerClickEvent);this.map.removeEventListener("onmousedown",this._layerMouseDownEvent);this.map.removeEventListener("onzoomend",this._onZoomEvent)}this.map=null};aE.prototype.setData=function(e){if(!this.gParse){this.gParse=new fZ({reference:this.reference})}if(!e){return}if(this.dataSource&&this.overlayData.length>0){this.clearData()}this.dataSource=e;this.overlayData=this.gParse.readFeaturesFromObject(e,{markerStyle:this.markerStyle,polylineStyle:this.polylineStyle,polygonStyle:this.polygonStyle},this._register.bind(this))};aE.prototype._register=function(e){e.layerName=this.layerName;e.setZIndex(this.level)};aE.prototype.resetStyle=function(){for(var e=0;e<this.overlayData.length;e++){if(this.overlayData[e] instanceof r){var i=this.markerStyle;if(this.markerStyle instanceof Function){i=this.markerStyle(this.overlayData[e].properties)||{}}}if(this.overlayData[e] instanceof bd){var i=this.polylineStyle;if(this.polylineStyle instanceof Function){i=this.polylineStyle(this.overlayData[e].properties)||{}}}if(this.overlayData[e] instanceof hW){var i=this.polygonStyle;if(this.polygonStyle instanceof Function){i=this.polygonStyle(this.overlayData[e].properties)||{}}}if(i){this.overlayData[e].setOptions(i)}}};aE.prototype.getData=function(){return this.overlayData};aE.prototype.addOverlay=function(e){var jm=e;if(!(e instanceof Array)){jm=[e]}for(var jj=0;jj<jm.length;jj++){var T=jm[jj];if(T.__proto__ instanceof aI){this._register(T);this.overlayData.push(T);this.map.addOverlay(T)}else{var jl=this.gParse.readFeaturesFromObject(T,{markerStyle:this.markerStyle,polylineStyle:this.polylineStyle,polygonStyle:this.polygonStyle},this._register.bind(this));for(var jk=0;jk<jl.length;jk++){this.overlayData.push(jl[jk]);this.map.addOverlay(jl[jk])}}}};aE.prototype.removeOverlay=function(jj){var jk=jj;if(!(jj instanceof Array)){jk=[jj]}for(var T=0;T<jk.length;T++){var i=jk[T];var e=this.findItemIndex(i);if(e>=0){this.overlayData.splice(e,1);this.map.removeOverlay(i)}}};aE.prototype.findItemIndex=function(T){var i=-1;for(var e=0;e<this.overlayData.length;e++){if(this.overlayData[e].hashCode===T.hashCode){i=e;break}}return i};aE.prototype.addDataToMap=function(){if(this.visible&&this.map&&this.map.getZoom()>=this.minZoom&&this.map.getZoom()<=this.maxZoom){for(var e=0;e<this.overlayData.length;e++){this.map.addOverlay(this.overlayData[e])}}};aE.prototype.removeDataFromMap=function(){if(this.map&&this.overlayData.length>0){for(var e=0;e<this.overlayData.length;e++){this.map.removeOverlay(this.overlayData[e])}}};aE.prototype.clearData=function(){this.dataSource=null;if(this.map&&this.overlayData.length>0){this.removeDataFromMap()}this.overlayData=[]};aE.prototype.pickOverlays=function(jn){var jm=[];if(!this.visible||!this._onMap){return null}for(var jk=0;jk<this.overlayData.length;jk++){var jl=this.overlayData[jk];var jj;if(!jl&&!jl.isVisible()){continue}if(jl.toString()==="Marker"){jj=jl._getInPnBox(jn.pixel);if(jj){jm.push(jl)}continue}if(jl.toString()!=="Polyline"){jj=jl._getInPnpoly(jn.point)}else{jj=jl._getProximity(jn.point)}var T=jj.dist;if(T>=0&&T<jl._config.mouseOverTolerance){jm.push(jl)}}return jm.length>0?jm:null};aE.prototype.setLevel=function(e){if(e>-999&&e<9999){this.level=e;for(var T=0;T<this.overlayData.length;T++){this.overlayData[T].setZIndex(this.level)}if(this.map){this.map.fire(new BMapGL.Event("onupdate","line"))}}};aE.prototype.setClickDistrict=function(e){this.clickDistrict=e||5};aE.prototype.getLevel=function(){return this.level};aE.prototype.setVisible=function(i){var e=!!i;if(this.visible!==e){this.visible=e;if(e){this.addDataToMap()}else{this.removeDataFromMap()}}};aE.prototype.getVisible=function(){return this.visible};aE.prototype.toString=function(){return"GeoJSONLayer"};function i8(i){var i=i||{};var jk=i.transform||{source:"EPSG3857",target:"BD09MC"};if(!jk.source){jk.target="EPSG3857"}if(!jk.target){jk.target="BD09MC"}const jj=i.tileUrlTemplate||"";const jn=i.xTemplate||function(jv,jx,jw){return jv};const js=i.yTemplate||(i.tms?function(jv,jx,jw){return Math.pow(2,jw)-jx-1}:function(jv,jx,jw){return jx});const jm=i.zTemplate||function(jv,jx,jw){return jw};const jr=i.bTemplate||function(jv,jy,jx){const jw=de.getTileRangeExtent([jx,jv,jy]);return jw.minX+","+jw.minY+","+jw.maxX+","+jw.maxY};var jt=i.extent||[];const jl=i.extentCRSIsWGS84||false;var T=i.minZoom||0;var jp=i.maxZoom||23;var jq=i.spanLevel||0;var jo=true;var ju=new gS({transform:jk,transparentPng:jo,dataType:i.dataType||1,spanLevel:jq,tileTypeName:"xyz",cacheSize:256,customLayer:true,clipTile:false,boundary:i.boundary||false,useThumbData:i.useThumbData||false});ju.zIndex=2;(jt.length===4)&&jl&&(jt=de.fromEPSG4326(jt));ju.getTilesUrl=function(jw,jC,jA){if(!jw||jC<0||jC<(T+jq)||jC>(jp+jq)){ju.tileCache.clear();return null}if(jk.source!=="BD09MC"){jw.x=de.getTilesLoop(jC,jw.x)}if(jt.length===4){var jB=de.getTileRangeExtent([jC,jw.x,jw.y]);var jz=e([jB.minX,jB.minY,jB.maxX,jB.maxY]);if(!jz){return null}}var jx="";if(jj){jx=jj;var jy=/[^\{}]*\{(.*)\}[^\}]*/;jx.match(jy);var jv=[];if(RegExp.$1){jv=RegExp.$1.split(",")}jx=jx.replace(/\{(.*)\}/,jv[(jw.x+jw.y)%jv.length]);jx=jx.replace(/\[x\]/gi,jn(jw.x,jw.y,jC));jx=jx.replace(/\[y\]/gi,js(jw.x,jw.y,jC));jx=jx.replace(/\[z\]/gi,jm(jw.x,jw.y,jC));jx=jx.replace(/\[b\]/gi,jr(jw.x,jw.y,jC))}else{return null}return jx};function e(jv){if(jt&&jt instanceof Array&&jt.length===4){if((jt[0]<=jv[2]&&jt[1]<=jv[3])&&(jt[2]>=jv[0]&&jt[3]>=jv[1])){return true}else{return false}}return true}return ju}function c6(i){this.src=cJ();this.tileMaskUvCache=new at(64,{clearCallback:function(jl){}});var jk=6;if(i.pixelMap){this.opacity=typeof i.pixelMap.opacity==="number"?i.pixelMap.opacity:1;bX(this.opacity,0,1);if(this.opacity<1){i.useThumbData=false}var jj=i.pixelMap||{};this.colors=jj.colors||["#F9F871","#FFC75F","#FF9671","#FF6F91","#D65DB1","#845EC2"];this.positions=jj.positions||[0,0.2,0.4,0.6,0.8,1];this.domain=jj.domain||[0,255];this.clamp=jj.clamp||this.domain;this.noData=(jj.noData!==undefined)?jj.noData:-99999;this.fomularC=jj.fomularC||"float generateValue(vec4 pixel){return pixel.r * 255.;}";this.fomularJS=jj.fomularJS||function(jl){return jl.r};this.maskPng=jj.maskPng||null;if(this.maskPng){this.loadMaskPng(this.maskPng)}this.maskData=jj.maskData||-1;this.maskCoord=jj.maskCoord||null;this.fHashcode=l({str:this.fomularC});var e=this.canPixelMap();if(e){this.isPixelMap=true;this.setPixelMap()}jk=i.pixelMap.cacheSize||jk}var T=new i8(i);T.ontology=this;this.layer=T;this.cacheSize=jk;this.tileCache=new at(this.cacheSize,{clearCallback:function(jl){}});this.tileImageDataCache=new at(this.cacheSize,{clearCallback:function(jl){}})}c6.inherits(ey.BaseClass,"PixelLayer");ey.extend(c6.prototype,{canPixelMap:function(){if(this.colors&&this.positions){return true}return false},setPixelMap:function(){if(!this.isPixelMap||!this.canPixelMap()){return}var i=this.colors;var e=this.positions;this.pHashcode=l({colors:i,positions:e});this.pixelColorMap=gW.generateColorRamp(i,e)},setDomain:function(e){if(e instanceof Array&&e.length===2){this.domain=e;this.doOnceDraw()}},setClamp:function(e){if(e instanceof Array&&e.length===2){this.clamp=e;this.doOnceDraw()}},setNoData:function(e){this.noData=e;this.doOnceDraw()},setPositions:function(e){this.positions=e;this.setPixelMap();this.doOnceDraw()},setColors:function(e){this.colors=e;this.setPixelMap();this.doOnceDraw()},setFomular:function(e,i){if(e&&i){this.fomularJS=e;this.fomularC=i;this.fHashcode=l({str:this.fomularC});this.doOnceDraw()}},setOpacity:function(e){this.opacity=e;this.doOnceDraw()},setIsPixelMap:function(e){this.isPixelMap=e;this.doOnceDraw()},setMaskPng:function(e){this.maskPng=e;this.loadMaskPng(this.maskPng);this.doOnceDraw()},setMaskData:function(e){this.maskData=e;this.doOnceDraw()},setMaskCoord:function(e){this.maskCoord=e||null;this.calMaskBox();this.doOnceDraw()},doOnceDraw:function(){if(this.layer.map){var e=new ff("onupdate");this.layer.map.dispatchEvent(e)}},_getInLayer:function(jr){if(!this.map){return null}var jq=Math.floor(this.map.getZoom());var jj=de.transformBDmcPoint(jr);var jn=de.getTileCoordForXYAndZ_(jj[0],jj[1],jq,false);var T=jn.join("-");var e=this.tileCache.getData(T);if(e){return e}var jk=this.layer.zIndex;var jm=this.map._featureMgr.result.bkData;var jo=jm[jk][2];var js=null;for(var jl=0;jl<jo.length;jl++){var jn=jo[jl];var jp=jn.tileInfo.zoom+"-"+jn.tileInfo.col+"-"+jn.tileInfo.row;if(T===jp){js=jn;break}}this.tileCache.setData(T,js);return js},_initEvent:function(jk){this.map=jk;var T=this;this._layerMouseEvent=function(jo){if(!T.map){return}var jm;var i=jo.point;var jn=T._getInLayer(i);if(jn){T.prox=jn;jm=new ff("onmousemove");T.map.platform.style.cursor=T.map.config.overlayMoveCursor}else{T.map.platform.style.cursor=T.map.config.defaultCursor;T.prox=null}if(jm){jm.point=jo.point;jm.pixel=jo.pixel;jm.latLng=jo.latlng;T.dispatchEvent(jm)}};this._layerClickEvent=function(jo){if(!T.map){return}var jm;var i=jo.point;var jn=T.getImagePixel(i);if(jn){jm=new ff(jo.type);jm.point=i;jm.pixel=jo.pixel;jm.latLng=jo.latlng;jm.color=jn;jm.value=T.getValue(jm.color);T.dispatchEvent(jm)}};jk.addEventListener("onmousemove",this._layerMouseEvent);var jj=["onclick","dblclick"];for(var e=0;e<jj.length;e++){var jl=jj[e];jk.addEventListener(jl,this._layerClickEvent)}jk.addEventListener("removetilelayer",function(i){if(i.target&&i.target.ontology){if(i.target.ontology.src===T.src){T.prox=null;T.tileCache.clear();T.tileImageDataCache.clear();T.tileMaskUvCache.clear();jk.removeEventListener("onmousemove",T._layerMouseEvent);jk.removeEventListener("onclick",T._layerClickEvent);jk.removeEventListener("ondblclick",T._layerClickEvent)}}})},getImagePixel:function(jo){if(!this.map){return null}var jj=de.transformBDmcPoint(jo);var jn=this._getInLayer(jo);if(!jn){return null}if(!this.getImageMaskPixel(jj)){return null}var jl=[jn.tileInfo.zoom,jn.tileInfo.col,jn.tileInfo.row];var jm=de.getTileRangeExtent(jl);var e=this.getImageObject(jn.textureSource,jl.join("-"));var T=Math.floor((jj[0]-jm.minX)/(jm.maxX-jm.minX)*e.width);var i=Math.floor((-jj[1]+jm.maxY)/(jm.maxY-jm.minY)*e.height);var jk=Math.floor((i*e.width+T)*4);return[e.data.data[jk],e.data.data[jk+1],e.data.data[jk+2],e.data.data[jk+3],]},getImageObject:function(jk,jj){var jl=this.tileImageDataCache.getData(jj);if(jl){return jl}var i=document.createElement("canvas");i.width=jk.width;i.height=jk.height;var T=i.getContext("2d");T.drawImage(jk,0,0,jk.width,jk.height);var e={width:jk.width,height:jk.height,data:T.getImageData(0,0,jk.width,jk.height)};this.tileImageDataCache.setData(jj,e);T=null;i=null;return e},getValue:function(i){if(this.isPixelMap&&i&&this.fomularJS){if(!(i instanceof Array)){i=this.getImagePixel(i.point)}var e=this.fomularJS({r:i[0],g:i[1],b:i[2],a:i[3]});if(e>=this.clamp[0]&&e<=this.clamp[1]){return e}}return null},setMaskImageObject:function(T){var e=document.createElement("canvas");e.width=T.width;e.height=T.height;var i=e.getContext("2d");i.drawImage(T,0,0,T.width,T.height);this.imageMaskObject={width:T.width,height:T.height,data:i.getImageData(0,0,T.width,T.height)};i=null;e=null},getImageMaskPixel:function(e){if(!this.imageMaskObject||!this.maskBox){return true}var jj=[e];var jo=this.maskBox;var jl=jo[1][0]-jo[0][0];var jk=jo[1][1]-jo[0][1];var T=Math.floor((jj[0][0]-jo[0][0])/jl*this.imageMaskObject.width);var i=Math.floor((-jj[0][1]+jo[1][1])/jk*this.imageMaskObject.height);var jn=Math.floor((i*this.imageMaskObject.width+T)*4);if(T>this.imageMaskObject.width||T<0){return null}if(i>this.imageMaskObject.height||i<0){return null}var jm=this.imageMaskObject.data.data;if(jn+3>jm.length){return false}if(jm[jn+3]>0){if(this.maskData>-1&&this.maskData!==jm[jn]){return false}return true}return false},calMaskBox:function(){var T=this.maskCoord||[];if(this.hasMaskPng&&T&&T.length===2){var e=[];for(var jj=0;jj<T.length;jj++){e[jj]=de.transformBDmcPoint(il.convertLL2MC(T[jj]))}this.maskBox=e;this.tileMaskUvCache.clear()}else{this.maskBox=null}},buildFillMaskVertex:function(jp,jn,jm){var jo=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];if(!this.maskBox){return jo}var jr=[jp,jn,jm].join("-");var e=this.tileMaskUvCache.getData(jr);if(e){return e}if(this.hasMaskPng){var ju=this.maskBox||[];var jl=[jm,jp,jn];var jq=de.getTileRangeExtent(jl);var jk=ju[1][0]-ju[0][0];var T=ju[1][1]-ju[0][1];var jt=(jq.minX-ju[0][0])/jk;var js=(jq.minY-ju[0][1])/T;var jj=(jq.maxX-ju[0][0])/jk;var i=(jq.maxY-ju[0][1])/T;jo=[jt,js,jj,js,jj,i,jt,js,jj,i,jt,i]}this.tileMaskUvCache.setData(jr,jo);return jo},loadMaskPng:function(T){var e=this;function i(jk,jj){if(jj){e.hasMaskPng=true;e.setMaskImageObject(jk);e.calMaskBox();e.doOnceDraw()}else{e.hasMaskPng=false}e.maskTextureSource=jj?jk:null}this.imageLoad(T,i)},imageLoad:function(i,jk){if(!i){jk&&jk(null,false)}var e=new Image();e.crossOrigin="anonymous";e.onload=function jj(){jk&&jk(this,true)};e.onerror=function T(){jk&&jk(null,false)};e.src=i},toString:function(){return"PixelLayer"}});var O=function(e){var e=e||{};this.inputCRS=e.inputCRS||"EPSG3857";this.outCRS=e.outCRS||"EPSG3857";this.minZoom=e.minZoom||3;this.maxZoom=e.maxZoom||19;this.retry=e.retry||false;this.retryTime=e.retryTime||600;this.useThumbData=e.useThumbData||true;this.lastZoom=3;this.cacheSize=e.cacheSize||128;this.tileType=hl.getInstance("web");this._mapCenter={};this._featureMgr=[[],[],[]];this._gridRefs={row:{},col:{}};this.tileCache=new at(this.cacheSize,{clearCallback:function(i){}})};O.inherits(cN,"BaiduLayer");ey.extend(O.prototype,{fetch:function(i,jj,jk){var jj=Math.ceil(jj)||3;var i=i||[];if(i.length!==4||jj>19){jk(null);return}var e=this.getZoomState(jj);var T=this.calCoord(i,jj,e);this.curViewTilesInfo=this.calTilesOrders(T.sw,T.ne,jj);this.clearData();this.clearRefs();this.loadLayerData(this.curViewTilesInfo,e,true,jk)},calCoord:function(T,jj,i){if(T.length!==4){return}var e=gcoord.transform([T[0],T[1]],gcoord[this.inputCRS],gcoord.BD09MC);var jk=gcoord.transform([T[2],T[3]],gcoord[this.inputCRS],gcoord.BD09MC);if(jk[1]>19505879.362428114||e[1]<-15949096.637571886){jk[1]=19505879.362428114;e[1]=-15949096.637571886}this._mapCenter[jj]=new cg((e[0]+jk[0])/2,(e[1]+jk[1])/2);return{sw:e,ne:jk}},calTilesOrders:function(jo,ju,jq){var jr=this.tileType.getMercatorSize(jq,jq);var jm=[Math.floor(jo[0]/jr),Math.floor(jo[1]/jr)];var i=[Math.floor(ju[0]/jr),Math.floor(ju[1]/jr)];var jn=jm[0]-1;var jl=i[0]+2;var jk=jm[1]-1;var jt=i[1]+2;var jp=[];for(var jj=jn;jj<jl;jj++){for(var js=jk;js<jt;js++){var T={col:jj,row:js,zoom:jq,useZoom:jq,tileTypeName:"web",loopOffsetX:0,tileSize:256,baseTileSize:256,mercatorSize:jr,combine:false,dataIndex:256};jp.push(T);var e="id_"+jj+"_"+js+"_"+jq;jp[e]=true}}jp.sort((function(jv){return function(jw,jx){return((0.4*Math.abs(jw.col-jv[0])+0.6*Math.abs(jw.row-jv[1]))-(0.4*Math.abs(jx.col-jv[0])+0.6*Math.abs(jx.row-jv[1])))}})([(jn+jl)/2,(jk+jt)/2]));jp.zoom=jq;jp.tileTypeName="web";return jp},getZoomState:function(i){var e=i-this.lastZoom;if(e>0){this.zoomState=1}else{if(e<0){this.zoomState=-1}}this.lastZoom=i;return this.zoomState||0},loadLayerData:function(jq,jj,jk,jp){this.thumbCache={};if(jk){for(var jn=0,jl=jq.length;jn<jl;jn++){var T=jq[jn];var jm=this.getTileKey(T);var e=this.tileCache.getData(jm);if(e&&e.status==="ready"){e.key=jm;this.setData(e,2)}else{if(this.useThumbData){jj===1&&this.setThumbData(T.col,T.row,T.zoom,T.useZoom,jj)}}}this.calOutData(jp)}for(var jn=0,jl=jq.length;jn<jl;jn++){var T=jq[jn];var jm=this.getTileKey(T);var e=this.tileCache.getData(jm);if(!e){this.tileCache.setData(jm,{});var jo=this;this.loadRasterTileData(T,function(i,jr){jo.rasterTileDataCbk(i,jr,jp)})}}},loadRasterTileData:function(i,e){var T=new Image();var jk=i.col;var jn=i.row;var jl=i.zoom;var jj=this.getTilesUrl(new eS(jk,jn),jl);if(!jj){return}var jm=this.getTileKey(i);T=this.loadTileImage(jj,i,jm,e);T.tileInfo=i},loadTileImage:function(jn,e,T,jl){var jj=new Image();jj.crossOrigin="anonymous";var jm=this;var jk;function jo(){if(jm.retry){jk&&clearInterval(jk);jk=null}}if(this.retry){var i=1;jk=setInterval(function(){if(i>3){jo();return}var jp=jm.getTilesUrl(new eS(e.col,e.row),e.zoom,i);jj.src=jp;i++},this.retryTime)}jj.onload=function(){jo();jl&&jl(this,T)};jj.onerror=function(){jo();jl&&jl(null,T)};jj.src=jn;return jj},rasterTileDataCbk:function(jk,jj,jn){if(!jk||typeof jk==="string"){this.tileCache.removeData(jj);return}var i=jk.tileInfo;var T=i.col;var jp=i.row;var jo=i.zoom;var e=this.tileCache.getData(jj);if(!e){return}e.textureSource=jk;e.dataType=f8;e.tileInfo=i;e.status="ready";this.tileCache.setData(jj,e);var jl="id_"+T+"_"+jp+"_"+jo;var jm=false;if(this.curViewTilesInfo[jl]){e.png8=this.png8||false;e.key=jj;this.setData(e,2);jm=true}if(jm){this.calOutData(jn,e)}},getTilesUrl:function(jk,jr,i){var jm=i||0;var T=jk.x;var js=jk.y;var jo=iY("ditu","normal");var jn=jo.udt;var jq=dU.B_NORMAL_MAP.tileUrls;var jl=Math.abs(T+js+jm)%jq.length;var jp=jq[jl];if(T<0){T="M"+(-T)}if(js<0){js="M"+(-js)}var jj="x="+T+"&y="+js+"&z="+Math.floor(jr);jj+="&styles=pl&scaler=2&udt="+jn+"&from=jsapi3_0";var e=jp+"?qt=vtile&"+jj;return e},calOutData:function(jp,T){if(!T){for(var jm=0;jm<this._featureMgr.length;jm++){var e=this._featureMgr[jm];for(var jk=0;jk<e.length;jk++){var jj=e[jk].tileInfo;if(jm===2){var jn=e[jk].extent;if(jn){this.addRefs(jn,jj.col,jj.row)}else{var jo=this.calBoxCoord(jj);if(!jo){continue}e[jk].extent=this.findRefs(jo,jj.col,jj.row)}}}}jp({size:this.curViewTilesInfo.length,zoom:this.lastZoom,data:this._featureMgr})}else{var jl=this.calBoxCoord(T.tileInfo);if(!jl){return}T.extent=this.findRefs(jl,T.tileInfo.col,T.tileInfo.row);jp({zoom:this.lastZoom,size:this.curViewTilesInfo.length,data:[[],[],[T]]})}},calOutData_back:function(jr,jj){if(!jj){var jl;var js;var jp;for(var jn=0;jn<this._featureMgr.length;jn++){var T=this._featureMgr[jn];for(var jm=0;jm<T.length;jm++){var jk=T[jm].tileInfo;if(jn===2){if(jm===0){var jo=this.calBoxCoord(jk);T[0].extent=jo;jl=T[0];js=jo[2]-jo[0];jp=jo[3]-jo[1]}else{if(jl&&js&&jp){var e=(jk.row-jl.tileInfo.row)*jp;var jq=(jk.col-jl.tileInfo.col)*js;var jo=jl.extent;T[jm].extent=[jo[0]+jq,jo[1]+e,jo[2]+jq,jo[3]+e]}}}else{var jo=this.calBoxCoord(jk);T[jm].extent=jo}}}jr({size:this.curViewTilesInfo.length,zoom:this.lastZoom,data:this._featureMgr})}else{if(this._featureMgr[2].length===1){var jo=this.calBoxCoord(jj.tileInfo);jj.extent=jo;this.featureCell=jj;this.cellW=jo[2]-jo[0];this.cellH=jo[3]-jo[1]}else{var e=(jj.tileInfo.row-this.featureCell.tileInfo.row)*this.cellH;var jq=(jj.tileInfo.col-this.featureCell.tileInfo.col)*this.cellW;var jo=this.featureCell.extent;jj.extent=[jo[0]+jq,jo[1]+e,jo[2]+jq,jo[3]+e]}jr({zoom:this.lastZoom,size:this.curViewTilesInfo.length,data:[[],[],[jj]]})}},calBoxCoord:function(e){var i=il.prototype.tileToBound(e,this._mapCenter[e.zoom]).LL;var T=gcoord.transform([i.sw.lng,i.sw.lat],gcoord.BD09LL,gcoord[this.outCRS]);var jj=gcoord.transform([i.ne.lng,i.ne.lat],gcoord.BD09LL,gcoord[this.outCRS]);return[T[0],T[1],jj[0],jj[1]]},clearData:function(){this._featureMgr=[[],[],[]]},addRefs:function(i,e,T){this._gridRefs.row[T]=i[1];this._gridRefs.row[T+1]=i[3];this._gridRefs.col[e]=i[0];this._gridRefs.col[e+1]=i[2]},findRefs:function(i,e,jj){var T=[];this._gridRefs.row[jj]&&(T[1]=this._gridRefs.row[jj]);this._gridRefs.row[jj+1]&&(T[3]=this._gridRefs.row[jj+1]);this._gridRefs.col[e]&&(T[0]=this._gridRefs.col[e]);this._gridRefs.col[e+1]&&(T[2]=this._gridRefs.col[e+1]);!this._gridRefs.row[jj]&&(this._gridRefs.row[jj]=i[1])&&(T[1]=i[1]);!this._gridRefs.row[jj+1]&&(this._gridRefs.row[jj+1]=i[3])&&(T[3]=i[3]);!this._gridRefs.col[e]&&(this._gridRefs.col[e]=i[0])&&(T[0]=i[0]);!this._gridRefs.col[e+1]&&(this._gridRefs.col[e+1]=i[2])&&(T[2]=i[2]);return T},clearRefs:function(){this._gridRefs={row:{},col:{}}},destroy:function(){this.tileCache.clear();this.clearData();this.clearRefs();this._mapCenter={}},setData:function(jk,T){var e=this._featureMgr[T];for(var jj=0;jj<e.length;jj++){if(e[jj].key&&e[jj].key===jk.key){e[jj]=jk;return}}e.push(jk)},getTileKey:function(e,jj){jj=jj||{};var i=typeof jj.useZoom==="number"?jj.useZoom:e.useZoom;var T="default";return"web_"+T+"_"+e.col+"_"+e.row+"_"+e.zoom+"_"+i},setThumbData:function(i,jk,jj,e,T){if(T===1){if(this._findParentZoomTile(i,jk,jj,e,8)===false){this._findChildZoomTile(i,jk,jj,e,3)}}else{if(T===-1){if(this._findChildZoomTile(i,jk,jj,e,3)===false){this._findParentZoomTile(i,jk,jj,e,8)}}}this.sortThumbData()},_findParentZoomTile:function(jm,jv,ju,jk,jp){var jl="web";var T=3;var e=jm;var js=jv;var jq=ju;var jr=jk;for(var jo=1;jo<=jp;jo++){var jj=this.tileType.getParentTile(e,js,jq,jr,T);if(jj===null){continue}var jt=this.getTileKey(jj);var jn=this.tileCache.getData(jt);if(jn&&jn.status==="ready"){if(this.thumbCache[jt]){continue}jn.key=jt;this.setData(jn,0);this.thumbCache[jt]=true;return true}e=jj.col;js=jj.row;jq=jj.zoom;jr=jj.useZoom}return false},_findChildZoomTile:function(jn,jp,e,jk,jy){var jw="web";var js=21;var jm=jn;var jo=jp;var jq=e;var jj=jk;var jl=true;for(var jv=1;jv<=jy;jv++){var jt=false;var T=this.tileType.getChildTiles(jm,jo,jq,jj,js,jv);if(!T){continue}for(var ju=0;ju<T.length;ju++){var jr=this.getTileKey(T[ju]);var jx=this.tileCache.getData(jr);if(jx&&jx.status==="ready"){if(!this.thumbCache[jr]){jx.key=jr;this.setData(jx,1);this.thumbCache[jr]=true}jt=true}else{jl=false}}if(jt){break}}return jl},sortThumbData:function(){var e=this._featureMgr;if(!e){return}if(e[0]&&e[0].length>0){e[0].sort(function(T,i){return T.tileInfo.useZoom-i.tileInfo.useZoom})}}});bp.register(function(i){if(i.config&&i.config.isOverviewMap){return}if(i.isLoaded()){E(i)}else{i.addEventListener("load",function(){E(this)})}i.cityName="中国";i.cCode="1";var e={};e.enableRequest=true;e.request=function(){if(e.enableRequest){e.enableRequest=false;setTimeout(function(){e._request()},500)}};e._request=function(){var jj=i.getBoundsIn();var jl=i.getZoom();var T=jj.getSouthWest();var jk=jj.getNorthEast();i4.request(function(jp){if(jp.current_city["code"]>=9000&&jp.current_city["code"]<=9378){jp.current_city["name"]="台湾省"}if(jp.current_city["code"]>=20000&&jp.current_city["code"]<=20499){jp.current_city["name"]="新加坡"}if(jp.current_city["code"]>=20500&&jp.current_city["code"]<=25999){jp.current_city["name"]="泰国"}if(jp.current_city["code"]>=26000&&jp.current_city["code"]<=29999){jp.current_city["name"]="日本"}if(jp.current_city["code"]>=30000&&jp.current_city["code"]<=30999){jp.current_city["name"]="韩国"}if(jp.current_city["code"]>=31000&&jp.current_city["code"]<=37000){jp.current_city["name"]="亚太"}if(jp.current_city["code"]>=46609&&jp.current_city["code"]<=52505){jp.current_city["name"]="欧洲"}if(jp.current_city["code"]>=39509&&jp.current_city["code"]<=53500){jp.current_city["name"]="南美洲"}if(jp.current_city["code"]>=54000&&jp.current_city["code"]<=70000){jp.current_city["name"]="北美洲"}if(jp.current_city["code"]===54003&&jp.current_city["code"]>=60731&&jp.current_city["code"]<=61123){jp.current_city["name"]="美国"}if(jp.current_city["code"]===54015||jp.current_city["code"]>=57970&&jp.current_city["code"]<=60223){jp.current_city["name"]="加拿大"}if(jp.current_city["code"]===54025||jp.current_city["code"]>=54338&&jp.current_city["code"]<=57374){jp.current_city["name"]="墨西哥"}e.enableRequest=true;if(jp&&jp.current_city){var jo=jp.current_city["name"];var jn=jp.current_city["code"];if(jn!==i.cCode){var jm=new ff("oncitychange");jm.name=jo;jm.code=jn;i.dispatchEvent(jm)}i.cityName=jo;i.cCode=jn;if(!bK()){cH(i)}}},{qt:"cen",b:T.lng+","+T.lat+";"+jk.lng+","+jk.lat,l:jl},"","",true)};i.addEventListener("load",function(T){e.request()});i.addEventListener("moveend",function(T){e.request()});i.addEventListener("zoomend",function(T){e.request()});e.request()});function E(i){if(i.temp.copyadded){return}i.temp.copyadded=true;if(!i.cpyCtrl){var jj=new id(2,2);i.config.cpyCtrlOffset=jj;if(bK()){jj.width=72;jj.height=0}var T=new fA({offset:jj,printable:true});i.cpyCtrl=T}if(!bK()){cH(i);i.addEventListener("maptypechange",function(){cH(i)})}i.addControl(T);var e=new bs();e._opts={printable:true};i.logoCtrl=e;i.addControl(e);i.addEventListener("resize",function(){if(this.getSize().width>=300&&i.getSize().height>=100){e.show();T.setOffset(i.config.cpyCtrlOffset)}else{e.hide();T.setOffset(new id(4,2))}});if(i.getSize().width>=300&&i.getSize().height>=100){e.show()}else{e.hide();T.setOffset(new id(4,2))}i.addEventListener("oncopyrightoffsetchange",function(jk){i.logoCtrl.setOffset(jk.target.logo);i.cpyCtrl.setOffset(jk.target.cpy)});i.dispatchEvent(new ff("oncopyrightaddend"))}function cH(jy){if(!jy.cpyCtrl){var jG=new id(2,2);if(bK()){jG.width=72;jG.height=0}var jB=new fA({offset:jG,printable:true});jy.cpyCtrl=jB}var jP=jy.cityName||"中国";var jz=jy.getMapType();var jA=["常州市","南昌市","乌鲁木齐市","无锡市","福州市","泉州市","珠海市","贵阳市"];var js=["北京市","上海市","广州市","深圳市","宁波市","石家庄市","沈阳市","长春市","青岛市","温州市","台州市","金华市","佛山市","中山市","昆明市","南宁市","苏州市","西安市","济南市","郑州市","合肥市","呼和浩特市","杭州市","成都市","武汉市","长沙市","天津市","南京市","重庆市","大连市","东莞市","厦门市"];var ju=["香港特别行政区"];var jo=["台湾省"];var jH=["日本"];var jN=["韩国"];var jC=["泰国"];var jF=["亚太"];var jp=["新加坡"];var jO=["欧洲"];var jj=["南美洲"];var jK=["北美洲"];var T=["美国"];var jE=["墨西哥"];var jm=["加拿大"];for(var jL in jA){if(jA[jL]===jP){var jv=true;break}}for(var jL in js){if(js[jL]===jP){var jk=true;break}}for(var jL in ju){if(ju[jL]===jP){var jR=true;break}}if(jo[0]===jP){var jJ=true}if(jp[0]===jP){var i=true}if(jH[0]===jP){var jr=true}if(jN[0]===jP){var jx=true}if(jC[0]===jP){var jw=true}if(jF[0]===jP){var jn=true}if(jO[0]===jP){var jt=true}if(jj[0]===jP){var jq=true}if(jK[0]===jP){var e=true}if(T[0]===jP){var jM=true}if(jm[0]===jP){var jI=true}if(jE[0]===jP){var jl=true}var jQ=["&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "];var jD="rgba(255, 255, 255, 0.701961)";if(jy.getZoom()<=9){jQ=["&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "]}else{if(jJ){jQ=["&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "]}else{if(jr||jx){jQ=["&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "]}else{if(i||jw){jQ=["&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "]}else{if(jn){jQ=["&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "]}else{if(jt){jQ=["&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "]}else{if(jq){jQ=["&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "]}else{if(e){jQ=["&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "]}}}}}}}}if(jy.getZoom()<=9){jQ.push("百度智图");jQ.push(' &amp; <a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>');jQ.push(' &amp; <a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>');if(jz===BMAP_SATELLITE_MAP||jz===BMAP_HYBRID_MAP){jQ.push(' &amp; <a target="_blank" href="http://www.eso.org/public/">ESO</a>');jD="rgba(0,0,0,.7)"}}else{if(jr||jx){jQ.push('<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>')}else{if(i||jw){jQ.push('<a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>')}else{if(jn){jQ.push('<a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>');jQ.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{if(jt){jQ.push('<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>');jQ.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{if(jq){jQ.push('<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>');jQ.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{if(jM||jl||jI){jQ.push('<a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>');jQ.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{if(e){jQ.push('<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>');jQ.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{jQ.push("百度智图");if(jv){jQ.push(' &amp; <a target="_blank" href="http://www.palmcity.cn/palmcity/">PalmCity</a>')}if(jR){jQ.push(' &amp; <a target="_blank" href="http://www.mapking.com/HongKong/eng/home/MapKing_Webmap.html">MapKing</a>')}if(jJ){jQ.push(' &amp; <a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>');jQ.push(' &amp; <a target="_blank" href="http://www.localking.com.tw/about/localking.aspx">樂客LocalKing</a>')}if(jz===BMAP_SATELLITE_MAP||jz===BMAP_HYBRID_MAP){jD="rgba(0,0,0,.7)"}}}}}}}}}jQ.unshift('<span style="background: '+jD+';padding: 0px 1px;line-height: 16px;display: inline;height: 16px;">');jQ.push("</span>");jQ=jQ.join("");jy.cpyCtrl.addCopyright({id:1,content:jQ})}window.BMAP_STATUS_SUCCESS=0;window.BMAP_STATUS_CITY_LIST=1;window.BMAP_STATUS_UNKNOWN_LOCATION=2;window.BMAP_STATUS_UNKNOWN_ROUTE=3;window.BMAP_STATUS_INVALID_KEY=4;window.BMAP_STATUS_INVALID_REQUEST=5;window.BMAP_STATUS_PERMISSION_DENIED=6;window.BMAP_STATUS_SERVICE_UNAVAILABLE=7;window.BMAP_STATUS_TIMEOUT=8;window.BMAP_ROUTE_TYPE_WALKING=2;window.BMAP_ROUTE_TYPE_DRIVING=3;window.BMAP_ROUTE_TYPE_RIDING=6;window.BMAP_ROUTE_STATUS_NORMAL=0;window.BMAP_ROUTE_STATUS_EMPTY=1;window.BMAP_ROUTE_STATUS_ADDRESS=2;var cU="cur";var U="cen";var D="s";var db="con";var c3="bd";var cx="nb";var gp="bt";var aF="nav";var ht="walk";var fn="gc";var dz="rgc";var F="dec";var hG="iploc";var gb="bse";var fJ="nse";var cR="bl";var dY="bsl";var fk="bda";var dV="sa";var a0="nba";var hy="drag";var ie="ext";var iN="exts";var iQ="hip";var gU="ride";var i2="drct";var eY=2;var a6=4;var fu=7;var hz=11;var bU=12;var et=14;var cu=15;var dM=18;var au=20;var aZ=21;var C=19;var a=23;var hS=26;var av=28;var fK=31;var eG=35;var hH=44;var a4=45;var aq=46;var iL=47;var fO=-1;var a2=0;var bo=1;var ij=2;var dq=3;window.BMAP_POI_TYPE_NORMAL=0;var cj=1;var hB=2;BMapGL.I=ey.I;var by={};by.removeHtml=function(e){e=e.replace(/<\/?[^>]*>/g,"");e=e.replace(/[ | ]* /g," ");return e};by.parseGeoExtReg1=function(e){return e.replace(/([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0|[1-9]\d*),([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0|[1-9]\d*)(,)/g,"$1,$2;")};by.parseGeoExtReg2=function(i,e){var T=new RegExp("(((-?\\d+)(\\.\\d+)?),((-?\\d+)(\\.\\d+)?);)(((-?\\d+)(\\.\\d+)?),((-?\\d+)(\\.\\d+)?);){"+e+"}","ig");return i.replace(T,"$1")};var dh=0;var cT=1;var N=2;by.unique=function(T){var jl=false;var jk=[];var jm={};for(var jj=0,e=T.length;jj<e;jj++){if(!jm[T[jj]]){jm[T[jj]]=true;jk.push(T[jj])}}return jk};by.getBestLevel=function(T,i){if(i){var e=Math.min(i.width/1100,i.height/660);T=Math.round(T+(Math.log(e)/Math.log(2)))}if(T<1){T=1}if(T>21){T=21}return T};by.parseGeo=function(jm,jp){if(typeof jm!="string"||!jm){return}var jr=jm.split("|");var e;var jk;var T;if(jr.length==1){e=bO(jm)}else{e=bO(jr[2]);jk=bO(jr[0]);T=bO(jr[1]);if(!jp){return e}}var jn={type:e.geoType};if(jp){switch(jn.type){case N:var jo=new cg(e.geo[0][0],e.geo[0][1]);var jq=il.convertMC2LL(jo);jn.point=jq;jn.points=[jq];break;case cT:jn.points=[];var js=e.geo[0];for(var jl=0,jj=js.length-1;jl<jj;jl+=2){var jt=new cg(js[jl],js[jl+1]);jt=il.convertMC2LL(jt);jn.points.push(jt)}jk=new cg(jk.geo[0][0],jk.geo[0][1]);T=new cg(T.geo[0][0],T.geo[0][1]);jk=il.convertMC2LL(jk);T=il.convertMC2LL(T);jn.bounds=new hk(jk,T);break;default:break}}return jn};by.parseGeoExt=function(jC,jt){if(!jt){jt=0}else{if(jt<0.25){jt=0}else{if(jt>0.25&&jt<1){jt=1}else{if(jt>32){jt=32}}}}var jo=jC.split("|");if(jo.length==1){var jj=bO(jo[0]);return{type:jj.type,bound:"",points:jj.geo.join(",")}}else{if(jo.length>1){var ju=jC.split(";.=");var jq=[];var jk=[];var jv=0;var jz=ju.length;for(var jw=0;jw<jz;jw++){var jB=ju[jw];if(jz>1){if(jw==0){jB=jB+";"}if(jw>0&&jw<jz-1){jB=".="+jB+";"}if(jw==jz-1){jB=".="+jB}}var jl=jB.split("|");var jy=bO(jl[0]);var jx=bO(jl[1]);jq.push(jy.geo.join(","));jq.push(jx.geo.join(","));var jj=bO(jl[2]);jv=jj.type;var jA=jj.geo.join(",");jA=by.parseGeoExtReg1(jA);if(jt>0){jA=by.parseGeoExtReg2(jA,jt)}jk.push(jA)}if(jz<=1){jk=jk.join(";")}if(jz==2){var T=jk[0]+";"+jk[1];var jm=T.split(";");var e=[];for(var jw=0;jw<jm.length;jw++){var jp=jm[jw].split(",")[0];var jn=jm[jw].split(",")[1];var jr=new cg(jp,jn);var js=il.convertMC2LL(jr);e.push(js)}jk=e}return{type:jv,bound:jq.join(";"),points:jk}}}};by.getPoiPoint=function(e){var T=[];var i=null;if(e.toString()=="Point"){i=e}else{if(typeof e=="string"){T=ey.trim(e).split(",");if(T.length<2){return}T[0]=parseFloat(ey.trim(T[0]));T[1]=parseFloat(ey.trim(T[1]))}else{T=e.slice(0);if(T.length<2){return}}i=new BMap.Point(T[0],T[1])}return i};by.parseGeoStr=function(T){var i=T.split(",");var e=new cg(i[0],i[1]);return il.convertMC2LL(e)};by.level={country:4,province:11,city:12,area:13};var gA=["=",".","-","*"];var cO=1<<23;function bO(jp){var jo=hg(jp.charAt(0));var T=jp.substr(1);var jr=0;var e=T.length;var js=[];var jm=[];var jn=[];while(jr<e){if(T.charAt(jr)==gA[0]){if((e-jr)<13){return 0}jn=dL(T.substr(jr,13),js);if(jn<0){return 0}jr+=13}else{if(T.charAt(jr)==";"){jm.push(js.slice(0));js.length=0;++jr}else{if((e-jr)<8){return 0}jn=b0(T.substr(jr,8),js);if(jn<0){return 0}jr+=8}}}for(var jl=0,jj=jm.length;jl<jj;jl++){for(var jk=0,jq=jm[jl].length;jk<jq;jk++){jm[jl][jk]/=100}}return{geoType:jo,geo:jm}}function hg(i){var e=-1;if(i==gA[1]){e=N}else{if(i==gA[2]){e=cT}else{if(i==gA[3]){e=dh}}}return e}function dL(jk,T){var e=0;var jm=0;var jl=0;for(var jj=0;jj<6;jj++){jl=da(jk.substr(1+jj,1));if(jl<0){return -1-jj}e+=jl<<(6*jj);jl=da(jk.substr(7+jj,1));if(jl<0){return -7-jj}jm+=jl<<(6*jj)}T.push(e);T.push(jm);return 0}function b0(jl,jj){var T=jj.length;if(T<2){return -1}var e=0;var jn=0;var jm=0;for(var jk=0;jk<4;jk++){jm=da(jl.substr(jk,1));if(jm<0){return -1-jk}e+=jm<<(6*jk);jm=da(jl.substr(4+jk,1));if(jm<0){return -5-jk}jn+=jm<<(6*jk)}if(e>cO){e=cO-e}if(jn>cO){jn=cO-jn}jj.push(jj[T-2]+e);jj.push(jj[T-1]+jn);return 0}function da(i){var e=i.charCodeAt(0);if(i>="A"&&i<="Z"){return e-"A".charCodeAt(0)}else{if(i>="a"&&i<="z"){return(26+e-"a".charCodeAt(0))}else{if(i>="0"&&i<="9"){return(52+e-"0".charCodeAt(0))}else{if(i=="+"){return 62}else{if(i=="/"){return 63}}}}}return -1}by.pathToPoints=function(jl){var jj=[];if(typeof jl!=="string"){return jj}else{var jk=jl.split(";");for(var T=0;T<jk.length;T++){var e=jk[T].split(",");jj.push(new cg(e[0],e[1]))}}return jj};window.BMAP_POI_TYPE_NORMAL=0;window.BMAP_POI_TYPE_BUSSTOP=1;window.BMAP_POI_TYPE_BUSLINE=2;window.BMAP_POI_TYPE_SUBSTOP=3;window.BMAP_POI_TYPE_SUBLINE=4;var L=0;var gZ=1;var fb={};window.APIPack=fb;function az(i,e){cN.call(this);this._loc={};this.setLocation(i);e=e||{};e.renderOptions=e.renderOptions||{};this._opts={renderOptions:{panel:e.renderOptions.panel||null,map:e.renderOptions.map||null,autoViewport:e.renderOptions.autoViewport||true,selectFirstResult:e.renderOptions.selectFirstResult,highlightMode:e.renderOptions.highlightMode,enableDragging:e.renderOptions.enableDragging||false},onSearchComplete:e.onSearchComplete||function(){},onMarkersSet:e.onMarkersSet||function(){},onInfoHtmlSet:e.onInfoHtmlSet||function(){},onResultsHtmlSet:e.onResultsHtmlSet||function(){},onGetBusListComplete:e.onGetBusListComplete||function(){},onGetBusLineComplete:e.onGetBusLineComplete||function(){},onBusListHtmlSet:e.onBusListHtmlSet||function(){},onBusLineHtmlSet:e.onBusLineHtmlSet||function(){},onPolylinesSet:e.onPolylinesSet||function(){},reqFrom:e.reqFrom||""};if(typeof e!="undefined"&&typeof e.renderOptions!="undefined"&&typeof e.renderOptions["autoViewport"]!="undefined"){this._opts.renderOptions.autoViewport=e.renderOptions["autoViewport"]}else{this._opts.renderOptions.autoViewport=true}this._opts.renderOptions.panel=ey.G(this._opts.renderOptions.panel)}az.inherits(cN,"BaseSearch");ey.extend(az.prototype,{getResults:function(){if(!this._isMultiKey){return this._results}else{return this._arrResults}},enableAutoViewport:function(){this._opts.renderOptions.autoViewport=true},disableAutoViewport:function(){this._opts.renderOptions.autoViewport=false},setLocation:function(e){if(!e){return}this._loc.src=e},setSearchCompleteCallback:function(e){this._opts.onSearchComplete=e||function(){}},setMarkersSetCallback:function(e){this._opts.onMarkersSet=e||function(){}},setPolylinesSetCallback:function(e){this._opts.onPolylinesSet=e||function(){}},setInfoHtmlSetCallback:function(e){this._opts.onInfoHtmlSet=e||function(){}},setResultsHtmlSetCallback:function(e){this._opts.onResultsHtmlSet=e||function(){}},getStatus:function(){return this._status}});var ci=function(T,i){az.call(this,T,i);i=i||{};i.renderOptions=i.renderOptions||{};this.setPageCapacity(i.pageCapacity);if(typeof i.renderOptions["selectFirstResult"]!="undefined"&&!i.renderOptions["selectFirstResult"]){this.disableFirstResultSelection()}else{this.enableFirstResultSelection()}this._overlays=[];this._arrPois=[];this._curIndex=-1;this._queryList=[];var e=this;gs.load("localSearch",function(){e._check()},true)};ci.inherits(az,"LocalSearch");ci.DEFAULT_PAGE_CAPACITY=10;ci.MIN_PAGE_CAPACITY=1;ci.MAX_PAGE_CAPACITY=100;ci.DEFAULT_RADIUS=2000;ci.MAX_RADIUS=100000;ey.extend(ci.prototype,{search:function(e,i){this._queryList.push({method:"search",arguments:[e,i]})},searchInBounds:function(e,T,i){this._queryList.push({method:"searchInBounds",arguments:[e,T,i]})},searchNearby:function(T,i,e,jj){this._queryList.push({method:"searchNearby",arguments:[T,i,e,jj]})},clearResults:function(){delete this._json;delete this._status;delete this._results;delete this._ud;this._curIndex=-1;this._setStatus();if(this._opts.renderOptions.panel){this._opts.renderOptions.panel.innerHTML=""}},gotoPage:function(){},enableFirstResultSelection:function(){this._opts.renderOptions.selectFirstResult=true},disableFirstResultSelection:function(){this._opts.renderOptions.selectFirstResult=false},setPageCapacity:function(e){if(typeof e=="number"&&!isNaN(e)){this._opts.pageCapacity=e<1?ci.DEFAULT_PAGE_CAPACITY:(e>ci.MAX_PAGE_CAPACITY?ci.DEFAULT_PAGE_CAPACITY:e)}else{this._opts.pageCapacity=ci.DEFAULT_PAGE_CAPACITY}},getPageCapacity:function(){return this._opts.pageCapacity},toString:function(){return"LocalSearch"}});function a7(i){this._opts={};ey.extend(this._opts,i);this._queryList=[];var e=this;gs.load("otherSearch",function(){e._asyncSearch()})}a7.inherits(cN,"Geocoder");ey.extend(a7.prototype,{getPoint:function(e,T,i){this._queryList.push({method:"getPoint",arguments:[e,T,i]})},getLocation:function(e,T,i){this._queryList.push({method:"getLocation",arguments:[e,T,i]})},toString:function(){return"Geocoder"}});function cC(e){e=e||{};this.config={timeout:e.timeout||1000*10,maximumAge:e.maximumAge||0,enableHighAccuracy:e.enableHighAccuracy||true,SDKLocation:e.SDKLocation||false};this._pendingCalls=[];var i=this;gs.load("otherSearch",function(){var T=i._pendingCalls.length;for(var jj=0;jj<T;jj++){var jk=i._pendingCalls[jj];i[jk.method].apply(i,jk.arguments)}})}ey.extend(cC.prototype,{getCurrentPosition:function(e,i){this._pendingCalls.push({method:"getCurrentPosition",arguments:arguments})},getStatus:function(){return BMAP_STATUS_UNKNOWN_LOCATION},enableSDKLocation:function(){if(bK()){this.config.SDKLocation=true}},disableSDKLocation:function(){this.config.SDKLocation=false}});function eU(){this._queryList=[];var e=this;gs.load("otherSearch",function(){e._asyncSearch()})}eU.inherits(cN,"Boundary");ey.extend(eU.prototype,{get:function(i,e){this._queryList.push({method:"get",arguments:[i,e]})},toString:function(){return"Boundary"},parsebdStr:function(i,e){}});function eM(i){i=i||{};i.renderOptions=i.renderOptions||{};this._opts={renderOptions:{map:i.renderOptions.map||null}};this._queryList=[];var e=this;gs.load("otherSearch",function(){e._asyncSearch()})}eM.inherits(cN,"LocalCity");ey.extend(eM.prototype,{get:function(e){this._queryList.push({method:"get",arguments:[e]})},toString:function(){return"LocalCity"}});function gE(e,T){cN.call(this);this.markersList=[];this.destList=[];this.pointsList=[];this._opts=T;this.json=e;this.map=this._opts.renderOptions.map||null;this.sType=this._opts.sType;this.infoWindow=null;this.curPointIndex=0;this.startName="";this.endIndex=1;this.endName="";this.resCity=[0,0,0,0,0,0,0];this.locPois=[];this.curPageIndex=[1,1,1,1,1,1,1];this.totalPage=[1,1,1,1,1,1,1];this.resCount=[0,0,0,0,0,0,0];this.resType=[0,0,0,0,0,0,0];this.qInfo=[{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1}];this.curSelectedIndex=-1;this.tpList=[];this.tpListInMap=[];var i=this;gs.load("route",function(){})}gE.inherits(cN,"RouteAddr");function d9(T,i){az.call(this,T,i);this.QUERY_TYPE_BUSLIST=cR;this.RETURN_TYPE_BUSLIST=cu;this.QUERY_TYPE_BUSLINE=dY;this.RETURN_TYPE_BUSLINE=dM;this._queryList=[];var e=this;gs.load("buslineSearch",function(){e._asyncSearch()})}var fa=w.staticHost+"/wolfman/static/common/images/";d9._iconOpen=w.apiIMG+"/iw_plus.gif";d9._iconClose=w.apiIMG+"/iw_minus.gif";d9._stopUrl=fa+"new/bus-stop-1x_ddd4723.png";d9.inherits(az,"BusLineSearch");ey.extend(d9.prototype,{getBusList:function(e){this._queryList.push({method:"getBusList",arguments:[e]})},getBusLine:function(e){this._queryList.push({method:"getBusLine",arguments:[e]})},setGetBusListCompleteCallback:function(e){this._opts.onGetBusListComplete=e||function(){}},setGetBusLineCompleteCallback:function(e){this._opts.onGetBusLineComplete=e||function(){}},setBusListHtmlSetCallback:function(e){this._opts.onBusListHtmlSet=e||function(){}},setBusLineHtmlSetCallback:function(e){this._opts.onBusLineHtmlSet=e||function(){}},setPolylinesSetCallback:function(e){this._opts.onPolylinesSet=e||function(){}}});function ig(i){az.call(this,i);i=i||{};this._options={input:i.input||null,baseDom:i.baseDom||null,types:i.types||[],onSearchComplete:i.onSearchComplete||function(){}};this._loc.src=i.location||"全国";this._word="";this._show=false;this._suggestion=null;this._inputValue="";this._initialize();var e=this;gs.load("autocomplete",function(){e._asyncSearch()},true)}ig.inherits(az,"Autocomplete");ey.extend(ig.prototype,{_initialize:function(){},show:function(){this._show=true},hide:function(){this._show=false},setTypes:function(e){this._options.types=e},setLocation:function(e){this._loc.src=e},search:function(e){this._word=e},setInputValue:function(e){this._inputValue=e},setSearchCompleteCallback:function(e){this._options.onSearchComplete=e}});var iT=function(i,e){az.call(this,i,e)};ey.inherit(iT,az,"BaseRoute");ey.extend(iT.prototype,{clearResults:function(){}});window.BMAP_TRANSIT_POLICY_RECOMMEND=0;window.BMAP_TRANSIT_POLICY_LEAST_TIME=4;window.BMAP_TRANSIT_POLICY_LEAST_TRANSFER=1;window.BMAP_TRANSIT_POLICY_LEAST_WALKING=2;window.BMAP_TRANSIT_POLICY_AVOID_SUBWAYS=3;window.BMAP_TRANSIT_POLICY_FIRST_SUBWAYS=5;window.BMAP_LINE_TYPE_BUS=0;window.BMAP_LINE_TYPE_SUBWAY=1;window.BMAP_LINE_TYPE_FERRY=2;window.BMAP_LINE_TYPE_TRAIN=3;window.BMAP_LINE_TYPE_AIRPLANE=4;window.BMAP_LINE_TYPE_COACH=5;var hC=3;var dK=4;var ab=1;var hA=2;var aN=5;var cw=6;window.BMAP_TRANSIT_TYPE_IN_CITY=0;window.BMAP_TRANSIT_TYPE_CROSS_CITY=1;window.BMAP_TRANSIT_PLAN_TYPE_ROUTE=0;window.BMAP_TRANSIT_PLAN_TYPE_LINE=1;window.BMAP_TRANSIT_TYPE_POLICY_TRAIN=0;window.BMAP_TRANSIT_TYPE_POLICY_AIRPLANE=1;window.BMAP_TRANSIT_TYPE_POLICY_COACH=2;window.BMAP_INTERCITY_POLICY_LEAST_TIME=0;window.BMAP_INTERCITY_POLICY_EARLY_START=1;window.BMAP_INTERCITY_POLICY_CHEAP_PRICE=2;function en(T,i){iT.call(this,T,i);i=i||{};this.setPolicy(i.policy);this.setIntercityPolicy(i.intercityPolicy);this.setTransitTypePolicy(i.transitTypePolicy);this.setPageCapacity(i.pageCapacity);this.QUERY_TYPE=gp;this.RETURN_TYPE=et;this.ROUTE_TYPE=gZ;this._overlays=[];this._curIndex=-1;this._opts._enableTraffic=i.enableTraffic||false;this._queryList=[];var e=this;gs.load("route",function(){e._asyncSearch()},true)}en.MAX_PAGE_CAPACITY=100;en.LINE_TYPE_MAPPING=[0,1,0,0,0,0,0,0,2,0,0,0,1,1,1];en.LINE_TYPE_MAPPING_CROSS_CITY=[0,3,4,0,0,0,5];ey.inherit(en,iT,"TransitRoute");ey.extend(en.prototype,{setPolicy:function(e){if(e>=BMAP_TRANSIT_POLICY_RECOMMEND&&e<=BMAP_TRANSIT_POLICY_FIRST_SUBWAYS){this._opts.policy=e}else{this._opts.policy=BMAP_TRANSIT_POLICY_RECOMMEND}},setIntercityPolicy:function(e){if(e>=BMAP_INTERCITY_POLICY_LEAST_TIME&&e<=BMAP_INTERCITY_POLICY_CHEAP_PRICE){this._opts.intercityPolicy=e}else{this._opts.intercityPolicy=BMAP_INTERCITY_POLICY_LEAST_TIME}},setTransitTypePolicy:function(e){if(e>=BMAP_TRANSIT_TYPE_POLICY_TRAIN&&e<=BMAP_TRANSIT_TYPE_POLICY_COACH){this._opts.transitTypePolicy=e}else{this._opts.transitTypePolicy=BMAP_TRANSIT_TYPE_POLICY_TRAIN}},_internalSearch:function(i,e){this._queryList.push({method:"_internalSearch",arguments:[i,e]})},search:function(i,e){this._queryList.push({method:"search",arguments:[i,e]})},setPageCapacity:function(e){if(typeof e==="string"){e=parseInt(e,10);if(isNaN(e)){this._opts.pageCapacity=en.MAX_PAGE_CAPACITY;return}}if(typeof e!=="number"){this._opts.pageCapacity=en.MAX_PAGE_CAPACITY;return}if(e>=1&&e<=en.MAX_PAGE_CAPACITY){this._opts.pageCapacity=Math.round(e)}else{this._opts.pageCapacity=en.MAX_PAGE_CAPACITY}},toString:function(){return"TransitRoute"},_shortTitle:function(e){return e.replace(/\(.*\)/,"")}});window.BMAP_HIGHLIGHT_STEP=1;window.BMAP_HIGHLIGHT_ROUTE=2;var cl=function(e,jj){iT.call(this,e,jj);this._overlays=[];this._curIndex=-1;this._queryList=[];var T=this;var i=this._opts.renderOptions;if(i.highlightMode!==BMAP_HIGHLIGHT_STEP&&i.highlightMode!==BMAP_HIGHLIGHT_ROUTE){i.highlightMode=BMAP_HIGHLIGHT_STEP}this._enableDragging=this._opts.renderOptions.enableDragging?true:false;gs.load("route",function(){T._asyncSearch()},true);if(this.init_d){this.init_d()}};cl.ROAD_TYPE=["","环岛","无属性道路","主路","高速连接路","交叉点内路段","连接道路","停车场内部道路","服务区内部道路","桥","步行街","辅路","匝道","全封闭道路","未定义交通区域","POI连接路","隧道","步行道","公交专用道","提前右转道"];ey.inherit(cl,iT,"DWRoute");ey.extend(cl.prototype,{search:function(T,e,i){this._queryList.push({method:"search",arguments:[T,e,i]})}});window.BMAP_DRIVING_POLICY_DEFAULT=0;window.BMAP_DRIVING_POLICY_AVOID_HIGHWAYS=3;window.BMAP_DRIVING_POLICY_FIRST_HIGHWAYS=4;window.BMAP_DRIVING_POLICY_AVOID_CONGESTION=5;window.BMAP_TRAFFICE_STATUS_NONE=0;window.BMAP_TRAFFICE_STATUS_NORMAL=1;window.BMAP_TRAFFICE_STATUS_SLOW=2;window.BMAP_TRAFFICE_STATUS_JAM=3;function b9(e,i){cl.call(this,e,i);i=i||{};this._opts._enableTraffic=i.enableTraffic||false;this.setPolicy(i.policy);this.QUERY_TYPE=aF;this.RETURN_TYPE=au;this.ROUTE_TYPE=BMAP_ROUTE_TYPE_DRIVING}ey.inherit(b9,cl,"DrivingRoute");b9.prototype.setPolicy=function(e){if(e>=BMAP_DRIVING_POLICY_DEFAULT&&e<=BMAP_DRIVING_POLICY_AVOID_CONGESTION){this._opts.policy=e}else{this._opts.policy=BMAP_DRIVING_POLICY_DEFAULT}};function eZ(e,i){cl.call(this,e,i);this.QUERY_TYPE=ht;this.RETURN_TYPE=fK;this.ROUTE_TYPE=BMAP_ROUTE_TYPE_WALKING;this._enableDragging=false}ey.inherit(eZ,cl,"WalkingRoute");function cK(e,i){cl.call(this,e,i);this.QUERY_TYPE=gU;this.ROUTE_TYPE=BMAP_ROUTE_TYPE_RIDING;this._enableDragging=false}ey.inherit(cK,cl,"RidingRoute");window.BMAP_MODE_DRIVING="driving";window.BMAP_MODE_TRANSIT="transit";window.BMAP_MODE_WALKING="walking";window.BMAP_MODE_NAVIGATION="navigation";var aT={web:"//api.map.baidu.com/direction?",android:"bdapp://map/direction?",ios:"baidumap://map/direction?"};function hX(e){this.opts=e||{}}ey.extend(hX.prototype,{routeCall:function(jj,e,T){var i=this;gs.load("route",function(){i._asyncSearch(jj,e,T)})}});function dJ(){return Pano.getStreetViewCoverageLayer(bp)}function ep(){Pano.PanoramaService.call(this)}ey.inherit(ep,Pano.PanoramaService,"PanoramaService");ey.extend(ep.prototype,{getPanoramaById:function(T,i){var e=this;this.getPanoById(T,function(jj){i&&i(e._makeData(jj))})},getPanoramaByLocation:function(e,T){e=il.convertLL2MC(e);var i=this;this.getPanoByLocation(e,50,function(jj){T&&T(i._makeData(jj))})},_makeData:function(T){if(!T){return null}var i={};var e=T.content[0];i.description=e.Rname||e.Info||"";i.id=e.ID;i.pointX=e.X/100;i.pointY=e.Y/100;i.position=il.convertMC2LL(new cg(i.pointX,i.pointY));return i}});function eP(){if(window.PANORAMA_URL){return Pano.getPanoControl(bp,{imgPath:w.imgPath,tileBaseUrl:w.panoTilePath,})}return Pano.getPanoControl(bp)}function J(T,e){if(!e){return}this.content=T;if(e.position&&!Array.isArray(e.position)){e.position=il.convertLL2MC(e.position);this.position=e.position;this.hideDistance=!!e.hideDistance}else{this.hideDistance=true}var i=this._createDom();Pano.PanoOverlay.call(this,e.position,{dom:i,altitude:e.altitude,})}ey.inherit(J,Pano.PanoOverlay,"PanoramaLabel");ey.extend(J.prototype,{init:function(e){var i=this;this._pano=e;this.updatedDistance();Pano.PanoOverlay.prototype.init.call(this,e);this._pano.on("dataload",function(T){i.updatedDistance()})},_createDom:function(){var jj=this.content;var jm=document.createElement("div");var i=jm.style;i.position="absolute";i.backgroundColor="rgba(29, 29, 29, 0.8)";i.padding="7px 0";i.height="19px";i.font="16px arial";i.color="white";i.whiteSpace="nowrap";i.borderRadius="4px";var e=document.createElement("div");e.style["float"]="left";e.style["lineHeight"]="19px";jm.appendChild(e);var T=document.createElement("span");T.style.margin="0 14px";T.innerText=jj;e.appendChild(T);if(!this.hideDistance){var jl=document.createElement("span");jl.style.color="color:rgba(255,255,255,0.3)";jl.innerText="|";e.appendChild(jl);var jk=document.createElement("span");jk.style.margin="0 8px";jk.style.color="#60c7fa";jk.style.fontSize="12px";jk.innerText="0米";e.appendChild(jk);this._distanceDom=jk}this._dom=jm;this._titleDom=T;return jm},updatedDistance:function(){if(this.hideDistance){return}var T=0;if(this._pano){var i=this._pano.position;var e=this.position;if(i&&!i.equals(e)){T=il.getDistanceByMC(i,e)}}if(T>100){T=T/1000;T=T<100?T.toFixed(2):T.toFixed(0);T+="公里"}else{T=T<100?T.toFixed(2):T.toFixed(0);T+="米"}this._distanceDom.innerText=T},});function c(i){if(typeof i==="string"&&/^(?!#)(\w)*/.test(i)){i="#"+i}var jj={};if(window.PANORAMA_URL){jj.imgPath=w.imgPath;jj.tileBaseUrls=[w.panoTilePath]}var e=Pano.init(i,jj);var T=e.setPosition;e.setPosition=function(jl){var jm=il.convertLL2MC(jl);T.call(e,jm)};var jk=e.addEventListener;e.addEventListener=function(jl,jm){if(jl==="position_changed"){jk.call(e,jl,function(jn){var jo=il.convertMC2LL(jn);jm(jo)})}else{jk.call(e,jl,jm)}};return e}bp.Map=g5;bp.MapType=dU;bp.Point=cg;bp.Pixel=eS;bp.Size=id;bp.Bounds=hk;bp.PrivateRegionDataModel=cs;bp.TileLayer=gS;bp.Copyright=h;bp.Projection=bp.Project=il;bp.XYZProjection=bp.XYZProject=de;bp.Convertor=fp;bp.RenderTypeUtils=cL;bp.Overlay=aI;bp.Label=hd;bp.Marker=r;bp.Symbol=eQ;bp.SVGSymbol=dn;bp.Icon=iD;bp.Polyline=bd;bp.BezierCurve=co;bp.PolylineMultipart=dW;bp.Polygon=hW;bp.MapMask=i7;bp.Prism=bj;bp.Marker3D=dN;bp.GroundOverlay=fv;bp.InfoWindow=dF;bp.SimpleInfoWindow=hn;bp.Circle=aL;bp.Control=ga;bp.NavigationControl=iP;bp.NavigationControl3D=eA;bp.CopyrightControl=fA;bp.ScaleControl=ji;bp.CityListControl=bk;bp.MapTypeControl=u;bp.ZoomControl=ip;bp.LocationControl=fS;bp.LogoControl=bs;bp.DistanceTool=b1;bp.ContextMenu=gJ;bp.MenuItem=hi;bp.OperationMask=ae;bp.Animation=e8;bp.ViewAnimation=n;bp.Transitions=f3;bp.Event=ff;bp.trafficLayer=iM;bp.TrafficLayer=iu;bp.GeoJSONLayer=aE;bp.XYZLayer=i8;bp.PixelLayer=c6;bp.GeoJSONParse=fZ;bp.BaiduLayer=O;bp.Geolocation=cC;bp.Geocoder=a7;bp.Boundary=eU;bp.DistrictLayer=dC;bp.LocalCity=eM;bp.LocalSearch=ci;bp.Autocomplete=ig;bp.BusLineSearch=d9;bp.WalkingRoute=eZ;bp.RidingRoute=cK;bp.DrivingRoute=b9;bp.TransitRoute=en;bp.RouteSearch=hX;bp.PanoramaCoverageLayer=dJ;bp.PanoramaControl=eP;bp.PanoramaService=ep;bp.PanoramaLabel=J;bp.Panorama=c;function gB(e,i){for(var T in i){e[T]=i[T]}}bp.fetchDebug&&bp.fetchDebug.init();bp.verify();bp.apiLoad();bp.frequency();bp.getSeckeyCid();window._layer=1;ey.extend(dC.prototype,{_asyncSearch:function(){for(var T=0,e=this._queryList.length;T<e;T++){var jj=this._queryList[T];this[jj.method].apply(this,jj.arguments)}delete this._queryList},addDistrict:function(){if(this._opts.districts){var e=this._opts.districts;if(typeof e==="string"){this.getDistrictData(e)}else{if(Object.prototype.toString.call(e)==="[object Array]"){var i=this.parseArrayParams(e);this.getDistrictData(i)}}}},parseArrayParams:function(e){var jk="";for(var jj=0;jj<e.length;jj++){if(e[jj] instanceof Array){jk+="(";for(var T=0;T<e.length;T++){jk+=e[T]}jk+=")"}else{jk+="("+e[jj]+")"}}return jk},getDistrictData:function(e){var i=this;i4.request(function(jj){var T=i._parseGeoData(jj);i._drawToMap(i,T)},{qt:iN,adnames:e,level:i._opts.kind})},_drawToMap:function(js,jo){var jr=jo.boundaries.length;if(jr===0){alert("未能获取当前输入行政区域");return}var jt=this._config.fillColor;var jl=this._config.fillOpacity;var T=this._config.strokeColor;var e=this._config.strokeOpacity;var jp=this._config.strokeWeight;if(typeof jt==="string"){var jj=jt;var ju=[];for(var jn=0;jn<jr;jn++){var jq=new BMapGL.Polygon(jo.boundaries[jn],{strokeWeight:jp,strokeColor:T,strokeOpacity:e,fillColor:jj,fillOpacity:jl});jq.style={strokeWeight:jp,strokecolor:T,strokeOpacity:e,fillColor:jj,fillOpacity:jl};this.disOverlays.push(jq);this.addEventListenerIn();js._map.addOverlay(jq);ju=ju.concat(jq.getPath())}if(this._config.viewport){js._map.setViewport(ju)}}else{if(Object.prototype.toString.call(jt)==="[object Array]"){var ju=[];var jm=jt.length;if(jm<jr){for(var jn=0,jk=0;jn<jr-jm;jn++){if(jk<jm-1){jt.push(jt[jk++])}else{jt.push(jt[0])}}}for(var jn=0;jn<jr;jn++){var jj=jt[jn];var jq=new BMapGL.Polygon(jo.boundaries[jn],{strokeWeight:jp,strokeColor:T,strokeOpacity:e,fillColor:jj,fillOpacity:jl});jq.style={strokeWeight:jp,strokecolor:T,strokeOpacity:e,fillColor:jj,fillOpacity:jl};this.disOverlays.push(jq);this.addEventListenerIn();js._map.addOverlay(jq);ju=ju.concat(jq.getPath())}if(this._config.viewport){js._map.setViewport(ju)}}}},_parseGeoData:function(js){var jv={};jv.boundaries=[];if(js&&js.content&&js.content["geo"]){for(var jA=0;jA<js.content["geo"].length;jA++){var jj=by.parseGeo(js.content["geo"][jA],false);if(jj.geo&&jj.geo.length&&jj.geo.length>0){var jy=jj.geo.length;for(iA=0;iA<jy;iA++){var T=jj.geo[iA];if(T&&T.length&&T.length>0){var jq=T.length-1;var jx=[];var jp=false;var jw=0;var ju=0;for(var jz=0;jz<jq;jz+=2){var jn=T[jz];var jl=T[jz+1];var jt=new cg(jn,jl);jt=il.convertMC2LL(jt);if(jz<jq-3){var i=T[jz+2];var e=T[jz+3];var jr=new cg(i,e);jr=il.convertMC2LL(jr)}jx.push(jt.lng+", "+jt.lat)}if(jp===true){if(jw>ju){var jB=jw;jw=ju;ju=jB}var jo=jx;var jm=jx.splice(jw+1);var jk=jm.splice(ju-jw);jo=jo.concat(jk);jv.boundaries.push(jo.join(";"));jv.boundaries.push(jm.join(";"));jp=false;continue}if(jx.length!==0){jv.boundaries.push(jx.join(";"))}}}}}}return jv},deleteDistrict:function(jj){var T=jj.disOverlays;for(var e=0;e<T.length;e++){this._map.removeOverlay(T[e])}},addEventListener:function(e,i){this.eventAndCallback[e]=i},addEventListenerIn:function(){var jj=this;var jl=Object.keys(jj.eventAndCallback);if(jl.length>0){for(var T=0;T<jl.length;T++){var jk=jj.eventAndCallback[jl[T]];for(var e=0;e<jj.disOverlays.length;e++){jj.disOverlays[e].addEventListener(jl[T],jk)}}}},searchBoundary:function(i,jk){i=i||{};var e=i.name||"";var T=i.kind||0;var jj=this;i4.request(function(jm){var jl=jj._parseGeoData(jm);jk&&jk(jl)},{qt:iN,adnames:e,level:T})}});window._layer=2;})(BMapGL,"BMapGL");