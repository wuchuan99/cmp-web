<template>
  <div class="vul-charts">
    <div class="vul-charts-container">
      <div>
        <new-chart
          :ref="deviceVendorRef"
          :option="vendorOption"
          :isClick="true"
        ></new-chart>
      </div>
      <div>
        <new-chart
          :ref="vulTypeRef"
          :option="typeOption"
          :isClick="true"
        ></new-chart>
      </div>
      <div>
        <new-chart
          :ref="vulLevel"
          :option="levelOption"
          :isClick="true"
        ></new-chart>
      </div>
      <div>
        <new-chart
          :ref="vulRef"
          :option="vulOption"
          :isClick="true"
        ></new-chart>
      </div>
    </div>
  </div>
</template>
<script>
import { chartMixins } from "../mixins/js/chart-options";
import { chartMap } from "../mixins/js/chart-list";
export default {
  data() {
    return {
      deviceVendorRef: "deviceVendorChart",
      vulLevel: "levelChart",
      vulTypeRef: "typeChart",
      weakPasswordRef: "weakPasswordChart",
      vulRef: "vulChart"
    };
  },
  mixins: [chartMixins],
  methods: {
    chartInit() {
      for (const [ref, { seriesType, method, option }] of chartMap) {
        if (!seriesType || !this[ref] || !method || !this[option]) continue;
        if (!this.$refs[this[ref]]) continue;
        this.$refs[this[ref]].loading = true;
        const params = { topN: 10 };
        method(params).then(res => {
          const { success, data } = res.data;
          if (success) {
            if (seriesType === "bar") this.setBarOption(option, data);
            else if (seriesType === "pie") this.setPieOption(option, data);
            else if (seriesType === "radar") this.setRadarOption(option, data);
            this.$refs[this[ref]].initChart();
          }
        });
      }
    },
    setBarOption(option, data) {
      if (data?.dataAxis) this[option].xAxis.data = data?.dataAxis;
      if (data?.data) this[option].series[0].data = data?.data;
    },
    setPieOption(option, data) {
      if (data?.pieDatas) this[option].series[0].data = data?.pieDatas;
    },
    setRadarOption(option, data) {
      if (data?.dataAxis)
        this[option].radar.indicator = data.dataAxis.map(item => ({
          text: item
        }));
      if (data?.data) {
        this[option].series[0].data[0].value = data.data;
        this[option].series[0].data[0].labels = data?.dataAxis || [];
      }
    }
  },
  mounted() {
    this.chartInit();
  }
};
</script>
<style lang="scss" scoped>
.vul-charts {
  .vul-charts-container {
    display: flex;
    width: 100%;
    height: 100%;
    background-color: white;
    box-shadow: 0px 2px 7px 0px rgba(0, 0, 0, 0.17);
    & > div {
      width: 400px;
      border-right: 1px solid #e4e6e7;
      // padding-top: 20px;
    }
  }
}
</style>
