<template>
  <div class="weak-password">
    <div class="header">
      <div class="operation">
        <new-button
          type="add"
          @click="handle({ action: 'openDrawer', ref: 'operate', type: 'add' })"
          >新增</new-button
        >
        <new-search
          class="search"
          v-model="queryParams.keyword"
          @click="handle({ action: 'search' })"
        />
      </div>
    </div>
    <div class="main">
      <new-table
        :border="true"
        :columns="table.columns"
        :data="records"
        :loading="loading"
      />
    </div>
    <operate ref="operate" @update="update" />
    <check ref="check" @update="update" />
  </div>
</template>
<script>
import { debounce } from "@/utils/common";
import operate from "./components/operate.vue";
import check from "./components/check.vue";
export default {
  components: { operate, check },
  data() {
    return {
      loading: false,
      table: {
        columns: [
          { type: "index", label: "序号", width: 80 },
          { prop: "name", label: "名称" },
          { prop: "level", label: "风险等级" },
          {
            prop: "assets",
            label: "风险资产",
            render: scope => {
              return (
                <span
                  style="text-decoration: underline;color: #135BD2;cursor: pointer;"
                  onclick={() =>
                    this.handle({
                      action: "openDrawer",
                      ref: "check",
                      type: "view",
                      data: scope.row
                    })
                  }
                >
                  {scope.row.assets}
                </span>
              );
            }
          },
          {
            label: "操作",
            width: "280",
            showOverflowTooltip: false,
            render: scope => {
              return (
                <div class="cell-operation">
                  <span
                    class="primary"
                    onclick={() => {
                      this.handle({
                        action: "openDrawer",
                        ref: "check",
                        type: "edit",
                        data: scope.row
                      });
                    }}
                  >
                    验证
                  </span>
                  <span
                    class="primary margin-left-15"
                    onclick={() => {
                      this.handle({
                        action: "openDrawer",
                        ref: "operate",
                        type: "edit",
                        data: scope.row
                      });
                    }}
                  >
                    编辑字典
                  </span>
                </div>
              );
            }
          }
        ]
      },
      records: [
        {
          id: 1,
          name: "xxxxx",
          level: "超危",
          assets: 2
        }
      ],
      queryParams: {
        keyword: ""
      }
    };
  },
  created() {},
  mounted() {},
  methods: {
    handle: debounce(function(context) {
      this[context.action] && this[context.action](context);
    }, 200),
    openDrawer({ ref, type, data }) {
      this.$refs[ref].show({ type, row: data });
    },
    update(data) {
      console.log(data);
    },
    search() {
      console.log(this.queryParams.keyword);
    }
  }
};
</script>
<style lang="scss" scoped>
@import "~@/style/mixin.scss";
.weak-password {
  height: 100%;
  padding: 25px 0;
  .header {
    @include flex-end;
    background-color: white;
    height: 75px;
    width: 100%;
    box-shadow: 0px 2px 7px 0px rgba(0, 0, 0, 0.17);
    padding: 20px;
    .operation {
      @include flex-start;
      .search {
        margin-left: 15px;
      }
    }
  }
  .main {
    padding: 20px;
    margin-top: 16px;
    height: calc(100% - 92px);
    background-color: white;
    box-shadow: 0px 2px 7px 0px rgba(0, 0, 0, 0.17);
  }
}
</style>
